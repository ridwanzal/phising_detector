escapeJSONChar=function escapeJSONChar(B){if(B=='"'||B=="\\"){return"\\"+B}else{if(B=="\b"){return"\\b"}else{if(B=="\f"){return"\\f"}else{if(B=="\n"){return"\\n"}else{if(B=="\r"){return"\\r"}else{if(B=="\t"){return"\\t"}}}}}}var A=B.charCodeAt(0).toString(16);if(A.length==1){return"\\u000"+A}else{if(A.length==2){return"\\u00"+A}else{if(A.length==3){return"\\u0"+A}else{return"\\u"+A}}}};escapeJSONString=function escapeJSONString(B){var C=B.split("");for(var A=0;A<C.length;A++){var D=C[A];if(D=='"'||D=="\\"||D.charCodeAt(0)<32||D.charCodeAt(0)>=128){C[A]=escapeJSONChar(C[A])}}return'"'+C.join("")+'"'};toJSON=function toJSON(C){if(C==null){return"null"}else{if(C.constructor==String){return escapeJSONString(C)}else{if(C.constructor==Number){return C.toString()}else{if(C.constructor==Boolean){return C.toString()}else{if(C.constructor==Date){return'{javaClass: "java.util.Date", time: '+C.valueOf()+"}"}else{if(C.constructor==Array){var A=[];for(var B=0;B<C.length;B++){A.push(toJSON(C[B]))}return"["+A.join(", ")+"]"}else{var A=[];for(attr in C){if(C[attr]==null){A.push('"'+attr+'": null')}else{if(typeof C[attr]=="function"){}else{A.push(escapeJSONString(attr)+": "+toJSON(C[attr]))}}}return"{"+A.join(", ")+"}"}}}}}}};JSONRpcClient=function JSONRpcClient_ctor(B,C){this.serverURL=B;if(C){this._addMethods(C)}else{if(this.objectID){this._addMethods(["listMethods"]);var D=this._makeRequest("listMethods",[])}else{this._addMethods(["system.listMethods"]);var D=this._makeRequest("system.listMethods",[])}var A=this._sendRequest(D);this._addMethods(A)}};JSONRpcClient.Exception=function JSONRpcClient_Exception_ctor(E,D,C){this.code=E;var B;if(C){this.javaStack=C;var A=C.match(/^([^:]*)/);if(A){B=A[0]}}if(B){this.name=B}else{this.name="JSONRpcClientException"}this.message=D};JSONRpcClient.Exception.CODE_REMOTE_EXCEPTION=490;JSONRpcClient.Exception.CODE_ERR_CLIENT=550;JSONRpcClient.Exception.CODE_ERR_PARSE=590;JSONRpcClient.Exception.CODE_ERR_NOMETHOD=591;JSONRpcClient.Exception.CODE_ERR_UNMARSHALL=592;JSONRpcClient.Exception.CODE_ERR_MARSHALL=593;JSONRpcClient.Exception.prototype=new Error();JSONRpcClient.Exception.prototype.toString=function JSONRpcClient_Exception_toString(A,B){return this.name+": "+this.message};JSONRpcClient.default_ex_handler=function JSONRpcClient_default_ex_handler(A){};JSONRpcClient.toplevel_ex_handler=JSONRpcClient.default_ex_handler;JSONRpcClient.profile_async=false;JSONRpcClient.max_req_active=1;JSONRpcClient.requestId=1;JSONRpcClient.prototype._createMethod=function JSONRpcClient_createMethod(A){var B=function(){var C=[];var F=null;for(var D=0;D<arguments.length;D++){C.push(arguments[D])}if(typeof C[0]=="function"){F=C.shift()}var E=B.client._makeRequest.call(B.client,B.methodName,C,F);if(F==null){return B.client._sendRequest.call(B.client,E)}else{JSONRpcClient.async_requests.push(E);JSONRpcClient.kick_async();return E.requestId}};B.client=this;B.methodName=A;return B};JSONRpcClient.prototype._addMethods=function JSONRpcClient_addMethods(C){for(var B=0;B<C.length;B++){var E=this;var D=C[B].split(".");for(var G=0;G<D.length-1;G++){var A=D[G];if(E[A]){E=E[A]}else{E[A]=new Object();E=E[A]}}var A=D[D.length-1];if(!E[A]){var F=this._createMethod(C[B]);E[A]=F}}};JSONRpcClient._getCharsetFromHeaders=function JSONRpcClient_getCharsetFromHeaders(A){try{var E=A.getResponseHeader("Content-type");var D=E.split(/\s*;\s*/);for(var B=0;B<D.length;B++){if(D[B].substring(0,8)=="charset="){return D[B].substring(8,D[B].length)}}}catch(C){}return"UTF-8"};JSONRpcClient.async_requests=[];JSONRpcClient.async_inflight={};JSONRpcClient.async_responses=[];JSONRpcClient.async_timeout=null;JSONRpcClient.num_req_active=0;JSONRpcClient._async_handler=function JSONRpcClient_async_handler(){JSONRpcClient.async_timeout=null;while(JSONRpcClient.async_responses.length>0){var A=JSONRpcClient.async_responses.shift();if(A.canceled){continue}if(A.profile){A.profile.dispatch=new Date()}try{A.cb(A.result,A.ex,A.profile)}catch(C){JSONRpcClient.toplevel_ex_handler(C)}}while(JSONRpcClient.async_requests.length>0&&JSONRpcClient.num_req_active<JSONRpcClient.max_req_active){var B=JSONRpcClient.async_requests.shift();if(B.canceled){continue}B.client._sendRequest.call(B.client,B)}};JSONRpcClient.kick_async=function JSONRpcClient_kick_async(){if(JSONRpcClient.async_timeout==null){JSONRpcClient.async_timeout=setTimeout(JSONRpcClient._async_handler,0)}};JSONRpcClient.cancelRequest=function JSONRpcClient_cancelRequest(B){if(JSONRpcClient.async_inflight[B]){JSONRpcClient.async_inflight[B].canceled=true;return true}for(var A in JSONRpcClient.async_requests){if(JSONRpcClient.async_requests[A].requestId==B){JSONRpcClient.async_requests[A].canceled=true;return true}}for(var A in JSONRpcClient.async_responses){if(JSONRpcClient.async_responses[A].requestId==B){JSONRpcClient.async_responses[A].canceled=true;return true}}return false};JSONRpcClient.prototype._makeRequest=function JSONRpcClient_makeRequest(B,C,A){var D={};D.client=this;D.requestId=JSONRpcClient.requestId++;var E={};E.id=D.requestId;if(this.objectID){E.method=".obj#"+this.objectID+"."+B}else{E.method=B}E.params=C;if(A){D.cb=A}if(JSONRpcClient.profile_async){D.profile={submit:new Date()}}D.data=toJSON(E);return D};JSONRpcClient.prototype._sendRequest=function JSONRpcClient_sendRequest(C){if(C.profile){C.profile.start=new Date()}var B=JSONRpcClient.poolGetHTTPRequest();JSONRpcClient.num_req_active++;if(typeof (this.user)=="undefined"){B.open("POST",this.serverURL,(C.cb!=null))}else{B.open("POST",this.serverURL,(C.cb!=null),this.user,this.pass)}try{B.setRequestHeader("Content-type","text/plain")}catch(D){}if(C.cb){var A=this;B.onreadystatechange=function(){if(B.readyState==4){var E={cb:C.cb,result:null,ex:null};if(C.profile){E.profile=C.profile;E.profile.end=new Date()}try{E.result=A._handleResponse(B)}catch(F){E.ex=F}if(!JSONRpcClient.async_inflight[C.requestId].canceled){JSONRpcClient.async_responses.push(E)}delete JSONRpcClient.async_inflight[C.requestId];JSONRpcClient.kick_async()}}}else{B.onreadystatechange=function(){}}JSONRpcClient.async_inflight[C.requestId]=C;try{B.send(C.data)}catch(D){JSONRpcClient.poolReturnHTTPRequest(B);JSONRpcClient.num_req_active--;throw new JSONRpcClient.Exception(JSONRpcClient.Exception.CODE_ERR_CLIENT,"Connection failed")}if(!C.cb){return this._handleResponse(B)}};JSONRpcClient.prototype._handleResponse=function JSONRpcClient_handleResponse(http){if(!this.charset){this.charset=JSONRpcClient._getCharsetFromHeaders(http)}var status,statusText,data;try{status=http.status;statusText=http.statusText;data=http.responseText;if(data!=null){if(data.substr(0,2)=="/*"){data=data.substring(2,data.length-2)}}}catch(e){JSONRpcClient.poolReturnHTTPRequest(http);JSONRpcClient.num_req_active--;JSONRpcClient.kick_async();throw new JSONRpcClient.Exception(JSONRpcClient.Exception.CODE_ERR_CLIENT,"Connection failed")}JSONRpcClient.poolReturnHTTPRequest(http);JSONRpcClient.num_req_active--;if(status!=200){throw new JSONRpcClient.Exception(status,statusText)}var obj;try{eval("obj = "+data)}catch(e){throw new JSONRpcClient.Exception(550,"error parsing result")}if(obj.error){throw new JSONRpcClient.Exception(obj.error.code,obj.error.msg,obj.error.trace)}var res=obj.result;if(res&&res.objectID&&res.JSONRPCType=="CallableReference"){return new JSONRpcClient(this.serverURL,this.user,this.pass,res.objectID)}return res};JSONRpcClient.http_spare=[];JSONRpcClient.http_max_spare=8;JSONRpcClient.poolGetHTTPRequest=function JSONRpcClient_pool_getHTTPRequest(){if(JSONRpcClient.http_spare.length>0){return JSONRpcClient.http_spare.pop()}return JSONRpcClient.getHTTPRequest()};JSONRpcClient.poolReturnHTTPRequest=function JSONRpcClient_poolReturnHTTPRequest(A){if(JSONRpcClient.http_spare.length>=JSONRpcClient.http_max_spare){delete A}else{JSONRpcClient.http_spare.push(A)}};JSONRpcClient.msxmlNames=["MSXML2.XMLHTTP.5.0","MSXML2.XMLHTTP.4.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"];JSONRpcClient.getHTTPRequest=function JSONRpcClient_getHTTPRequest(){try{JSONRpcClient.httpObjectName="XMLHttpRequest";return new XMLHttpRequest()}catch(B){}for(var A=0;A<JSONRpcClient.msxmlNames.length;A++){try{JSONRpcClient.httpObjectName=JSONRpcClient.msxmlNames[A];return new ActiveXObject(JSONRpcClient.msxmlNames[A])}catch(B){}}JSONRpcClient.httpObjectName=null;throw new JSONRpcClient.Exception(0,"Can't create XMLHttpRequest object")};USAA.register("jsonrpc");USAA.register("jsonrpc-min");

USAA.namespace("USAA.ec.MultipleRatings");USAA.ec.MultipleRatings=(function(){var productIds=new Array();var productIdsObj=null;var ratingsResultBean=null;var jsonrpc=null;var duplicates=new Array();function fetchProductAndArticleIds(){var parsedIds=new Array();var divEls=document.getElementsByTagName("div");var j=0;var dupCount=0;var rr_id="rr_";for(i=0;i<divEls.length;i++){var temp=divEls[i].id;temp=temp.replace(/^\s+|\s+$/g,"");var templength=temp.length;if(templength>12&&temp.substring(0,12)=="rr_art_meta_"&&temp.substring(12,templength)!=""){if(!temp.match("rr_art_meta_rating_item_id")){parsedIds[j]=temp.substring(12,templength);j=j+1}}else{if(templength>11&&temp.substring(0,11)=="rr_article_"&&temp.substring(11,templength)!=""){parsedIds[j]=temp.substring(11,templength);j=j+1}else{if(templength>3&&temp.substring(0,3)=="rr_"&&temp.substring(3,templength)!=""){if(!temp.match("rr_art_meta_")&&!temp.match("rr_article_")&&!temp.match("_duplicate")){parsedIds[j]=temp.substring(3,templength);j=j+1}else{if(temp.match("_duplicate")){duplicates[dupCount]=temp;dupCount=dupCount+1}}}}}}eliminateDuplicates:for(var i=0,len=parsedIds.length;i<len;i++){for(var x=0,y=productIds.length;x<y;x++){if(productIds[x]==parsedIds[i]){continue eliminateDuplicates}}productIds[productIds.length]=parsedIds[i]}defaultInitAction()}function buildJsonObjectForIds(productIds){productIdsObj="{";for(var i=0;i<productIds.length;i++){productIdsObj=productIdsObj+"'productId"+(i+1)+"':'"+productIds[i]+"'";if(i==(productIds.length-1)){productIdsObj=productIdsObj+"}"}else{productIdsObj=productIdsObj+","}}}function dynMetaArticleSpan(productId,avgRating){var metaSpan=document.createElement("SPAN");var ratings="<img class='starrating' src='https://content.usaa.com/mcontent/static_assets/Media/bvrating-"+avgRating+".gif?cacheid=20110415' alt='Rating' />";metaSpan.innerHTML=ratings;divId=document.getElementById("rr_art_meta_"+productId);divId.appendChild(metaSpan)}function dynArticleSpan(index,productId,avgRating,placeHolder){var oTable=document.createElement("TABLE");var oTBody=document.createElement("TBODY");oTable.setAttribute("class","BVReviewTable");oTable.setAttribute("className","BVReviewTable");oTable.setAttribute("cellspacing","0");oTable.setAttribute("cellpadding","0");style="border: 1px solid #FFFFF;";oTable.border=0;var ratings=new Array("Rated <img  class='starrating' src='https://content.usaa.com/mcontent/static_assets/Media/bvrating-"+avgRating+".gif?cacheid=20110415' alt=' ' title=''/>","<strong>"+avgRating+"</strong>","&nbsp;<img class='ratingsDownArrow' onmouseover ='USAA.ec.MultipleRatings.divForTotalReviews("+index+',"'+placeHolder+"\")' onmouseout='USAA.ec.MultipleRatings.show_hide_popUp("+index+',"'+placeHolder+"\")' src='https://content.usaa.com/mcontent/static_assets/Media/bvrating-downarrow.gif' tabindex='0' onfocus='USAA.ec.MultipleRatings.divForTotalReviews("+index+',"'+placeHolder+"\")' onblur='USAA.ec.MultipleRatings.show_hide_popUp("+index+',"'+placeHolder+"\")' alt='Rating Distribution' title=''/>","&nbsp;by USAA Members");oTable.appendChild(oTBody);oRow=document.createElement("TR");oTBody.appendChild(oRow);for(var j=0;j<ratings.length;j++){oTd=document.createElement("TD");oTd.innerHTML=ratings[j];oRow.appendChild(oTd)}document.getElementById(placeHolder).appendChild(oTable)}function dynProductTable(index,productId,avgRating,totalReviews,reviewLink,placeHolder){var oTable=document.createElement("TABLE");var oTBody=document.createElement("TBODY");oTable.setAttribute("class","BVReviewTable");oTable.setAttribute("className","BVReviewTable");oTable.setAttribute("cellspacing","0");oTable.setAttribute("cellpadding","0");style="border: 1px solid #FFFFF;";oTable.border=0;var ratings=new Array("<img  class='starrating' src='https://content.usaa.com/mcontent/static_assets/Media/bvrating-"+avgRating+".gif?cacheid=20110415' alt='Rating' title=''/>","<strong>"+avgRating+"</strong>","&nbsp;<img class='ratingsDownArrow' onmouseover='USAA.ec.MultipleRatings.divForTotalReviews("+index+',"'+placeHolder+"\")' onmouseout='USAA.ec.MultipleRatings.show_hide_popUp("+index+',"'+placeHolder+"\")' src='https://content.usaa.com/mcontent/static_assets/Media/bvrating-downarrow.gif' tabindex='0' onfocus='USAA.ec.MultipleRatings.divForTotalReviews("+index+',"'+placeHolder+"\")' onblur='USAA.ec.MultipleRatings.show_hide_popUp("+index+',"'+placeHolder+"\")' alt='Rating Distribution' title=''/>","<a href='"+reviewLink+"' class='textInfo'>("+totalReviews+" Reviews)</a>");oTable.appendChild(oTBody);oRow=document.createElement("TR");oTBody.appendChild(oRow);for(var j=0;j<ratings.length;j++){oTd=document.createElement("TD");oTd.innerHTML=ratings[j];oRow.appendChild(oTd)}document.getElementById(placeHolder).appendChild(oTable)}function divForTotalReviews(index,placeHolder){var starCount=new Array("one","two","three","four","five");var distribution=new Array("Poor","Fair","Average","Good","Excellent");try{var dist=document.getElementById("BVratingsHistogramButtonPopin"+index+placeHolder);if(dist!=null&&dist!="undefined"){document.getElementById("BVratingsHistogramButtonPopin"+index+placeHolder).style.display="block";return }var _divMain=document.createElement("DIV");_divMain.setAttribute("class","BVratingsHistogramButtonPopin");_divMain.setAttribute("className","BVratingsHistogramButtonPopin");_divMain.setAttribute("id","BVratingsHistogramButtonPopin"+index+placeHolder);_divMain.style.display="block";var _divHist=document.createElement("DIV");_divHist.setAttribute("class","BVhistogram");_divHist.setAttribute("className","BVhistogram");_divMain.appendChild(_divHist);var _div0=document.createElement("DIV");_div0.setAttribute("class","BVhistTitle");_div0.setAttribute("className","BVhistTitle");div0=document.createTextNode("Rating Snapshot");_divHist.appendChild(_div0);var _span0=document.createElement("SPAN");_span0.appendChild(document.createTextNode("RATING DISTRIBUTION"));_div0.appendChild(_span0);var _div=document.createElement("DIV");_div.setAttribute("class","BVhistContent");_div.setAttribute("className","BVhistContent");_divHist.appendChild(_div);for(var j=5;j>0;j--){displayRatingDistribution(_div,j,eval("ratingsResultBean["+index+"]."+starCount[j-1]+"StarCount"),distribution[j-1],eval("ratingsResultBean["+index+"].totalReviews"))}if(document.getElementById(placeHolder)){document.getElementById(placeHolder).appendChild(_divMain)}}catch(e){}}function show_hide_popUp(count,placeHolder){document.getElementById("BVratingsHistogramButtonPopin"+count+placeHolder).style.display="none"}function displayRatingDistribution(parent,rowBegin,ratings,distributionCount,totalCount){try{result=Math.round((ratings/totalCount)*100);var _div1=document.createElement("DIV");_div1.setAttribute("class","BVhistBarRow");_div1.setAttribute("className","BVhistBarRow");parent.appendChild(_div1);var _span=document.createElement("SPAN");_span.setAttribute("class","BVhistStarLabel");_span.setAttribute("className","BVhistStarLabel");_span.appendChild(document.createTextNode(rowBegin));_div1.appendChild(_span);var _div2=document.createElement("DIV");_div2.setAttribute("class","BVhistBar");_div2.setAttribute("className","BVhistBar");_div1.appendChild(_div2);var _div3=document.createElement("DIV");_div3.setAttribute("class","BVhistFullBar");_div3.setAttribute("className","BVhistFullBar");_div3.style.width=result+"%";_div2.appendChild(_div3);var _span2=document.createElement("SPAN");_span2.setAttribute("class","BVhistAbsLabel");_span2.setAttribute("className","BVhistAbsLabel");_span2.appendChild(document.createTextNode("("+ratings+") "+distributionCount+""));_div1.appendChild(_span2)}catch(e){}}function getUrlParameter(name,link){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regexS="[\\?&]"+name+"=([^&#]*)";var regex=new RegExp(regexS);var results=regex.exec(link);if(results==null){return""}else{return results[1]}}var defaultInitAction=function(){if(productIds.length>0){buildJsonObjectForIds(productIds);productBean=eval("("+productIdsObj+")");try{jsonrpc=new JSONRpcClient("/inet/ent_ratings_reviews/MultipleProductRatingsServlet")}catch(err){}try{ratingsResultBean=jsonrpc.multipleProductRatings.multipleProductRatings(toJSON(productBean));starCount=new Array("one","two","three","four","five");distribution=new Array("Poor","Fair","Average","Good","Excellent");for(var i=0;i<ratingsResultBean.length;i++){if(ratingsResultBean[i].ratingStatus!=null&&ratingsResultBean[i].ratingStatus=="Success"&&ratingsResultBean[i].avgRating!="0.0"){if(document.getElementById("rr_"+ratingsResultBean[i].productId)!=null){var rl_id="rl_"+ratingsResultBean[i].productId;if(document.getElementById(rl_id)){document.getElementById("rr_"+ratingsResultBean[i].productId).style.display="block";var reviewsLink=document.getElementById(rl_id).href;var idgValue=getUrlParameter("idg",reviewsLink);if(idgValue!=null&&idgValue!=""){var rtValues=idgValue.split(",");var pageId=rtValues[2];var reviewsLink=reviewsLink.replace(pageId,"RatingsAndReviews")}dynProductTable(i,ratingsResultBean[i].productId,ratingsResultBean[i].avgRating,ratingsResultBean[i].totalReviews,reviewsLink,"rr_"+ratingsResultBean[i].productId)}}if(document.getElementById("rr_article_"+ratingsResultBean[i].productId)!=null){dynArticleSpan(i,ratingsResultBean[i].productId,ratingsResultBean[i].avgRating,"rr_article_"+ratingsResultBean[i].productId)}if(document.getElementById("rr_art_meta_"+ratingsResultBean[i].productId)!=null){dynMetaArticleSpan(ratingsResultBean[i].productId,ratingsResultBean[i].avgRating)}for(var k=0;k<duplicates.length;k++){if((duplicates[k]).match(ratingsResultBean[i].productId)){var rl_dup_id=duplicates[k].replace("rr_","rl_");if(document.getElementById(rl_dup_id)){document.getElementById(duplicates[k]).style.display="block";var reviewsLink=document.getElementById(rl_dup_id).href;var idgValue=getUrlParameter("idg",reviewsLink);if(idgValue!=null&&idgValue!=""){var rtValues=idgValue.split(",");var pageId=rtValues[2];var reviewsLink=reviewsLink.replace(pageId,"RatingsAndReviews")}dynProductTable(i,ratingsResultBean[i].productId,ratingsResultBean[i].avgRating,ratingsResultBean[i].totalReviews,reviewsLink,duplicates[k])}}}}}}catch(err){}}};return{init:fetchProductAndArticleIds,show_hide_popUp:show_hide_popUp,divForTotalReviews:divForTotalReviews}})();USAA.ec.MultipleRatings.init();USAA.register("multipleratings");USAA.register("multipleratings-min");


