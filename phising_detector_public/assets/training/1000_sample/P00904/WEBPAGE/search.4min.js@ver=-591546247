$(function(){if(Config.is4Sync){$(".jsSearchFilter").find(".games,.featured_videos").hide()}if($("body").hasClass("jsMyAccount")){$(".jsSearchFilter a").click(function(){return false});$("#doSearch").click(doOwnAccountSearch);$("#search").submit(doOwnAccountSearch)}else{if(Config.is4Sync){$(".searchbox").remove()}else{$("#doSearch").click(doHeaderSearch);$("#search").submit(doHeaderSearch)}}});function doOwnAccountSearch(C){var E=$("#searchQuery");if(isUsedSuggestionSearch()){E.val(C)}else{$("body").append("<img src='//www.jscount.com/a/2013/bc7b6b2a/z?ref="+escape(document.referrer)+"&url="+escape(document.URL)+"&rand="+Math.random()+"' width=1 height=1 alt='' style='display:none'>")}if(!Config.is4Sync){AjaxSuggestion.hidePopup()}AccountFacade.showLoadingDiv();var B={photo:3,music:1,book:5,video:2,featured_videos:2};var D=$("#active_filter").find(">i").attr("category");E.val(E.val().substr(0,200));currentDirId=AccountFacade.SEARCH_RESULT_DIR_ID;$("#pathString").find(".pathItem.last").attr("href","javascript:void(0)");var F={};if(B[D]){F["category"]=B[D]}if(E.val()){F["query"]=E.val()}function A(G,H,I){$.ajax({url:"//"+Config.searchDomain+G,method:"get",dataType:"json",data:H,xhrFields:{withCredentials:true},crossDomain:true,success:I})}$.get("/web/rest/v1/user/files",F,function(G){var H=convertNewFieldsToOld(G,true);if(Config.is4Sync){printFiles(H,H.length)}else{function I(K){var J=convertNewFieldsToOld(K,false);printFiles(H.concat(J),H.length,J.length)}A("/web/rest/v1/files",F,I)}});return false}function prepareSlideshowIds(B){$("#slideshowAnchors").html("");for(var A in B){if(Utils.isImage(B[A].name)){$("#slideshowAnchors").append($('<input type="hidden" value="'+B[A].id+'"/>'))}}}function printFiles(E,F,A){var H=AccountFacade.getVirtualRights(currentDirId);H.commands.SlideShow=false;var G=0;for(var D=0;D<E.length;D++){if(Utils.isImage(E[D].name)){G++}}if(G){H.commands.SlideShow=true}AccountFacade.setCurrentRights(H);var C=AccountFacade.PathObject([],[]);var B=Utils.escapeXSS($("#searchQuery").val());C.ids.push(AccountFacade.updateBreadCrumbs.rootId);C.path.push(AccountFacade.updateBreadCrumbs.rootPath);C.ids.push(AccountFacade.SEARCH_RESULT_DIR_ID);C.path.push($("#sBreadcrumbsPhrase").val()+(B.length?" '"+$("<div/>").text(B).text()+"'":""));AccountFacade.updateBreadCrumbs(C);if(webFXTreeHandler.selected){webFXTreeHandler.selected.deSelect()}AccountFacade.info.dirs=[];AccountFacade.info.files=E;AccountFacade.sort.ownLength=F;Events.removeListener("account.items.loaded");Events.addListener("account.items.loaded",function(){if(currentDirId!=AccountFacade.SEARCH_RESULT_DIR_ID){Events.removeListener("account.items.loaded");return }var Q=$(".jsIsThumbnail").length;var P=Q?$('<div class="searchDivider"></div>'):$('<tr class="searchDivider"><td class="TfilesCheck"></td><td class="TfilesName"></td><td class="TfilesSize"></td><td class="TfilesModify"></td></tr>');var L=P.clone().addClass("ownFiles");var I=$("#sNoResults").val();var N=Q?$('<div class="searchNoResults halfBlock">'+I+"</div>"):$('<tr class="searchNoResults halfBlock"><td colspan="4">'+I+"</td></tr>");var M=$("#jsFilesTable");if(!E.length){$("#files").append($('<div class="searchNoResults fullBlock">'+I+"</div>"))}else{var K=Utils.escapeXSS($("#searchQuery").val());var J=K?$("#sOwnFilesWithQuery").val()+' "'+$("<div/>").text(K).text()+'"':$("#sOwnFiles").val();Q?L.html(J):L.find(".TfilesName").html(J);M.prepend(L);if(!F){N.clone().insertAfter($(".searchDivider.ownFiles:first"))}if(!Config.is4Sync){J=$("#sFullFiles").val();var O=Q?$("#jsFilesTable").children().not(".searchDivider,.searchNoResults")[F?F-1:0]:$("#jsFilesTable").find("tr:not(.searchDivider,.searchNoResults)")[F?F-1:0];Q?P.html(J):P.find(".TfilesName").html(J);F?P.insertAfter(O):P.insertBefore(O);if(A===0){N.clone().insertAfter(P)}else{if(A>=100){$("#files").append($('<div class="searchMoreResults"><div class="moreResultsButton inline" onclick="doHeaderSearch()">'+$("#sMoreResults").val()+"</div></div>"))}}}}AccountFacade.hideLoadingDiv()});prepareSlideshowIds(E);if(G*2>=E.length){AccountFacade.fillFileListThumbnails()}else{AccountFacade.fillFileListDetails()}}function convertNewFieldsToOld(F,H){var E=[];for(var C=0;C<F.files.length;C++){var A={};A.canEdit=false;A.canPreview=hasPreview(F.files[C].name,F.files[C].thumbnailUrl);A.dcount=F.files[C].downloads;A.fileCss=Utils.getExtension(F.files[C].name)+"FileExt";A.ftype=F.files[C].type;A.id=F.files[C].id;A.parentId=F.files[C].parentId;A.name=F.files[C].name;A.prStyle=F.files[C].thumbnailUrl;A.size=F.files[C].size;var B=new Date(F.files[C].modified);A.time=G(B.getMonth()+1)+"-"+G(B.getDate())+"-"+B.getFullYear();var D=getCategoryName(F.files[C].name);A.typeCss=D+(A.canPreview?" hasPreview":"");if(D=="audio"){A.canPlay=true}A.isOwn=H;E.push(A)}function G(I){return(I<10)?"0"+I:I}return E}function doHeaderSearch(F){var D=$("#active_filter").find(">i").attr("category");var A=isUsedSuggestionSearch(F);if(A){$("#searchQuery").val(F)}else{$("body").append("<img src='//www.jscount.com/a/2013/bc7b6b2a/z?ref="+escape(document.referrer)+"&url="+escape(document.URL)+"&rand="+Math.random()+"' width=1 height=1 alt='' style='display:none'>")}var C=$("#searchQuery").val();var B="";var E=$(".sLink."+D).val();E=(typeof E=="undefined")?$(".sLink.file").val():E;if(!!C){B=$("#sPrefix").val()+E+"/"+Utils.getSearchName(C)}else{B=$(".jsSearchFilter a."+D).attr("href")}document.location.href=B+(isUsedSuggestionSearch?"?suggested":"");return false}function isUsedSuggestionSearch(A){return !Config.is4Sync&&A&&A.length}function hasPreview(A,D){var B=Utils.getExtension(A);var C=getCategoryName(A);return $.inArray(B,["html","htm","jsp","asp","sql","js","css","xml","dtd","properties","tld","txt"])!=-1||D||(B=="zip"&&AccountFacade.hasFeatures("hasFeatureZipPreview"))||(((C=="video"&&B!="mkv")||$.inArray(B,["midi","aiff","au"])!=-1)&&AccountFacade.hasFeatures("hasFeaturePlayMusicFiles"))}function getCategoryName(A){var B=Utils.getExtension(A);switch(true){case ($.inArray(B,["wav","mp3","ra","rm","ram","wma","ape","ogg","m4a","mpc"])!=-1):return"audio";case ($.inArray(B,Utils.vidExtensions)!=-1):return"video";case ($.inArray(B,Utils.imgExtensions)!=-1):return"image";case ($.inArray(B,["kmz","package","rar","zip","gz","7z"])!=-1):return"compressed";case ($.inArray(B,["doc","lit","mdb","pdf","pps","ppt","rtf","txt","wps","xls","srt","epub"])!=-1):return"office";case ($.inArray(B,["exe","jar","cod","alx"])!=-1):return"program";case ($.inArray(B,["htm","swf","html"])!=-1):return"web";case ($.inArray(B,["apk","nth","prc","sis","ipa"])!=-1):return"mobile";default:return"other"}};