/*
 rad_liquid_table-1.2.0.js
 Copyright (c) 2015 Rakuten.Inc
 Date : 2015-03-04 14:23:01
*/
(function(p,q){function r(i){var a=i.css("cssText");null==a&&(a="");i.css("cssText",a+"; display:none!important;")}if(p.jQuery!==q){jQuery.noConflict();var i=jQuery;if(i.RJS_Helpers){var s=function(n){var a=this;i.extend(a,{settings:{common:{url:["","Str","^https?://(?:[a-zA-Z0-9\\-]+\\.)+rakuten\\.co\\.jp/[a-zA-Z0-9!~_&='\\(\\)\\*\\?\\-\\.%/]+$"],maxitem:[0,"Range","0,9999"],maxrows:[0,"Range","0,9999"],minitem:[0,"Range","0,9999"],stretchable:[0,"Int","^[01]$"],itemalign:["left","Str","^(left|center)$"],
autocentering:[0,"Int","^[01]$"],chop:[0,"Int","^[01]$"],maxcount:[1E3,"Range","1,10000"],ajaxtimer:[99,"Range","1,99"],sid:["","Str","^[a-zA-Z0-9_\\-]{3,64}$"],event_target:["","Str",".+"],event_name:["","Str",".+"],config_debug:[0,"Int","^[01]$"],impvar:["","Str","^[a-zA-Z0-9_]{3,64}$"],impdisp:["","Str","^[a-zA-Z0-9_]{3,64}$"],impnodisp:["","Str","^[a-zA-Z0-9_]{3,64}$"]},rad:{blankimageurl:["http://a.ichiba.jp.rakuten-static.com/com/img/home/t.gif","Str",".*"],textnum:[1,"Range","1,9999"],imagenum:[1,
"Range","1,9999"],iconnum:[1,"Range","1,9999"],shopnum:[1,"Range","1,9999"],textlinenum:[1,"Range","1,9999"]}},eobj:{config:n.find(".rad-table-config"),proto:n.find(".rad-table-proto"),frame:n.find(".rad-table-frame"),existItem:n,itemsDisplay:n.find(".rad-table-body"),altContents:n.find(".rad-table-alteredContents")},props:{items:[],proto:{html:"",height:0,width:0,identifiers:{text:["","#TEXT$1L$2#",""],texturl:["","#TEXTURL$1#",""],image:['<img src="',"#IMAGE$1#",'" alt="#IMAGEALT$1#">'],imageurl:["",
"#IMAGEURL$1#",""],imagealt:["","#IMAGEALT$1#",""],icon:['<img src="',"#ICON$1#",'" alt="#ICONALT$1#">'],iconurl:["","#ICONURL$1#",""],iconalt:["","#ICONALT$1#",""],shop:["","#SHOP$1#",""],shopurl:["","#SHOPURL$1#",""]}}},multiplyPlaceholders:function(){var d,e,c,b,k,h,m,f,j,g,l;h=a.props.proto.identifiers;m=["text","image","icon","shop"];e=a.settings.rad.textlinenum;var o=function(a,b,c){b+=1;return"number"==typeof c?(c+=1,[a[0].replace("$1",b).replace("$2",c),RegExp(a[1].replace("$1",b).replace("$2",
c),"g"),a[2].replace("$1",b).replace("$2",c)]):[a[0].replace("$1",b),RegExp(a[1].replace("$1",b),"g"),a[2].replace("$1",b)]};for(k in m){f=m[k];d=a.settings.rad[f+"num"];j=h[f];g=h[f+"url"];l=h[f+"alt"];if("text"==f)for(c=0;d>c;c++)for(b=0;e>b;b++)h[f+c+"l"+b]=o(j,c,b);else for(c=0;d>c;c++)h[f+c]=o(j,c);delete a.props.proto.identifiers[f];for(c=0;d>c;c++)h[f+"url"+c]=o(g,c);delete a.props.proto.identifiers[f+"url"];if(l){for(c=0;d>c;c++)h[f+"alt"+c]=o(l,c);delete a.props.proto.identifiers[f+"alt"]}}},
loadSettings:function(){r(a.eobj.config);r(a.eobj.proto);if(1>a.eobj.config.size())return!1;a.settings.common=i.RJS_Helpers.readAttr(a.eobj.config,a.settings.common);a.settings.rad=i.RJS_Helpers.readAttr(a.eobj.config,a.settings.rad);return""==a.settings.common.url||0===a.eobj.proto.length?!1:!0},initialize:function(){a.loadSettings()?(a.multiplyPlaceholders(),i(function(){i.ajax({url:a.settings.common.url,cache:!1,dataType:"jsonp",scriptCharset:"utf-8",timeout:1E3*a.settings.common.ajaxtimer,success:a.prepareData,
error:function(){a.displayDefaultContents();a.triggerCustomEvent(9)}})})):(a.displayDefaultContents(),a.triggerCustomEvent(9))},prepareData:function(d){var e=a.settings.common;if(!d||!d.adList)return a.triggerCustomEvent(2),!1;if(0==d.adList.length)return a.regImpressionCode(e.impnodisp),a.triggerCustomEvent(1),!1;var c=d.adList,d=c.length;if(d>e.maxcount)d=e.maxcount;c.length=d;e=a.validateRadData(c);a.props.items=e;a.props.recoItemNum=d;return a.displayData(a.props,a.eobj)},validateRadData:function(d){var e=
[],c=a.settings.rad,b,k,h,m,f,j,g,l;m=d.length;for(h=0;m>h;h++){j={};f=d[h];g=f.text;for(b=0;c.textnum>b;b++){l=g[b]||{value:[],url:""};var o=l.value;for(k=0;c.textlinenum>k;k++)o[k]=o[k]||"",j["text"+b+"l"+k]=o[k];j["texturl"+b]=a.addSID(l.url)}g=f.image;for(b=0;c.imagenum>b;b++)l=g[b]||{value:c.blankimageurl,url:"",alt:""},j["image"+b]=l.value,j["imageurl"+b]=a.addSID(l.url),j["imagealt"+b]=l.alt;g=f.icon;for(b=0;c.iconnum>b;b++)l=g[b]||{value:c.blankimageurl,url:"",alt:""},j["icon"+b]=l.value,
j["iconurl"+b]=a.addSID(l.url),j["iconalt"+b]=l.alt;g=f.shop;for(b=0;c.shopnum>b;b++)l=g[b]||{value:"",url:""},j["shop"+b]=l.value,j["shopurl"+b]=a.addSID(l.url);e[h]=j}return e},displayData:function(d,e){if(0===e.proto.length||""==e.proto.html())return a.triggerCustomEvent(9),!1;e.itemsDisplay.empty();e.altContents.remove();a.eobj.existItem.show();var c,b,k,h,m,f;c=d.items;b=d.proto.identifiers;for(m=0;c.length>m;m++){k=c[m];h=e.proto.html();for(f in b)h=h.replace(b[f][1],k[f]!=q?b[f][0]+k[f]+b[f][2]:
"");e.itemsDisplay.append(i(h))}(""==a.settings.common.event_target||""==a.settings.common.event_name)&&a.setResizeEvent(d,e);0==a.settings.common.config_debug&&(e.config.remove(),e.proto.remove());a.triggerCustomEvent(0);a.regImpressionCode(a.settings.common.impdisp)},setResizeEvent:function(d,e){var c,b,k,h,m,f,j,g;g=a.settings.common;c=e.itemsDisplay.children();b=c.width();k=g.maxrows||Number.POSITIVE_INFINITY;h=g.maxitem||Number.POSITIVE_INFINITY;m=g.minitem||1;if(1==g.autocentering&&h>d.items.length)h=
d.items.length;m=Math.min(m,h);f=m*b;j=1==g.stretchable?function(a){c.css("width",99.5/a+"%")}:"center"==g.itemalign?function(a,c){var d=Math.max(0,(c-b*a)/2)+"px";e.itemsDisplay.css({marginLeft:d,marginRight:d})}:function(a,c){var d=Math.max(0,c-b*a)+"px";e.itemsDisplay.css("marginRight",d)};g=function(){var g,i,n;g=e.frame.width();i=Math.max(Math.min(g/b|0,h),m);n=+a.settings.common.chop?Math.min(k,d.items.length/i|0):k;j(i,g);e.itemsDisplay.css("width",f>g?f+"px":"auto");c.css("display","block").slice(i*
n).css("display","none")};g();i(p).bind("resize",g);setTimeout(g,0)},addSID:function(d){var e=a.settings.common.sid;""!==d&&""!==e&&(d+=(0<=d.indexOf("?")?"&":"?")+"ap=s-id%3D"+e);return d},triggerCustomEvent:function(d){if(""!=a.settings.common.event_target&&""!=a.settings.common.event_name)try{i(a.settings.common.event_target).trigger(a.settings.common.event_name,[d])}catch(e){}},regImpressionCode:function(d){return p[a.settings.common.impvar]===q||""==d?"":p[a.settings.common.impvar]=d},displayDefaultContents:function(){a.eobj.existItem.after(a.eobj.altContents.show());
a.eobj.existItem.remove()}})};i("div.rad-table-existItemDisplay").each(function(){(new s(i(this))).initialize()})}}})(this);
