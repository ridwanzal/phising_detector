!function(a,b,c){a(function(){var d=a("#homepage-prompt");if(a("#hide-homepage-prompt").click(function(){d.fadeOut("slow")}),1!==parseInt(a.cookie("refuse-to-add-homepage"),10)){var e="http://www.pixnet.net"+c.domain_append+"/";"undefined"!=typeof b.isHomePage&&!1===b.isHomePage(e)&&d.fadeIn("slow"),a("#add-pixnet-homepage").click(function(){document.body.style.behavior="url(#default#homepage)",document.body.setHomePage(e),d.fadeOut("slow")}),a("#cancel-homepage").click(function(){d.fadeOut("slow"),a.cookie("refuse-to-add-homepage",1,{expires:365})})}})}(jQuery,oHomePage,pix),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}(),window.requestTimeout=function(a,b){function c(){var f=(new Date).getTime(),g=f-d;g>=b?a.call():e.value=requestAnimFrame(c)}if(!(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame&&window.mozCancelRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame))return window.setTimeout(a,b);var d=(new Date).getTime(),e=new Object;return e.value=requestAnimFrame(c),e},window.clearRequestTimeout=function(a){window.cancelAnimationFrame?window.cancelAnimationFrame(a.value):window.webkitCancelAnimationFrame?window.webkitCancelAnimationFrame(a.value):window.webkitCancelRequestAnimationFrame?window.webkitCancelRequestAnimationFrame(a.value):window.mozCancelRequestAnimationFrame?window.mozCancelRequestAnimationFrame(a.value):window.oCancelRequestAnimationFrame?window.oCancelRequestAnimationFrame(a.value):window.msCancelRequestAnimationFrame?window.msCancelRequestAnimationFrame(a.value):clearTimeout(a)},function(a,b,c){"use strict";a(function(){var d=c.document,e=c.pix;jQuery.support.placeholder=function(){var a=d.createElement("input");return"placeholder"in a}(),b({test:jQuery.support.placeholder,nope:e.libsSite+"/jquery-placeholder/jquery.placeholder.min.js",callback:function(){a("input").placeholder()}});var f,g,h=a("body"),i=a("#search"),j=a("#search__input"),k=i.find(".search__btns"),l=i.find(".search__types"),m=l.find(".search__submit"),n=a("#search__switcher"),o=i.find(".search__reset"),p=(i.find(".search__error"),a('<ul class="search__suggestion"></ul>').appendTo(i)),q='<li class="search__suggestion__item">#{$keyword}</li>',r="search__suggestion__item--selected",s=location.pathname.split(/^\//)[1],t=m.filter('[value="'+s+'"]');0!==t.index()&&s&&l.prepend(t),n.click(function(a){a.preventDefault(),k.toggleClass("active")}),m.on("click.sort",function(){var b=a(this);0!==b.index()&&b.parent().prepend(b)}),h.click(function(a){a.target!==n[0]&&k.removeClass("active")});var u=function(a,b){var e,f=new Image(1,1),g=function(){c.clearRequestTimeout(e),d.location.href=b};f.src=a,f.onload=g,f.onerror=g,e=c.requestTimeout(g,700)};i.on("submit.redirect",function(b){if(""===a.trim(j.val()))return!1;var c,d=a(this),e=l.find(".search__submit").eq(0),f=e.val(),g=e.data("counterlink");j.val(j.val().slice(0,32)),c=d.attr("action")+"?"+d.serialize()+"&search="+f,c&&u(g,c),b.preventDefault(),i.off("submit.redirect")}),o.on("click",function(a){a.preventDefault(),j[0].value="",v(),z()});var v=function(){""===j.val()?o.hide():o.show()},w=document.all&&!c.atob;f={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},g=function(a,b){var c=/\#\{\$(.+?)\}/g;return a.replace(c,function(a){return String(b[a.replace(c,"$1")]).replace(/[&<>"'\/]/g,function(a){return f[a]})})};var x=function(b){if(b=a.trim(String(b)),!b.length)return void z();var c=y();!function(c){a.ajax({url:"//emma.pixnet.cc/mainpage/keywords/search.json?sort=count&limit=10&q="+b,dataType:"jsonp"}).done(function(a){var d=a.keywords;a.error||(d.length?c===p.data("kwd-counter")&&A(d,b):z())})}(c)},y=function(){var a,b=p.data("kwd-counter")||0;return p.data("kwd-counter",b+1),a=p.data("kwd-counter")},z=function(){p.empty().removeClass("search__suggestion--show")},A=function(b,c){for(var d,e=0,f=b.length,h="",i=a("<ul />"),j=new RegExp("("+c.replace(/(\W)/g,"\\$1")+")","gi");f>e;e+=1)d=i.html(g(q,{keyword:b[e]})).children("li"),d.html(d.html().replace(j,'<mark class="search__suggestion__mark">$1</mark>')),h+=i.html();p.html(h).addClass("search__suggestion--show"),h=i=d=null},B=function(a){if(27===a)return z(),void j.val(unescape(j.data("kwd")));p.addClass("search__suggestion--show");var b=p.find("li"),c=b.length,d=b.filter("."+r).index(),e=38===a?-1:1,f=(d+e)%c;b.length||x(j.val()),b.removeClass(r).eq(f).addClass(r),C()},C=function(a){var b=p.find("."+r);b.length&&(a=a||p.find("."+r).text(),j.val(a))};i.on("click.suggestion",".search__suggestion__item",function(){C(),i.submit()}),a(d).on("click.suggestion",function(b){0===a(b.target).parents().filter(i).length&&z()}),j.on({"input.check change.check":function(){v()},"input.keyword change.keyword focus.keyword":function(){x(j.val())},"keydown.keywords":function(a){var b=a.keyCode,c=j.val();switch(b){case 27:case 38:case 40:a.preventDefault(),B(b);break;default:w&&x(c),j.data("kwd",escape(c))}}}),j.data("kwd",escape(j.val())),p.on("mouseenter",".search__suggestion__item",function(){a(this).siblings().removeClass(r).end().addClass(r)}).on("mouseleave",".search__suggestion__item",function(){a(this).removeClass(r)}),v()})}(jQuery,yepnope,window),function(a,b){a(function(){var c=a("#announce").find(".announce-item"),d={index:0,total:c.length,duration:6e3};!function e(){b.requestTimeout(function(){d.index++,d.index%=d.total,c.eq(d.index).removeClass("hide").siblings().addClass("hide"),e()},d.duration)}()})}(jQuery,window),function(a,b){a(function(){var c,d,e=0,f=a("#feature-title"),g=a("#feature-select a"),h=a("#feature-box"),i=a("#feature-link"),j=a("#feature-title-span"),k=a("#feature-countdown"),l=h.find("li"),m=g.length,n=86400,o=3600,p=60;f.click(function(a){"feature-title-span"!==a.target.id&&a.preventDefault()});var q=function(a){var b='<span class="countdown-hr"></span> 小時<span class="countdown-min"></span>分<span class="countdown-sec"></span>秒後開始';k.hide(),0!=a&&(k.html(b),k.show(),r(a,k.find(".countdown-hr"),k.find(".countdown-min"),k.find(".countdown-sec")))},r=function(a,b,c,e){var f,g,h,i=parseInt((new Date).getTime()/1e3,10),j=a-i;return 0>=j?(k.html("<span>活動進行中</span>"),void clearTimeout(d)):j>n?void k.hide():(f=Math.floor(j/o),g=Math.floor(j%o/p),h=j%p,b.text(f),c.text(g),e.text(h),void(d=setTimeout(function(){r(a,b,c,e)},1e3)))};q(h.find("li").eq(e).data("countdown"));var s=function(){var a=h.find("li").eq(e);i.attr("href",a.data("href")),i.data("counterlink",a.data("counterlink")),j.text(a.data("title")),clearTimeout(d),q(a.data("countdown")),l.eq(0).attr("id","frame"+e),g.eq(e).addClass("current").siblings().removeClass("current")},t=function(){c=b.requestTimeout(function(){e++,e%=m,s(),t()},7e3)};t(),g.click(function(d){d.preventDefault(),c&&(b.clearRequestTimeout(c),t());var f=a(this).index();return f===e?!1:(e=f,void s())})})}(jQuery,window),function(a){a(function(){var b=a("#input-username"),c=a("#loginbox-login"),d=a("#loginbox-openid"),e=a("#switch-normal"),f=a("#switch-openid"),g=a(".popup-login");b.is(":visible")&&b.focus(),f.click(function(a){a.preventDefault(),c.addClass("hide"),d.removeClass("hide")}),e.click(function(a){a.preventDefault(),d.addClass("hide"),c.removeClass("hide")}),g.click(function(b){b.preventDefault();var c=a(this),d=c.attr("id").split("-")[2],e=c.attr("id").split("-")[3];window.open(c.attr("href"),"OpenIdPopupLogin","height="+d+",width="+e+",scrollbars=1,resizable=0").focus()})})}(jQuery),function(a){a(function(){var b=a("#topic-tag-box").find("li"),c=b.find("a"),d=a("#topic-list"),e=d.find("div"),f=a("#column-star-left-switch"),g=a("#column-star-right-switch"),h=a("#topic-footer").find("div"),i=function(){return 0}(),j=function(a){b.eq(a).addClass("current").siblings().removeClass("current"),e.eq(a).removeClass("hide").siblings().addClass("hide"),h.eq(a).removeClass("hide").siblings().addClass("hide")};j(i);var k=function(a){var b=e.eq(a),c=b.find("a").siblings(".hide"),d=b.find("a").siblings(".current");c.removeClass("hide").addClass("current"),d.removeClass("current").addClass("hide")};c.click(function(b){b.preventDefault();var c=a(this).parent().index();i=c,j(i)}),f.click(function(a){a.preventDefault(),k(i)}),g.click(function(a){a.preventDefault(),k(i)})})}(jQuery),function(a,b){a(function(){function c(){var b=a("#article-stream").find("div.pane:not(.hide)"),c=b.find("div.article-grid");a.each(c,function(){try{var b=a(this).find("a");if(void 0===b.data("showcounter"))return;var c=new Image;c.src=b.data("showcounter")}catch(d){}})}var d=a("#article-type-box"),e=d.find("a"),f=d.find("li"),g=a("#article-stream").find("div.pane"),h=a("#video"),i=a("#native-ad"),j=0,k=Math.floor(Math.random()*e.length);e.click(function(b){b.preventDefault();var d=a(this),e=d.parent().index();return j===e?!1:(j=e,f.removeClass("current"),d.parent().addClass("current"),g.eq(j).removeClass("hide").siblings().addClass("hide"),d.parent().hasClass("expand-tag")?(h.hide(),i.hide()):h.data("inserted")?h.show():i.data("inserted")&&i.show(),void c())});var l=e.eq(k);if(l.length>0){l.parent().index();f.removeClass("current"),j=l.parent().addClass("current").index(),g.eq(l.parent().index()).removeClass("hide").siblings().addClass("hide");var m=new Image;m.src=l.data("systemcounter"),c()}a(b).on("insert:video:ad:34",function(a){h.css({position:"absolute","bakground-color":"#000"}).data("inserted",1),f.filter(".current").first().hasClass("expand-tag")||h.show()}),a(b).on("insert:ad:897",function(a){i.data("inserted",1),f.filter(".current").first().hasClass("expand-tag")||i.show()}),location.hash&&/^\#ad-pos/.test(location.hash)&&e.filter("[data-hash="+location.hash+"]").trigger("click")})}(jQuery,window),function(a,b){a(function(){var b=a('meta[name="csrf-token"]').first().attr("content"),c=(a('meta[name="csrf-param"]').first().attr("content"),a("#news-feed-wrapper"));c.length&&a.ajax({url:"/index/feed",type:"GET",dataType:"html"}).done(function(d){c.fadeOut(function(){c.html(d).removeClass("feed-init").slideDown().on("click","button.delete-subscription",function(c){var d=a(this).attr("id").split("-")[1];a.post("/index/deletesub",{sToken:b,username:d},function(a){alert("取消訂閱成功"),document.location=document.location},"json")})})})})}(jQuery,window),function(a){a("#news-feed .preview-title a").click(function(){var b=a(this).parents("li.feed-li").data("type");_gaq.push(["_setAccount","UA-20543617-1"]),_gaq.push(["_trackEvent","NewsFeed","PreviewTitleClick",b])}),a("#news-feed .preview-album-images a").click(function(){var b=a(this).parents("li.feed-li").data("type");_gaq.push(["_setAccount","UA-20543617-1"]),_gaq.push(["_trackEvent","NewsFeed","PreviewImageClick",b])}),a("#news-feed").on("appear",function(){_gaq.push(["_setAccount","UA-20543617-1"]),_gaq.push(["_trackEvent","NewsFeed","Appear",""])}),a("#news-feed").initAppear({once:!0})}(jQuery);