var NNotify=(function(){var t="http://notification.nicovideo.jp";var e=null;var f=null;var g={};var c={};var k={};var q=null;var h=100;function n(x){var w=x+"=";var v=document.cookie.split(";");for(var y=0;y<v.length;y++){var z=v[y];while(z.charAt(0)==" "){z=z.substring(1)}if(z.indexOf(w)!=-1){return z.substring(w.length,z.length)}}return null}function l(){var v=n("user_session");if(v){try{var x=v.split("_")[2];return x%800<h*8}catch(w){}}return false}function j(){if(f!=null){clearTimeout(f);f=null}}function b(v,w){function x(y,A){if(y!=null){for(var z=0;z<y.length;++z){if(y[z].notify_id==A.notify_id){return true}}return false}return false}if(!x(g[v],w)&&!x(c[v],w)){if(c[v]==null){c[v]=[w]}else{c[v].push(w)}}}function u(v){var x=g[v];var w=c[v];if(x==null){g[v]=w}else{g[v]=x.concat(w)}c[v]=[]}function o(){j();f=setTimeout(function(){j();m()},60000)}function s(v){if(q!=null){q.parentNode.removeChild(q)}q=document.createElement("script");q.src=v;if(q.async!=null){q.async=true}q.onerror=function(){o()};document.getElementsByTagName("head")[0].appendChild(q)}function p(){return(Date.now||function(){return +new Date})()}function r(){if(document.cookie.indexOf("user_session")!=-1){s(t+"/v1/sessions.json?callback=NNotify.handshakeCallback&timestamp="+p())}}function i(){j();s(t+e+"&callback=NNotify.pollingCallback")}function a(v){e=v.url;if(v.interval==0){f=null;i()}else{f=setTimeout(function(){i()},v.interval*1000)}}function d(v){for(var x=0;x<v.length;++x){var A=v[x];var B={notify_id:A.notify_id,data:A.body};var w=A.event_type;b(w,B)}for(var z in c){if(c[z].length!=0){var y=k[z];if(y!=null){y({detail:c[z]});u(z)}}}}function m(){r()}if(l()){if(window.addEventListener){window.addEventListener("load",function(){m()},false)}else{if(window.attachEvent){window.attachEvent("onload",function(){m()})}}}return{addEventHandler:function(w,v){k[w]=v},handshakeCallback:function(w){var v=w.meta.status;if(v==200){a(w.data.next)}else{if(v>=500&&v<=599){o()}else{if(v>=400&&v<=499){}else{}}}},pollingCallback:function(w){var v=w.meta.status;if(w.meta.status==200){d(w.data.notifications);a(w.data.next)}else{if(v==503){a(w.data.next)}else{if(v>=500&&v<=599){o()}else{if(v==400){o()}else{}}}}}}})();