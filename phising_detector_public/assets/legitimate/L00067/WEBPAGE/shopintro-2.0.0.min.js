/*
 shopintro-2.0.0.js
 Copyright (c) 2015 Rakuten.Inc
 Date : 2015-09-16 17:22:40
*/
(function(){var f=window.jQuery;if(f.RJS_Helpers){var k=-1!=navigator.userAgent.indexOf("Mac"),l=-1!=navigator.userAgent.indexOf("Firefox");new function(){var a=this;f.extend(a,{settings:{ajaxtimer:[3E3,"Range","1,9999"],ajaxurl:["","Str",""],shoplogourl:["","Str","^https?://(?:[a-zA-Z0-9\\-]+\\.)+rakuten\\.co\\.jp/[a-zA-Z0-9!~_@&='\\(\\)\\*\\?\\-\\.#%/]+$"],shopbookmarkurl:["","Str","^https?://(?:[a-zA-Z0-9\\-]+\\.)+rakuten\\.co\\.jp/[a-zA-Z0-9!~_@&='\\(\\)\\*\\?\\-\\.#%/]+$"],shopprourl:["","Str",
"^https?://(?:[a-zA-Z0-9\\-]+\\.)+rakuten\\.co\\.jp/[a-zA-Z0-9!~_@&='\\(\\)\\*\\?\\-\\.#%/]+$"],shopmoreurl:["","Str","^https?://(?:[a-zA-Z0-9\\-]+\\.)+rakuten\\.co\\.jp/[a-zA-Z0-9!~_@&='\\(\\)\\*\\?\\-\\.#%/]+$"],shoplogosid:["","Str","^[a-zA-Z0-9_]{3,64}$"],shoptitlesid:["","Str","^[a-zA-Z0-9_]{3,64}$"],shopmoresid:["","Str","^[a-zA-Z0-9_]{3,64}$"],itemsid:["","Str","^[a-zA-Z0-9_]{3,64}$"],innerscroll:[1,"Int","^[0-1]$"],innerscrollsize:[41,"Range","1,99"],loadinglayer:[0,"Int","^[0-1]$"],dialogloadtimeout:[300,
"Range","1,9999"],dialoganimation:[1,"Int","^[0-1]$"],itemimagesize:[110,"Range","1,9999"]},eobj:{config:f("#shopIntroConfig"),dialogPrototype:f("#shopListMouseOverCnt")},status:{error:!1,isTimeout:!1,isAjax:!1},initialize:function(){if(a.loadSettings()){if(a.settings.innerscroll&&!k){var d=1,c=null,h=null;l?a.eobj.dialogPrototype.find(".innerScroll").bind({DOMMouseScroll:function(b){var g=f(this);if(b.originalEvent.detail!=h||null==c)0>b.originalEvent.detail*h&&(d=1,c=g.scrollTop()),d+=(0>b.originalEvent.detail?
-b.originalEvent.detail:b.originalEvent.detail)/3,null==c&&(c=g.scrollTop()),h=b.originalEvent.detail;g.stop(!0,!1).animate({scrollTop:c+(0>b.originalEvent.detail?d++*-a.settings.innerscrollsize:d++*a.settings.innerscrollsize)},200,function(){d=1;c=null});b.stopPropagation();return!1}}):a.eobj.dialogPrototype.find(".innerScroll").bind({mousewheel:function(b){var g=f(this);if(b.originalEvent.wheelDelta!=h||null==c)0>b.originalEvent.wheelDelta*h&&(d=1,c=g.scrollTop()),d+=(0>b.originalEvent.wheelDelta?
-b.originalEvent.wheelDelta:b.originalEvent.wheelDelta)/120,null==c&&(c=g.scrollTop()),h=b.originalEvent.wheelDelta;g.stop(!0,!1).animate({scrollTop:c+(0<b.originalEvent.wheelDelta?d++*-a.settings.innerscrollsize:d++*a.settings.innerscrollsize)},200,function(){d=1;c=null});b.stopPropagation();return!1}})}a.createDelegate()}},createDelegate:function(){f("body").delegate(".shopIntroBanner","mouseenter",function(d){if(0<f(d.target).parents("div.clonedShopListMouseOverCnt").length)return!1;d.stopPropagation();
d.preventDefault();var c=f(this),h,b=c.attr("data-shopid");if(!b||!isFinite(b))return!1;b=window.setTimeout(function(){c.removeData("dialogOpenTimoutId");var b="clonedDg_"+(new Date).getTime(),e,i=c.find("a.shopListsid"),j=f(".shopListMouseOverCnt").clone(!0);j.addClass("clonedShopListMouseOverCnt").addClass(b);j.attr("id","clonedShopListMouseOverCnt");j.find(".shopListMouseOverDesc, .shopListMouseOverPartItems").css("display","none");f("body").append(j);a.setDialogPosition(c,j);f(".clonedShopListMouseOverCnt:not(."+
b+")").remove();b=j.find("div.shopListMouseOverShopIcon a");b.attr("href",a.parseLink(i.attr("href"),a.settings.shoplogosid));b.find("img").attr("src",i.find("img").attr("src"));j.bind("mouseleave",function(){f("div.clonedShopListMouseOverCnt").remove();void 0!=h&&null!=h&&(clearTimeout(h),h=null)});a.settings.dialoganimation?j.fadeIn(200):j.show();a.settings.loadinglayer&&(f("div.clonedshopListMouseOverLayer").remove(),e=f("#shopListMouseOverCntLoadingLayer").clone(),e.attr("id","shopListMouseOverCntLoadingLayercloned"),
e.addClass("clonedshopListMouseOverLayer"),e.css("height",j.css("height")),e.css("width",j.css("width")),j.prepend(e),e.show());a.status.isTimeout=!1;h=setTimeout(function(){a.status.isTimeout=!0},a.settings.ajaxtimer);i=c.data("jsonDataOfShops");if(null!=i&&10!=i.code&&0<i.shops[0].items.length)return clearTimeout(h),h=null,a.openDialogAndLoadItems.apply(c,[d,i,e,j]),!1;f.ajax({url:a.settings.ajaxurl.replace("#SHOPID#",c.attr("data-shopid")),cache:!1,dataType:"jsonp",scriptCharset:"euc-jp",timeout:a.settings.ajaxtimer,
success:function(b){""!=b&&10!=b.code&&0<b.shops[0].items.length&&!a.status.isTimeout&&(clearTimeout(h),h=null,c.data("jsonDataOfShops",b),a.openDialogAndLoadItems.apply(c,[d,b,e,j]))},error:function(){}});return!1},a.settings.dialogloadtimeout);c.data("dialogOpenTimoutId",b)});f("body").delegate(".shopIntroBanner","mouseleave",function(){var a=f(this);null!=a.data("dialogOpenTimoutId")&&clearTimeout(a.data("dialogOpenTimoutId"))});f("body").delegate(".clonedShopListMouseOverCnt a","click",function(){f(".clonedShopListMouseOverCnt").remove()});
f("body").delegate(".shopListMouseOverCloseIcon","click",function(){f(".clonedShopListMouseOverCnt").remove()})},openDialogAndLoadItems:function(d,c,h,b){var d=f(this),g=a.eobj.dialogPrototype.find(".innerScroll");0==g.scrollTop?g.animate({scrollTop:0}):g.scrollTop(0);var g=b.find("h3.shopListMouseOverDescTtl a"),e=c.shops[0].items[0],i=e.shopurl,d=d.find("a.shopListsid");g.attr("href",a.parseLink(a.settings.shopprourl.replace("#SHOPURL#",i),a.settings.shoptitlesid));g.html(e.shopname);b.find("div.shopListMouseOverDesc a.shopListMouseOverDescBkmrk").attr("href",
a.settings.shopbookmarkurl.replace("#SHOPURL#",i).replace("#SHOPNAME#",encodeURIComponent(e.shopname)).replace("#SHOPID#",e.shopid));b.find("p.shopListMouseOverDescShopReview span.reviewave").html(e.reviewave);b.find("p.shopListMouseOverPonitP").html(d.find("p").html());b.find("h3.shopListMouseOverImgThumbTtl a").attr("href",a.parseLink(a.settings.shopmoreurl.replace("#SHOPID#",e.shopid),a.settings.shopmoresid));b.find(".shopListMouseOverDescTtlPoint").attr("href",a.parseLink(d.attr("href"),a.settings.shoplogosid));
d=b.find(".shopListMouseOverImgThumbList");g=d.find("div.shopListMouseOverImgThumb").eq(0).clone();d.find("div").remove();for(var i=0,j=g.find("a");i<c.shops[0].items.length;i++)e=c.shops[0].items[i],j.attr("href",a.parseLink(e.itemurlfull,a.settings.itemsid)),j.find("img").attr({src:e.imageurl+"?_ex="+a.settings.itemimagesize+"x"+a.settings.itemimagesize,alt:e.itemname.substr(0,20),title:e.itemname.substr(0,20)}),d.append(g.clone());a.settings.loadinglayer?h.fadeOut(100,function(){h.remove();b.find(".shopListMouseOverDesc, .shopListMouseOverPartItems").fadeIn(300)}):
b.find(".shopListMouseOverDesc, .shopListMouseOverPartItems").fadeIn(300)},setDialogPosition:function(d,c){var f=a.getInternetExplorerVersion(),b=d.offset(),g=b.top,b=b.left,e=c.find(".shopListMouseOverShopIcon").parent(),i=parseInt(e.css("marginTop"))+parseInt(c.css("paddingTop")),e=parseInt(e.css("marginLeft"))+parseInt(c.css("paddingLeft")),i=isNaN(i)?0:i,e=isNaN(e)?0:e,g=g-i-1+"px!important",b=b-e-1+"px!important";-1<f&&7===f&&(g=parseInt(g)+5+"px !important");c.attr("style",c.attr("style")+";top:"+
g+";left:"+b)},loadSettings:function(){a.settings=f.RJS_Helpers.readAttr(a.eobj.config,a.settings);return""==a.settings.ajaxurl||""==a.settings.shopbookmarkurl||""==a.settings.shoplogourl||""==a.settings.shopprourl||""==a.settings.shopmoreurl?!1:!0},parseLink:function(a,c){return c?a+"?s-id="+c:a},getInternetExplorerVersion:function(){return void 0===window.ActiveXObject?null:!document.querySelector?7:!document.addEventListener?8:!window.atob?9:!document.__proto__?10:11}});a.initialize()}}})();
