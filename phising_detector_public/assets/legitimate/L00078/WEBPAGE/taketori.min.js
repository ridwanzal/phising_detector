/* Taketori - Make Text Vertical 
 * Copyright 2010-2013 CMONOS. Co,Ltd (http://cmonos.jp)
 *
 * Version: 1.3.1
 * Lisence: MIT Lisence
 * Last-Modified: 2013-05-09
 */
var TaketoriDblClickAlert={"ja-jp":"\ufeff\u7e26\u66f8\u304d\u5316\u3057\u305f\u3044\u90e8\u5206\u3092\u30c0\u30d6\u30eb\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044\u3002","zh-tw":"\u9ede\u5169\u4e0b\u4ee5\u5207\u63db\u5230\u76f4\u6392\u986f\u793a\u3002","zh-cn":"Double click to make text vertical.","ko-kr":"Double click to make text vertical."},TaketoriDefaultLang=document.getElementsByTagName("html")[0]&&document.getElementsByTagName("html")[0].lang?-1!=document.getElementsByTagName("html")[0].lang.search(/tw/i)?
"zh-tw":"ja-jp":"ja-jp",TaketoriTool=function(){};
TaketoriTool.prototype={element:function(a){1<arguments.length&&(a=Array.prototype.slice.call(arguments));this.elements=[];return this.appendElement(a)},list:function(){return this.elements?this.elements:[]},appendElement:function(a){1<arguments.length&&(a=Array.prototype.slice.call(arguments));if(!a)return this;this.elements||(this.elements=[]);if(a.constructor==Array)for(var b=0;b<a.length;b++)this.appendElement(a[b]);else if("object"==typeof a)this.isIncluded(a)||(this.elements[this.elements.length]=
a);else if("string"==typeof a)if(a.match(/^(\w+)\.([\w\-]+)$/)){var c=RegExp.$1.toLowerCase(),d=RegExp.$2,e=[];if("function"==typeof document.getElementsByClassName){e=document.getElementsByClassName(d);for(b=0;b<e.length;b++)e[b].tagName.toLowerCase()==c&&!this.isIncluded(e[b])&&(this.elements[this.elements.length]=e[b])}if("function"!=typeof document.getElementsByClassName||0==e.length){e=document.getElementsByTagName(c);c=RegExp("(^|\\s)"+d+"(?![\\w\\-])");for(b=0;b<e.length;b++)-1!=e[b].className.search(c)&&
!this.isIncluded(e[b])&&(this.elements[this.elements.length]=e[b])}}else(a=document.getElementById(a.replace("#","")))&&!this.isIncluded(a)&&(this.elements[this.elements.length]=a);return this},isIncluded:function(a){for(var b=0;b<this.elements.length;b++)if(this.elements[b]==a)return!0;return!1},removeClassName:function(a){return this.replaceClassName(a,"","ig")},replaceClassName:function(a,b,c){if(this.elements&&null!=a&&""!=a){a=RegExp("(^|\\s)"+a+"(?![\\w\\-])",c);null==b&&(b="");for(c=0;c<this.elements.length;c++)null!=
this.elements[c].className&&(this.elements[c].className=this.elements[c].className.replace(a,b))}return this},addClassName:function(a){if(this.elements&&null!=a&&""!=a)for(var b=RegExp("(^|\\s)"+a+"(?![\\w\\-])"),c=0;c<this.elements.length;c++)null==this.elements[c].className||""==this.elements[c].className?this.elements[c].className=a:-1==this.elements[c].className.search(b)&&(this.elements[c].className+=" "+a);return this},addEventListener:function(a,b,c){null==c&&(c=!1);if(this.elements)for(var d=
0;d<this.elements.length;d++)"function"==typeof this.elements[d].addEventListener?this.elements[d].addEventListener(a,b,c):"object"==typeof this.elements[d].attachEvent&&this.elements[d].attachEvent("on"+a,b);return b},removeEventListener:function(a,b,c){if(this.elements)for(var d=0;d<this.elements.length;d++)"function"==typeof this.elements[d].removeEventListener?this.elements[d].removeEventListener(a,b,c):this.elements[d].detachEvent&&this.elements[d].detachEvent("on"+a,b)},stopPropagation:function(a){a.stopPropagation?
a.stopPropagation():event.cancelBubble=!0},preventDefault:function(a){a.preventDefault?a.preventDefault():event.returnValue=!1}};var Taketori=function(){};
Taketori.prototype={isMSIE:-1!=navigator.appVersion.search(/MSIE/)?document.documentMode?document.documentMode:5:0,isWritingModeReady:-1!=navigator.appVersion.search(/MSIE/)||"undefined"!=typeof document.createElement("div").style.MozWritingMode||"undefined"!=typeof document.createElement("div").style.webkitWritingMode||"undefined"!=typeof document.createElement("div").style.OWritingMode?!0:!1,isMultiColumnReady:"undefined"!=typeof document.createElement("div").style.MozColumnWidth||"undefined"!=
typeof document.createElement("div").style.webkitColumnWidth||"undefined"!=typeof document.createElement("div").style.webkitWritingMode&&"undefined"!=typeof document.createElement("div").style.webkitColumnWidth||"undefined"!=typeof document.createElement("div").style.OColumnWidth||"undefined"!=typeof document.createElement("div").style.msColumnWidth||"undefined"!=typeof document.createElement("div").style.columnWidth?!0:!1,isLegacy:-1!=navigator.appVersion.search(/MSIE/)||"undefined"!=typeof document.createElement("div").style.MozTransform||
"undefined"!=typeof document.createElement("div").style.webkitTransform||"undefined"!=typeof document.createElement("div").style.OTransform||"undefined"!=typeof document.createElement("div").style.transform?!1:!0,isTextEmphasisReady:"undefined"!=typeof document.createElement("div").style.MozTextEmphasisStyle||"undefined"!=typeof document.createElement("div").style.webkitTextEmphasisStyle||"undefined"!=typeof document.createElement("div").style.OTextEmphasisStyle||"undefined"!=typeof document.createElement("div").style.msTextEmphasisStyle||
"undefined"!=typeof document.createElement("div").style.textEmphasisStyle?!0:!1,document:new TaketoriTool,importCSS:function(){for(var a=!1,b=document.getElementsByTagName("link"),c=0;c<b.length;c++)null!=b[c].href&&-1!=b[c].href.search(/taketori\.css$/)&&(a=!0);if(a)return!0;if(null==this.config.cssPath||"auto"==this.config.cssPath){a=document.getElementsByTagName("script");for(c=0;c<a.length;c++)if(null!=a[c].src&&-1!=a[c].src.search(/taketori\.js$/)){this.config.cssPath=a[c].src.replace("taketori.js",
"");break}}(c=document.getElementsByTagName("head")[0])?(a=document.createElement("link"),a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),a.setAttribute("href",this.config.cssPath+"taketori.css"),c.appendChild(a)):document.write('<link rel="stylesheet" type="text/css" href="'+this.config.cssPath+'taketori.css" />')},setTemporaryCSS:function(a){this.temporaryStyle||(this.temporaryStyle=document.createElement("style"),this.temporaryStyle.setAttribute("type","text/css"),document.getElementsByTagName("head")[0].appendChild(this.temporaryStyle));
this.temporaryStyle.appendChild(document.createTextNode(a))},removeTemporaryCSS:function(){this.temporaryStyle&&(document.getElementsByTagName("head")[0].removeChild(this.temporaryStyle),this.temporaryStyle=null)},init:function(){if(!this.windowWidth){var a=this;this.document.element(window).addEventListener("resize",function(){a.resizeTimer&&clearTimeout(a.resizeTimer);a.resizeTimer=setTimeout(function(){a.refresh()},500)})}this.windowWidth=self.innerWidth?self.innerWidth:null!=document.compatMode&&
"BackCompat"!=document.compatMode?self.document.documentElement.clientWidth:self.document.body.clientWidth;this.windowHeight=self.innerHeight?self.innerHeight:null!=document.compatMode&&"BackCompat"!=document.compatMode?self.document.documentElement.clientHeight:self.document.body.clientHeight;if(!this.isMSIE&&null==this.rubyDisabled)if(window.opera)this.rubyDisabled=!0;else{var b=document.createElement("ruby");this.rubyDisabled="block"==this.getStyle(b).display?!0:!1}},set:function(a){if(this.isLegacy)return this;
this.config||(this.config={});null!=a&&this.merge(this.config,a);this.config.lang&&(this.config.lang=this.config.lang.toLowerCase());return this},merge:function(a,b){a||(a={});if(null!=b)for(var c in b)if(null!=b[c])if(b[c].constructor==Array)this.merge(a[c],b[c]);else if("string"==typeof b[c]||"number"==typeof b[c]||"boolean"==typeof b[c])a[c]=b[c];return a},element:function(a){if(this.isLegacy)return this;1<arguments.length&&(a=Array.prototype.slice.call(arguments));this.config.elements||(this.config.elements=
[]);if(a&&a.constructor==Array)for(var b=0;b<a.length;b++)this.config.elements[this.config.elements.length]=a[b];else a&&(this.config.elements[this.config.elements.length]=a);return this},reset:function(a){this.config=null;this.set(a)},japaneseReadableElements:function(a){for(var b=[],c=[],d=document.getElementsByTagName("p"),e=0;e<d.length;e++)c[c.length]=d[e];d=document.getElementsByTagName("br");for(e=0;e<d.length;e++)c[c.length]=d[e];for(e=0;e<c.length;e++)if(d=this.lookUpBlockElements(c[e],b),
null!=d&&!this.isCountedElement(b,d)){var h=0;d.innerHTML.replace(/\u3002/g,function(){h++}).replace(/\u3001/g,function(){h+=0.5});b[b.length]={element:d,readabilityScore:h}}if(0<b.length){b=b.sort(function(a,b){return b.readabilityScore-a.readabilityScore});c=[];for(e=0;e<b.length;e++)if(!this.isVerticalTextElement(b[e].element)&&(!a||a<b[e].readabilityScore))c[c.length]=b[e].element;return c}return[document.body]},isVerticalTextElement:function(a){a=this.getStyle(a);return-1!=navigator.appVersion.search(/MSIE/)&&
"string"==typeof a.writingMode&&("tb-rl"==a.writingMode.toLowerCase()||"vertical-rl"==a.writingMode.toLowerCase())||"string"==typeof a.MozWritingMode&&"vertical-rl"==a.MozWritingMode.toLowerCase()||"string"==typeof a.webkitWritingMode&&"vertical-rl"==a.webkitWritingMode.toLowerCase()||"string"==typeof a.OWritingMode&&"vertical-rl"==a.OWritingMode.toLowerCase()||"string"==typeof a.writingMode&&"vertical-rl"==a.writingMode.toLowerCase()?!0:!1},isCountedElement:function(a,b){for(var c=0;c<a.length;c++)if(a[c].element==
b)return!0;return!1},lookUpBlockElements:function(a){for(var b=null;a;){var c=a.tagName.toLowerCase();if("div"==c||"td"==c||"th"==c||"dd"==c||"section"==c||"article"==c||"body"==c){if(a.taketori||!b)b=a;if("body"==c)break}a=a.parentNode}return b},isIncludedIn:function(a,b){if(a&&a.constructor==Array)for(var c=0;c<a.length;c++)if(a[c]==b)return!0;return!1},escapeHTML:function(a){var b=document.createElement("div");a=document.createTextNode(a);b.appendChild(a);return b.innerHTML},unescapeHTML:function(a){return null==
a?"":a.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},getCookie:function(a){for(var b=[],c=document.cookie.split(/;\s*/),d=0;d<c.length;d++)if(""!=c[d]){var e=c[d].indexOf("=");if(0<=e){var h=c[d].substring(0,e),e=c[d].substring(e+1,c[d].length);b[h]=e}}return null!=a&&null!=b[a]?b[a]:""},setCookie:function(a,b,c){c||(this.config.cookieExpires?c=this.config.cookieExpires:(c=new Date,c.setTime(c.getTime()+864E8)));document.cookie=a+"="+b+"; expires="+c.toGMTString()+
";"+(null!=this.config.cookieDomain&&""!=this.config.cookieDomain?" domain="+this.config.cookieDomain+";":"")+(null!=this.config.cookiePath&&""!=this.config.cookiePath?" path="+this.config.cookiePath:"")},deleteCookie:function(a){this.setCookie(a,"",new Date(70,0,1,0,0,1))},setOnLoad:function(a){if(this.isLegacy)return this;"function"==typeof window.addEventListener?window.addEventListener("load",a,!1):"object"==typeof window.attachEvent&&window.attachEvent("onload",!this.isMultiColumnReady?function(){setTimeout(a,
600)}:a);return this},getStyle:function(a){if(a.currentStyle)return a.currentStyle;var b=document.defaultView.getComputedStyle(a,null),c=document.createElement("div");if(b.length){for(var d=0;d<b.length;d++)c.style.setProperty(b[d],b.getPropertyValue(b[d]),"");for(d=0;d<a.style.length;d++)c.style.setProperty(a.style[d],a.style.getPropertyValue(a.style[d]),"")}else c.style.cssText=b.cssText+a.style.cssText;return c.style},counterClockwiseRotatedOuterHTML:function(a,b,c){var d,e="inline"!=b.display||
b.cssFloat&&"none"!=b.cssFloat||b.styleFloat&&"none"!=b.styleFloat?!0:!1,h=!1;b||(b=this.getStyle(a));d=c?document.createElement("div"):a.cloneNode(!0);this.isWritingModeReady&&c&&(b.width&&-1!=b.width.search(/\d+\.?\d*(px|em)/i)&&0<parseInt(b.width)&&b.height&&-1!=b.height.search(/\d+\.?\d*(px|em)/i)&&0<parseInt(b.height)?a.currentStyle||b.cssFloat&&"none"!=b.cssFloat||"inline-block"==b.display?h=!0:(d.style.width="auto",d.style.height="auto"):b.width&&-1!=b.width.search(/\d+\.?\d*%/)||b.height&&
-1!=b.height.search(/\d+\.?\d*%/)?(d.style.width=b.height&&-1!=b.height.search(/\d+\.?\d*%/)?b.height:"auto",d.style.height=b.width&&-1!=b.width.search(/\d+\.?\d*%/)?b.width:"auto"):("0px"==b.width&&(d.style.width="auto"),"0px"==b.height&&(d.style.height="auto")));if(!this.isWritingModeReady||h||this.isWritingModeReady&&!c){var j=0,f=0,n=!1;this.isWritingModeReady?(j=this.getMarginSize([b.paddingLeft,b.paddingRight,b.borderLeftWidth,b.borderRightWidth]),f=this.getMarginSize([b.paddingTop,b.paddingBottom,
b.borderTopWidth,b.borderBottomWidth]),n=!0):(j=this.getMarginSize([b.paddingTop,b.paddingBottom,b.borderTopWidth,b.borderBottomWidth]),f=this.getMarginSize([b.paddingLeft,b.paddingRight,b.borderLeftWidth,b.borderRightWidth]));var g=!isNaN(parseInt(b.width))&&0<parseInt(b.width)?parseInt(b.width):a.width?a.width:a.offsetWidth?a.offsetWidth-(n?j:f):null,l=!isNaN(parseInt(b.height))&&0<parseInt(b.height)?parseInt(b.height):a.height?a.height:a.offsetHeight?a.offsetHeight-(n?f:j):null,r=!1;if(!g||!l)this.makeClipboard(this.process.target,
!0),this.clipboard.appendChild(d),g=d.offsetWidth?d.offsetWidth-(n?j:f):d.clientWidth,l=d.offsetHeight?d.offsetHeight-(n?f:j):d.clientHeight,this.clipboard.removeChild(d);if(!isNaN(g)&&!isNaN(l)&&(g+=j,l+=f,l>this.process.config.height&&(g=parseInt(g*this.process.config.height/l),l=this.process.config.height,r=!0),g>this.process.config.width&&(l=parseInt(l*this.process.config.width/g),g=this.process.config.width,r=!0),r||h))j=g-j,f=l-f,h?(a.currentStyle||"inline-block"==b.display?(d.width=f,d.style.width=
f+"px"):d.style.width="auto",d.height=j,d.style.height=j+"px"):(d.width=j,d.height=f,d.style.width=j+"px",d.style.height=f+"px",r&&e&&(d.style.overflow="auto"))}d.style.borderTopWidth=b.borderLeftWidth||0;d.style.borderRightWidth=b.borderTopWidth||0;d.style.borderBottomWidth=b.borderRightWidth||0;d.style.borderLeftWidth=b.borderBottomWidth||0;d.style.borderTopColor=b.borderLeftColor||"";d.style.borderRightColor=b.borderTopColor||"";d.style.borderBottomColor=b.borderRightColor||"";d.style.borderLeftColor=
b.borderBottomColor||"";d.style.borderTopStyle=b.borderLeftStyle||"none";d.style.borderRightStyle=b.borderTopStyle||"none";d.style.borderBottomStyle=b.borderRightStyle||"none";d.style.borderLeftStyle=b.borderBottomStyle||"none";if(e||!c||this.isWritingModeReady&&(!this.isMSIE||8>this.isMSIE))d.style.paddingTop=b.paddingLeft||0,d.style.paddingRight=b.paddingTop||0,d.style.paddingBottom=b.paddingRight||0,d.style.paddingLeft=b.paddingBottom||0;if(this.isWritingModeReady){if(e&&c&&(d.style.overflowX=
b.overflowY?b.overflowY:"visible",d.style.overflowY=b.overflowX?b.overflowX:"visible"),b.backgroundPositionX||b.backgroundPositionY?(d.style.backgroundPositionX=b.backgroundPositionY?"top"==b.backgroundPositionY?"left":"bottom"==b.backgroundPositionY?"right":b.backgroundPositionY:"50%",d.style.backgroundPositionY=b.backgroundPositionX?"left"==b.backgroundPositionX?"top":"right"==b.backgroundPositionX?"bottom":b.backgroundPositionX:"50%"):b.backgroundPosition&&-1!=b.backgroundPosition.search(/(\S+)\s+(\S)/)&&
(d.style.backgroundPosition=RegExp.$2+" "+RegExp.$1+";"),e||!c||!this.isMSIE||8>this.isMSIE)d.style.marginTop=b.marginLeft||0,d.style.marginRight=b.marginTop||0,d.style.marginBottom=b.marginRight||0,d.style.marginLeft=b.marginBottom||0}else d.style.marginTop=parseInt((b.marginTop&&"auto"!=b.marginTop?parseInt(b.marginTop):0)+(g-l)/2)+"px",d.style.marginRight=parseInt((b.marginRight&&"auto"!=b.marginRight?parseInt(b.marginRight):0)+(l-g)/2)+"px",d.style.marginBottom=parseInt((b.marginBottom&&"auto"!=
b.marginBottom?parseInt(b.marginBottom):0)+(g-l)/2)+"px",d.style.marginLeft=parseInt((b.marginLeft&&"auto"!=b.marginLeft?parseInt(b.marginLeft):0)+(l-g)/2)+"px",b.backgroundPosition&&-1!=b.backgroundPosition.search(/(\S+)\s+(\S)/)&&(d.style.backgroundPosition=RegExp.$2+" "+RegExp.$1+";");return c?d.style.cssText+";"+a.style.cssText:this.outerHTML(d)},outerHTML:function(a){if(!a)return"";var b=document.createElement("div");b.appendChild(a.cloneNode(!0));return b.innerHTML},rotatedBlockAdditionalCSSText:function(a,
b,c,d){null==c&&(c=0);return this.isWritingModeReady?"width:"+b+"px;height:"+a+"px;"+(c?(!d?"padding-bottom:":"margin-bottom:")+c+"px;":"")+(!d?"position:relative;overflow:auto;overflow-x:auto;overflow-y:hidden;":""):"width:"+a+"px;height:"+b+"px;margin-top:-"+b+"px;margin-right:"+(b-a-c)+"px;margin-bottom:"+(a+c)+"px;margin-left:0;"+(!d?"padding-right:"+c+"px;overflow:auto;overflow-x:visible;overflow-y:auto;":"")},toVertical:function(a){if(this.isLegacy)return this;var b=this;if(null==a||a)this.setOnLoad(function(){b.toVertical(!1)});
else{this.importCSS();var c=!1,d=!1;if(!this.targetElements)if(!this.config.elements||"=auto"==this.config.elements[0])this.targetElements=this.japaneseReadableElements(null==this.config.minScore?3:this.config.minScore),this.config.togglable=!1,c=!0;else if("=dblclick"==this.config.elements[0])d=c=!0;else{var e=this.document.element(this.config.elements).list();this.targetElements=[];for(a=0;a<e.length;a++)this.isVerticalTextElement(e[a])||(this.targetElements[this.targetElements.length]=e[a])}if(c&&
(this.toggleEventAttached||(this.document.element(document.body).addEventListener("dblclick",function(a){b.toggle(b.lookUpBlockElements(a.target||event.target||event.srcElement));b.document.stopPropagation(a);b.document.preventDefault(a)}),this.toggleEventAttached=!0),d))return a=navigator.browserLanguage||navigator.language||navigator.userLanguage,a=-1!=a.search(/tw/i)?"zh-tw":-1!=a.search(/(zh|cn)/i)?"zh-cn":-1!=a.search(/(ko|kr)/i)?"ko-kr":"ja-jp",alert(TaketoriDblClickAlert[a]),this;null==this.ttbDisabled&&
(this.ttbDisabled="true"==this.getCookie("TTB_DISABLED")?!0:!1);if(this.config.togglable){this.config.cookieDomain||(this.config.cookieDomain=document.domain);this.config.cookiePath||(this.config.cookiePath="/");for(a=0;a<this.targetElements.length;a++)c=this.targetElements[a],c.taketori||(c.taketori={}),c.taketori.toggleEventAttached||(this.document.element(c).addEventListener("dblclick",function(a){b.document.stopPropagation(a);b.document.preventDefault(a);b.ttbDisabled?(b.deleteCookie("TTB_DISABLED"),
b.ttbDisabled=!1):(b.setCookie("TTB_DISABLED","true"),b.ttbDisabled=!0);b.toVertical(!1)}),c.taketori.toggleEventAttached=!0),this.toggle(c,this.ttbDisabled,!0)}else if(!this.ttbDisabled)for(a=0;a<this.targetElements.length;a++)this.make(this.targetElements[a])}return this},configClone:function(a){if(!a)return{};for(var b={},c="width height fontFamily maxHeight multiColumnEnabled gap contentWidth contentHeight onbreak classNameImported lang".split(" "),d=0;d<c.length;d++)null!=a[c[d]]&&(b[c[d]]=a[c[d]]);
return b},toggleAll:function(){if(this.isLegacy)return this;this.config.cookieDomain||(this.config.cookieDomain=document.domain);this.config.cookiePath||(this.config.cookiePath="/");this.ttbDisabled?(this.deleteCookie("TTB_DISABLED"),this.ttbDisabled=!1):(this.setCookie("TTB_DISABLED","true"),this.ttbDisabled=!0);for(var a=0;a<this.targetElements.length;a++)this.toggle(this.targetElements[a],this.ttbDisabled,!0);return this},clearAll:function(){if(this.isLegacy)return this;this.config.cookieDomain||
(this.config.cookieDomain=document.domain);this.config.cookiePath||(this.config.cookiePath="/");this.ttbDisabled||(this.setCookie("TTB_DISABLED","true"),this.ttbDisabled=!0);for(var a=0;a<this.targetElements.length;a++)this.toggle(this.targetElements[a],!0,!0,!0);return this},appendTarget:function(a){this.isVerticalTextElement(a)||(this.targetElements?this.isIncludedIn(this.targetElements,a)||(this.targetElements[this.targetElements.length]=a):this.targetElements=Array(a))},removeTarget:function(a){if(this.targetElements){for(var b=
[],c=0;c<this.targetElements.length;c++)this.targetElements[c]!=a&&(b[b.length]=this.targetElements[c]);this.targetElements=b}},makeClipboard:function(a,b){if(b||this.process.isBreakable)if(this.clipboard&&this.clipboard.parentNode!=a&&this.removeClipboard(),!this.clipboard){this.clipboard=document.createElement("div");this.clipboard.style.position="absolute";a.appendChild(this.clipboard);var c=this.windowWidth>this.windowHeight?this.windowWidth:this.windowHeight;this.clipboard.style.top="-"+(c+100)+
"px";this.clipboard.style.left="-"+(c+100)+"px";this.clipboard.style.width=c+"px";this.clipboard.style.height=c+"px";this.clipboard.style.overflow="auto"}},removeClipboard:function(){this.temporaryContent&&this.temporaryContent.parentNode.removeChild(this.temporaryContent);this.clipboard&&this.clipboard.parentNode.removeChild(this.clipboard);this.temporaryContent=this.clipboard=null},toPx:function(a,b,c,d){return!a?0:c?-1!=a.search(/(\d+\.\d+)/)?parseInt(RegExp.$1*b):parseInt(1.5*b):-1!=a.search(/\d+\.?\d*em/i)?
parseInt(parseFloat(a)*b):-1!=a.search(/\d+\.?\d*%/)?parseInt(parseFloat(a)*(d?d:b)/100):-1!=a.search(/\d/)?parseInt(a):a},getFontSize:function(a){if(!isNaN(a)||-1!=a.search(/\d+px/))return parseInt(a);var b=this.getStyle(document.body).fontSize,b=-1!=b.search(/\d+\.?\d*(em|%)/)?this.toPx(b,16):parseInt(b);a=this.toPx(a,b);return 0<a?a:16},setCurrentConfig:function(a,b){b||(b=this.configClone(this.config));if(!b.classNameImported){var c=a.className;if(c)for(var d="width height fontFamily maxHeight multiColumnEnabled gap contentWidth contentHeight lang".split(" "),
e=0;e<d.length;e++)-1!=c.search(RegExp("(^|\\s)taketori-"+d[e]+"-([\\w\\.\\-\\%]+)(?![\\w\\-])","i"))&&(b[d[e]]=RegExp.$2);b.classNameImported=!0}b.lang=b.lang?b.lang.toLowerCase():TaketoriDefaultLang;this.init();d=this.getStyle(a);c=this.getFontSize(d.fontSize);this.process={target:a,done:!1,isMultiColumnEnabled:!1,noCJK:0,latin:0,width:0,columnCount:0,openTagsHTML:"",listStart:[],listStyleType:[],currentStyle:{},openTags:[],closeTags:[],columnHTML:"",content:"",config:{}};if("boolean"==typeof b.multiColumnEnabled&&
b.multiColumnEnabled||this.isMultiColumnReady&&b.multiColumnEnabled&&"auto"==b.multiColumnEnabled)this.process.config.multiColumnEnabled=!0;this.isMultiColumnReady&&this.process.config.multiColumnEnabled&&(this.process.isMultiColumnEnabled=!0);if(!this.isMultiColumnReady&&this.process.config.multiColumnEnabled||b.contentHeight&&b.contentWidth)this.process.isBreakable=!0;d=this.getElementWidth(a,d);b.contentWidth&&(this.process.config.contentWidth=this.toPx(b.contentWidth,c,!1,d));b.contentHeight&&
(this.process.config.contentHeight=this.toPx(b.contentHeight,c,!1,d));this.process.config.width=b.width?this.toPx(b.width,c,!1,d):null!=this.process.config.contentWidth?this.process.config.contentWidth:d;this.process.config.gap=null!=b.gap?this.toPx(b.gap,c):2*c;null==b.height?(b.maxHeight||(b.maxHeight="36em"),d=this.toPx(b.maxHeight,c),c=this.process.config.contentHeight?this.process.config.contentHeight:this.windowHeight,this.process.config.multiColumnEnabled?(d=Math.ceil(c/(d+this.process.config.gap)),
this.process.config.height=parseInt((c-40)/d)-this.process.config.gap,this.process.config.contentHeight&&(this.process.config.columnCount=d)):(c=c-this.process.config.gap-18,this.process.config.height=c>d?d:c)):this.process.config.contentHeight&&this.process.config.multiColumnEnabled?(c=this.toPx(b.height,c),this.process.config.columnCount=Math.ceil(this.process.config.contentHeight/(c+this.process.config.gap)),this.process.config.height=parseInt((this.process.config.contentHeight+this.process.config.gap)/
this.process.config.columnCount)-this.process.config.gap):this.process.config.height=b.height&&"width"==b.height?this.process.config.width:this.process.config.multiColumnEnabled?this.toPx(b.height,c):this.process.config.contentHeight||this.toPx(b.height,c);this.process.currentConfig=b;return this},getElementWidth:function(a,b){return(a.offsetWidth?a.offsetWidth:a.scrollWidth)-this.getMarginSize([b.paddingLeft,b.paddingRight,b.borderLeftWidth,b.borderRightWidth])},getMarginSize:function(a){for(var b=
0,c=0;c<a.length;c++)a[c]&&!isNaN(parseInt(a[c]))&&(b+=parseInt(a[c]));return b},getWidth:function(a){this.setTaketoriClassName(this.clipboard);this.temporaryContent||(this.temporaryContent=document.createElement("div"),this.setTemporaryContentStyle(),this.clipboard.appendChild(this.temporaryContent));this.temporaryContent.innerHTML=a;this.process.width=this.getTemporaryContentWidth();this.clipboard.className="";return this.process.width},setTemporaryContentStyle:function(){this.temporaryContent.className=
"taketori-col";this.isWritingModeReady?(this.temporaryContent.style.height=this.process.config.height+"px",this.temporaryContent.style.width="16px"):(this.temporaryContent.style.overflow="auto",this.temporaryContent.style.width=this.process.config.height+"px")},getTemporaryContentWidth:function(){return this.isWritingModeReady?this.temporaryContent.scrollWidth||this.temporaryContent.clientWidth||this.temporaryContent.offsetWidth:this.temporaryContent.scrollHeight||this.temporaryContent.clientHeight||
this.temporaryContent.offsetHeight},hasToBreak:function(a){this.temporaryContent||(this.temporaryContent=document.createElement("div"),this.clipboard.appendChild(this.temporaryContent));var b=0,b=!1;this.temporaryContent.className="taketori-col";this.temporaryContent.style.overflow="auto";this.setTaketoriClassName(this.clipboard);if(this.process.config.columnCount&&1<this.process.config.columnCount){var c=this.process.config.width*this.process.config.columnCount;this.process.width+50<c&&(this.setTemporaryContentStyle(),
this.temporaryContent.innerHTML=a,this.process.width=this.getTemporaryContentWidth());this.process.width+50>=c&&(b=this.getMultiColumnWidth(a),b=b>this.process.config.contentHeight?!0:!1)}else this.isWritingModeReady?(this.temporaryContent.style.height=this.process.config.contentHeight+"px",this.temporaryContent.innerHTML=a,this.process.width=this.temporaryContent.scrollWidth||this.temporaryContent.clientWidth||this.temporaryContent.offsetWidth):(this.temporaryContent.style.width=this.process.config.contentHeight+
"px",this.temporaryContent.innerHTML=a,this.process.width=this.temporaryContent.scrollHeight||this.temporaryContent.clientHeight||this.temporaryContent.offsetHeight),b=this.process.width>this.process.config.contentWidth?!0:!1;this.clipboard.className="";return b},getMultiColumnWidth:function(a){this.temporaryContent||(this.temporaryContent=document.createElement("div"),this.clipboard.appendChild(this.temporaryContent));var b=0;this.setTaketoriClassName(this.clipboard);this.setMultiColumnStyle(this.temporaryContent);
this.temporaryContent.innerHTML=a;b=this.isWritingModeReady?this.getTotalHeight(this.temporaryContent):this.getTotalWidth(this.temporaryContent);this.clipboard.className="";return b},setMultiColumnStyle:function(a){a.className="taketori-col taketori-multi-column";a.style.overflow="auto";this.isWritingModeReady?(a.style.width=this.process.config.width+"px",a.style.height=this.process.config.height+"px"):(a.style.width=this.process.config.height+"px",a.style.height=this.process.config.width+"px");a.style.MozColumnWidth=
this.process.config.height+"px";a.style.webkitColumnWidth=this.process.config.height+"px";a.style.OColumnWidth=this.process.config.height+"px";a.style.columnWidth=this.process.config.height+"px";a.style.MozColumnGap=this.process.config.gap+"px";a.style.webkitColumnGap=this.process.config.gap+"px";a.style.OColumnGap=this.process.config.gap+"px";a.style.columnGap=this.process.config.gap+"px"},setMultiColumnWidth:function(a){if(this.isWritingModeReady){var b=this.getTotalHeight(a);a.style.height=b+"px";
a.style.overflow="visible";this.fixMargin(a,this.process.config.width,b)}else b=this.getTotalWidth(a),a.style.width=b+"px",a.style.overflow="visible",this.fixMargin(a,b,this.process.config.width)},getTotalWidth:function(a){return Math.ceil((a.scrollWidth||a.clientWidth||a.offsetWidth)/(this.process.config.height+this.process.config.gap))*(this.process.config.height+this.process.config.gap)-this.process.config.gap},getTotalHeight:function(a){return Math.ceil((a.scrollHeight||a.clientHeight||a.offsetHeight)/
(this.process.config.height+this.process.config.gap))*(this.process.config.height+this.process.config.gap)-this.process.config.gap},setTaketoriClassName:function(a){var b=this.isWritingModeReady?"taketori-writingmode-ttb":"taketori-ttb";this.rubyDisabled&&(b+=" taketori-ruby-disabled");this.isTextEmphasisReady||(b+=" taketori-text-emphasis-disabled");b+=(this.isWritingModeReady&&-1!=navigator.userAgent.search(/WebKit/i)&&-1!=navigator.userAgent.search(/Windows/i)?" taketori-atsign":!this.process.currentConfig.fontFamily?
" taketori-serif":"sans-serif"==this.process.currentConfig.fontFamily?" taketori-sans-serif":"cursive"==this.process.currentConfig.fontFamily?" taketori-cursive":"kai"==this.process.currentConfig.fontFamily?" taketori-kai":" taketori-serif")+"-"+this.process.currentConfig.lang;b+=" taketori-lang-"+this.process.currentConfig.lang;a.className+=(a.className?" ":"")+b},removeTaketoriClassName:function(a){this.document.element(a).removeClassName("taketori-ttb").removeClassName("taketori-writingmode-ttb").removeClassName("taketori-ruby-disabled").removeClassName("taketori-(lang|serif|sans-serif|cursive|kai)[\\w\\-]*")},
make:function(a,b){this.document.element(a).addClassName("taketori-in-progress");var c=this;setTimeout(function(){b||c.setCurrentConfig(a);c.makeClipboard(a);c.parse(a,!0);c.complement(a);c.removeClipboard();c.document.element(a).removeClassName("taketori-in-progress")},120)},isSkipClass:function(a){if(this.config.skipClass&&a.className)for(a=0;a<this.config.skipClass.length;a++)if(-1!=this.elements.className.search(RegExp("(^|\\s)"+this.config.skipClass[a]+"(?![\\w\\-])")))return!0;return!1},isSkipId:function(a){return this.config.skipId&&
a.id&&this.isIncludedIn(this.config.skipId,thisNode.id)?!0:!1},parse:function(a,b){if(a!=this.clipboard){a.taketori&&a.taketori.ttb&&this.toggle(a,!0,!0);var c=a.nodeName.toLowerCase(),d="",e="",h="",j="",f="",n="",n=!1,g=a.nodeType,l=null,r=!1,w=a.hasChildNodes&&a.hasChildNodes();switch(g){case 1:g=this.getStyle(a);if(this.process.isBreakable){var m=this.getFontSize(g.fontSize);this.process.lineHeight=this.toPx(g.lineHeight,m,!0);this.process.lineLength||(this.process.lineLength=this.process.config.height);
if(!b&&"block"==g.display){var x=this.process.lineLength;this.process.lineLength-=this.getMarginSize([g.marginTop,g.marginBottom,g.paddingTop,g.paddingBottom,g.borderTopWidth,g.borderBottomWidth]);this.process.lineLength<m&&(this.process.lineLength=m)}this.process.roughFormula=m*this.process.lineHeight/this.process.lineLength}if(!b){if(this.isIncludedIn("img object embed video audio textarea".split(" "),c)){this.appendHTML(this.counterClockwiseRotatedOuterHTML(a,g));break}else if(this.isSkipClass(a)||
this.isSkipId(a)){this.appendHTML(this.counterClockwiseRotatedOuterHTML(a,g));break}else if(this.isIncludedIn("link meta base script style map".split(" "),c)){this.process.columnHTML+=this.outerHTML(a);break}else if("!"==c)break;else if(this.isIncludedIn(["br","input","select","option"],c)||this.isMSIE&&8>this.isMSIE&&"table"==c){this.appendHTML(this.outerHTML(a));break}for(var m=a.attributes,v=!1,y=!1,s=0;s<m.length;s++){var t=m[s],u=t.nodeName.toLowerCase(),p="string"==typeof t.nodeValue||"number"==
typeof t.nodeValue?this.escapeHTML(t.nodeValue):"style"==u&&null!=a.style.cssText?a.style.cssText.replace(/[\w\-]+:/g,function(a){return a.toLowerCase()}):"class"==u&&null!=a.className?a.className:null;if(t.specified&&p&&!this.isIncludedIn(this.stripAttributes,u)){switch(u){case "style":j=p;p="";break;case "class":f+=(f?" ":"")+p;-1!=p.search(/(^|\s)ltr(?![\w\-])/)&&(this.process.ltr||(v=!0),this.process.ltr=!0);p="";break;case "dir":-1!=p.search(/(^|\s)ltr(?![\w\-])/)&&(this.process.ltr||(v=!0),
this.process.ltr=!0),f+=(f?" ":"")+p}null!=p&&""!=p&&(h+=" "+u+'="'+p+'"')}}v?j+=this.counterClockwiseRotatedOuterHTML(a,g,!0):this.isWritingModeReady&&!this.isIncludedIn("table caption thead tbody tr td th tfoot".split(" "),c)&&(j+=this.counterClockwiseRotatedOuterHTML(a,g,!0));if(!this.process.ltr&&(!this.isMSIE||7<this.isMSIE)){"li"==c&&(this.process.listStyleType&&""!=this.process.listStyleType[this.process.listStyleType.length-1])&&(h+=' data-marker="'+this.getListMarkerText()+'"');if("ul"==
c||"ol"==c)n=!0,this.process.listStart[this.process.listStart.length]=0,m=g.listStyleType.toLowerCase(),this.isIncludedIn(["none","disc","circle","square"],m)?this.process.listStyleType[this.process.listStyleType.length]="":(this.process.listStyleType[this.process.listStyleType.length]=m,f+=(f?" ":"")+"cjk");this.isWritingModeReady&&"strong"==c&&(this.isTextEmphasisReady||(this.process.kenten||(y=!0),this.process.kenten=!0),f+=(f?" ":"")+"bo-ten");!this.isWritingModeReady&&(g.fontStyle&&"italic"==
g.fontStyle.toLowerCase()&&w)&&(f+=(f?" ":"")+"italic");g.textDecoration&&w&&(m=g.textDecoration.toLowerCase(),"none"!=m&&(-1!=m.search(/underline/i)&&-1!=m.search(/overline/i)?(f+=(f?" ":"")+"bothline",l=this.lineMarginHeight(g)):-1!=m.search(/underline/i)?(f+=(f?" ":"")+"underline",l=this.lineMarginHeight(g)):-1!=m.search(/overline/i)&&(f+=(f?" ":"")+"overline",l=this.lineMarginHeight(g)),!this.isWritingModeReady&&l&&(this.process.lineMarginHeight||(r=!0),this.process.lineMarginHeight=l)))}f&&(h+=
' class="'+f+'"');j&&(h+=' style="'+j+'"');b||(d+="<"+c+h)}if(w){b||(this.process.columnHTML+=d+">",n&&(d+=' start=""'),e="</"+c+">",this.process.openTags[this.process.openTags.length]=d+">",this.process.closeTags[this.process.closeTags.length]=c);for(s=0;s<a.childNodes.length;s++)this.parse(a.childNodes[s]);b||(this.process.columnHTML+=e,this.process.openTags.pop(),this.process.closeTags.pop(),v&&(this.process.ltr=null),y&&(this.process.kenten=null),r&&(this.process.lineMarginHeight=null),n&&(this.process.listStart.pop(),
this.process.listStyleType.pop()))}else b||(d+="></"+c+">",this.process.columnHTML+=d);x&&(this.process.lineLength=x);break;case 3:var n=this.escapeHTML(a.nodeValue),n=n.replace(/\uFF0F\uFF3C/g,"\u3033\u3035").replace(/\uFF3C\uFF0F/g,"\u3033\u3035").replace(/\uFF0F\u0022\uFF3C/g,"\u3034\u3035").replace(/\uFF3C\u0022\uFF0F/g,"\u3034\u3035"),k=this,q=0;n.replace(/&#?\w+;|\s+|./g,function(a){if(-1!=a.search(/^[\u1100-\u11FF\u2030-\u217F\u2460-\u24FF\u2600-\u261B\u2620-\u277F\u2E80-\u2FDF\u2FF0-\u4DBF\u4E00-\u9FFF\uA960-\uA97F\uAC00-\uD7AF\uD7B0-\uD7FF\uF900-\uFAFF\uFE30-\uFE4F\uFF00\uFF01\uFF03-\uFF06\uFF08-\uFF0C\uFF0E-\uFF1B\uFF1F-\uFF3D\uFF40-\uFF5B\uFF5D-\uFFEF]$/)){k.setCJK();
if((!k.isWritingModeReady||k.process.kenten)&&!k.process.ltr)a=k.kinsokuShori("<span"+(!k.process.ltr?' class="'+k.getCJKClassName(a)+'"':"")+(!k.process.ltr&&k.process.lineMarginHeight?' style="margin-top:'+k.process.lineMarginHeight+"px;margin-bottom:"+k.process.lineMarginHeight+'px;"':"")+">"+a+"</span>");q++}else-1!=a.search(/^\s+$/)?0<q&&(q+=0.5):(-1!=a.search(/^[0-9a-zA-Z]$/)?(q+=0.5,k.process.latin++):(q++,k.process.latin=0),0==k.process.noCJK&&(a='<span class="nocjk notcy">'+a),this.isTextEmphasisReady||
k.process.noCJK++);!k.process.isBreakable||1<q&&k.isNoBreak(k.process.width+q*k.process.roughFormula+k.process.lineHeight)?k.process.columnHTML+=a:(q=1,k.appendHTML(a))});this.setCJK()}}},isNoBreak:function(a){return this.isWritingModeReady||!this.process.isMultiColumnEnabled?a<this.process.config.width?!0:!1:this.process.config.contentHeight&&this.process.config.contentWidth?this.process.config.columnCount&&1<this.process.config.columnCount?a+50<this.process.config.width*this.process.config.columnCount?
!0:!1:a<this.process.config.contentHeight?!0:!1:!0},setCJK:function(){0<this.process.noCJK&&(this.process.columnHTML=(this.process.noCJK==this.process.latin&&2>=this.process.latin?this.process.columnHTML.replace('<span class="nocjk notcy">','<span class="tcy">'):this.process.columnHTML.replace('<span class="nocjk notcy">','<span class="nocjk">'))+"</span>");this.process.latin=this.process.noCJK=0},lineMarginHeight:function(a){var b=a.lineHeight;a=this.getFontSize(a.fontSize);return-1!=b.search(/\d+px/)?
parseInt((parseInt(b)-a)/2):parseInt((parseFloat(b)*a-a)/2)},getListMarkerText:function(){var a=++this.process.listStart[this.process.listStart.length-1],b=this.process.listStyleType[this.process.listStyleType.length-1];return"A"==b||"\u30a2"==b||"upper-latin"==b||"katakana"==b?(b="\u30a2\u30a2\u30a4\u30a6\u30a8\u30aa\u30ab\u30ad\u30af\u30b1\u30b3\u30b5\u30b7\u30b9\u30bb\u30bd\u30bf\u30c1\u30c4\u30c6\u30c8\u30ca\u30cb\u30cc\u30cd\u30ce\u30cf\u30d2\u30d5\u30d8\u30db\u30de\u30df\u30e0\u30e1\u30e2\u30e4\u30e6\u30e8\u30e9\u30ea\u30eb\u30ec\u30ed\u30ef\u30f0\u30f1\u30f2\u30f3".split(""),
"("+b[a]+")"):"a"==b||"\u3042"==b||"lower-latin"==b||"hiragana"==b?(b="\u3042\u3042\u3044\u3046\u3048\u304a\u304b\u304d\u304f\u3051\u3053\u3055\u3057\u3059\u305b\u305d\u305f\u3061\u3064\u3066\u3068\u306a\u306b\u306c\u306d\u306e\u306f\u3072\u3075\u3078\u307b\u307e\u307f\u3080\u3081\u3082\u3084\u3086\u3088\u3089\u308a\u308b\u308c\u308d\u308f\u3090\u3091\u3092\u3093".split(""),"("+b[a]+")"):"\u30a4"==b||"katakana-iroha"==b?(b="\u30a4\u30a4\u30ed\u30cf\u30cb\u30db\u30d8\u30c8\u30c1\u30ea\u30cc\u30eb\u30f2\u30ef\u30ab\u30e8\u30bf\u30ec\u30bd\u30c4\u30cd\u30ca\u30e9\u30e0\u30a6\u30f0\u30ce\u30aa\u30af\u30e4\u30de\u30b1\u30d5\u30b3\u30a8\u30c6\u30a2\u30b5\u30ad\u30e6\u30e1\u30df\u30b7\u30f1\u30d2\u30e2\u30bb\u30b9".split(""),
"("+b[a]+")"):"\u3044"==b||"hiragana-iroha"==b?(b="\u3044\u3044\u308d\u306f\u306b\u307b\u3078\u3068\u3061\u308a\u306c\u308b\u3092\u308f\u304b\u3088\u305f\u308c\u305d\u3064\u306d\u306a\u3089\u3080\u3046\u3090\u306e\u304a\u304f\u3084\u307e\u3051\u3075\u3053\u3048\u3066\u3042\u3055\u304d\u3086\u3081\u307f\u3057\u3091\u3072\u3082\u305b\u3059".split(""),"("+b[a]+")"):"I"==b||"upper-roman"==b?(b="I I II III IV V VI VII VIII IX X XI XII XIII XIV XV XVI XVII XVIII XIX XX".split(" "),"("+b[a]+")"):"i"==b||
"lower-roman"==b?(b="i i ii iii iv v vi vii viii ix x xi xii xiii xiv xv xvi xvii xviii xix xx".split(" "),"("+b[a]+")"):"1"==b||"decimal"==b||"\u4e00"==b||"cjk-ideographic"==b||"\u58f1"==b?10>=a?(b="\u58f1"==b?"\u58f1\u58f1\u5f10\u53c2\u56db\u4f0d\u516d\u4e03\u516b\u4e5d\u62fe".split(""):"\u4e00\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341".split(""),"("+b[a]+")"):"("+a+")":""},appendHTML:function(a,b){var c="";null==a&&(a="");if((b||this.process.isBreakable)&&""!=this.process.columnHTML)if(this.isWritingModeReady&&
!this.isMultiColumnReady||!this.process.isMultiColumnEnabled){if(c=b?this.columnComplement():this.columnComplement(this.process.columnHTML+a),b||this.process.config.width<this.getWidth(c))b||(c=this.columnComplement()),this.process.content+='<div class="taketori-col" style="'+this.rotatedBlockAdditionalCSSText(this.process.config.height,this.process.config.width,this.process.config.gap,this.process.config.multiColumnEnabled)+'">'+c+"</div>",this.process.columnCount++,(b||this.process.config.columnCount&&
this.process.config.columnCount==this.process.columnCount)&&this.containerBreak()}else if(this.process.config.contentHeight&&this.process.config.contentWidth){if(c=b?this.columnComplement():this.columnComplement(this.process.columnHTML+a),b||this.hasToBreak(c))b||(c=this.columnComplement()),this.process.content=this.process.config.columnCount&&1<this.process.config.columnCount?this.process.content+('<div class="taketori-col taketori-multi-column" style="-moz-column-width:'+this.process.config.height+
"px;-webkit-column-width:"+this.process.config.height+"px;column-width:"+this.process.config.height+"px;-moz-column-count:"+this.process.config.columnCount+";-webkit-column-count:"+this.process.config.columnCount+";column-count:"+this.process.config.columnCount+";-moz-column-gap:"+this.process.config.gap+"px;-webkit-column-gap:"+this.process.config.gap+"px;column-gap:"+this.process.config.gap+"px;"+this.rotatedBlockAdditionalCSSText(this.process.config.contentHeight,this.process.config.contentWidth,
0,!0)+'">'+c+"</div>"):this.process.content+('<div class="taketori-col" style="'+this.rotatedBlockAdditionalCSSText(this.process.config.contentHeight,this.process.config.contentWidth)+'">'+c+"</div>"),this.containerBreak()}else b&&(this.process.content=document.createElement("div"),this.setMultiColumnStyle(this.process.content),this.process.content.innerHTML=this.columnComplement(),this.containerBreak(),this.setMultiColumnWidth(this.process.target.firstChild));this.process.columnHTML+=a},columnComplement:function(a){var b=
!1,c="";null==a?(c=this.process.columnHTML+(1<this.process.noCJK?"</span>":""),b=!0):c=a+(this.process.noCJK?"</span>":"");b&&(this.process.columnHTML="",this.process.width=0,this.process.noCJK&&(this.process.noCJK=1),this.process.latin&&(this.process.latin=1));a="";for(var d=this.process.openTagsHTML,e=!0,h=this.process.closeTags.length-1;0<=h;h--){var j=this.process.closeTags[h],f=RegExp("<"+j+"(?!\\w)[^>]*>\\s*$");-1==c.search(f)?a+="</"+j+">":""==a&&(c=c.replace(f,""),"li"==j&&(e=!1))}if(b){this.process.openTagsHTML=
this.process.openTags.join("");e&&(this.process.openTagsHTML=this.process.openTagsHTML.replace(/ data-marker=".*?"/g,""));for(h=0;h<this.process.listStart.length;h++)this.process.openTagsHTML=this.process.openTagsHTML.replace(/ start=""/,'start="'+this.process.listStart[h]+'"')}return d+c+a},getCJKClassName:function(a){if("\u30fc"==a||"\u301c"==a||"\uff5e"==a||"\u2026"==a)return this.process.kinsoku=!0,"cjk cho-on";if("\u3001"==a||"\uff0c"==a)return this.process.kinsoku=!0,"ja-jp"==this.process.currentConfig.lang?
"cjk tou-ten":"cjk";if("\u3002"==a||"\uff0e"==a)return this.process.kinsoku=!0,"ja-jp"==this.process.currentConfig.lang?"cjk ku-ten":"cjk";if(-1!=a.search(/^[\u3041\u3043\u3045\u3047\u3049\u3083\u3085\u3087\u3063\u30A1\u30A3\u30A5\u30A7\u30A9\u30E3\u30E5\u30E7\u30C3]$/))return this.process.kinsoku=!0,"cjk kogaki";if(-1!=a.search(/^[\u3009\u300B\u300D\u300F\u3011\u3015\u3017\u3019\uFF09\uFF5D\uFF60]$/))return this.process.kinsoku=!0,"kakko";if(-1!=a.search(/^[\u3008\u300A\u300C\u300E\u3010\u3014\u3016\u3018\uFF08\uFF5B\uFF5F]$/))return"kakko";
-1!=a.search(/^[\uFF01\uFF1A\uFF1B\uFF1F]$/)&&(this.process.kinsoku=!0);return"cjk"},kinsokuShori:function(a){this.process.kinsoku&&(this.process.columnHTML=this.process.columnHTML.replace(/(<span(?!\w)[^>]*class="cjk"[^>]*>.<\/span>)$/,""),RegExp.$1&&(a='<span class="kinsoku">'+RegExp.$1+a+"</span>"),this.process.kinsoku=null);return a},complement:function(){this.appendHTML("",!0)},containerBreak:function(){if("function"==typeof this.process.config.onbreak)this.process.config.onbreak(this);else this._containerBreak()},
_containerBreak:function(){if(this.process.target){this.removeClipboard();this.process.target.taketori||(this.process.target.taketori={});if(!this.process.config.contentWidth||!this.process.config.contentHeight||!this.process.done){var a=this.process.target.innerHTML;this.setTaketoriClassName(this.process.target);if("object"==typeof this.process.content)this.process.target.innerHTML="",this.process.target.appendChild(this.process.content);else{this.process.target.innerHTML=this.process.content;var b=
this.process.target.firstChild,c=this,d=this.process.config.width,e=this.process.config.gap;setTimeout(function(){if(c.isWritingModeReady)b.clientHeight<b.scrollHeight&&(b.style.height=b.scrollHeight+"px");else if(b.clientWidth<b.scrollWidth){var a=b.scrollWidth;b.style.width=a+"px";c.fixMargin(b,a,d,e,c.process.config.multiColumnEnabled)}},600)}this.process.config.contentWidth&&this.process.config.contentHeight&&(this.process.done=!0);this.process.content="";this.process.target.taketori.ttb=!0;this.process.target.taketori.alt=
a;this.process.target.taketori.config=this.configClone(this.process.currentConfig);this.process.target.taketori.clientWidth=this.process.target.clientWidth;this.process.target.taketori.windowHeight=this.windowHeight}this.makeClipboard(this.process.target)}},fixMargin:function(a,b,c,d,e){d||(d=0);this.isWritingModeReady?d&&(e?a.style.marginBottom=d+"px":a.style.paddingBottom=d+"px"):(a.style.marginTop="-"+c+"px",a.style.marginRight=c-b-d+"px",a.style.marginBottom=b+d+"px",a.style.marginLeft=0,!e&&
d&&(a.style.paddingRight=d+"px"))},refresh:function(){if(this.isLegacy)return this;this.init();for(var a=0;a<this.targetElements.length;a++){var b=this.targetElements[a];if(b&&b.taketori&&b.taketori.alt&&b.taketori.ttb&&(b.clientWidth!=b.taketori.clientWidth||b.taketori.windowHeight!=this.windowHeight))if(this.setCurrentConfig(b,b.taketori.config),this.process.isBreakable)this.toggle(b,!0,!0),this.make(b,!0);else{var c=b.firstChild,d;c&&(this.process.isMultiColumnEnabled&&(c.style.overflow="auto"),
b.clientWidth!=b.taketori.clientWidth&&(b.taketori.clientWidth=b.clientWidth,this.isWritingModeReady?c.style.width=this.process.config.width+"px":c.style.height=this.process.config.width+"px"),b.taketori.windowHeight!=this.windowHeight&&(this.process.isMultiColumnEnabled?(d=this.process.config.height,c.style.MozColumnWidth=d+"px",c.style.webkitColumnWidth=d+"px",c.style.OColumnWidth=d+"px",c.style.columnWidth=d+"px"):this.isWritingModeReady?(c.style.height=this.process.config.height+"px",c.clientHeight<
c.scrollHeight&&(c.style.height=c.scrollHeight+"px")):(d=this.process.config.height,c.style.width=d+"px",c.clientWidth<c.scrollWidth&&(d=c.scrollWidth,c.style.width=d+"px")),b.taketori.windowHeight=this.windowHeight),this.process.isMultiColumnEnabled?(this.isWritingModeReady?c.style.height=this.process.config.height+"px":c.style.width=this.process.config.height+"px",this.setMultiColumnWidth(c)):this.isWritingModeReady||this.fixMargin(c,d,this.process.config.width,this.process.config.gap,this.process.config.multiColumnEnabled))}}},
toggle:function(a,b,c,d){if(this.isLegacy||this.isVerticalTextElement(a)||null!=b&&(b&&(!a.taketori||!a.taketori.ttb)||!b&&a.taketori&&a.taketori.ttb))return this;this.init();a.taketori&&a.taketori.alt&&(a.taketori.ttb||a.clientWidth==a.taketori.clientWidth&&a.taketori.windowHeight==this.windowHeight)?(b=a.innerHTML,a.innerHTML=a.taketori.alt,a.taketori.ttb?this.removeTaketoriClassName(a):(this.setTaketoriClassName(a),c=!0),c?(a.taketori.alt=(d||this.config.cacheDisabled)&&a.taketori.ttb?null:b,a.taketori.ttb=
a.taketori.ttb?!1:!0,a.taketori.clientWidth=a.clientWidth,a.taketori.windowHeight=this.windowHeight):(this.removeTarget(a),a.taketori=null)):(this.appendTarget(a),this.make(a,!1));return this},clear:function(a){this.toggle(a,!0,!0,!0)}};