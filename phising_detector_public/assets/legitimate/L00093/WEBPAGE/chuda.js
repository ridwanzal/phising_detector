!function(){var e={Cookie:{set:function(e,t,a,s,i){var n="";if(a&&"number"==typeof a){var r=new Date;r.setTime(r.getTime()+24*a*60*60*1e3),n="; expires="+r.toGMTString()}var s=s||"/",i=i||".youku.com";document.cookie=[e,"=",t,n,";domain=",i,";path=",s].join("")},get:function(e){for(var t=e+"=",a=document.cookie?document.cookie.split("; "):[],s=0;s<a.length;s++){for(var i=a[s];" "==i.charAt(0);)i=i.substring(1,i.length);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return null},remove:function(e){this.set(e,"",-1)}},Common:{shichang:function(e){return 30*e*e-20*e},decodeBase64:function(e){if(!e)return"";var t,a,s,i,n,r,o,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",d=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do i=c.indexOf(e.charAt(d++)),n=c.indexOf(e.charAt(d++)),r=c.indexOf(e.charAt(d++)),o=c.indexOf(e.charAt(d++)),t=i<<2|n>>4,a=(15&n)<<4|r>>2,s=(3&r)<<6|o,l+=String.fromCharCode(t),64!=r&&(l+=String.fromCharCode(a)),64!=o&&(l+=String.fromCharCode(s));while(d<e.length);return this.utf8To16(l)},utf8To16:function(e){var t,a,s,i,n,r=[];for(a=e.length,t=0;a>t;)switch(s=e.charCodeAt(t++),s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r.push(e.charAt(t-1));break;case 12:case 13:i=e.charCodeAt(t++),r.push(String.fromCharCode((31&s)<<6|63&i));break;case 14:i=e.charCodeAt(t++),n=e.charCodeAt(t++),r.push(String.fromCharCode((15&s)<<12|(63&i)<<6|(63&n)<<0))}return r.join("")},cutStr:function(e,t,s){var e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;"),i=this._strLen(e);if(t>=i)return e;var n=0,r=0;str_cut=new String,r=e.length;for(var o=0;r>o;o++){if(n++,a=e.charAt(o),escape(a).length>4&&n++,n>t)return s&&(str_cut=str_cut.concat(s)),str_cut;str_cut=str_cut.concat(a)}},_strLen:function(e){if(!e)return 0;var t=0,s=0;s=e.length;for(var i=0;s>i;i++)t++,a=e.charAt(i),escape(a).length>4&&t++;return t},serialize:function(e){return JSON.stringify(e)},deserialize:function(e){if("string"!=typeof e)return void 0;try{return JSON.parse(e)}catch(t){return e||void 0}},getBrowser:function(){var e,t={},a=navigator.userAgent.toLowerCase();return(e=a.match(/rv:([\d.]+)\) like gecko/))?t.ie=e[1]:(e=a.match(/msie ([\d.]+)/))?t.ie=e[1]:(e=a.match(/firefox\/([\d.]+)/))?t.firefox=e[1]:(e=a.match(/chrome\/([\d.]+)/))?t.chrome=e[1]:(e=a.match(/opera.([\d.]+)/))?t.opera=e[1]:(e=a.match(/version\/([\d.]+).*safari/))?t.safari=e[1]:0,t},bind:function(e,t,a){e.attachEvent?e.attachEvent("on"+t,function(){return function(t){window.event.cancelBubble=!0,e.attachEvent=[a.apply(e)]}}(e),!1):e.addEventListener&&e.addEventListener(t,function(e){e.stopPropagation(),a.apply(this)},!1)},Md5:function(e){var t,a,s,i,n,r,o,c,l,d=function(e,t){return e<<t|e>>>32-t},u=function(e,t){var a,s,i,n,r;return i=2147483648&e,n=2147483648&t,a=1073741824&e,s=1073741824&t,r=(1073741823&e)+(1073741823&t),a&s?2147483648^r^i^n:a|s?1073741824&r?3221225472^r^i^n:1073741824^r^i^n:r^i^n},p=function(e,t,a){return e&t|~e&a},h=function(e,t,a){return e&a|t&~a},g=function(e,t,a){return e^t^a},m=function(e,t,a){return t^(e|~a)},v=function(e,t,a,s,i,n,r){return e=u(e,u(u(p(t,a,s),i),r)),u(d(e,n),t)},_=function(e,t,a,s,i,n,r){return e=u(e,u(u(h(t,a,s),i),r)),u(d(e,n),t)},f=function(e,t,a,s,i,n,r){return e=u(e,u(u(g(t,a,s),i),r)),u(d(e,n),t)},y=function(e,t,a,s,i,n,r){return e=u(e,u(u(m(t,a,s),i),r)),u(d(e,n),t)},k=function(e){for(var t,a=e.length,s=a+8,i=(s-s%64)/64,n=16*(i+1),r=Array(n-1),o=0,c=0;a>c;)t=(c-c%4)/4,o=c%4*8,r[t]=r[t]|e.charCodeAt(c)<<o,c++;return t=(c-c%4)/4,o=c%4*8,r[t]=r[t]|128<<o,r[n-2]=a<<3,r[n-1]=a>>>29,r},C=function(e){var t,a,s="",i="";for(a=0;3>=a;a++)t=e>>>8*a&255,i="0"+t.toString(16),s+=i.substr(i.length-2,2);return s},b=function(e){e=e.replace(/\x0d\x0a/g,"\n");for(var t="",a=0;a<e.length;a++){var s=e.charCodeAt(a);128>s?t+=String.fromCharCode(s):s>127&&2048>s?(t+=String.fromCharCode(s>>6|192),t+=String.fromCharCode(63&s|128)):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128),t+=String.fromCharCode(63&s|128))}return t},w=Array(),A=7,U=12,I=17,N=22,D=5,M=9,S=14,x=20,E=4,j=11,T=16,H=23,z=6,q=10,Q=15,L=21;for(e=b(e),w=k(e),r=1732584193,o=4023233417,c=2562383102,l=271733878,t=0;t<w.length;t+=16)a=r,s=o,i=c,n=l,r=v(r,o,c,l,w[t+0],A,3614090360),l=v(l,r,o,c,w[t+1],U,3905402710),c=v(c,l,r,o,w[t+2],I,606105819),o=v(o,c,l,r,w[t+3],N,3250441966),r=v(r,o,c,l,w[t+4],A,4118548399),l=v(l,r,o,c,w[t+5],U,1200080426),c=v(c,l,r,o,w[t+6],I,2821735955),o=v(o,c,l,r,w[t+7],N,4249261313),r=v(r,o,c,l,w[t+8],A,1770035416),l=v(l,r,o,c,w[t+9],U,2336552879),c=v(c,l,r,o,w[t+10],I,4294925233),o=v(o,c,l,r,w[t+11],N,2304563134),r=v(r,o,c,l,w[t+12],A,1804603682),l=v(l,r,o,c,w[t+13],U,4254626195),c=v(c,l,r,o,w[t+14],I,2792965006),o=v(o,c,l,r,w[t+15],N,1236535329),r=_(r,o,c,l,w[t+1],D,4129170786),l=_(l,r,o,c,w[t+6],M,3225465664),c=_(c,l,r,o,w[t+11],S,643717713),o=_(o,c,l,r,w[t+0],x,3921069994),r=_(r,o,c,l,w[t+5],D,3593408605),l=_(l,r,o,c,w[t+10],M,38016083),c=_(c,l,r,o,w[t+15],S,3634488961),o=_(o,c,l,r,w[t+4],x,3889429448),r=_(r,o,c,l,w[t+9],D,568446438),l=_(l,r,o,c,w[t+14],M,3275163606),c=_(c,l,r,o,w[t+3],S,4107603335),o=_(o,c,l,r,w[t+8],x,1163531501),r=_(r,o,c,l,w[t+13],D,2850285829),l=_(l,r,o,c,w[t+2],M,4243563512),c=_(c,l,r,o,w[t+7],S,1735328473),o=_(o,c,l,r,w[t+12],x,2368359562),r=f(r,o,c,l,w[t+5],E,4294588738),l=f(l,r,o,c,w[t+8],j,2272392833),c=f(c,l,r,o,w[t+11],T,1839030562),o=f(o,c,l,r,w[t+14],H,4259657740),r=f(r,o,c,l,w[t+1],E,2763975236),l=f(l,r,o,c,w[t+4],j,1272893353),c=f(c,l,r,o,w[t+7],T,4139469664),o=f(o,c,l,r,w[t+10],H,3200236656),r=f(r,o,c,l,w[t+13],E,681279174),l=f(l,r,o,c,w[t+0],j,3936430074),c=f(c,l,r,o,w[t+3],T,3572445317),o=f(o,c,l,r,w[t+6],H,76029189),r=f(r,o,c,l,w[t+9],E,3654602809),l=f(l,r,o,c,w[t+12],j,3873151461),c=f(c,l,r,o,w[t+15],T,530742520),o=f(o,c,l,r,w[t+2],H,3299628645),r=y(r,o,c,l,w[t+0],z,4096336452),l=y(l,r,o,c,w[t+7],q,1126891415),c=y(c,l,r,o,w[t+14],Q,2878612391),o=y(o,c,l,r,w[t+5],L,4237533241),r=y(r,o,c,l,w[t+12],z,1700485571),l=y(l,r,o,c,w[t+3],q,2399980690),c=y(c,l,r,o,w[t+10],Q,4293915773),o=y(o,c,l,r,w[t+1],L,2240044497),r=y(r,o,c,l,w[t+8],z,1873313359),l=y(l,r,o,c,w[t+15],q,4264355552),c=y(c,l,r,o,w[t+6],Q,2734768916),o=y(o,c,l,r,w[t+13],L,1309151649),r=y(r,o,c,l,w[t+4],z,4149444226),l=y(l,r,o,c,w[t+11],q,3174756917),c=y(c,l,r,o,w[t+2],Q,718787259),o=y(o,c,l,r,w[t+9],L,3951481745),r=u(r,a),o=u(o,s),c=u(c,i),l=u(l,n);var O=C(r)+C(o)+C(c)+C(l);return O.toLowerCase()}},User:{getYKToken:function(){return e.Cookie.get("yktk")},getUserName:function(){var t=this.getYKToken();if(t){var a=e.Common.decodeBase64(decodeURIComponent(t).split("|")[3]);if(a.indexOf(",")>-1&&a.indexOf("nn:")>-1&&a.indexOf("id:")>-1)return a.split(",")[1].split(":")[1]}return 0},getUID:function(){var t=this.getYKToken();if(t){var a=e.Common.decodeBase64(decodeURIComponent(t).split("|")[3]);if(a.indexOf(",")>-1&&a.indexOf("nn:")>-1&&a.indexOf("id:")>-1)return parseInt(a.split(",")[0].split(":")[1])}return 0},getYTID:function(){var t=this.getYKToken();if(t){var a=e.Common.decodeBase64(decodeURIComponent(t).split("|")[3]);if(a.indexOf(",")>-1&&a.indexOf("ytid:")>-1)return parseInt(a.split(",")[3].split(":")[1])}return 0},getisVIP:function(){var t=this.getYKToken();if(t){var a=e.Common.decodeBase64(decodeURIComponent(t).split("|")[3]);if(a.indexOf(",")>-1&&a.indexOf("vip:")>-1)return!!a.split(",")[2].split(":")[1]}return!1},getLoginStatus:function(){return 0!==this.getUID()}},Ajax:{getScript:function(e,t,a){if("string"==typeof arguments[0]){var t="function"==typeof arguments[1]?t:function(){},a="boolean"==typeof arguments[2]?a:!1,s=document.getElementsByTagName("HEAD")[0],i=document.createElement("SCRIPT");i.type="text/javascript",i.src=e,i.onload=i.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(t(),i.onload=i.onreadystatechange=null,a&&this.parentNode.removeChild(this))},s.appendChild(i)}}}};window.CHUDA=e}(),function(){if(void 0==window.jQuery){var e=[location.protocol,"//","static.youku.com","/js/jquery.js"].join("");CHUDA.Ajax.getScript(e,function(){window.jQuery=jQuery.noConflict()},!0)}Number.prototype.toFixed=function(e){var t=this+"";if(e||(e=0),-1==t.indexOf(".")&&(t+="."),t+=new Array(e+1).join("0"),new RegExp("^(-|\\+)?(\\d+(\\.\\d{0,"+(e+1)+"})?)\\d*$").test(t)){var t="0"+RegExp.$2,a=RegExp.$1,s=RegExp.$3.length,i=!0;if(s==e+2){if(s=t.match(/\d/g),parseInt(s[s.length-1])>4)for(var n=s.length-2;n>=0&&(s[n]=parseInt(s[n])+1,10==s[n]);n--)s[n]=0,i=1!=n;t=s.join("").replace(new RegExp("(\\d+)(\\d{"+e+"})\\d$"),"$1.$2")}return i&&(t=t.substr(1)),(a+t).replace(/\.$/,"")}return this+""},UC_DOMAIN=window.UC_DOMAIN||"i.youku.com",API_DOMAIN_DEF="www.youku.com",API_DOMAIN_Link="http://lv.youku.com/page/grade/task",LINK_GRAGE_ICON="http://cps.youku.com/redirect.html?id=000145df";var t=function(e){return document.getElementById(e)},a={targetURL:{vip:"http://cps.youku.com/redirect.html?id=000145de",lvip:"http://cps.youku.com/redirect.html?id=000145dd"},curpanel:"",userDefauleIcon:"http://static.youku.com/v1.0.1040/user/img/head/64/999.jpg",panel:{user:"qheader_username_panel",noticelist:"qheader_notice_info"},loading:'<div class="cd-hpanel-loading" id="hpanelloading"><span class="ico-loading-64"></span></div>',initHeaderUser:function(){var e=CHUDA.User.getUID();if(e){window.USERINFO=void 0;var t="http://lv.youku.com/api/grade/get_uinfo?callback=QheaderModule.upUserImg";CHUDA.Ajax.getScript(t,null,!0)}},upUserImg:function(e){if(t("qheader_username")){var s=null;if(void 0!=e.errno&&-300003504===e.errno)return CHUDA.Cookie.remove("yktk"),void setTimeout(function(){window.location.reload()},500);if(void 0!=e.errno&&0===e.errno)s=e.data,window.localStorage&&window.localStorage.setItem("USERDATA",CHUDA.Common.serialize(s));else{if(!window.localStorage||null==window.localStorage.getItem("USERDATA"))return;s=CHUDA.Common.deserialize(window.localStorage.getItem("USERDATA"))}t("qheader_userlog").className+=" patch-user-info";var i=s.user_image?s.user_image:a.userDefauleIcon,n="";(s.is_vip||s.is_lvip)&&0==s.vip_grade&&(s.vip_grade=1),s.is_vip?n='<span class="vip-level-icon level-vip'+s.vip_grade+(1===s.vip_year?" level-annual":"")+'" title="优酷土豆'+(1===s.vip_year?"年费":"")+"黄金会员：VIP"+s.vip_grade+'" id="qheader_crown_icon" data-type="vip"></span>':s.is_lvip?n='<span class="vip-level-icon level-lvip'+s.vip_grade+(1===s.vip_year?" level-annual":"")+'" title="优酷土豆'+(1===s.vip_year?"年费":"")+"白银会员：VIP"+s.vip_grade+'" id="qheader_crown_icon" data-type="lvip"></span>':s.vip_grade>0&&(n='<span class="vip-level-icon level-expired'+s.vip_grade+'" title="您的优酷土豆会员已过期" id="qheader_crown_icon" data-type="vip"></span>');var r='<div class="yk-userlog-after-meta"><img class="yk-userlog-after-avatar" src="'+i+'"><span class="yk-userlog-after-name'+(s.is_vip||s.is_lvip?" patch-red-name":"")+'" title="'+s.user_name+'" id="qheaer_user_name">'+CHUDA.Common.cutStr(s.user_name,10,null)+"</span>"+n+'<span class="user-grade-icon user-grade-lv'+s.grade+'" title="优酷等级：'+s.grade+'" id="qheader_grade_icon"></span><b class="caret yk-userlog-after-caret"></b></div>';t("qheader_username_show").innerHTML=r,window.USERDATA=s,CHUDA.Common.bind(t("qheaer_user_name"),"click",function(){return window.location.href="http://"+UC_DOMAIN+"/u/home?type=watch_timeline",!1});var o=this,c=t("qheader_crown_icon");void 0!=c&&CHUDA.Common.bind(c,"click",function(){return window.location.href=o.targetURL[c.getAttribute("data-type")],!1}),CHUDA.Common.bind(t("qheader_grade_icon"),"click",function(){return window.location.href=LINK_GRAGE_ICON,!1}),this.showUserMsgInit({init:!0,userIdEncode:"profile",isverified:!1,is_verify_email:1,is_verify_mobile:!1})}},showUserMsg:function(){a.curpanel="user";var e=t(a.panel.user);if(!e)return!1;if(a.showsign(),window.USERZPD||a.showUserZpd(),void 0==window.USERINFO){var s="http://lvip.youku.com/api/user/get_user_info?uid="+CHUDA.User.getUID()+"&access_token="+encodeURIComponent(CHUDA.User.getYKToken())+"&callback=QheaderModule.showUserMsgCallback";CHUDA.Ajax.getScript(s,null,!0)}else a.showUserMsgInit(window.USERINFO)},showsign:function(){var e="http://actives.youku.com/task/show/user_is_sign?uid="+CHUDA.User.getUID()+"&callback=QheaderModule.showsignCallback";CHUDA.Ajax.getScript(e,null,!0)},showsignCallback:function(e){window.SIGNTAG=0===e.errno&&1===e.data.is_sign?1:0},showUserMsgInit:function(e){t(a.panel.user).innerHTML='<div class="cd-hpanel-ico ico-arrow-top-grey"></div>';var s=window.USERDATA,i=document.createElement("div");if(i.className="cd-hpanel-user-info",CHUDA.User.getLoginStatus()){var n=s.user_image||a.userDefauleIcon,r='<div class="cd-hpanel-user-avatar"><a href="http://'+UC_DOMAIN+"/u/"+e.userIdEncode+'" target="_blank"><img src="'+n+'"></a></div>',o='<div class="cd-hpanel-user-profile"><div class="cd-hpanel-user-name"><a href="http://'+UC_DOMAIN+"/u/"+e.userIdEncode+'" target="_blank" title="'+s.user_name+'"'+(s.is_vip||s.is_lvip?' class="patch-red-name"':"")+">"+CHUDA.Common.cutStr(s.user_name,12,"...")+"</a></div>";o+='<div class="cd-hpanel-user-credit">',s.is_vip?o+='<a href="'+this.targetURL.vip+'" target="_blank"><span class="vip-level-icon level-vip'+s.vip_grade+(1===s.vip_year?" level-annual":"")+'" title="优酷土豆'+(1===s.vip_year?"年费":"")+"黄金会员：VIP"+s.vip_grade+'"></span></a>':s.is_lvip?o+='<a href="'+this.targetURL.lvip+'" target="_blank"><span class="vip-level-icon level-lvip'+s.vip_grade+(1===s.vip_year?" level-annual":"")+'" title="优酷土豆'+(1===s.vip_year?"年费":"")+"白银会员：VIP"+s.vip_grade+'"></span></a>':s.vip_grade>0&&(o+='<a href="'+this.targetURL.vip+'" target="_blank"><span class="vip-level-icon level-expired'+s.vip_grade+'" title="您的优酷土豆会员已过期"></span></a>'),o+='<a href="'+LINK_GRAGE_ICON+'" target="_blank"><span class="user-grade-icon user-grade-lv'+s.grade+'" title="优酷等级：'+s.grade+'"></span></a>',e.isverified&&(o+='<a href="http://'+UC_DOMAIN+'/u/rz" target="_blank"><i class="ico-cert" title="认证用户"></i></a>'),o+=0!=e.is_verify_email?'<div class="cd-hpanel-user-valid cd-hpanel-user-valid-email"><a class="cd-hpanel-ico ico-valid-email" href="http://'+UC_DOMAIN+'/u/setting/sec_security/tab_mail.html" target="_blank"></a></div>':'<div class="cd-hpanel-user-valid cd-hpanel-user-valid-email"><a class="cd-hpanel-ico ico-valid-email-done" href="http://'+UC_DOMAIN+'/u/setting/sec_security.html" target="_blank"></a></div>',1!=e.is_verify_mobile?(o+='<div class="cd-hpanel-user-valid cd-hpanel-user-valid-phone"><a class="cd-hpanel-ico ico-valid-phone" href="http://'+UC_DOMAIN+'/u/setting/sec_security/tab_mobile.html" target="_blank"></a>',e.init||(o+=0==e.is_verify_email?'<div class="qtips qtips_valid qtips_valid_email"><div class="cd-hpanel-ico ico-arrow-left"></div><div class="content"><span class="cd-hpanel-ico ico-min-close" onclick="this.parentNode.parentNode.style.display=\'none\'"></span><a href="http://'+UC_DOMAIN+'/u/setting/sec_security/tab_mobile.html" target="_blank">绑定手机</a></div></div>':'<div class="qtips qtips_valid qtips_valid_email"><div class="cd-hpanel-ico ico-arrow-left"></div><div class="content"><span class="cd-hpanel-ico ico-min-close" onclick="this.parentNode.parentNode.style.display=\'none\'"></span><a href="http://'+UC_DOMAIN+'/u/setting/sec_security/tab_mobile.html" target="_blank">去绑定</a></div></div>'),o+="</div>"):o+='<div class="cd-hpanel-user-valid cd-hpanel-user-valid-phone-done"><a class="cd-hpanel-ico ico-valid-phone-done" href="http://'+UC_DOMAIN+'/u/setting/sec_security/tab_mobile.html" target="_blank"></a></div>',o+="</div>",o+='<div class="cd-hpanel-user-vip">',s.is_vip?(o+='<div class="user-vip-item">黄金会员剩余<span>'+s.vip_last_day+'</span>天</div><a class="user-vip-buy" href="http://cps.youku.com/redirect.html?id=00014639" target="_blank" title="续费黄金会员"><span>续费</span><i></i></a>',this.cpsStatistics("00014639")):s.is_lvip?(o+='<div class="user-vip-item">白银会员剩余<span>'+s.lvip_last_day+'</span>天</div><a class="user-vip-buy" href="http://cps.youku.com/redirect.html?id=0001463b" target="_blank" title="续费白银会员"><span>续费</span><i></i></a>',this.cpsStatistics("0001463b")):(o+='<div class="user-vip-item">加入会员免广告</div><a class="user-vip-buy" href="http://cps.youku.com/redirect.html?id=0001463a" target="_blank" title="开通优酷土豆会员"><span>开通</span><i></i></a>',this.cpsStatistics("0001463a")),o+="</div>",o+='<div class="cd-hpanel-user-extend"><a href="http://'+UC_DOMAIN+'/u/setting/base_profile.html" target="_blank">设置</a><span class="cd-hpanel-split">|</span><a href="javascript:;" onclick="setTimeout(function(){logout();},200);return false;">登出</a></div></div>';var c='<div class="cd-hpanel-user-zpd" id="cdhpaneluserzpd"></div>',l='<div class="cd-hpanel-code"><div class="ykcode-flag" id="sidetoolqrcodepanelshow"><span></span></div><div class="ykcode-cover"><img class="ykcode-cover-img" src="http://static.youku.com/index/img/toolbar/codecover.png"></div></div>';i.innerHTML=r+o+c+l}else{var d='<div class="cd-hpanel-user-avatar"><a><img src="http://static.youku.com/index/img/toolbar/toolbar_avatar.jpg" alt=""></a></div><div class="cd-hpanel-user-profile"><div class="cd-hpanel-user-name">Hi, 您好～～</div><p>登录可以攒时长玩升级哦~</p></div><div class="cd-hpanel-code"><div class="ykcode-flag" id="sidetoolqrcodepanelshow"><span></span></div><div class="ykcode-cover"><img class="ykcode-cover-img" src="http://static.youku.com/index/img/toolbar/codecover.png"></div></div>';i.innerHTML=d}if(t(a.panel.user).appendChild(i),c&&a.showUserZpdInit(),CHUDA.User.getLoginStatus()){var u=document.createElement("div");u.className="panel-user-grade";var p=[];Math.round(s.score/6)/10,Math.round(s.upgrade_score/6)/10;if(p.push('<div class="panel-user-grade-title"><span>我的等级</span><a class="panel-user-grade-reward-a" href="'+LINK_GRAGE_ICON+'" target="_blank">立即领取></a><div class="panel-user-grade-reward">专属礼包，</div></div>'),s.grade>=100)var h=99;else var h=s.grade;p.push('<div class="panel-user-grade-line">'),p.push('<a class="panel-user-grade-left-new">'+h+'</a><a class="panel-user-grade-center-new"></a><a class="panel-user-grade-right-new">'+parseInt(h+1)+"</a>"),p.push('<div class="panel-user-grade-time-new" id="panelusergradetimenew">');var g=223,m=Math.ceil((s.score-CHUDA.Common.shichang(h))/(CHUDA.Common.shichang(h+1)-CHUDA.Common.shichang(h))*g);(s.score/60).toFixed(1)==(CHUDA.Common.shichang(h+1)/60).toFixed(1)&&(m=223);var v=s.score-CHUDA.Common.shichang(h)<=0?"":s.score-CHUDA.Common.shichang(h)<4?"0.1":((s.score/60).toFixed(1)-(CHUDA.Common.shichang(h)/60).toFixed(1)).toFixed(1);p.push('<a target="_blank" href="'+LINK_GRAGE_ICON+'" class="panel-user-grade-left-new">'+h+"</a>"),s.score-CHUDA.Common.shichang(h)>0&&(p.push('<a target="_blank" href="'+LINK_GRAGE_ICON+'" class="panel-user-grade-center-new" id="rank_todayDuraLine">'+v+"小时</a>"),p.push('<a target="_blank" href="'+LINK_GRAGE_ICON+'" class="panel-user-grade-right-new"></a>')),p.push('<a target="_blank" href="'+LINK_GRAGE_ICON+'" class="panel-user-grade-next '+(s.grade>=100?"panel-user-grade-next-top":"")+'">'+parseInt(h+1)+"</a>"),p.push('<div class="panel-user-grade-line-hover" id="panelusergradelinehover"><div class="panel-user-grade-line-today"><i></i><em>今日已成长'+(s.today_score/60).toFixed(1)+'小时</em></div><div class="panel-user-grade-line-todaymore"><i></i><em>最多可再增加'+((s.today_max_score*(s.is_vip?1.2:s.is_lvip?1.1:1)/60).toFixed(1)-(s.today_score/60).toFixed(1)).toFixed(1)+"小时</em></div></div>"),p.push("</div>"),p.push("</div>"),p.push('<div class="panel-user-grade-info-new">'),p.push('<a target="_blank" href="'+LINK_GRAGE_ICON+'" class="panel-user-grade-icon-new panel-grade-icon-nowlv">'+(CHUDA.Common.shichang(h)/60).toFixed(1)+"小时</a>"),p.push('<a target="_blank" href="'+LINK_GRAGE_ICON+'" class="panel-user-grade-icon-new panel-grade-icon-nextlv '+(s.grade>=100?"panel-grade-icon-nextlv-top":"")+'">'+(CHUDA.Common.shichang(h+1)/60).toFixed(1)+"小时</a>"),p.push("</div>"),u.innerHTML=p.join(""),t(a.panel.user).appendChild(u),!e.init&&m>0&&jQuery("#rank_todayDuraLine").animate({width:m+"px"},"slow","swing");var _=document.createElement("div");_.className="cd-hpanel-u-task";var f='<div class="u-task-title"><span>我的任务</span></div>';_.innerHTML=f;var y=document.createElement("div");y.className="u-task-list",y.setAttribute("id","tasklistsidetool"),y.innerHTML=a.loading,_.appendChild(y),t(a.panel.user).appendChild(_),this.getUserTaskListNew();var k=document.createElement("div");k.className="cd-hpanel-userservices",k.innerHTML='<ul class="cd-userservices-list cd-userservices-list-topborder"><li class="u-service-chanel"><a href="http://'+UC_DOMAIN+"/u/"+e.userIdEncode+'" target="_blank"><i class="cd-hpanel-ico ico-myspace"></i>我的频道</a></li><li class="u-service-manage"><a href="http://'+UC_DOMAIN+'/u/creative_center" target="_blank"><i class="cd-hpanel-ico ico-videomanage"></i>创作中心</a></li><li class="u-service-favor"><a href="http://faxian.youku.com/" target="_blank"><i class="cd-hpanel-ico ico-yourfavor"></i>精彩发现</a></li><li class="u-service-subscribe"><a href="http://'+UC_DOMAIN+'/u/home?type=favorite" target="_blank"><i class="cd-hpanel-ico ico-subscribe"></i>我的收藏</a></li></ul>',t(a.panel.user).appendChild(k)}else{var C=document.createElement("div");C.className="cd-hpanel-oauth-login";var b='<button class="btn btn-large" href="jsvascript:;" onclick="login({type:\'toolbar\',callBack:\'QheaderModule.initHeaderUser\'});return false;">立即登录</button><a onclick="login({type:\'toolbar\',callBack:\'QheaderModule.initHeaderUser\'});return false;" class="cd-hpanel-ico ico-qq" title="QQ"><span>qq</span></a><a onclick="login({type:\'toolbar\',callBack:\'QheaderModule.initHeaderUser\'});return false;" class="cd-hpanel-ico ico-weibo" title="微博"><span>微博</span></a><a onclick="login({type:\'toolbar\',callBack:\'QheaderModule.initHeaderUser\'});return false;" class="cd-hpanel-ico ico-alipay" title="通过支付宝扫描可直接注册、登录优酷了"><span>支付宝</span></a><span class="extend">没有账号? <a href="http://www.youku.com/user/signup" target="_blank">免费注册</a></span>';C.innerHTML=b,t(a.panel.user).appendChild(C)}setTimeout(function(){a.userMsgShowHover()},500),this.cpsStatistics("0001472a")},showUserMsgCallback:function(e){return void 0!=e.errno&&-300003504===e.errno?(CHUDA.Cookie.remove("yktk"),void setTimeout(function(){window.location.reload()},500)):void(void 0!==e.errno&&0==e.errno&&(window.USERINFO=e.data,this.showUserMsgInit(window.USERINFO)))},makeTasklistNewHtml:function(e){var t="";if(!e.web||e.web.length<=0)return t='<div class="u-task-meta u-task-meta-null"><p class="u-task-e-null-status">更多精彩 敬请期待...</p></div>';for(var a=0;a<e.web.length;a++){var s=e.web[a];t+='<div class="sign1" style="overflow:hidden;margin-bottom:10px;position:relative;">',t+='<div class="s-img" style="float:left;width:234px;height:50px;"><img src="'+s.img+'" width="234" height="50"></div>',t+='<div class="s-link" style="position:absolute;right:0;width:54px;height:50px;" id="signLink">',t+='<a href="'+s.redirect_url+'" target="_blank" id="qheaderSignTag" style="display:block;width:54px;height:50px;"><img style="width:54px;height:50px;" src="'+("number"==typeof window.SIGNTAG&&1===window.SIGNTAG?s.status_finish_img:s.status_unfinish_img)+'"></a>',t+="</div>",t+="</div>"}return t},makeTasklistHtml:function(e){var t="";if(!e.tasklist||e.tasklist.length<=0)return t='<div class="u-task-meta u-task-meta-null"><p class="u-task-e-null-status">更多精彩 敬请期待...</p></div>';for(var a=!1,s="",i=0;i<e.tasklist.length;i++){var n="u-task-meta";2==e.tasklist[i].status?n="u-task-meta u-task-meta-done":1==e.tasklist[i].status&&(n="u-task-meta"),t+='<div class="'+n+'" id="task_list_'+e.tasklist[i].tid+'" name="tasklistidetool" tid="'+e.tasklist[i].tid+'" ttype="'+e.tasklist[i].type+'"><a class="u-task-m-link"><img src="'+e.tasklist[i].icon+'"><span class="u-task-link-icon-done"></span></a><div class="u-task-m-entry"><a class="u-task-m-e-title" title="'+e.tasklist[i].name+'">'+e.tasklist[i].name+'</a><span title="'+e.tasklist[i].desc+'">'+e.tasklist[i].desc+'</span><div class="u-task-m-e-reward"><span>奖励：</span>';for(var r=0;r<e.tasklist[i].awards.length;r++)1==e.tasklist[i].awards[r].type&&0==a&&(a=!0),e.tasklist[i].awards[r].detail&&(t+='<span class="reward-entry">'+e.tasklist[i].awards[r].detail+"</span>");if(t+="</div></div>",2==e.tasklist[i].status)t+='<span class="u-task-m-status u-task-m-status-done" id="task_receive_'+e.tasklist[i].tid+'">领奖励</span>';else if(1==e.tasklist[i].status)if(10!=e.tasklist[i].type)e.tasklist[i].progress&&e.tasklist[i].progress.length>0?t+="0/1"===e.tasklist[i].progress?'<span class="u-task-m-status u-task-m-status-ing">进行中…</span>':'<span class="u-task-m-status u-task-m-status-degree">'+e.tasklist[i].progress+"</span>":(s="","string"==typeof e.tasklist[i].toUrl&&e.tasklist[i].toUrl.length>0&&(s=' data-tourl="'+e.tasklist[i].toUrl+'"'),t+='<span class="u-task-m-status u-task-m-status-progress" id="toolbar_initiative_task_'+e.tasklist[i].tid+'"'+s+">领任务</span>");else if(e.tasklist[i].special_task_type&&2==e.tasklist[i].special_task_type){var o=e.tasklist[i].special_task_source?e.tasklist[i].special_task_source:"http://www.youku.com";t+='<span class="u-task-m-status u-task-m-status-progress"><a href="'+o+'" target="_blank">做任务</a></span>'}else t+='<span class="u-task-m-status u-task-m-status-progress" id="do_task_'+e.tasklist[i].tid+'">做任务</span>';t+="</div>"}if(a){var c=window.USERDATA;t+=c.is_vip?'<div class="u-task-meta-hint"><i class="ico__vipsuper"></i><span>黄金会员双倍积分</span></div>':'<div class="u-task-meta-hint u-task-meta-hint-no"><i class="cd-hpanel-ico ico__vipsuper_no"></i><span>黄金会员双倍积分</span></div>'}return t},userMsgShowHover:function(){t("sidetoolqrcodepanelshow")&&(t("sidetoolqrcodepanelshow").onclick=function(){a.qrcodeShow()}),a.bindTastDivListEvent();var e=t("panelusergradetimenew");e&&jQuery("#panelusergradetimenew").hover(function(e){jQuery(e.target).hasClass("panel-user-grade-next")||jQuery(e.target).hasClass("panel-user-grade-left-new")||jQuery("#panelusergradelinehover").show()},function(){jQuery("#panelusergradelinehover").hide()})},bindTastDivListEvent:function(){var e=a._getElementsByName("div","tasklistidetool");if(e)for(var s=e.length,i=0;s>i;i++){var n=e[i].getAttribute("tid");!function(e){t("task_receive_"+e)&&(t("task_receive_"+e).onclick=function(){var t="http://"+API_DOMAIN_DEF+"/index_QSideToolJSONP?function[]=userReceiveAward&callback[]=QheaderModule.userReceiveAwardCallback&tid="+e;CHUDA.Ajax.getScript(t,null,!0)}),t("do_task_"+e)&&(t("do_task_"+e).onclick=function(){taskUpdateUserInfo(e,0)}),t("toolbar_initiative_task_"+e)&&(t("toolbar_initiative_task_"+e).onclick=function(){doInitiativeTask(e,0)})}(n)}},qrcodeShow:function(){var e=t(a.panel.user).select(".cd-hpanel-code")[0];qrcodeLogin.getObj("toolbar")&&qrcodeLogin.getObj("toolbar").delInterval();var s={size:138,loginfrom:"toolbar",stfrom:"toolbar",hParentDom:e,isPageExist:function(){return"user"==a.curpanel?!0:!1},getQrcodeCallback:function(){a.qrcodeShowAnimation()},callback:function(){window.toolbarQrloginObj.isQrloginSucc=!0,window.login_callback(),a.initHeaderUser()}};qrcodeLogin.init("toolbar",s),setTimeout(function(){window.toolbarQrloginObj=qrcodeLogin.getObj("toolbar")},500)},qrcodeShowAnimation:function(){setTimeout(function(){a.qrcodePanelShow.call(t("sidetoolqrcodepanelshow"),a),setTimeout(function(){t("sidetoolqrcodepanelclose")&&(t("sidetoolqrcodepanelclose").onclick=function(){a.qrcodePanelClose.call(t("sidetoolqrcodepanelclose"),a),setTimeout(function(){a.qrcodeHide()},600)})},100)},100)},qrcodeHide:function(){var e=t(a.panel.user).select(".cd-hpanel-code .ykcode-container")[0];e&&e.remove(),qrcodeLogin.getObj("toolbar")&&qrcodeLogin.getObj("toolbar").delInterval()},userReceiveAwardCallback:function(e){e&&e.ret&&"OK"==e.ret&&e.tid&&t("task_list_"+e.tid)&&a.userReceiveAward.call(t("task_list_"+e.tid),a)},getUserTaskListNew:function(){if(t("tasklistsidetool")){var e="http://task.youku.com/task/task/get_config_v2?pl=web&callback=QheaderModule.getUserTaskListNewCallback";CHUDA.Ajax.getScript(e,null,!0)}},getUserTaskListNewCallback:function(e){if(void 0!==e.errno&&0==e.errno){var e=e.data;if(e.web&&e.web.length>0&&t("tasklistsidetool")){var s=a.makeTasklistNewHtml(e),i=jQuery("#tasklistsidetool");i.html(s)}else t("tasklistsidetool")&&(t("tasklistsidetool").innerHTML='<div class="u-task-meta u-task-meta-null"><p class="u-task-e-null-status">更多精彩 敬请期待...</p></div>')}},qrcodePanelShow:function(e){var t=jQuery,a=CHUDA.Common.getBrowser(),s=t(this).parent(),i=s.find(".ykcode-container"),n=s.find(".ykcode-cover"),r=n.find(".ykcode-cover-img"),o=300;return t(this).hide(),i.css("display","block"),a.ie&&parseInt(a.ie)<10?void s.css({height:"330px",width:"274px",zIndex:"100"}):(n.show(),void s.on("hover",function(){return!1}).css({width:"32px",height:"32px",zIndex:"100",overflow:"hidden"}).animate({width:"330px",height:"274px"},o,function(){r.css({transition:"transform 0.35s","-webkit-transition":"-webkit-transform 0.35s","-moz-transition":"-moz-transform 0.35s","-o-transition":"-o-transform 0.35s","-ms-transition":"-ms-transform 0.35s",transform:"rotate(-55deg)","-webkit-transform":"rotate(-55deg)","-moz-transform":"rotate(-55deg)","-o-transform":"rotate(-55deg)","-ms-transform":"rotate(-55deg)"}),n.delay(o+350).hide(1)}))},qrcodePanelClose:function(e){var t=jQuery,a=CHUDA.Common.getBrowser(),s=t(this).parent().parent(),i=t(this).parent(),n=s.find(".ykcode-flag"),r=s.find(".ykcode-cover"),o=r.find(".ykcode-cover-img"),c=300;return a.ie&&parseInt(a.ie)<10?(i.hide(),n.show(),void s.css({height:"auto",width:"auto",overflow:""})):(r.show(),o.css("display"),o.css({transition:"transform 0.25s","-webkit-transition":"-webkit-transform 0.25s","-moz-transition":"-moz-transform 0.25s","-o-transition":"-o-transform 0.25s","-ms-transition":"-ms-transform 0.25s",transform:"rotate(0deg)","-webkit-transform":"rotate(0deg)","-moz-transform":"rotate(0deg)","-o-transform":"rotate(0deg)","-ms-transform":"rotate(0deg)"}),void s.delay(230).animate({width:"32px",height:"32px"},c,function(){i.hide(),r.hide(),n.show()}))},userReceiveAward:function(e){var t=jQuery,a=e,s=t(this).find("span.reward-entry"),i=(t(".cd-integral"),t('<div class="u-task-mask"><p>领取成功</p></div>'));meta=t("<div class='task-reward-meta'></div>"),t.each(s,function(e){t(s[e]).appendTo(meta)});var n=t(this).find("div.u-task-mask");n.length&&n.remove(),t(this).fadeOut("fast",function(){t(this).addClass("u-task-meta-reward"),i.append(meta),t(this).append(i),t(this).removeClass("u-task-meta-done"),t(this).fadeIn(function(){t(this).delay(1700).slideUp(300,function(){t(this).remove(),a.getUserTaskListNew()})})})},showUserZpd:function(){var e="http://cvip.youku.com/zpd_api/get_medal_list?&callback=QheaderModule.showUserZpdCallback";CHUDA.Ajax.getScript(e,null,!0)},showUserZpdCallback:function(e){return void 0!=e.errno&&-300003504===e.errno?(CHUDA.Cookie.remove("yktk"),void setTimeout(function(){window.location.reload()},500)):void(void 0!==e.errno&&0==e.errno&&0!=e.data.length&&(e.data=e.data.sort(function(e,t){return t.status?1:-1}),window.USERZPD=e.data,this.showUserZpdInit(window.USERZPD)))},showUserZpdInit:function(e){var a;if((window.USERZPD||""==e)&&t("cdhpaneluserzpd")&&(a=window.USERZPD),a&&a.length>0){for(var s=a.length,i='<div class="cd-hpanel-user-zpd-content"><ul class="cd-hpanel-user-zpd-list" id="cdhpaneluserzpdlist" style="width:'+41*s+'px;left:0px;">',n=j=0;j<s;j++)n=j,"罗辑思维频道"==a[n].name&&(a[n].name="罗辑思维"),i+='<li><a target="_blank" href="'+a[n].info_link+'/zpd" class="'+(a[n].status?"cd-hpanel-user-zpd-follow":"cd-hpanel-user-zpd-unfollow")+'" title="'+a[n].name+'频道会员"><img src="'+a[n].medal_icon_medium+'"></a></li>';i+="</ul>",s>7&&(i+='</div><div class="cd-hpanel-user-zpd-nav"><a class="cd-hpanel-user-zpd-prv-none" id="cdhpaneluserzpdprv" title="上一个"></a><a class="cd-hpanel-user-zpd-pre" id="cdhpaneluserzpdpre" title="下一个"></a></div>'),t("cdhpaneluserzpd").style.height="26px",t("cdhpaneluserzpd").innerHTML=i,s>7&&(t("cdhpaneluserzpdprv").onclick=function(){if(t("cdhpaneluserzpdprv").className.indexOf("cd-hpanel-user-zpd-prv-none")>-1);else{
var e=t("cdhpaneluserzpdlist").style?parseInt(t("cdhpaneluserzpdlist").style.left):0;t("cdhpaneluserzpdlist").style.left=e+41+"px",t("cdhpaneluserzpdlist").style&&0==parseInt(t("cdhpaneluserzpdlist").style.left)?(t("cdhpaneluserzpdpre").className="cd-hpanel-user-zpd-pre",t("cdhpaneluserzpdprv").className="cd-hpanel-user-zpd-prv cd-hpanel-user-zpd-prv-none"):t("cdhpaneluserzpdlist").style&&parseInt(t("cdhpaneluserzpdlist").style.left)<0&&(t("cdhpaneluserzpdpre").className="cd-hpanel-user-zpd-pre",t("cdhpaneluserzpdprv").className="cd-hpanel-user-zpd-prv")}},t("cdhpaneluserzpdpre").onclick=function(){if(t("cdhpaneluserzpdpre").className.indexOf("cd-hpanel-user-zpd-pre-none")>-1);else{var e=t("cdhpaneluserzpdlist").style?parseInt(t("cdhpaneluserzpdlist").style.left):0;t("cdhpaneluserzpdlist").style.left=e-41+"px",t("cdhpaneluserzpdlist").style&&parseInt(t("cdhpaneluserzpdlist").style.left)==41*(7-a.length)?(t("cdhpaneluserzpdpre").className="cd-hpanel-user-zpd-pre cd-hpanel-user-zpd-pre-none",t("cdhpaneluserzpdprv").className="cd-hpanel-user-zpd-prv"):parseInt(t("cdhpaneluserzpdlist").style.left)>41*(7-a.length)&&(t("cdhpaneluserzpdpre").className="cd-hpanel-user-zpd-pre",t("cdhpaneluserzpdprv").className="cd-hpanel-user-zpd-prv")}})}},_getElementsByName:function(e,t){for(var a=[],s=document.getElementById("qheader_box"),i=s.getElementsByTagName(e),n=0;n<i.length;n++)i[n].getAttribute("name")==t&&(a[a.length]=i[n]);return a},MSGCENTER_LINK:"http://msg.youku.com/page/msg/index",MSGCENTER_API:"http://msg.youku.com/api/push/",noticePoll:function(){if(this.initNoticePannel(),this.resetNoticeTypeAndCount(),!this.timer){this.updateNoticeNum();var e=this;this.timer=setInterval(function(){e.updateNoticeNum()},3e4)}},initNoticePannel:function(){var e=document.getElementById("qheader_notice"),t=document.getElementById("qheader_notice_panel"),a=document.getElementById("qheader_notice_show"),s=document.getElementById("qheader_notice_num");e&&t&&(this.getChudaMessage(),s&&(s.className="chuda_qheader_spot"),a&&(a.getElementsByTagName("a")[0].href=this.MSGCENTER_LINK),t.innerHTML='<div class="chuda_panel_arrow"></div><div id="qheader_notice_info" class="chuda_notice_box"></div>')},updateNoticeNum:function(){var e=CHUDA.User.getUID();e&&CHUDA.Ajax.getScript("http://notify.youku.com/notify/get.json?uid="+e+'&types=["umc_notice","mvip.msg.state"]&callback=QheaderModule.updateNoticeNumCallback',null,!0)},resetNoticeTypeAndCount:function(){this.noticeCount=0,this.noticeType={privateMsg:{notify:"umc_notice",category:3,type:"private_msg",parentCat:"privateMsg",subCats:[6]},comments:{notify:"umc_notice",category:4,type:"comments",parentCat:"privateMsg",subCats:[7,8,9]},act_notice:{notify:"mvip.msg.state",category:2,type:"act_notice",parentCat:"activityMsg",subCats:[2]},renewal:{notify:"mvip.msg.state",category:3,type:"renewal",parentCat:"systemMsg",subCats:[3]},view_coupons:{notify:"mvip.msg.state",category:1e3,type:"view_coupons",parentCat:"systemMsg",subCats:[1e3]},grow_up:{notify:"mvip.msg.state",category:1001,type:"grow_up",parentCat:"systemMsg",subCats:[1001]},video_publish:{notify:"mvip.msg.state",category:1004,type:"video_publish",parentCat:"systemMsg",subCats:[1004]},self_channel:{notify:"mvip.msg.state",category:1002,type:"self_channel",parentCat:"systemMsg",subCats:[1002]},level_up:{notify:"mvip.msg.state",category:1009,type:"level_up",parentCat:"systemMsg",subCats:[1009]},task_credits:{notify:"mvip.msg.state",category:1010,type:"task_credits",parentCat:"systemMsg",subCats:[1010]},weiku_zhibo:{notify:"mvip.msg.state",category:1011,type:"weiku_zhibo",parentCat:"systemMsg",subCats:[1011]},bofangliang:{notify:"mvip.msg.state",category:1012,type:"bofangliang",parentCat:"systemMsg",subCats:[1012]},crowdfunding:{notify:"mvip.msg.state",category:1013,type:"crowdfunding",parentCat:"systemMsg",subCats:[1013]},account_msg:{notify:"mvip.msg.state",category:1014,type:"account_msg",parentCat:"systemMsg",subCats:[1014]},sys_ad:{notify:"mvip.msg.state",category:2001,type:"sys_ad",parentCat:"systemMsg",subCats:[2001]},sys_important:{notify:"mvip.msg.state",category:2002,type:"sys_important",parentCat:"systemMsg",subCats:[2002]},zpd_msg:{notify:"mvip.msg.state",category:3002,type:"zpd_msg",parentCat:"systemMsg",subCats:[3002]},nryypush_msg:{notify:"mvip.msg.state",category:3003,type:"nryypush_msg",parentCat:"systemMsg",subCats:[3003]},id_msg:{notify:"mvip.msg.state",category:3004,type:"id_msg",parentCat:"systemMsg",subCats:[3004]},loginerr_msg:{notify:"mvip.msg.state",category:3011,type:"loginerr_msg",parentCat:"systemMsg",subCats:[3011]},core_msg:{notify:"mvip.msg.state",category:3012,type:"core_msg",parentCat:"systemMsg",subCats:[3012]},videopass_msg:{notify:"mvip.msg.state",category:3101,type:"videopass_msg",parentCat:"systemMsg",subCats:[3101]},zpdfinance_msg:{notify:"mvip.msg.state",category:3201,type:"zpdfinance_msg",parentCat:"systemMsg",subCats:[3201]},topic_msg:{notify:"mvip.msg.state",category:3202,type:"topic_msg",parentCat:"systemMsg",subCats:[3202]},actives_msg:{notify:"mvip.msg.state",category:4001,type:"actives_msg",parentCat:"systemMsg",subCats:[4001]},live_msg:{notify:"mvip.msg.state",category:4002,type:"live_msg",parentCat:"systemMsg",subCats:[4002]},holiday_msg:{notify:"mvip.msg.state",category:4003,type:"holiday_msg",parentCat:"systemMsg",subCats:[4003]}}},updateNoticeNumCallback:function(e){if(e&&e.notify){if(this.resetNoticeTypeAndCount(),e.notify.umc_notice){var t=e.notify.umc_notice[0];for(var a in this.noticeType)if("umc_notice"==this.noticeType[a].notify){var s=this.noticeType[a].category,i=t[s]||0;this.noticeCount+=i}subscribeCount=t[1]||0}if(e.notify["mvip.msg.state"]){var t=e.notify["mvip.msg.state"][0];for(var a in this.noticeType)if("mvip.msg.state"==this.noticeType[a].notify){var s=this.noticeType[a].category,i=t[s]||0;this.noticeCount+=i}}this.initNoticeSpot(),this.subscribeCount=subscribeCount,this.initSubscribeSpot()}},initSubscribeSpot:function(){var e=document.getElementById("subscribe_lsidetooln_flag"),t=document.getElementById("subscribe_lsidetoolw_flag");this.subscribeCount>0?(e&&(e.innerHTML=this.subscribeCount>50?"...":this.subscribeCount,e.className=this.subscribeCount>50?"sub-update-num sub-update-nonum":"sub-update-num",e.style.display="block"),t&&(t.innerHTML=this.subscribeCount>50?"...":this.subscribeCount,t.className=this.subscribeCount>50?"sub-update-num sub-update-nonum":"sub-update-num",t.style.display="block")):(e&&(e.style.display="none"),t&&(e.style.display="none"))},initNoticeSpot:function(){return document.getElementById("qheader_notice_num")&&(document.getElementById("qheader_notice_num").style.display=this.noticeCount>0?"block":"none"),document.getElementById("chuda_notice_clear")&&(document.getElementById("chuda_notice_clear").style.display=this.noticeCount>0?"block":"none"),this.noticeCount},showNoticeList:function(){this.curpanel="notice";var e=document.getElementById("qheader_notice_info");if(e)if(e.innerHTML="",CHUDA.User.getLoginStatus()){var t=!1;t=void 0!=window.USERDATA?window.USERDATA.is_vip||window.USERDATA.is_lvip:CHUDA.User.getisVIP(),e.parentNode.className="chuda_notice_panel";var a=[];a.push('<div class="chuda_notice_bd">'),a.push('<div class="chuda_notice_inner">'+(0===this.noticeCount,'<div class="chuda_notice_loading"></div>')+"</div>"),a.push("</div>"),a.push('<div class="chuda_notice_ft"><a href="javascript:void(0)" class="chuda_notice_clear" id="chuda_notice_clear">全部标记已读</a><a class="chuda_notice_rightlink" href="'+this.MSGCENTER_LINK+'" target="_blank" style="display: none;">查看全部消息></a></div>'),e.innerHTML=a.join(""),CHUDA.Ajax.getScript(this.MSGCENTER_API+"get_msg_box_list?"+this.getApiSignature()+"&uid="+CHUDA.User.getUID()+"&page=1&page_size=12&callback=QheaderModule.showNoticeListCallback",null,!0),this.cpsStatistics("0001472b")}else{e.parentNode.className="chuda_notice_panel chuda_notice_notlogin";var s='<div class="chuda_notice_notlogin_hd"><h3 class="chuda_notice_notlogin_title">我的通知</h3></div>';s+='<div class="chuda_notice_notlogin_bd"><div class="chuda_notice_notlogin_tips"><span class="chuda_notice_notlogin_icon"></span><p>登录后可以看到海量信息</p><p>参与精彩活动～</p></div>',s+='<a class="chuda_notice_notlogin_btn" href="javscript:;" onclick="login({type:\'toolbar\',callBack:\'QheaderModule.initHeaderUser\'});return false;">马上登录</a></div>',e.innerHTML=s}},showNoticeListCallback:function(e){var t=this,a=3,s=4;if(void 0===e.errno||0!=e.errno)return jQuery(".chuda_notice_loading").html('<div class="chuda_notice_tips">获取数据超时，<a href="javascript:void(0)" class="chuda_notice_reload">重新加载</a></div>'),void jQuery(".chuda_notice_reload").one("click",function(){t.showNoticeList()});var i=e.data.msg_list,n=jQuery("#qheader_notice_info .chuda_notice_inner"),r=[];for(var o in i){var c=i[o],l="notice_page_";c.type&&(o=parseInt(o)+1,l+=Math.ceil(o/s),o>a*s||(new RegExp(/^[A-Za-z]+:\/\/[A-Za-z0-9-_]+.[A-Za-z0-9-_%&\?\/.:=]+$/).test(c.content.link)||(c.content.link=""),r.push('<li data-msgid="'+c.msgid+'" data-catid="'+c.type+'" class="notice_juhe '+(2==c.status?"notice_visited ":"")+l+'"><div class="notice_img"><img src="'+c.fromuid.img+'"></div><div class="notice_node"><div class="notice_juhe_title">'+c.fromuid.name+'<span class="notice_difftime">'+t._dateDiff(1e3*c.access_time)+'</span></div><a title="查看详情" target="_blank" href="'+c.content.link+'" class="notice_go"><span title="'+c.content.ifo.replace(/"/g,"'")+'">'+CHUDA.Common.cutStr(c.content.ifo.replace(/"/g,"'"),36,"...")+"</span></a>"+(1==c.juhe?"":'<a title="删除" class="notice_del"><i class="notice_del_i"></i></a>')+"</div></li>")))}var d=jQuery("#notice_page .on").html()?parseInt(jQuery("#notice_page .on").html()):1;if(n.eq(0).html(r.length?'<ul class="chuda_notice_list">'+r.join("")+"</ul>"+(e.data.total_pages>1?'<div id="notice_page"></div>':""):'<div class="chuda_notice_empty"></div>').show(),e.data.total_pages>1){e.data.total_pages>3&&(e.data.total_pages=3);var u=function(e){var t="notice_page_";jQuery(".chuda_notice_list .notice_juhe").hide(),jQuery('<div class="chuda_notice_loading"></div>').insertBefore(jQuery(".chuda_notice_list")),setTimeout(function(){jQuery(".chuda_notice_loading").remove(),jQuery(".chuda_notice_list ."+t+e).show()},500)};u(1),t.setPage(document.getElementById("notice_page"),e.data.total_pages,d,u)}t.noticeCount>0?(jQuery(".chuda_notice_clear").show(),t.initNoticeSpot()):(jQuery(".chuda_notice_clear").hide(),t.noticeCount=0,t.initNoticeSpot()),r.length>4&&jQuery(".chuda_notice_rightlink").show(),jQuery(".chuda_notice_clear").click(function(){t.updateAllmsgs()}),jQuery(".chuda_notice_list li").hover(function(){jQuery(this).addClass("notice_hover")},function(){jQuery(this).removeClass("notice_hover")}).one("click",function(){jQuery(this).hasClass("notice_visited")||(jQuery(this).addClass("notice_visited"),t.resetNoticeNum(jQuery(this).attr("data-msgid"),jQuery(this).attr("data-catid")),t.noticeCount-=1,t.initNoticeSpot(),jQuery(this).parent().children("li.notice_visited").length===s&&setTimeout(function(){t.showNoticeList()},2e3))}),jQuery(".chuda_notice_list .notice_go").each(function(){jQuery(this).click(function(e){jQuery(this).parent().parent().hasClass("notice_visited")||(jQuery(this).parent().parent().addClass("notice_visited"),t.noticeCount-=1,t.initNoticeSpot(),t.resetNoticeNum(jQuery(this).parent().parent().attr("data-msgid"),jQuery(this).parent().parent().attr("data-catid")));var a=jQuery(this).attr("href");return e.stopPropagation(),""==a?!1:void 0})}),jQuery(".chuda_notice_list .notice_del").each(function(){jQuery(this).click(function(e){var a=jQuery(this).parent().parent(),s=CHUDA.User.getUID(),i=a.attr("data-msgid"),n="http://msg.youku.com/api/push/deletemsg?callback=QheaderModule.deletemsgCallback&"+t.getApiSignature()+"&uid="+s+"&msgid="+i;CHUDA.Ajax.getScript(n,null,!0),e.stopPropagation()})})},resetNoticeNum:function(e,t){if(CHUDA.User.getUID()&&t){var a=new Image;a.src=this.MSGCENTER_API+"readcomfirm_msg?"+this.getApiSignature()+"&msgid="+e+"&type="+t}},updateAllmsgs:function(){var e="http://msg.youku.com/api/push/update_all_status?callback=QheaderModule.updateAllmsgsCallback&"+this.getApiSignature()+"&uid="+CHUDA.User.getUID()+"&status=2";CHUDA.Ajax.getScript(e,null,!0)},updateAllmsgsCallback:function(e){0==e.errno&&(jQuery(".chuda_notice_list li").addClass("notice_visited"),this.noticeCount=0,this.initNoticeSpot(),jQuery(".chuda_notice_clear").hide())},getApiSignature:function(){var e=Math.round((new Date).getTime()/1e3),t=CHUDA.User.getYKToken(),a=CHUDA.User.getUID(),s="1001";return"appid="+s+"&ts="+e+"&uid="+a+"&access_token="+t+"&sig="+CHUDA.Common.Md5([s,e,a,decodeURIComponent(t)].join(""))},getChudaMessage:function(){var e=CHUDA.User.getLoginStatus()?this.MSGCENTER_API+"getpopupmsg?"+this.getApiSignature()+"&page_no=1&callback=QheaderModule.getChudaMessageCallback":"http://static.youku.com/lvip/msg/chuda_message.js";CHUDA.Ajax.getScript(e,null,!0)},getChudaMessageCallback:function(e){if(void 0!==e.errno&&0==e.errno&&e.data&&e.data.msgs&&e.data.msgs.length>0){Math.round((new Date).getTime()/1e3);for(i=0;i<e.data.msgs.length;i++){var t=e.data.msgs[i];if(this.showChudaMessage(t,!0))break}}},initUnloginMessage:function(e){if(e&&e.length>0){var t=Math.round((new Date).getTime()/1e3);for(i=0;i<e.length;i++)if(("undefined"==typeof e[i].access_time||isNaN(parseInt(e[i].access_time))||!(t<parseInt(e[i].access_time)))&&("undefined"==typeof e[i].expire_time||isNaN(parseInt(e[i].expire_time))||!(t>parseInt(e[i].expire_time)))){var a="msgid_"+e[i].msgid;if(!CHUDA.Cookie.get(a)&&this.showChudaMessage(e[i],!1)){CHUDA.Cookie.set(a,e[i].msgid,1);break}}}},showChudaMessage:function(e,t){if("undefined"!=typeof e.status&&0!==e.status)return!1;var a=document.getElementById("qheader_msg_panel");if(a)return!1;var s=document.getElementById("qheader_notice");if(!s)return!1;a=document.createElement("div"),a.id="qheader_msg_panel",a.className="chuda_msg_panel";var i='<div class="chuda_panel_arrow"></div><div class="chuda_msg_box" id="qheader_msg_box">',n=this;try{i+=1007==e.type?'<div class="chuda_msg_hd chuda_msg_hd_new"><div class="chuda_msg_icon"><img src="'+e.fromuid.img.replace(/</g,"&lt;").replace(/>/g,"&gt;")+'"><span>'+e.fromuid.name.replace(/</g,"&lt;").replace(/>/g,"&gt;")+'</span></div><h3 class="chuda_msg_title_new">'+e.content.title.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</h3></div>":'<div class="chuda_msg_hd"><h3 class="chuda_msg_title">'+e.content.title.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</h3></div>",i+='<div class="chuda_msg_bd"><div class="chuda_msg_info">'+e.content.ifo.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</div>",e.content.btnname&&(i+='<a class="chuda_msg_btn" href="'+(e.content.link&&e.content.link.indexOf("http")>=0?e.content.link+'" target="_blank"':"javascript:void(0)")+'" id="qheader_msg_btn">'+e.content.btnname+"</a>"),i+='<a class="chuda_msg_close" href="#closeMsgBox" onclick="jQuery(\'#qheader_msg_panel\').remove(); return false;">关闭</a></div>'}catch(r){}i+="</div>";var o=this.MSGCENTER_API+"updatemsgstatus?"+this.getApiSignature()+"&msgid="+e.msgid+"&status=";if(t){var c=!1;void 0!=window.USERDATA?c=window.USERDATA.is_vip||window.USERDATA.is_lvip:CHUDA.User.getLoginStatus()&&(c=CHUDA.User.getisVIP()),c&&1007!=e.type&&1006!=e.type&&(a.className="chuda_msg_panel chuda_msg_vip");var l=new Image;l.src=o+"1"}else if(e.msgid){var d=new Image;d.src="http://msg.youku.com/api/push/read_unlogin_msg?msgid="+e.msgid}a.innerHTML=i,s.parentNode.appendChild(a),t&&document.getElementById("qheader_msg_btn")&&(document.getElementById("qheader_msg_btn").onclick=function(){var e=document.getElementById("qheader_msg_panel");e&&e.remove(),n.updateChudaMessage(o+2)}),!t&&document.getElementById("qheader_msg_btn")&&e.msgid&&(document.getElementById("qheader_msg_btn").onclick=function(){var t=document.getElementById("qheader_msg_panel");t&&t.remove();var a=new Image;a.src="http://msg.youku.com/api/push/click_unlogin_msg?msgid="+e.msgid}),!isNaN(parseInt(e.fade))&&parseInt(e.fade)>0&&setTimeout(function(){var e=document.getElementById("qheader_msg_panel");e&&e.remove()},1e3*parseInt(e.fade));try{var u="cps.youku.com/redirect.html?id=";if(e.content&&e.content.link&&e.content.link.indexOf(u)>0){var p=e.content.link.substr(e.content.link.indexOf(u)+u.length,8);this.cpsStatistics(p)}}catch(r){}return!0},cpsStatistics:function(e){if(e){var t=new Image;t.src="http://p.l.youku.com/vippay?lt=2&uri="+e+"&ext="}},setPage:function(e,t,a,s){function i(){if(a==o){console.log(a,o);var e='<a href="#" class="on">'+o}else var e='<a href="#">'+o;t>o?n[n.length]=e+".</a>":o==t&&(n[n.length]=e+"</a>")}var e=e,t=t,a=a,s=s,n=[],r=this;if(6>=t)for(var o=1;t>=o;o++)i();e.innerHTML=n.join("");(function(){for(var i=e.getElementsByTagName("a"),n=a,o=0;o<i.length;o++)i[o].onclick=function(){return n=parseInt(this.innerHTML),s&&s(n),r.setPage(e,t,n,s),!1}})()},deletemsgCallback:function(e){void 0!==e.errno&&0==e.errno&&e.data&&e.data.msgid&&(this.noticeCount-=1,this.initNoticeSpot(),jQuery("#notice_page a").removeClass("on"),CHUDA.Ajax.getScript(this.MSGCENTER_API+"get_msg_box_list?"+this.getApiSignature()+"&uid="+CHUDA.User.getUID()+"&page=1&page_size=12&callback=QheaderModule.showNoticeListCallback",null,!0))},_dateDiff:function(e){var t=6e4,a=60*t,s=24*a,i=30*s,n=(new Date).getTime(),r=n-e,o=r/i,c=r/(7*s),l=r/s,d=r/a,u=r/t;return o>=1?result=parseInt(o)+"个月前":c>=1?result=parseInt(c)+"周前":l>=1?result=parseInt(l)+"天前":d>=1?result=parseInt(d)+"小时前":u>=1?result=parseInt(u)+"分钟前":result="刚刚",result},updateChudaMessage:function(e){var t=e+"&callback=QheaderModule.updateChudaMessageCallback";CHUDA.Ajax.getScript(t,null,!0)},updateChudaMessageCallback:function(e){void 0!==e.errno&&0==e.errno&&e.data&&e.data.msgid&&this.updateNoticeNum()}},s="http://static.youku.com/lvip/css/chuda_qheader.css",n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",s),document.getElementsByTagName("head")[0].appendChild(n),window.QheaderModule=a}();