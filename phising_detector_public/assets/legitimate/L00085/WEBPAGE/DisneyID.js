!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(process){!function(definition){if("function"==typeof bootstrap)bootstrap("promise",definition);else if("object"==typeof exports&&"object"==typeof module)module.exports=definition();else if("function"==typeof define&&define.amd)define(definition);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=definition}else Q=definition()}(function(){"use strict";function uncurryThis(f){return function(){return call.apply(f,arguments)}}function isObject(value){return value===Object(value)}function isStopIteration(exception){return"[object StopIteration]"===object_toString(exception)||exception instanceof QReturnValue}function makeStackTraceLong(error,promise){if(hasStacks&&promise.stack&&"object"==typeof error&&null!==error&&error.stack&&-1===error.stack.indexOf(STACK_JUMP_SEPARATOR)){for(var stacks=[],p=promise;p;p=p.source)p.stack&&stacks.unshift(p.stack);stacks.unshift(error.stack);var concatedStacks=stacks.join("\n"+STACK_JUMP_SEPARATOR+"\n");error.stack=filterStackString(concatedStacks)}}function filterStackString(stackString){for(var lines=stackString.split("\n"),desiredLines=[],i=0;i<lines.length;++i){var line=lines[i];isInternalFrame(line)||isNodeFrame(line)||!line||desiredLines.push(line)}return desiredLines.join("\n")}function isNodeFrame(stackLine){return-1!==stackLine.indexOf("(module.js:")||-1!==stackLine.indexOf("(node.js:")}function getFileNameAndLineNumber(stackLine){var attempt1=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(stackLine);if(attempt1)return[attempt1[1],Number(attempt1[2])];var attempt2=/at ([^ ]+):(\d+):(?:\d+)$/.exec(stackLine);if(attempt2)return[attempt2[1],Number(attempt2[2])];var attempt3=/.*@(.+):(\d+)$/.exec(stackLine);return attempt3?[attempt3[1],Number(attempt3[2])]:void 0}function isInternalFrame(stackLine){var fileNameAndLineNumber=getFileNameAndLineNumber(stackLine);if(!fileNameAndLineNumber)return!1;var fileName=fileNameAndLineNumber[0],lineNumber=fileNameAndLineNumber[1];return fileName===qFileName&&lineNumber>=qStartingLine&&qEndingLine>=lineNumber}function captureLine(){if(hasStacks)try{throw new Error}catch(e){var lines=e.stack.split("\n"),firstLine=lines[0].indexOf("@")>0?lines[1]:lines[2],fileNameAndLineNumber=getFileNameAndLineNumber(firstLine);if(!fileNameAndLineNumber)return;return qFileName=fileNameAndLineNumber[0],fileNameAndLineNumber[1]}}function deprecate(callback,name,alternative){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(name+" is deprecated, use "+alternative+" instead.",new Error("").stack),callback.apply(callback,arguments)}}function Q(value){return value instanceof Promise?value:isPromiseAlike(value)?coerce(value):fulfill(value)}function defer(){function become(newPromise){resolvedPromise=newPromise,promise.source=newPromise,array_reduce(messages,function(undefined,message){nextTick(function(){newPromise.promiseDispatch.apply(newPromise,message)})},void 0),messages=void 0,progressListeners=void 0}var resolvedPromise,messages=[],progressListeners=[],deferred=object_create(defer.prototype),promise=object_create(Promise.prototype);if(promise.promiseDispatch=function(resolve,op,operands){var args=array_slice(arguments);messages?(messages.push(args),"when"===op&&operands[1]&&progressListeners.push(operands[1])):nextTick(function(){resolvedPromise.promiseDispatch.apply(resolvedPromise,args)})},promise.valueOf=function(){if(messages)return promise;var nearerValue=nearer(resolvedPromise);return isPromise(nearerValue)&&(resolvedPromise=nearerValue),nearerValue},promise.inspect=function(){return resolvedPromise?resolvedPromise.inspect():{state:"pending"}},Q.longStackSupport&&hasStacks)try{throw new Error}catch(e){promise.stack=e.stack.substring(e.stack.indexOf("\n")+1)}return deferred.promise=promise,deferred.resolve=function(value){resolvedPromise||become(Q(value))},deferred.fulfill=function(value){resolvedPromise||become(fulfill(value))},deferred.reject=function(reason){resolvedPromise||become(reject(reason))},deferred.notify=function(progress){resolvedPromise||array_reduce(progressListeners,function(undefined,progressListener){nextTick(function(){progressListener(progress)})},void 0)},deferred}function promise(resolver){if("function"!=typeof resolver)throw new TypeError("resolver must be a function.");var deferred=defer();try{resolver(deferred.resolve,deferred.reject,deferred.notify)}catch(reason){deferred.reject(reason)}return deferred.promise}function race(answerPs){return promise(function(resolve,reject){for(var i=0,len=answerPs.length;len>i;i++)Q(answerPs[i]).then(resolve,reject)})}function Promise(descriptor,fallback,inspect){void 0===fallback&&(fallback=function(op){return reject(new Error("Promise does not support operation: "+op))}),void 0===inspect&&(inspect=function(){return{state:"unknown"}});var promise=object_create(Promise.prototype);if(promise.promiseDispatch=function(resolve,op,args){var result;try{result=descriptor[op]?descriptor[op].apply(promise,args):fallback.call(promise,op,args)}catch(exception){result=reject(exception)}resolve&&resolve(result)},promise.inspect=inspect,inspect){var inspected=inspect();"rejected"===inspected.state&&(promise.exception=inspected.reason),promise.valueOf=function(){var inspected=inspect();return"pending"===inspected.state||"rejected"===inspected.state?promise:inspected.value}}return promise}function when(value,fulfilled,rejected,progressed){return Q(value).then(fulfilled,rejected,progressed)}function nearer(value){if(isPromise(value)){var inspected=value.inspect();if("fulfilled"===inspected.state)return inspected.value}return value}function isPromise(object){return isObject(object)&&"function"==typeof object.promiseDispatch&&"function"==typeof object.inspect}function isPromiseAlike(object){return isObject(object)&&"function"==typeof object.then}function isPending(object){return isPromise(object)&&"pending"===object.inspect().state}function isFulfilled(object){return!isPromise(object)||"fulfilled"===object.inspect().state}function isRejected(object){return isPromise(object)&&"rejected"===object.inspect().state}function resetUnhandledRejections(){unhandledReasons.length=0,unhandledRejections.length=0,trackUnhandledRejections||(trackUnhandledRejections=!0)}function trackRejection(promise,reason){trackUnhandledRejections&&(unhandledRejections.push(promise),unhandledReasons.push(reason&&"undefined"!=typeof reason.stack?reason.stack:"(no stack) "+reason))}function untrackRejection(promise){if(trackUnhandledRejections){var at=array_indexOf(unhandledRejections,promise);-1!==at&&(unhandledRejections.splice(at,1),unhandledReasons.splice(at,1))}}function reject(reason){var rejection=Promise({when:function(rejected){return rejected&&untrackRejection(this),rejected?rejected(reason):this}},function(){return this},function(){return{state:"rejected",reason:reason}});return trackRejection(rejection,reason),rejection}function fulfill(value){return Promise({when:function(){return value},get:function(name){return value[name]},set:function(name,rhs){value[name]=rhs},"delete":function(name){delete value[name]},post:function(name,args){return null===name||void 0===name?value.apply(void 0,args):value[name].apply(value,args)},apply:function(thisp,args){return value.apply(thisp,args)},keys:function(){return object_keys(value)}},void 0,function(){return{state:"fulfilled",value:value}})}function coerce(promise){var deferred=defer();return nextTick(function(){try{promise.then(deferred.resolve,deferred.reject,deferred.notify)}catch(exception){deferred.reject(exception)}}),deferred.promise}function master(object){return Promise({isDef:function(){}},function(op,args){return dispatch(object,op,args)},function(){return Q(object).inspect()})}function spread(value,fulfilled,rejected){return Q(value).spread(fulfilled,rejected)}function async(makeGenerator){return function(){function continuer(verb,arg){var result;if("undefined"==typeof StopIteration){try{result=generator[verb](arg)}catch(exception){return reject(exception)}return result.done?Q(result.value):when(result.value,callback,errback)}try{result=generator[verb](arg)}catch(exception){return isStopIteration(exception)?Q(exception.value):reject(exception)}return when(result,callback,errback)}var generator=makeGenerator.apply(this,arguments),callback=continuer.bind(continuer,"next"),errback=continuer.bind(continuer,"throw");return callback()}}function spawn(makeGenerator){Q.done(Q.async(makeGenerator)())}function _return(value){throw new QReturnValue(value)}function promised(callback){return function(){return spread([this,all(arguments)],function(self,args){return callback.apply(self,args)})}}function dispatch(object,op,args){return Q(object).dispatch(op,args)}function all(promises){return when(promises,function(promises){var countDown=0,deferred=defer();return array_reduce(promises,function(undefined,promise,index){var snapshot;isPromise(promise)&&"fulfilled"===(snapshot=promise.inspect()).state?promises[index]=snapshot.value:(++countDown,when(promise,function(value){promises[index]=value,0===--countDown&&deferred.resolve(promises)},deferred.reject,function(progress){deferred.notify({index:index,value:progress})}))},void 0),0===countDown&&deferred.resolve(promises),deferred.promise})}function allResolved(promises){return when(promises,function(promises){return promises=array_map(promises,Q),when(all(array_map(promises,function(promise){return when(promise,noop,noop)})),function(){return promises})})}function allSettled(promises){return Q(promises).allSettled()}function progress(object,progressed){return Q(object).then(void 0,void 0,progressed)}function nodeify(object,nodeback){return Q(object).nodeify(nodeback)}var hasStacks=!1;try{throw new Error}catch(e){hasStacks=!!e.stack}var qFileName,QReturnValue,qStartingLine=captureLine(),noop=function(){},nextTick=function(){function flush(){for(;head.next;){head=head.next;var task=head.task;head.task=void 0;var domain=head.domain;domain&&(head.domain=void 0,domain.enter());try{task()}catch(e){if(isNodeJS)throw domain&&domain.exit(),setTimeout(flush,0),domain&&domain.enter(),e;setTimeout(function(){throw e},0)}domain&&domain.exit()}flushing=!1}var head={task:void 0,next:null},tail=head,flushing=!1,requestTick=void 0,isNodeJS=!1;if(nextTick=function(task){tail=tail.next={task:task,domain:isNodeJS&&process.domain,next:null},flushing||(flushing=!0,requestTick())},"undefined"!=typeof process&&process.nextTick)isNodeJS=!0,requestTick=function(){process.nextTick(flush)};else if("function"==typeof setImmediate)requestTick="undefined"!=typeof window?setImmediate.bind(window,flush):function(){setImmediate(flush)};else if("undefined"!=typeof MessageChannel){var channel=new MessageChannel;channel.port1.onmessage=function(){requestTick=requestPortTick,channel.port1.onmessage=flush,flush()};var requestPortTick=function(){channel.port2.postMessage(0)};requestTick=function(){setTimeout(flush,0),requestPortTick()}}else requestTick=function(){setTimeout(flush,0)};return nextTick}(),call=Function.call,array_slice=uncurryThis(Array.prototype.slice),array_reduce=uncurryThis(Array.prototype.reduce||function(callback,basis){var index=0,length=this.length;if(1===arguments.length)for(;;){if(index in this){basis=this[index++];break}if(++index>=length)throw new TypeError}for(;length>index;index++)index in this&&(basis=callback(basis,this[index],index));return basis}),array_indexOf=uncurryThis(Array.prototype.indexOf||function(value){for(var i=0;i<this.length;i++)if(this[i]===value)return i;return-1}),array_map=uncurryThis(Array.prototype.map||function(callback,thisp){var self=this,collect=[];return array_reduce(self,function(undefined,value,index){collect.push(callback.call(thisp,value,index,self))},void 0),collect}),object_create=Object.create||function(prototype){function Type(){}return Type.prototype=prototype,new Type},object_hasOwnProperty=uncurryThis(Object.prototype.hasOwnProperty),object_keys=Object.keys||function(object){var keys=[];for(var key in object)object_hasOwnProperty(object,key)&&keys.push(key);return keys},object_toString=uncurryThis(Object.prototype.toString);QReturnValue="undefined"!=typeof ReturnValue?ReturnValue:function(value){this.value=value};var STACK_JUMP_SEPARATOR="From previous event:";Q.resolve=Q,Q.nextTick=nextTick,Q.longStackSupport=!1,Q.defer=defer,defer.prototype.makeNodeResolver=function(){var self=this;return function(error,value){error?self.reject(error):self.resolve(arguments.length>2?array_slice(arguments,1):value)}},Q.Promise=promise,Q.promise=promise,promise.race=race,promise.all=all,promise.reject=reject,promise.resolve=Q,Q.passByCopy=function(object){return object},Promise.prototype.passByCopy=function(){return this},Q.join=function(x,y){return Q(x).join(y)},Promise.prototype.join=function(that){return Q([this,that]).spread(function(x,y){if(x===y)return x;throw new Error("Can't join: not the same: "+x+" "+y)})},Q.race=race,Promise.prototype.race=function(){return this.then(Q.race)},Q.makePromise=Promise,Promise.prototype.toString=function(){return"[object Promise]"},Promise.prototype.then=function(fulfilled,rejected,progressed){function _fulfilled(value){try{return"function"==typeof fulfilled?fulfilled(value):value}catch(exception){return reject(exception)}}function _rejected(exception){if("function"==typeof rejected){makeStackTraceLong(exception,self);try{return rejected(exception)}catch(newException){return reject(newException)}}return reject(exception)}function _progressed(value){return"function"==typeof progressed?progressed(value):value}var self=this,deferred=defer(),done=!1;return nextTick(function(){self.promiseDispatch(function(value){done||(done=!0,deferred.resolve(_fulfilled(value)))},"when",[function(exception){done||(done=!0,deferred.resolve(_rejected(exception)))}])}),self.promiseDispatch(void 0,"when",[void 0,function(value){var newValue,threw=!1;try{newValue=_progressed(value)}catch(e){if(threw=!0,!Q.onerror)throw e;Q.onerror(e)}threw||deferred.notify(newValue)}]),deferred.promise},Q.when=when,Promise.prototype.thenResolve=function(value){return this.then(function(){return value})},Q.thenResolve=function(promise,value){return Q(promise).thenResolve(value)},Promise.prototype.thenReject=function(reason){return this.then(function(){throw reason})},Q.thenReject=function(promise,reason){return Q(promise).thenReject(reason)},Q.nearer=nearer,Q.isPromise=isPromise,Q.isPromiseAlike=isPromiseAlike,Q.isPending=isPending,Promise.prototype.isPending=function(){return"pending"===this.inspect().state},Q.isFulfilled=isFulfilled,Promise.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},Q.isRejected=isRejected,Promise.prototype.isRejected=function(){return"rejected"===this.inspect().state};var unhandledReasons=[],unhandledRejections=[],trackUnhandledRejections=!0;Q.resetUnhandledRejections=resetUnhandledRejections,Q.getUnhandledReasons=function(){return unhandledReasons.slice()},Q.stopUnhandledRejectionTracking=function(){resetUnhandledRejections(),trackUnhandledRejections=!1},resetUnhandledRejections(),Q.reject=reject,Q.fulfill=fulfill,Q.master=master,Q.spread=spread,Promise.prototype.spread=function(fulfilled,rejected){return this.all().then(function(array){return fulfilled.apply(void 0,array)},rejected)},Q.async=async,Q.spawn=spawn,Q["return"]=_return,Q.promised=promised,Q.dispatch=dispatch,Promise.prototype.dispatch=function(op,args){var self=this,deferred=defer();return nextTick(function(){self.promiseDispatch(deferred.resolve,op,args)}),deferred.promise},Q.get=function(object,key){return Q(object).dispatch("get",[key])},Promise.prototype.get=function(key){return this.dispatch("get",[key])},Q.set=function(object,key,value){return Q(object).dispatch("set",[key,value])},Promise.prototype.set=function(key,value){return this.dispatch("set",[key,value])},Q.del=Q["delete"]=function(object,key){return Q(object).dispatch("delete",[key])},Promise.prototype.del=Promise.prototype["delete"]=function(key){return this.dispatch("delete",[key])},Q.mapply=Q.post=function(object,name,args){return Q(object).dispatch("post",[name,args])},Promise.prototype.mapply=Promise.prototype.post=function(name,args){return this.dispatch("post",[name,args])},Q.send=Q.mcall=Q.invoke=function(object,name){return Q(object).dispatch("post",[name,array_slice(arguments,2)])},Promise.prototype.send=Promise.prototype.mcall=Promise.prototype.invoke=function(name){return this.dispatch("post",[name,array_slice(arguments,1)])},Q.fapply=function(object,args){return Q(object).dispatch("apply",[void 0,args])},Promise.prototype.fapply=function(args){return this.dispatch("apply",[void 0,args])},Q["try"]=Q.fcall=function(object){return Q(object).dispatch("apply",[void 0,array_slice(arguments,1)])},Promise.prototype.fcall=function(){return this.dispatch("apply",[void 0,array_slice(arguments)])},Q.fbind=function(object){var promise=Q(object),args=array_slice(arguments,1);return function(){return promise.dispatch("apply",[this,args.concat(array_slice(arguments))])}},Promise.prototype.fbind=function(){var promise=this,args=array_slice(arguments);return function(){return promise.dispatch("apply",[this,args.concat(array_slice(arguments))])}},Q.keys=function(object){return Q(object).dispatch("keys",[])},Promise.prototype.keys=function(){return this.dispatch("keys",[])},Q.all=all,Promise.prototype.all=function(){return all(this)},Q.allResolved=deprecate(allResolved,"allResolved","allSettled"),Promise.prototype.allResolved=function(){return allResolved(this)},Q.allSettled=allSettled,Promise.prototype.allSettled=function(){return this.then(function(promises){return all(array_map(promises,function(promise){function regardless(){return promise.inspect()}return promise=Q(promise),promise.then(regardless,regardless)}))})},Q.fail=Q["catch"]=function(object,rejected){return Q(object).then(void 0,rejected)},Promise.prototype.fail=Promise.prototype["catch"]=function(rejected){return this.then(void 0,rejected)},Q.progress=progress,Promise.prototype.progress=function(progressed){return this.then(void 0,void 0,progressed)},Q.fin=Q["finally"]=function(object,callback){return Q(object)["finally"](callback)},Promise.prototype.fin=Promise.prototype["finally"]=function(callback){return callback=Q(callback),this.then(function(value){return callback.fcall().then(function(){return value})},function(reason){return callback.fcall().then(function(){throw reason})})},Q.done=function(object,fulfilled,rejected,progress){return Q(object).done(fulfilled,rejected,progress)},Promise.prototype.done=function(fulfilled,rejected,progress){var onUnhandledError=function(error){nextTick(function(){if(makeStackTraceLong(error,promise),!Q.onerror)throw error;Q.onerror(error)})},promise=fulfilled||rejected||progress?this.then(fulfilled,rejected,progress):this;"object"==typeof process&&process&&process.domain&&(onUnhandledError=process.domain.bind(onUnhandledError)),promise.then(void 0,onUnhandledError)},Q.timeout=function(object,ms,error){return Q(object).timeout(ms,error)},Promise.prototype.timeout=function(ms,error){var deferred=defer(),timeoutId=setTimeout(function(){error&&"string"!=typeof error||(error=new Error(error||"Timed out after "+ms+" ms"),error.code="ETIMEDOUT"),deferred.reject(error)},ms);return this.then(function(value){clearTimeout(timeoutId),deferred.resolve(value)},function(exception){clearTimeout(timeoutId),deferred.reject(exception)},deferred.notify),deferred.promise},Q.delay=function(object,timeout){return void 0===timeout&&(timeout=object,object=void 0),Q(object).delay(timeout)},Promise.prototype.delay=function(timeout){return this.then(function(value){var deferred=defer();return setTimeout(function(){deferred.resolve(value)},timeout),deferred.promise})},Q.nfapply=function(callback,args){return Q(callback).nfapply(args)},Promise.prototype.nfapply=function(args){var deferred=defer(),nodeArgs=array_slice(args);return nodeArgs.push(deferred.makeNodeResolver()),this.fapply(nodeArgs).fail(deferred.reject),deferred.promise},Q.nfcall=function(callback){var args=array_slice(arguments,1);return Q(callback).nfapply(args)},Promise.prototype.nfcall=function(){var nodeArgs=array_slice(arguments),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),this.fapply(nodeArgs).fail(deferred.reject),deferred.promise},Q.nfbind=Q.denodeify=function(callback){var baseArgs=array_slice(arguments,1);return function(){var nodeArgs=baseArgs.concat(array_slice(arguments)),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),Q(callback).fapply(nodeArgs).fail(deferred.reject),deferred.promise}},Promise.prototype.nfbind=Promise.prototype.denodeify=function(){var args=array_slice(arguments);return args.unshift(this),Q.denodeify.apply(void 0,args)},Q.nbind=function(callback,thisp){var baseArgs=array_slice(arguments,2);return function(){function bound(){return callback.apply(thisp,arguments)}var nodeArgs=baseArgs.concat(array_slice(arguments)),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),Q(bound).fapply(nodeArgs).fail(deferred.reject),deferred.promise}},Promise.prototype.nbind=function(){var args=array_slice(arguments,0);return args.unshift(this),Q.nbind.apply(void 0,args)},Q.nmapply=Q.npost=function(object,name,args){return Q(object).npost(name,args)},Promise.prototype.nmapply=Promise.prototype.npost=function(name,args){var nodeArgs=array_slice(args||[]),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),this.dispatch("post",[name,nodeArgs]).fail(deferred.reject),deferred.promise},Q.nsend=Q.nmcall=Q.ninvoke=function(object,name){var nodeArgs=array_slice(arguments,2),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),Q(object).dispatch("post",[name,nodeArgs]).fail(deferred.reject),deferred.promise},Promise.prototype.nsend=Promise.prototype.nmcall=Promise.prototype.ninvoke=function(name){var nodeArgs=array_slice(arguments,1),deferred=defer();return nodeArgs.push(deferred.makeNodeResolver()),this.dispatch("post",[name,nodeArgs]).fail(deferred.reject),deferred.promise},Q.nodeify=nodeify,Promise.prototype.nodeify=function(nodeback){return nodeback?void this.then(function(value){nextTick(function(){nodeback(null,value)})},function(error){nextTick(function(){nodeback(error)})}):this};var qEndingLine=captureLine();return Q})}).call(this,require("_process"))},{_process:4}],2:[function(require,module,exports){"use strict";var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(message){this.toString=function(){return"CORRUPT: "+this.message},this.message=message},invalid:function(message){this.toString=function(){return"INVALID: "+this.message},this.message=message},bug:function(message){this.toString=function(){return"BUG: "+this.message},this.message=message},notReady:function(message){this.toString=function(){return"NOT READY: "+this.message},this.message=message}}};"undefined"!=typeof module&&module.exports&&(module.exports=sjcl),"function"==typeof define&&define([],function(){return sjcl}),sjcl.cipher.aes=function(key){this._tables[0][0][0]||this._precompute();var i,j,tmp,encKey,decKey,sbox=this._tables[0][4],decTable=this._tables[1],keyLen=key.length,rcon=1;if(4!==keyLen&&6!==keyLen&&8!==keyLen)throw new sjcl.exception.invalid("invalid aes key size");for(this._key=[encKey=key.slice(0),decKey=[]],i=keyLen;4*keyLen+28>i;i++)tmp=encKey[i-1],(i%keyLen===0||8===keyLen&&i%keyLen===4)&&(tmp=sbox[tmp>>>24]<<24^sbox[tmp>>16&255]<<16^sbox[tmp>>8&255]<<8^sbox[255&tmp],i%keyLen===0&&(tmp=tmp<<8^tmp>>>24^rcon<<24,rcon=rcon<<1^283*(rcon>>7))),encKey[i]=encKey[i-keyLen]^tmp;for(j=0;i;j++,i--)tmp=encKey[3&j?i:i-4],decKey[j]=4>=i||4>j?tmp:decTable[0][sbox[tmp>>>24]]^decTable[1][sbox[tmp>>16&255]]^decTable[2][sbox[tmp>>8&255]]^decTable[3][sbox[255&tmp]]},sjcl.cipher.aes.prototype={encrypt:function(data){return this._crypt(data,0)},decrypt:function(data){return this._crypt(data,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var i,x,xInv,x2,x4,x8,s,tEnc,tDec,encTable=this._tables[0],decTable=this._tables[1],sbox=encTable[4],sboxInv=decTable[4],d=[],th=[];for(i=0;256>i;i++)th[(d[i]=i<<1^283*(i>>7))^i]=i;for(x=xInv=0;!sbox[x];x^=x2||1,xInv=th[xInv]||1)for(s=xInv^xInv<<1^xInv<<2^xInv<<3^xInv<<4,s=s>>8^255&s^99,sbox[x]=s,sboxInv[s]=x,x8=d[x4=d[x2=d[x]]],tDec=16843009*x8^65537*x4^257*x2^16843008*x,tEnc=257*d[s]^16843008*s,i=0;4>i;i++)encTable[i][x]=tEnc=tEnc<<24^tEnc>>>8,decTable[i][s]=tDec=tDec<<24^tDec>>>8;for(i=0;5>i;i++)encTable[i]=encTable[i].slice(0),decTable[i]=decTable[i].slice(0)},_crypt:function(input,dir){if(4!==input.length)throw new sjcl.exception.invalid("invalid aes block size");var a2,b2,c2,i,key=this._key[dir],a=input[0]^key[0],b=input[dir?3:1]^key[1],c=input[2]^key[2],d=input[dir?1:3]^key[3],nInnerRounds=key.length/4-2,kIndex=4,out=[0,0,0,0],table=this._tables[dir],t0=table[0],t1=table[1],t2=table[2],t3=table[3],sbox=table[4];for(i=0;nInnerRounds>i;i++)a2=t0[a>>>24]^t1[b>>16&255]^t2[c>>8&255]^t3[255&d]^key[kIndex],b2=t0[b>>>24]^t1[c>>16&255]^t2[d>>8&255]^t3[255&a]^key[kIndex+1],c2=t0[c>>>24]^t1[d>>16&255]^t2[a>>8&255]^t3[255&b]^key[kIndex+2],d=t0[d>>>24]^t1[a>>16&255]^t2[b>>8&255]^t3[255&c]^key[kIndex+3],kIndex+=4,a=a2,b=b2,c=c2;for(i=0;4>i;i++)out[dir?3&-i:i]=sbox[a>>>24]<<24^sbox[b>>16&255]<<16^sbox[c>>8&255]<<8^sbox[255&d]^key[kIndex++],a2=a,a=b,b=c,c=d,d=a2;return out}},sjcl.bitArray={bitSlice:function(a,bstart,bend){return a=sjcl.bitArray._shiftRight(a.slice(bstart/32),32-(31&bstart)).slice(1),void 0===bend?a:sjcl.bitArray.clamp(a,bend-bstart)},extract:function(a,bstart,blength){var x,sh=Math.floor(-bstart-blength&31);return x=-32&(bstart+blength-1^bstart)?a[bstart/32|0]<<32-sh^a[bstart/32+1|0]>>>sh:a[bstart/32|0]>>>sh,x&(1<<blength)-1},concat:function(a1,a2){if(0===a1.length||0===a2.length)return a1.concat(a2);var last=a1[a1.length-1],shift=sjcl.bitArray.getPartial(last);return 32===shift?a1.concat(a2):sjcl.bitArray._shiftRight(a2,shift,0|last,a1.slice(0,a1.length-1))},bitLength:function(a){var x,l=a.length;return 0===l?0:(x=a[l-1],32*(l-1)+sjcl.bitArray.getPartial(x))},clamp:function(a,len){if(32*a.length<len)return a;a=a.slice(0,Math.ceil(len/32));var l=a.length;return len=31&len,l>0&&len&&(a[l-1]=sjcl.bitArray.partial(len,a[l-1]&2147483648>>len-1,1)),a},partial:function(len,x,_end){return 32===len?x:(_end?0|x:x<<32-len)+1099511627776*len},getPartial:function(x){return Math.round(x/1099511627776)||32},equal:function(a,b){if(sjcl.bitArray.bitLength(a)!==sjcl.bitArray.bitLength(b))return!1;var i,x=0;for(i=0;i<a.length;i++)x|=a[i]^b[i];return 0===x},_shiftRight:function(a,shift,carry,out){var i,shift2,last2=0;for(void 0===out&&(out=[]);shift>=32;shift-=32)out.push(carry),carry=0;if(0===shift)return out.concat(a);for(i=0;i<a.length;i++)out.push(carry|a[i]>>>shift),carry=a[i]<<32-shift;return last2=a.length?a[a.length-1]:0,shift2=sjcl.bitArray.getPartial(last2),out.push(sjcl.bitArray.partial(shift+shift2&31,shift+shift2>32?carry:out.pop(),1)),out},_xor4:function(x,y){return[x[0]^y[0],x[1]^y[1],x[2]^y[2],x[3]^y[3]]},byteswapM:function(a){var i,v,m=65280;for(i=0;i<a.length;++i)v=a[i],a[i]=v>>>24|v>>>8&m|(v&m)<<8|v<<24;return a}},sjcl.codec.utf8String={fromBits:function(arr){var i,tmp,out="",bl=sjcl.bitArray.bitLength(arr);for(i=0;bl/8>i;i++)0===(3&i)&&(tmp=arr[i/4]),out+=String.fromCharCode(tmp>>>24),tmp<<=8;return decodeURIComponent(escape(out))},toBits:function(str){str=unescape(encodeURIComponent(str));var i,out=[],tmp=0;for(i=0;i<str.length;i++)tmp=tmp<<8|str.charCodeAt(i),3===(3&i)&&(out.push(tmp),tmp=0);return 3&i&&out.push(sjcl.bitArray.partial(8*(3&i),tmp)),out}},sjcl.codec.hex={fromBits:function(arr){var i,out="";for(i=0;i<arr.length;i++)out+=((0|arr[i])+0xf00000000000).toString(16).substr(4);return out.substr(0,sjcl.bitArray.bitLength(arr)/4)},toBits:function(str){var i,len,out=[];for(str=str.replace(/\s|0x/g,""),len=str.length,str+="00000000",i=0;i<str.length;i+=8)out.push(0^parseInt(str.substr(i,8),16));return sjcl.bitArray.clamp(out,4*len)}},sjcl.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(arr,_noEquals,_url){var i,out="",bits=0,c=sjcl.codec.base64._chars,ta=0,bl=sjcl.bitArray.bitLength(arr);for(_url&&(c=c.substr(0,62)+"-_"),i=0;6*out.length<bl;)out+=c.charAt((ta^arr[i]>>>bits)>>>26),6>bits?(ta=arr[i]<<6-bits,bits+=26,i++):(ta<<=6,bits-=6);for(;3&out.length&&!_noEquals;)out+="=";return out},toBits:function(str,_url){str=str.replace(/\s|=/g,"");var i,x,out=[],bits=0,c=sjcl.codec.base64._chars,ta=0;for(_url&&(c=c.substr(0,62)+"-_"),i=0;i<str.length;i++){if(x=c.indexOf(str.charAt(i)),0>x)throw new sjcl.exception.invalid("this isn't base64!");bits>26?(bits-=26,out.push(ta^x>>>bits),ta=x<<32-bits):(bits+=6,ta^=x<<32-bits)}return 56&bits&&out.push(sjcl.bitArray.partial(56&bits,ta,1)),out}},sjcl.codec.base64url={fromBits:function(arr){return sjcl.codec.base64.fromBits(arr,1,1)},toBits:function(str){return sjcl.codec.base64.toBits(str,1)}},sjcl.hash.sha256=function(hash){this._key[0]||this._precompute(),hash?(this._h=hash._h.slice(0),this._buffer=hash._buffer.slice(0),this._length=hash._length):this.reset()},sjcl.hash.sha256.hash=function(data){return(new sjcl.hash.sha256).update(data).finalize()},sjcl.hash.sha256.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(data){"string"==typeof data&&(data=sjcl.codec.utf8String.toBits(data));var i,b=this._buffer=sjcl.bitArray.concat(this._buffer,data),ol=this._length,nl=this._length=ol+sjcl.bitArray.bitLength(data);for(i=512+ol&-512;nl>=i;i+=512)this._block(b.splice(0,16));return this},finalize:function(){var i,b=this._buffer,h=this._h;for(b=sjcl.bitArray.concat(b,[sjcl.bitArray.partial(1,1)]),i=b.length+2;15&i;i++)b.push(0);for(b.push(Math.floor(this._length/4294967296)),b.push(0|this._length);b.length;)this._block(b.splice(0,16));return this.reset(),h},_init:[],_key:[],_precompute:function(){function frac(x){return 4294967296*(x-Math.floor(x))|0}var factor,i=0,prime=2;outer:for(;64>i;prime++){for(factor=2;prime>=factor*factor;factor++)if(prime%factor===0)continue outer;8>i&&(this._init[i]=frac(Math.pow(prime,.5))),this._key[i]=frac(Math.pow(prime,1/3)),i++}},_block:function(words){var i,tmp,a,b,w=words.slice(0),h=this._h,k=this._key,h0=h[0],h1=h[1],h2=h[2],h3=h[3],h4=h[4],h5=h[5],h6=h[6],h7=h[7];for(i=0;64>i;i++)16>i?tmp=w[i]:(a=w[i+1&15],b=w[i+14&15],tmp=w[15&i]=(a>>>7^a>>>18^a>>>3^a<<25^a<<14)+(b>>>17^b>>>19^b>>>10^b<<15^b<<13)+w[15&i]+w[i+9&15]|0),tmp=tmp+h7+(h4>>>6^h4>>>11^h4>>>25^h4<<26^h4<<21^h4<<7)+(h6^h4&(h5^h6))+k[i],h7=h6,h6=h5,h5=h4,h4=h3+tmp|0,h3=h2,h2=h1,h1=h0,h0=tmp+(h1&h2^h3&(h1^h2))+(h1>>>2^h1>>>13^h1>>>22^h1<<30^h1<<19^h1<<10)|0;h[0]=h[0]+h0|0,h[1]=h[1]+h1|0,h[2]=h[2]+h2|0,h[3]=h[3]+h3|0,h[4]=h[4]+h4|0,h[5]=h[5]+h5|0,h[6]=h[6]+h6|0,h[7]=h[7]+h7|0}},sjcl.mode.ccm={name:"ccm",encrypt:function(prf,plaintext,iv,adata,tlen){var L,tag,out=plaintext.slice(0),w=sjcl.bitArray,ivl=w.bitLength(iv)/8,ol=w.bitLength(out)/8;if(tlen=tlen||64,adata=adata||[],7>ivl)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(L=2;4>L&&ol>>>8*L;L++);return 15-ivl>L&&(L=15-ivl),iv=w.clamp(iv,8*(15-L)),tag=sjcl.mode.ccm._computeTag(prf,plaintext,iv,adata,tlen,L),out=sjcl.mode.ccm._ctrMode(prf,out,iv,tag,tlen,L),w.concat(out.data,out.tag)},decrypt:function(prf,ciphertext,iv,adata,tlen){tlen=tlen||64,adata=adata||[];var L,tag2,w=sjcl.bitArray,ivl=w.bitLength(iv)/8,ol=w.bitLength(ciphertext),out=w.clamp(ciphertext,ol-tlen),tag=w.bitSlice(ciphertext,ol-tlen);

if(ol=(ol-tlen)/8,7>ivl)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(L=2;4>L&&ol>>>8*L;L++);if(15-ivl>L&&(L=15-ivl),iv=w.clamp(iv,8*(15-L)),out=sjcl.mode.ccm._ctrMode(prf,out,iv,tag,tlen,L),tag2=sjcl.mode.ccm._computeTag(prf,out.data,iv,adata,tlen,L),!w.equal(out.tag,tag2))throw new sjcl.exception.corrupt("ccm: tag doesn't match");return out.data},_computeTag:function(prf,plaintext,iv,adata,tlen,L){var mac,tmp,i,macData=[],w=sjcl.bitArray,xor=w._xor4;if(tlen/=8,tlen%2||4>tlen||tlen>16)throw new sjcl.exception.invalid("ccm: invalid tag length");if(adata.length>4294967295||plaintext.length>4294967295)throw new sjcl.exception.bug("ccm: can't deal with 4GiB or more data");if(mac=[w.partial(8,(adata.length?64:0)|tlen-2<<2|L-1)],mac=w.concat(mac,iv),mac[3]|=w.bitLength(plaintext)/8,mac=prf.encrypt(mac),adata.length)for(tmp=w.bitLength(adata)/8,65279>=tmp?macData=[w.partial(16,tmp)]:4294967295>=tmp&&(macData=w.concat([w.partial(16,65534)],[tmp])),macData=w.concat(macData,adata),i=0;i<macData.length;i+=4)mac=prf.encrypt(xor(mac,macData.slice(i,i+4).concat([0,0,0])));for(i=0;i<plaintext.length;i+=4)mac=prf.encrypt(xor(mac,plaintext.slice(i,i+4).concat([0,0,0])));return w.clamp(mac,8*tlen)},_ctrMode:function(prf,data,iv,tag,tlen,L){var enc,i,ctr,w=sjcl.bitArray,xor=w._xor4,l=data.length,bl=w.bitLength(data);if(ctr=w.concat([w.partial(8,L-1)],iv).concat([0,0,0]).slice(0,4),tag=w.bitSlice(xor(tag,prf.encrypt(ctr)),0,tlen),!l)return{tag:tag,data:[]};for(i=0;l>i;i+=4)ctr[3]++,enc=prf.encrypt(ctr),data[i]^=enc[0],data[i+1]^=enc[1],data[i+2]^=enc[2],data[i+3]^=enc[3];return{tag:tag,data:w.clamp(data,bl)}}},sjcl.mode.ocb2={name:"ocb2",encrypt:function(prp,plaintext,iv,adata,tlen,premac){if(128!==sjcl.bitArray.bitLength(iv))throw new sjcl.exception.invalid("ocb iv must be 128 bits");var i,bi,bl,pad,times2=sjcl.mode.ocb2._times2,w=sjcl.bitArray,xor=w._xor4,checksum=[0,0,0,0],delta=times2(prp.encrypt(iv)),output=[];for(adata=adata||[],tlen=tlen||64,i=0;i+4<plaintext.length;i+=4)bi=plaintext.slice(i,i+4),checksum=xor(checksum,bi),output=output.concat(xor(delta,prp.encrypt(xor(delta,bi)))),delta=times2(delta);return bi=plaintext.slice(i),bl=w.bitLength(bi),pad=prp.encrypt(xor(delta,[0,0,0,bl])),bi=w.clamp(xor(bi.concat([0,0,0]),pad),bl),checksum=xor(checksum,xor(bi.concat([0,0,0]),pad)),checksum=prp.encrypt(xor(checksum,xor(delta,times2(delta)))),adata.length&&(checksum=xor(checksum,premac?adata:sjcl.mode.ocb2.pmac(prp,adata))),output.concat(w.concat(bi,w.clamp(checksum,tlen)))},decrypt:function(prp,ciphertext,iv,adata,tlen,premac){if(128!==sjcl.bitArray.bitLength(iv))throw new sjcl.exception.invalid("ocb iv must be 128 bits");tlen=tlen||64;var i,bi,bl,pad,times2=sjcl.mode.ocb2._times2,w=sjcl.bitArray,xor=w._xor4,checksum=[0,0,0,0],delta=times2(prp.encrypt(iv)),len=sjcl.bitArray.bitLength(ciphertext)-tlen,output=[];for(adata=adata||[],i=0;len/32>i+4;i+=4)bi=xor(delta,prp.decrypt(xor(delta,ciphertext.slice(i,i+4)))),checksum=xor(checksum,bi),output=output.concat(bi),delta=times2(delta);if(bl=len-32*i,pad=prp.encrypt(xor(delta,[0,0,0,bl])),bi=xor(pad,w.clamp(ciphertext.slice(i),bl).concat([0,0,0])),checksum=xor(checksum,bi),checksum=prp.encrypt(xor(checksum,xor(delta,times2(delta)))),adata.length&&(checksum=xor(checksum,premac?adata:sjcl.mode.ocb2.pmac(prp,adata))),!w.equal(w.clamp(checksum,tlen),w.bitSlice(ciphertext,len)))throw new sjcl.exception.corrupt("ocb: tag doesn't match");return output.concat(w.clamp(bi,bl))},pmac:function(prp,adata){var i,bi,times2=sjcl.mode.ocb2._times2,w=sjcl.bitArray,xor=w._xor4,checksum=[0,0,0,0],delta=prp.encrypt([0,0,0,0]);for(delta=xor(delta,times2(times2(delta))),i=0;i+4<adata.length;i+=4)delta=times2(delta),checksum=xor(checksum,prp.encrypt(xor(delta,adata.slice(i,i+4))));return bi=adata.slice(i),w.bitLength(bi)<128&&(delta=xor(delta,times2(delta)),bi=w.concat(bi,[-2147483648,0,0,0])),checksum=xor(checksum,bi),prp.encrypt(xor(times2(xor(delta,times2(delta))),checksum))},_times2:function(x){return[x[0]<<1^x[1]>>>31,x[1]<<1^x[2]>>>31,x[2]<<1^x[3]>>>31,x[3]<<1^135*(x[0]>>>31)]}},sjcl.mode.gcm={name:"gcm",encrypt:function(prf,plaintext,iv,adata,tlen){var out,data=plaintext.slice(0),w=sjcl.bitArray;return tlen=tlen||128,adata=adata||[],out=sjcl.mode.gcm._ctrMode(!0,prf,data,adata,iv,tlen),w.concat(out.data,out.tag)},decrypt:function(prf,ciphertext,iv,adata,tlen){var out,tag,data=ciphertext.slice(0),w=sjcl.bitArray,l=w.bitLength(data);if(tlen=tlen||128,adata=adata||[],l>=tlen?(tag=w.bitSlice(data,l-tlen),data=w.bitSlice(data,0,l-tlen)):(tag=data,data=[]),out=sjcl.mode.gcm._ctrMode(!1,prf,data,adata,iv,tlen),!w.equal(out.tag,tag))throw new sjcl.exception.corrupt("gcm: tag doesn't match");return out.data},_galoisMultiply:function(x,y){var i,j,xi,Zi,Vi,lsb_Vi,w=sjcl.bitArray,xor=w._xor4;for(Zi=[0,0,0,0],Vi=y.slice(0),i=0;128>i;i++){for(xi=0!==(x[Math.floor(i/32)]&1<<31-i%32),xi&&(Zi=xor(Zi,Vi)),lsb_Vi=0!==(1&Vi[3]),j=3;j>0;j--)Vi[j]=Vi[j]>>>1|(1&Vi[j-1])<<31;Vi[0]=Vi[0]>>>1,lsb_Vi&&(Vi[0]=Vi[0]^225<<24)}return Zi},_ghash:function(H,Y0,data){var Yi,i,l=data.length;for(Yi=Y0.slice(0),i=0;l>i;i+=4)Yi[0]^=4294967295&data[i],Yi[1]^=4294967295&data[i+1],Yi[2]^=4294967295&data[i+2],Yi[3]^=4294967295&data[i+3],Yi=sjcl.mode.gcm._galoisMultiply(Yi,H);return Yi},_ctrMode:function(encrypt,prf,data,adata,iv,tlen){var H,J0,S0,enc,i,ctr,tag,last,l,bl,abl,ivbl,w=sjcl.bitArray;for(l=data.length,bl=w.bitLength(data),abl=w.bitLength(adata),ivbl=w.bitLength(iv),H=prf.encrypt([0,0,0,0]),96===ivbl?(J0=iv.slice(0),J0=w.concat(J0,[1])):(J0=sjcl.mode.gcm._ghash(H,[0,0,0,0],iv),J0=sjcl.mode.gcm._ghash(H,J0,[0,0,Math.floor(ivbl/4294967296),4294967295&ivbl])),S0=sjcl.mode.gcm._ghash(H,[0,0,0,0],adata),ctr=J0.slice(0),tag=S0.slice(0),encrypt||(tag=sjcl.mode.gcm._ghash(H,S0,data)),i=0;l>i;i+=4)ctr[3]++,enc=prf.encrypt(ctr),data[i]^=enc[0],data[i+1]^=enc[1],data[i+2]^=enc[2],data[i+3]^=enc[3];return data=w.clamp(data,bl),encrypt&&(tag=sjcl.mode.gcm._ghash(H,S0,data)),last=[Math.floor(abl/4294967296),4294967295&abl,Math.floor(bl/4294967296),4294967295&bl],tag=sjcl.mode.gcm._ghash(H,tag,last),enc=prf.encrypt(J0),tag[0]^=enc[0],tag[1]^=enc[1],tag[2]^=enc[2],tag[3]^=enc[3],{tag:w.bitSlice(tag,0,tlen),data:data}}},sjcl.misc.hmac=function(key,Hash){this._hash=Hash=Hash||sjcl.hash.sha256;var i,exKey=[[],[]],bs=Hash.prototype.blockSize/32;for(this._baseHash=[new Hash,new Hash],key.length>bs&&(key=Hash.hash(key)),i=0;bs>i;i++)exKey[0][i]=909522486^key[i],exKey[1][i]=1549556828^key[i];this._baseHash[0].update(exKey[0]),this._baseHash[1].update(exKey[1]),this._resultHash=new Hash(this._baseHash[0])},sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(data){if(this._updated)throw new sjcl.exception.invalid("encrypt on already updated hmac called!");return this.update(data),this.digest(data)},sjcl.misc.hmac.prototype.reset=function(){this._resultHash=new this._hash(this._baseHash[0]),this._updated=!1},sjcl.misc.hmac.prototype.update=function(data){this._updated=!0,this._resultHash.update(data)},sjcl.misc.hmac.prototype.digest=function(){var w=this._resultHash.finalize(),result=new this._hash(this._baseHash[1]).update(w).finalize();return this.reset(),result},sjcl.misc.pbkdf2=function(password,salt,count,length,Prff){if(count=count||1e3,0>length||0>count)throw sjcl.exception.invalid("invalid params to pbkdf2");"string"==typeof password&&(password=sjcl.codec.utf8String.toBits(password)),"string"==typeof salt&&(salt=sjcl.codec.utf8String.toBits(salt)),Prff=Prff||sjcl.misc.hmac;var u,ui,i,j,k,prf=new Prff(password),out=[],b=sjcl.bitArray;for(k=1;32*out.length<(length||1);k++){for(u=ui=prf.encrypt(b.concat(salt,[k])),i=1;count>i;i++)for(ui=prf.encrypt(ui),j=0;j<ui.length;j++)u[j]^=ui[j];out=out.concat(u)}return length&&(out=b.clamp(out,length)),out},sjcl.prng=function(defaultParanoia){this._pools=[new sjcl.hash.sha256],this._poolEntropy=[0],this._reseedCount=0,this._robins={},this._eventId=0,this._collectorIds={},this._collectorIdNext=0,this._strength=0,this._poolStrength=0,this._nextReseed=0,this._key=[0,0,0,0,0,0,0,0],this._counter=[0,0,0,0],this._cipher=void 0,this._defaultParanoia=defaultParanoia,this._collectorsStarted=!1,this._callbacks={progress:{},seeded:{}},this._callbackI=0,this._NOT_READY=0,this._READY=1,this._REQUIRES_RESEED=2,this._MAX_WORDS_PER_BURST=65536,this._PARANOIA_LEVELS=[0,48,64,96,128,192,256,384,512,768,1024],this._MILLISECONDS_PER_RESEED=3e4,this._BITS_PER_RESEED=80},sjcl.prng.prototype={randomWords:function(nwords,paranoia){var i,g,out=[],readiness=this.isReady(paranoia);if(readiness===this._NOT_READY)throw new sjcl.exception.notReady("generator isn't seeded");for(readiness&this._REQUIRES_RESEED&&this._reseedFromPools(!(readiness&this._READY)),i=0;nwords>i;i+=4)(i+1)%this._MAX_WORDS_PER_BURST===0&&this._gate(),g=this._gen4words(),out.push(g[0],g[1],g[2],g[3]);return this._gate(),out.slice(0,nwords)},setDefaultParanoia:function(paranoia,allowZeroParanoia){if(0===paranoia&&"Setting paranoia=0 will ruin your security; use it only for testing"!==allowZeroParanoia)throw"Setting paranoia=0 will ruin your security; use it only for testing";this._defaultParanoia=paranoia},addEntropy:function(data,estimatedEntropy,source){source=source||"user";var id,i,tmp,objName,t=(new Date).valueOf(),robin=this._robins[source],oldReady=this.isReady(),err=0;switch(id=this._collectorIds[source],void 0===id&&(id=this._collectorIds[source]=this._collectorIdNext++),void 0===robin&&(robin=this._robins[source]=0),this._robins[source]=(this._robins[source]+1)%this._pools.length,typeof data){case"number":void 0===estimatedEntropy&&(estimatedEntropy=1),this._pools[robin].update([id,this._eventId++,1,estimatedEntropy,t,1,0|data]);break;case"object":if(objName=Object.prototype.toString.call(data),"[object Uint32Array]"===objName){for(tmp=[],i=0;i<data.length;i++)tmp.push(data[i]);data=tmp}else for("[object Array]"!==objName&&(err=1),i=0;i<data.length&&!err;i++)"number"!=typeof data[i]&&(err=1);if(!err){if(void 0===estimatedEntropy)for(estimatedEntropy=0,i=0;i<data.length;i++)for(tmp=data[i];tmp>0;)estimatedEntropy++,tmp>>>=1;this._pools[robin].update([id,this._eventId++,2,estimatedEntropy,t,data.length].concat(data))}break;case"string":void 0===estimatedEntropy&&(estimatedEntropy=data.length),this._pools[robin].update([id,this._eventId++,3,estimatedEntropy,t,data.length]),this._pools[robin].update(data);break;default:err=1}if(err)throw new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string");this._poolEntropy[robin]+=estimatedEntropy,this._poolStrength+=estimatedEntropy,oldReady===this._NOT_READY&&(this.isReady()!==this._NOT_READY&&this._fireEvent("seeded",Math.max(this._strength,this._poolStrength)),this._fireEvent("progress",this.getProgress()))},isReady:function(paranoia){var entropyRequired=this._PARANOIA_LEVELS[void 0!==paranoia?paranoia:this._defaultParanoia];return this._strength&&this._strength>=entropyRequired?this._poolEntropy[0]>this._BITS_PER_RESEED&&(new Date).valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY:this._poolStrength>=entropyRequired?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY},getProgress:function(paranoia){var entropyRequired=this._PARANOIA_LEVELS[paranoia?paranoia:this._defaultParanoia];return this._strength>=entropyRequired?1:this._poolStrength>entropyRequired?1:this._poolStrength/entropyRequired},startCollectors:function(){if(!this._collectorsStarted){if(this._eventListener={loadTimeCollector:this._bind(this._loadTimeCollector),mouseCollector:this._bind(this._mouseCollector),keyboardCollector:this._bind(this._keyboardCollector),accelerometerCollector:this._bind(this._accelerometerCollector),touchCollector:this._bind(this._touchCollector)},window.addEventListener)window.addEventListener("load",this._eventListener.loadTimeCollector,!1),window.addEventListener("mousemove",this._eventListener.mouseCollector,!1),window.addEventListener("keypress",this._eventListener.keyboardCollector,!1),window.addEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.addEventListener("touchmove",this._eventListener.touchCollector,!1);else{if(!document.attachEvent)throw new sjcl.exception.bug("can't attach event");document.attachEvent("onload",this._eventListener.loadTimeCollector),document.attachEvent("onmousemove",this._eventListener.mouseCollector),document.attachEvent("keypress",this._eventListener.keyboardCollector)}this._collectorsStarted=!0}},stopCollectors:function(){this._collectorsStarted&&(window.removeEventListener?(window.removeEventListener("load",this._eventListener.loadTimeCollector,!1),window.removeEventListener("mousemove",this._eventListener.mouseCollector,!1),window.removeEventListener("keypress",this._eventListener.keyboardCollector,!1),window.removeEventListener("devicemotion",this._eventListener.accelerometerCollector,!1),window.removeEventListener("touchmove",this._eventListener.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this._eventListener.loadTimeCollector),document.detachEvent("onmousemove",this._eventListener.mouseCollector),document.detachEvent("keypress",this._eventListener.keyboardCollector)),this._collectorsStarted=!1)},addEventListener:function(name,callback){this._callbacks[name][this._callbackI++]=callback},removeEventListener:function(name,cb){var i,j,cbs=this._callbacks[name],jsTemp=[];for(j in cbs)cbs.hasOwnProperty(j)&&cbs[j]===cb&&jsTemp.push(j);for(i=0;i<jsTemp.length;i++)j=jsTemp[i],delete cbs[j]},_bind:function(func){var that=this;return function(){func.apply(that,arguments)}},_gen4words:function(){for(var i=0;4>i&&(this._counter[i]=this._counter[i]+1|0,!this._counter[i]);i++);return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words()),this._cipher=new sjcl.cipher.aes(this._key)},_reseed:function(seedWords){this._key=sjcl.hash.sha256.hash(this._key.concat(seedWords)),this._cipher=new sjcl.cipher.aes(this._key);for(var i=0;4>i&&(this._counter[i]=this._counter[i]+1|0,!this._counter[i]);i++);},_reseedFromPools:function(full){var i,reseedData=[],strength=0;for(this._nextReseed=reseedData[0]=(new Date).valueOf()+this._MILLISECONDS_PER_RESEED,i=0;16>i;i++)reseedData.push(4294967296*Math.random()|0);for(i=0;i<this._pools.length&&(reseedData=reseedData.concat(this._pools[i].finalize()),strength+=this._poolEntropy[i],this._poolEntropy[i]=0,full||!(this._reseedCount&1<<i));i++);this._reseedCount>=1<<this._pools.length&&(this._pools.push(new sjcl.hash.sha256),this._poolEntropy.push(0)),this._poolStrength-=strength,strength>this._strength&&(this._strength=strength),this._reseedCount++,this._reseed(reseedData)},_keyboardCollector:function(){this._addCurrentTimeToEntropy(1)},_mouseCollector:function(ev){var x,y;try{x=ev.x||ev.clientX||ev.offsetX||0,y=ev.y||ev.clientY||ev.offsetY||0}catch(err){x=0,y=0}0!=x&&0!=y&&sjcl.random.addEntropy([x,y],2,"mouse"),this._addCurrentTimeToEntropy(0)},_touchCollector:function(ev){var touch=ev.touches[0]||ev.changedTouches[0],x=touch.pageX||touch.clientX,y=touch.pageY||touch.clientY;sjcl.random.addEntropy([x,y],1,"touch"),this._addCurrentTimeToEntropy(0)},_loadTimeCollector:function(){this._addCurrentTimeToEntropy(2)},_addCurrentTimeToEntropy:function(estimatedEntropy){"undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?sjcl.random.addEntropy(window.performance.now(),estimatedEntropy,"loadtime"):sjcl.random.addEntropy((new Date).valueOf(),estimatedEntropy,"loadtime")},_accelerometerCollector:function(ev){var ac=ev.accelerationIncludingGravity.x||ev.accelerationIncludingGravity.y||ev.accelerationIncludingGravity.z;if(window.orientation){var or=window.orientation;"number"==typeof or&&sjcl.random.addEntropy(or,1,"accelerometer")}ac&&sjcl.random.addEntropy(ac,2,"accelerometer"),this._addCurrentTimeToEntropy(0)},_fireEvent:function(name,arg){var j,cbs=sjcl.random._callbacks[name],cbsTemp=[];for(j in cbs)cbs.hasOwnProperty(j)&&cbsTemp.push(cbs[j]);for(j=0;j<cbsTemp.length;j++)cbsTemp[j](arg)}},sjcl.random=new sjcl.prng(6),function(){function getCryptoModule(){return null}try{var buf,crypt,ab;if("undefined"!=typeof module&&module.exports&&(crypt=getCryptoModule())&&crypt.randomBytes)buf=crypt.randomBytes(128),buf=new Uint32Array(new Uint8Array(buf).buffer),sjcl.random.addEntropy(buf,1024,"crypto.randomBytes");else if("undefined"!=typeof window&&"undefined"!=typeof Uint32Array){if(ab=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(ab);else{if(!window.msCrypto||!window.msCrypto.getRandomValues)return;window.msCrypto.getRandomValues(ab)}sjcl.random.addEntropy(ab,1024,"crypto.getRandomValues")}}catch(e){"undefined"!=typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(e))}}(),sjcl.json={defaults:{v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},_encrypt:function(password,plaintext,params,rp){params=params||{},rp=rp||{};var tmp,prp,adata,j=sjcl.json,p=j._add({iv:sjcl.random.randomWords(4,0)},j.defaults);if(j._add(p,params),adata=p.adata,"string"==typeof p.salt&&(p.salt=sjcl.codec.base64.toBits(p.salt)),"string"==typeof p.iv&&(p.iv=sjcl.codec.base64.toBits(p.iv)),!sjcl.mode[p.mode]||!sjcl.cipher[p.cipher]||"string"==typeof password&&p.iter<=100||64!==p.ts&&96!==p.ts&&128!==p.ts||128!==p.ks&&192!==p.ks&&256!==p.ks||p.iv.length<2||p.iv.length>4)throw new sjcl.exception.invalid("json encrypt: invalid parameters");return"string"==typeof password?(tmp=sjcl.misc.cachedPbkdf2(password,p),password=tmp.key.slice(0,p.ks/32),p.salt=tmp.salt):sjcl.ecc&&password instanceof sjcl.ecc.elGamal.publicKey&&(tmp=password.kem(),p.kemtag=tmp.tag,password=tmp.key.slice(0,p.ks/32)),"string"==typeof plaintext&&(plaintext=sjcl.codec.utf8String.toBits(plaintext)),"string"==typeof adata&&(p.adata=adata=sjcl.codec.utf8String.toBits(adata)),prp=new sjcl.cipher[p.cipher](password),j._add(rp,p),rp.key=password,p.ct=sjcl.mode[p.mode].encrypt(prp,plaintext,p.iv,adata,p.ts),p},encrypt:function(password,plaintext,params,rp){var j=sjcl.json,p=j._encrypt.apply(j,arguments);return j.encode(p)},_decrypt:function(password,ciphertext,params,rp){params=params||{},rp=rp||{};var ct,tmp,prp,j=sjcl.json,p=j._add(j._add(j._add({},j.defaults),ciphertext),params,!0),adata=p.adata;if("string"==typeof p.salt&&(p.salt=sjcl.codec.base64.toBits(p.salt)),"string"==typeof p.iv&&(p.iv=sjcl.codec.base64.toBits(p.iv)),!sjcl.mode[p.mode]||!sjcl.cipher[p.cipher]||"string"==typeof password&&p.iter<=100||64!==p.ts&&96!==p.ts&&128!==p.ts||128!==p.ks&&192!==p.ks&&256!==p.ks||!p.iv||p.iv.length<2||p.iv.length>4)throw new sjcl.exception.invalid("json decrypt: invalid parameters");return"string"==typeof password?(tmp=sjcl.misc.cachedPbkdf2(password,p),password=tmp.key.slice(0,p.ks/32),p.salt=tmp.salt):sjcl.ecc&&password instanceof sjcl.ecc.elGamal.secretKey&&(password=password.unkem(sjcl.codec.base64.toBits(p.kemtag)).slice(0,p.ks/32)),"string"==typeof adata&&(adata=sjcl.codec.utf8String.toBits(adata)),prp=new sjcl.cipher[p.cipher](password),ct=sjcl.mode[p.mode].decrypt(prp,p.ct,p.iv,adata,p.ts),j._add(rp,p),rp.key=password,1===params.raw?ct:sjcl.codec.utf8String.fromBits(ct)},decrypt:function(password,ciphertext,params,rp){var j=sjcl.json;return j._decrypt(password,j.decode(ciphertext),params,rp)},encode:function(obj){var i,out="{",comma="";for(i in obj)if(obj.hasOwnProperty(i)){if(!i.match(/^[a-z0-9]+$/i))throw new sjcl.exception.invalid("json encode: invalid property name");switch(out+=comma+'"'+i+'":',comma=",",typeof obj[i]){case"number":case"boolean":out+=obj[i];break;case"string":out+='"'+escape(obj[i])+'"';break;case"object":out+='"'+sjcl.codec.base64.fromBits(obj[i],0)+'"';break;default:throw new sjcl.exception.bug("json encode: unsupported type")}}return out+"}"},decode:function(str){if(str=str.replace(/\s/g,""),!str.match(/^\{.*\}$/))throw new sjcl.exception.invalid("json decode: this isn't json!");var i,m,a=str.replace(/^\{|\}$/g,"").split(/,/),out={};for(i=0;i<a.length;i++){if(!(m=a[i].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)))throw new sjcl.exception.invalid("json decode: this isn't json!");m[3]?out[m[2]]=parseInt(m[3],10):m[4]?out[m[2]]=m[2].match(/^(ct|adata|salt|iv)$/)?sjcl.codec.base64.toBits(m[4]):unescape(m[4]):m[5]&&(out[m[2]]="true"===m[5])}return out},_add:function(target,src,requireSame){if(void 0===target&&(target={}),void 0===src)return target;var i;for(i in src)if(src.hasOwnProperty(i)){if(requireSame&&void 0!==target[i]&&target[i]!==src[i])throw new sjcl.exception.invalid("required parameter overridden");target[i]=src[i]}return target},_subtract:function(plus,minus){var i,out={};for(i in plus)plus.hasOwnProperty(i)&&plus[i]!==minus[i]&&(out[i]=plus[i]);return out},_filter:function(src,filter){var i,out={};for(i=0;i<filter.length;i++)void 0!==src[filter[i]]&&(out[filter[i]]=src[filter[i]]);return out}},sjcl.encrypt=sjcl.json.encrypt,sjcl.decrypt=sjcl.json.decrypt,sjcl.misc._pbkdf2Cache={},sjcl.misc.cachedPbkdf2=function(password,obj){var c,cp,salt,iter,cache=sjcl.misc._pbkdf2Cache;return obj=obj||{},iter=obj.iter||1e3,cp=cache[password]=cache[password]||{},c=cp[iter]=cp[iter]||{firstSalt:obj.salt&&obj.salt.length?obj.salt.slice(0):sjcl.random.randomWords(2,0)},salt=void 0===obj.salt?c.firstSalt:obj.salt,c[salt]=c[salt]||sjcl.misc.pbkdf2(password,salt,obj.iter),{key:c[salt].slice(0),salt:salt.slice(0)}}},{}],3:[function(require,module,exports){!function(window,undefined){"use strict";var LIBVERSION="0.7.8",EMPTY="",UNKNOWN="?",FUNC_TYPE="function",UNDEF_TYPE="undefined",OBJ_TYPE="object",STR_TYPE="string",MAJOR="major",MODEL="model",NAME="name",TYPE="type",VENDOR="vendor",VERSION="version",ARCHITECTURE="architecture",CONSOLE="console",MOBILE="mobile",TABLET="tablet",SMARTTV="smarttv",WEARABLE="wearable",EMBEDDED="embedded",util={extend:function(regexes,extensions){for(var i in extensions)-1!=="browser cpu device engine os".indexOf(i)&&extensions[i].length%2===0&&(regexes[i]=extensions[i].concat(regexes[i]));return regexes},has:function(str1,str2){return"string"==typeof str1?-1!==str2.toLowerCase().indexOf(str1.toLowerCase()):!1},lowerize:function(str){return str.toLowerCase()},major:function(version){return typeof version===STR_TYPE?version.split(".")[0]:undefined}},mapper={rgx:function(){for(var result,j,k,p,q,matches,match,i=0,args=arguments;i<args.length&&!matches;){var regex=args[i],props=args[i+1];if(typeof result===UNDEF_TYPE){result={};for(p in props)q=props[p],typeof q===OBJ_TYPE?result[q[0]]=undefined:result[q]=undefined}for(j=k=0;j<regex.length&&!matches;)if(matches=regex[j++].exec(this.getUA()))for(p=0;p<props.length;p++)match=matches[++k],q=props[p],typeof q===OBJ_TYPE&&q.length>0?2==q.length?result[q[0]]=typeof q[1]==FUNC_TYPE?q[1].call(this,match):q[1]:3==q.length?result[q[0]]=typeof q[1]!==FUNC_TYPE||q[1].exec&&q[1].test?match?match.replace(q[1],q[2]):undefined:match?q[1].call(this,match,q[2]):undefined:4==q.length&&(result[q[0]]=match?q[3].call(this,match.replace(q[1],q[2])):undefined):result[q]=match?match:undefined;i+=2}return result},str:function(str,map){for(var i in map)if(typeof map[i]===OBJ_TYPE&&map[i].length>0){for(var j=0;j<map[i].length;j++)if(util.has(map[i][j],str))return i===UNKNOWN?undefined:i}else if(util.has(map[i],str))return i===UNKNOWN?undefined:i;return str}},maps={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},regexes={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[NAME,VERSION],[/\s(opr)\/([\w\.]+)/i],[[NAME,"Opera"],VERSION],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi)\/([\w\.-]+)/i],[NAME,VERSION],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[NAME,"IE"],VERSION],[/(edge)\/((\d+)?[\w\.]+)/i],[NAME,VERSION],[/(yabrowser)\/([\w\.]+)/i],[[NAME,"Yandex"],VERSION],[/(comodo_dragon)\/([\w\.]+)/i],[[NAME,/_/g," "],VERSION],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?([\w\.]+)/i],[NAME,VERSION],[/(dolfin)\/([\w\.]+)/i],[[NAME,"Dolphin"],VERSION],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[NAME,"Chrome"],VERSION],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],[VERSION,[NAME,"MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[VERSION,[NAME,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[VERSION,[NAME,"Facebook"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[VERSION,[NAME,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[VERSION,NAME],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[NAME,[VERSION,mapper.str,maps.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[NAME,VERSION],[/(navigator|netscape)\/([\w\.-]+)/i],[[NAME,"Netscape"],VERSION],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[NAME,VERSION]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[ARCHITECTURE,"amd64"]],[/(ia32(?=;))/i],[[ARCHITECTURE,util.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[ARCHITECTURE,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[ARCHITECTURE,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[ARCHITECTURE,/ower/,"",util.lowerize]],[/(sun4\w)[;\)]/i],[[ARCHITECTURE,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[ARCHITECTURE,util.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[MODEL,VENDOR,[TYPE,TABLET]],[/applecoremedia\/[\w\.]+ \((ipad)/],[MODEL,[VENDOR,"Apple"],[TYPE,TABLET]],[/(apple\s{0,1}tv)/i],[[MODEL,"Apple TV"],[VENDOR,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[VENDOR,MODEL,[TYPE,TABLET]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[MODEL,[VENDOR,"Amazon"],[TYPE,TABLET]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[MODEL,mapper.str,maps.device.amazon.model],[VENDOR,"Amazon"],[TYPE,MOBILE]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[MODEL,VENDOR,[TYPE,MOBILE]],[/\((ip[honed|\s\w*]+);/i],[MODEL,[VENDOR,"Apple"],[TYPE,MOBILE]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[VENDOR,MODEL,[TYPE,MOBILE]],[/\(bb10;\s(\w+)/i],[MODEL,[VENDOR,"BlackBerry"],[TYPE,MOBILE]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7)/i],[MODEL,[VENDOR,"Asus"],[TYPE,TABLET]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[VENDOR,"Sony"],[MODEL,"Xperia Tablet"],[TYPE,TABLET]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[VENDOR,"Sony"],[MODEL,"Xperia Phone"],[TYPE,MOBILE]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[VENDOR,MODEL,[TYPE,CONSOLE]],[/android.+;\s(shield)\sbuild/i],[MODEL,[VENDOR,"Nvidia"],[TYPE,CONSOLE]],[/(playstation\s[3portablevi]+)/i],[MODEL,[VENDOR,"Sony"],[TYPE,CONSOLE]],[/(sprint\s(\w+))/i],[[VENDOR,mapper.str,maps.device.sprint.vendor],[MODEL,mapper.str,maps.device.sprint.model],[TYPE,MOBILE]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[VENDOR,MODEL,[TYPE,TABLET]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[VENDOR,[MODEL,/_/g," "],[TYPE,MOBILE]],[/(nexus\s9)/i],[MODEL,[VENDOR,"HTC"],[TYPE,TABLET]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[MODEL,[VENDOR,"Microsoft"],[TYPE,CONSOLE]],[/(kin\.[onetw]{3})/i],[[MODEL,/\./g," "],[VENDOR,"Microsoft"],[TYPE,MOBILE]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i],[MODEL,[VENDOR,"Motorola"],[TYPE,MOBILE]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[MODEL,[VENDOR,"Motorola"],[TYPE,TABLET]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[VENDOR,"Samsung"],MODEL,[TYPE,TABLET]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[VENDOR,"Samsung"],MODEL,[TYPE,MOBILE]],[/(samsung);smarttv/i],[VENDOR,MODEL,[TYPE,SMARTTV]],[/\(dtv[\);].+(aquos)/i],[MODEL,[VENDOR,"Sharp"],[TYPE,SMARTTV]],[/sie-(\w+)*/i],[MODEL,[VENDOR,"Siemens"],[TYPE,MOBILE]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[VENDOR,"Nokia"],MODEL,[TYPE,MOBILE]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[MODEL,[VENDOR,"Acer"],[TYPE,TABLET]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[VENDOR,"LG"],MODEL,[TYPE,TABLET]],[/(lg) netcast\.tv/i],[VENDOR,MODEL,[TYPE,SMARTTV]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[MODEL,[VENDOR,"LG"],[TYPE,MOBILE]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[MODEL,[VENDOR,"Lenovo"],[TYPE,TABLET]],[/linux;.+((jolla));/i],[VENDOR,MODEL,[TYPE,MOBILE]],[/((pebble))app\/[\d\.]+\s/i],[VENDOR,MODEL,[TYPE,WEARABLE]],[/android.+;\s(glass)\s\d/i],[MODEL,[VENDOR,"Google"],[TYPE,WEARABLE]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus)?[\s_]*(?:\d\w)?)\s+build/i],[[MODEL,/_/g," "],[VENDOR,"Xiaomi"],[TYPE,MOBILE]],[/(mobile|tablet);.+rv\:.+gecko\//i],[[TYPE,util.lowerize],VENDOR,MODEL]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[VERSION,[NAME,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[NAME,VERSION],[/rv\:([\w\.]+).*(gecko)/i],[VERSION,NAME]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[NAME,VERSION],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[NAME,[VERSION,mapper.str,maps.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[NAME,"Windows"],[VERSION,mapper.str,maps.os.windows.version]],[/\((bb)(10);/i],[[NAME,"BlackBerry"],VERSION],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[NAME,VERSION],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[NAME,"Symbian"],VERSION],[/\((series40);/i],[NAME],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[NAME,"Firefox OS"],VERSION],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[NAME,VERSION],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[NAME,"Chromium OS"],VERSION],[/(sunos)\s?([\w\.]+\d)*/i],[[NAME,"Solaris"],VERSION],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[NAME,VERSION],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[NAME,"iOS"],[VERSION,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[NAME,"Mac OS"],[VERSION,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[NAME,VERSION]]
},UAParser=function(uastring,extensions){if(!(this instanceof UAParser))return new UAParser(uastring,extensions).getResult();var ua=uastring||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:EMPTY),rgxmap=extensions?util.extend(regexes,extensions):regexes;return this.getBrowser=function(){var browser=mapper.rgx.apply(this,rgxmap.browser);return browser.major=util.major(browser.version),browser},this.getCPU=function(){return mapper.rgx.apply(this,rgxmap.cpu)},this.getDevice=function(){return mapper.rgx.apply(this,rgxmap.device)},this.getEngine=function(){return mapper.rgx.apply(this,rgxmap.engine)},this.getOS=function(){return mapper.rgx.apply(this,rgxmap.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ua},this.setUA=function(uastring){return ua=uastring,this},this.setUA(ua),this};UAParser.VERSION=LIBVERSION,UAParser.BROWSER={NAME:NAME,MAJOR:MAJOR,VERSION:VERSION},UAParser.CPU={ARCHITECTURE:ARCHITECTURE},UAParser.DEVICE={MODEL:MODEL,VENDOR:VENDOR,TYPE:TYPE,CONSOLE:CONSOLE,MOBILE:MOBILE,SMARTTV:SMARTTV,TABLET:TABLET,WEARABLE:WEARABLE,EMBEDDED:EMBEDDED},UAParser.ENGINE={NAME:NAME,VERSION:VERSION},UAParser.OS={NAME:NAME,VERSION:VERSION},module.exports=UAParser}(this)},{}],4:[function(require,module,exports){function cleanUpNextTick(){draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue()}function drainQueue(){if(!draining){var timeout=setTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,clearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var currentQueue,process=module.exports={},queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||setTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],5:[function(require,module,exports){!function(){"use strict";module.exports="153dea2211f"}()},{}],6:[function(require,module,exports){!function(){"use strict";function init(){messages.subscribe("debug.geoIP",function(ip){config.ip=ip}),messages.subscribe("debug.country",function(country){config.country=country}),messages.subscribe("debug.clear",function(){config={}})}var utils=require("utils"),messages=require("messages").getInstance(),config={};module.exports={getGeoIP:function(){return utils.get(config,"ip")},getCountry:function(){return utils.get(config,"country")}},init()}()},{messages:12,utils:29}],7:[function(require,module,exports){!function(){"use strict";function getEnvironmentFromUrl(url){return environmentUrlMap[getHostname(url)]||"QA"}function getClientIdEnvironment(environment){return environmentConfig[environment].clientIdEnv}function clientIdHasSuffix(clientId){return!!clientId.match(/-(DEV|VALID|QA|STAGE|PROD)$/)}function getClientIdSuffix(clientId){var env=null;return(clientId||"").replace(/-(DEV|VALID|QA|STAGE|PROD)$/,function(notUsed,match){env=match}),env}function getConfig(environment){return utils.clone(environmentConfig[environment])}function getHostname(url){var parsingNode=document.createElement("a");return parsingNode.setAttribute("href",url),""+parsingNode.hostname}module.exports={getEnvironmentFromUrl:getEnvironmentFromUrl,getClientIdEnvironment:getClientIdEnvironment,getConfig:getConfig,getClientIdSuffix:getClientIdSuffix,clientIdHasSuffix:clientIdHasSuffix};var utils=require("utils"),environmentUrlMap={"127.0.0.1":"QA",localhost:"QA","did.registerdisney.go.com":"LOCAL","local.registerdisney.go.com":"LOCAL","ui-local.registerdisney.go.com":"LOCAL","dev.registerdisney.go.com":"DEV","qa.registerdisney.go.com":"QA","ui-qa.registerdisney.go.com":"QA","ui-stg.dark.registerdisney.go.com":"STAGE-DARK","stg.dark.registerdisney.go.com":"STAGE-DARK","stg.registerdisney.go.com":"STAGE","stg.cdn.registerdisney.go.com":"STAGE","val.registerdisney.go.com":"VALID","ui-val.registerdisney.go.com":"VALID","dark.registerdisney.go.com":"PROD-DARK","registerdisney.go.com":"PROD","cdn.registerdisney.go.com":"PROD"},environmentConfig={LOCAL:{clientIdEnv:"QA",contentEnvironment:"qa",utagPath:"//tags.tiqcdn.com/utag/disney/disneyid/qa/utag.js",guestControllerPath:"https://local.registerdisney.go.com/jgc/v2",l10nPath:"https://stg-l10n.registerdisney.go.com/v2/collection"},DEV:{clientIdEnv:"DEV",contentEnvironment:"dev",utagPath:"//tags.tiqcdn.com/utag/disney/disneyid/prod/utag.js",guestControllerPath:"https://qa.registerdisney.go.com/jgc/v2",l10nPath:"https://stg-l10n.registerdisney.go.com/v2/collection"},VALID:{clientIdEnv:"VALID",contentEnvironment:"val",utagPath:"//tags.tiqcdn.com/utag/disney/disneyid/prod/utag.js",guestControllerPath:"https://val.registerdisney.go.com/jgc/v2",l10nPath:"https://val-l10n.registerdisney.go.com/v2/collection"},QA:{clientIdEnv:"QA",contentEnvironment:"qa",utagPath:"//tags.tiqcdn.com/utag/disney/disneyid/qa/utag.js",guestControllerPath:"https://qa.registerdisney.go.com/jgc/v2",l10nPath:"https://stg-l10n.registerdisney.go.com/v2/collection"},"STAGE-DARK":{clientIdEnv:"STAGE",contentEnvironment:"stg",utagPath:"//tags.tiqcdn.com/utag/disney/disneyid/prod/utag.js",guestControllerPath:"https://stg.dark.registerdisney.go.com/jgc/v2",l10nPath:"https://stg-l10n.registerdisney.go.com/v2/collection"},STAGE:{clientIdEnv:"STAGE",contentEnvironment:"stg",utagPath:"//tags.tiqcdn.com/utag/disney/disneyid/prod/utag.js",guestControllerPath:"https://stg.registerdisney.go.com/jgc/v2",l10nPath:"https://stg-l10n.registerdisney.go.com/v2/collection"},"PROD-DARK":{clientIdEnv:"PROD",contentEnvironment:"prod",utagPath:"//tags.tiqcdn.com/utag/disney/disneyid/prod/utag.js",guestControllerPath:"https://dark.registerdisney.go.com/jgc/v2",l10nPath:"https://l10n.registerdisney.go.com/v2/collection"},PROD:{clientIdEnv:"PROD",contentEnvironment:"prod",utagPath:"//tags.tiqcdn.com/utag/disney/disneyid/prod/utag.js",guestControllerPath:"https://registerdisney.go.com/jgc/v2",l10nPath:"https://l10n.registerdisney.go.com/v2/collection"}}}()},{utils:29}],8:[function(require,module,exports){!function(){"use strict";function on(listeners,e,fn){"undefined"==typeof listeners[e]&&(listeners[e]=[]),listeners[e].push(fn)}function off(listeners,e,fn){if("undefined"!=typeof listeners[e]){var len=listeners[e].length;if("undefined"==typeof fn)listeners[e]=[];else for(;len;)listeners[e][len-1]==fn&&listeners[e].splice(len-1,1),len--}}function emit(listeners,e){if(listeners=[].concat(listeners[e]||[]).concat(listeners["*"]||[]),listeners.length>0){var args=arguments.length>2?Array.prototype.slice.call(arguments,2):[];listeners.forEach(function(fn){try{fn.apply({eventName:e},args)}catch(e){setTimeout(function(){throw e},0)}})}}function emittable(o){var target=o.prototype||o,listeners={};return target.on=function(e,fn){on.call(this,listeners,e,fn)},target.off=function(e,fn){off.call(this,listeners,e,fn)},target.emit=function(){var args=Array.prototype.slice.call(arguments,0);args.unshift(listeners),emit.apply(this,args)},target.clear=function(){listeners={}},o}module.exports={emittable:emittable}}()},{}],9:[function(require,module,exports){!function(){"use strict";module.exports=require("./event-emitter")}()},{"./event-emitter":8}],10:[function(require,module,exports){!function(){"use strict";function getCollectionByType(collection,type){return collection.filter(function(address){return address.type===type})}function getAddressByGuid(addresses,guid){if(Array.isArray(addresses))for(var i=0;i<addresses.length;i++)if(addresses[i].addressGuid===guid)return addresses[i]}function getLegalCountry(siteConfig,profile){var countryCodeProvided=utils.get(profile,"region"),countryCodeDetected=utils.get(profile,"countryCodeDetected"),defaultCountry=utils.get(siteConfig,"compliance.defaultCountryCode");return countryCodeProvided||countryCodeDetected||defaultCountry||"US"}function mergeGuest(originalGuest,newGuest){return newGuest=utils.clone(newGuest),Object.keys(newGuest||{}).forEach(function(name){null===utils.get(newGuest,name)&&utils.get(originalGuest,name)&&utils.set(newGuest,name,originalGuest[name])}),utils.set(originalGuest,"etag",utils.get(newGuest,"etag")),originalGuest.profile=merge(originalGuest.profile,newGuest.profile),originalGuest.displayName=merge(originalGuest.displayName,newGuest.displayName),originalGuest.marketing=merge(originalGuest.marketing,newGuest.marketing),originalGuest}function merge(origObj,newObj){if(null===newObj||"object"!=typeof newObj||Array.isArray(newObj))return newObj;for(var key in newObj)newObj.hasOwnProperty(key)&&(origObj=origObj||{},origObj[key]=merge(origObj[key],newObj[key]));return origObj}function profileDiff(originalGuest,guest){if("undefined"==typeof originalGuest||"undefined"==typeof guest)return{};var output=utils.deepTrim({profile:utils.objectDiff(originalGuest.profile||{},guest.profile||{})||{},displayName:utils.objectDiff(originalGuest.displayName||{},guest.displayName||{})||{}});return guest.password&&(output.password=guest.password.trim()||null),guest.newPassword&&(output.newPassword=guest.newPassword.trim()||null),Object.keys(output.profile).forEach(function(key){""===output.profile[key]&&(output.profile[key]=null)}),Object.keys(output.displayName).forEach(function(key){""===output.displayName[key]&&(output.displayName[key]=null)}),addressesDiff(originalGuest,guest,output),phonesDiff(originalGuest,guest,output),marketingDiff(originalGuest,guest,output),legalDiff(originalGuest,guest,output),Object.keys(output).forEach(function(name){"object"!=typeof output[name]||output[name]&&0!==Object.keys(output[name]).length||delete output[name]}),output}function legalDiff(originalGuest,guest,output){var legalLookup=originalGuest.legalAssertions||[],legalDocuments=[];(guest.legalAssertions||[]).forEach(function(docName){-1===legalLookup.indexOf(docName)&&legalDocuments.push(docName)}),legalDocuments.length>0&&(output.legalAssertions=legalDocuments)}function addressesDiff(originalGuest,guest,output){function filterDefaultKeys(map){return Object.keys(map).filter(function(key){return-1===["preferred","addressGuid","type"].indexOf(key)})}var adddressFields=["line1","line2","line3","postalCode","stateProvince","country","city","type"],addresses=utils.clone(utils.get(guest,"profile.addresses")||[]),addressesOutput=[],originalMap={};(utils.get(originalGuest,"profile.addresses")||[]).forEach(function(address){originalMap[address.addressGuid]=address}),utils.get(output,"profile.addresses")&&delete output.profile.addresses,Array.isArray(addresses)&&addresses.length&&(addresses.forEach(function(address){var guid=address.addressGuid,filteredAddress={};adddressFields.forEach(function(field){filteredAddress[field]=address[field]?address[field]:null}),"undefined"!=typeof utils.get(originalMap,[guid,"addressGuid"].join("."))&&(filteredAddress.addressGuid=guid,filterDefaultKeys(filteredAddress).forEach(function(key){originalMap[guid][key]===address[key]&&delete filteredAddress[key]})),filterDefaultKeys(filteredAddress).length&&addressesOutput.push(filteredAddress)}),addressesOutput.length&&utils.set(output,"profile.addresses",addressesOutput))}function phonesDiff(originalGuest,guest,output){function getPhoneByGuid(guest,guid){return(utils.get(guest,"profile.phones")||[]).filter(function(p){return p.phoneGuid===guid})[0]}if("undefined"!=typeof utils.get(output,"profile.phones")&&delete output.profile.phones,Array.isArray(utils.get(guest,"profile.phones"))&&guest.profile.phones.length){for(var phones=[],i=0;i<guest.profile.phones.length;i++){var phone={number:guest.profile.phones[i].number,phoneGuid:guest.profile.phones[i].phoneGuid,preferred:guest.profile.phones[i].preferred,type:guest.profile.phones[i].type};if(guest.profile.phones[i].phoneGuid)if(""===guest.profile.phones[i].number)delete phone.number,delete phone.preferred,delete phone.type,phones.push(phone);else{var origPhone=getPhoneByGuid(originalGuest,guest.profile.phones[i].phoneGuid)||{};guest.profile.phones[i].number!==origPhone.number&&phones.push(phone)}else""!==guest.profile.phones[i].number&&(delete phone.preferred,delete phone.phoneGuid,phones.push(phone))}phones.length&&(output.profile.phones=phones)}}function marketingDiff(originalGuest,guest,output){var originalList=utils.get(originalGuest,"marketing"),list=utils.get(guest,"marketing"),origMap={};return(originalList||[]).forEach(function(item){origMap[item.code]=item}),Array.isArray(list)&&list.length&&(list=list.filter(function(item){return item.subscribed!==utils.get(origMap,[item.code,"subscribed"].join("."))}),list.length)?(output.marketing=list,output.marketing):[]}function generatePassword(email){var date=new Date;return email.substring(0,email.length>6?6:email.length)+date.getTime()%1e7}function removeDisallowedFields(guest,agebandConfig){if(!utils.get(guest,"profile.dateOfBirth"))return guest;var conf=getAgeband(guest.profile.dateOfBirth,agebandConfig),clonedGuest=utils.clone(guest);conf&&Object.keys(clonedGuest.profile).forEach(function(key){key in conf.CREATE||delete clonedGuest.profile[key]});var region=utils.get(guest,"profile.region");return region&&utils.set(clonedGuest,"profile.region",region),clonedGuest}function getAgeband(DOB,agebandConfig,returnsName){var ageband,agebandName,age=getAge(DOB);return Object.keys(agebandConfig).forEach(function(key){var ab=agebandConfig[key];ab&&age>=ab.minAge&&age<=ab.maxAge&&(ageband=ab,agebandName=key)}),returnsName?agebandName:ageband}function getAge(DOB){var today=new Date(Date.now()),birthDate=new Date(DOB),age=today.getFullYear()-birthDate.getFullYear(),m=today.getMonth()-birthDate.getMonth();return(0>m||0===m&&today.getDate()<birthDate.getDate())&&age--,age}function removeEmptyFields(guest){guest=guest||{};for(var property in guest.profile)switch(property){case"phones":guest.profile.phones=(guest.profile.phones||[]).filter(function(phone){return phone.number});break;case"addresses":guest.profile.addresses.forEach(function(addressType){for(var field in addressType)addressType[field]||delete addressType[field]}),guest.profile.addresses=(guest.profile.addresses||[]).filter(function(address){return Object.keys(address).length>2});break;default:guest.profile[property]||delete guest.profile[property]}return guest.displayName&&!guest.displayName.proposedDisplayName&&delete guest.displayName,guest}var utils=require("utils");module.exports={diff:profileDiff,merge:mergeGuest,generatePassword:generatePassword,getAge:getAge,getAgeband:getAgeband,removeEmptyFields:removeEmptyFields,removeDisallowedFields:removeDisallowedFields,getAddressByGuid:getAddressByGuid,getCollectionByType:getCollectionByType,getLegalCountry:getLegalCountry,marketingDiff:marketingDiff}}()},{utils:29}],11:[function(require,module,exports){!function(){"use strict";var LEVELS={ERROR:5,WARN:4,INFO:3,DEBUG:2,LOG:1,OFF:0},COLORS={ERROR:"color:#FC0C1B;background-color:#FFEFEF",WARN:"color:#5B3A06;background-color:#FFFBE6",INFO:"color:#363F47;background-color:#e1e9ff",DEBUG:"color:#444;background-color:#eee",LOG:"color:#000;background-color:transparent",DEFAULT:"color:#000;background-color:transparent;font-weight:",ONEID:"color:#2887b4;background-color:transparent;font-weight:bold"},utils=require("utils"),logLevel=LEVELS.INFO,noop=function(){},Logger=function(){function setLogLevel(level){"undefined"==typeof LEVELS[level.toUpperCase()]?this.error("Invalid log level specified: ",level):Object.keys(LEVELS).forEach(function(key){level.toUpperCase()===key&&(logLevel=LEVELS[key],rebind())})}function getLogLevel(){var result;return Object.keys(LEVELS).forEach(function(key){logLevel===LEVELS[key]&&(result=key)}),result}function rebind(){var format=HIGHLIGHT?"%c[OneID]%c %c[%s]%c: ":"[OneID] [%s]: ";for(var key in LEVELS)utils.isIE9()?logLevel<=LEVELS[key]&&logLevel!==LEVELS.OFF?!function(levelStr){self[key.toLowerCase()]=function(msg){window.console.log("[OneID] ["+levelStr+"]: "+msg)}}(key):self[key.toLowerCase()]=noop:self[key.toLowerCase()]=HIGHLIGHT?logLevel<=LEVELS[key]&&logLevel!==LEVELS.OFF?window.console[key.toLowerCase()].bind(window.console,format,COLORS["ONEID"],COLORS["DEFAULT"],COLORS[key],key,COLORS["DEFAULT"]):noop:logLevel<=LEVELS[key]&&logLevel!==LEVELS.OFF?window.console[key.toLowerCase()].bind(window.console,format,key):noop}var self=this,HIGHLIGHT=function(){var ua=navigator.userAgent.toLowerCase();return ua.indexOf("firefox")>-1||ua.indexOf("chrome")>-1}();this.setLogLevel=setLogLevel,this.getLogLevel=getLogLevel,this.LEVELS=LEVELS,rebind()};module.exports=new Logger}()},{utils:29}],12:[function(require,module,exports){!function(){"use strict";function getInstance(){return app}function publish(topic){var args=Array.prototype.slice.call(arguments,1);"undefined"!=typeof channels[topic]&&utils.clone(channels[topic]).forEach(function(subscriber){subscriber.callback.apply(null,args)})}function subscribe(topic,callback){if(!(callback instanceof Function))throw new Error("callback must be a function");return channels[topic]||(channels[topic]=[]),channels[topic].push({callback:callback,identifier:uniqueIdentifier}),function(topic,identifier){return function(){if(Array.isArray(channels[topic]))for(var i=0;i<channels[topic].length;i++)if(channels[topic][i].identifier===identifier)return void channels[topic].splice(i,1)}}(topic,uniqueIdentifier++)}function unsubscribe(topic,callback){return topic?void("undefined"!=typeof channels[topic]&&channels[topic].forEach(function(value,index){value.callback!==callback&&callback||channels[topic].splice(index,1)})):channels={}}var utils=require("../utils"),channels=(require("logger"),{}),uniqueIdentifier=0,app={publish:publish,subscribe:subscribe,unsubscribe:unsubscribe};module.exports={getInstance:getInstance}}()},{"../utils":29,logger:11}],13:[function(require,module,exports){!function(){"use strict";function Mutex(name,cookieDomain){function aquire(cb){function obtainLock(){function writeMutexLoop(){writeMutex(),saturateTimeout=setTimeout(writeMutexLoop,Mutex.SATURATE_INTERVAL)}logger.debug("aquiring mutex"),writeMutexLoop(),weHaveLock=!0,"function"==typeof cb&&(logger.debug("calling aquire success callback"),cb())}logger.log("Mutex#aquire"),setTimeout(function(){return isLocked()?(logger.debug("mutex is locked"),void wait(function(){obtainLock(cb)})):void obtainLock(cb)},calcRandomVariance(Mutex.RANDOM_BASE,Mutex.RANDOM_VARIANCE))}function isLocked(){return null!==utils.getCookie(cookieName)}function isLockedByUs(){return weHaveLock===!0}function release(){logger.log("Mutex#release"),isLockedByUs()&&(logger.debug("releasing mutex"),clearTimeout(saturateTimeout),saturateTimeout=null,utils.deleteCookie(cookieName,cookieDomain,cookiePath),weHaveLock=!1)}function wait(cb){function waitLoop(){return logger.debug("wait timeout called"),isLocked()?void setTimeout(waitLoop,Mutex.WAIT_INTERVAL+randomVariance):(logger.debug("mutex has been released"),cb())}if("function"==typeof cb){logger.debug("wait called");var randomVariance=calcRandomVariance(Mutex.RANDOM_BASE,Mutex.RANDOM_VARIANCE);logger.debug("random variance is "+randomVariance),logger.debug("wait timeout is "+Mutex.WAIT_INTERVAL+randomVariance),waitLoop()}}function writeMutex(){logger.debug("saturating mutex");var expire=new Date((new Date).getTime()+Mutex.EXPIRE_INTERVAL);utils.setCookie(cookieName,"0",cookieDomain,cookiePath,expire)}this.aquire=aquire,this.release=release,this.wait=wait,this.isLocked=isLocked,this.isLockedByUs=isLockedByUs;var saturateTimeout,weHaveLock,cookieName="mtx"+utils.crc32(name).toString(16),cookiePath="/";cookieDomain=cookieDomain||window.location.host}function calcRandomVariance(base,variance){return Math.floor(Math.random()*variance+base)}module.exports=Mutex;var utils=require("utils"),logger=require("logger");Mutex.SATURATE_INTERVAL=5e3,Mutex.EXPIRE_INTERVAL=2e4,Mutex.WAIT_INTERVAL=5e3,Mutex.RANDOM_BASE=1e3,Mutex.RANDOM_VARIANCE=1e3}()},{logger:11,utils:29}],14:[function(require,module,exports){!function(){"use strict";var noop=function(){};window.console=window.console||{},window.console.log=window.console.log||noop,window.console.error=window.console.error||noop,window.console.warn=window.console.warn||noop,window.console.debug=window.console.debug||noop}()},{}],15:[function(require,module,exports){!function(){module.exports={CLIENT:"lightbox-client-window",LIGHTBOX:"lightbox-main-iframe",RESPONDER:"lightbox-responder",MIGRATION_RESPONDER:"lightbox-migration-responder",MOCK:"lightbox-mock-api"}}()},{}],16:[function(require,module,exports){!function(){"use strict";module.exports=require("./postmessage-transport")}()},{"./postmessage-transport":17}],17:[function(require,module,exports){!function(){"use strict";function PostMessageTransport(name){this.name=name,this.emitter=eventEmitter.emittable(Object.create(null)),this.initialized=!1,this.deferreds={},this.targets={},this.pendingTargets={},this.parents=[]}function on(){if(this.initialized)throw"Cannot attach new listeners once init() has been invoked";this.emitter.on.apply(this,arguments)}function emit(){this.emitter.emit.apply(this,arguments)}function init(){logger.log("PostMessageTransport#init"),this.initialized||(window.addEventListener("message",routeMessage.bind(this),!1),resolveParents.call(this),delete this.parents,this.initialized=!0)}function resolveParents(){logger.log("PostMessageTransport#resolveParents");var self=this;self.parents.forEach(function(name){var startTime=Date.now(),target=self.targets[name];!function waitForParent(){clearTimeout(target.timeout),target.window.postMessage(JSON.stringify({type:"handshake",name:self.name}),target.origin),target.isReady===!1&&(Date.now()-startTime>HANDSHAKE_TIMEOUT?(logTimeout(),self.emit("error","Parent window has not responded within 60 seconds")):target.timeout=setTimeout(waitForParent,50))}()})}function registerChild(name,origin){logger.log("PostMessageTransport#registerChild: "+name);var deferred=Q.defer();if(this.initialized)throw"Cannot attach child windows after init has been invoked";"undefined"==typeof this.targets[name]&&(this.targets[name]={origin:origin,ready:deferred.promise},this.pendingTargets[name]=deferred)}function registerParent(name,origin){logger.log("PostMessageTransport#registerParent: "+name);var deferred=Q.defer();if(this.initialized)throw"Cannot attach parent windows after init has been invoked";if("undefined"==typeof this.targets[name]){var target={window:window.parent,origin:origin,isReady:!1,ready:deferred.promise,timeout:null};this.targets[name]=target,this.pendingTargets[name]=deferred,this.parents.push(name)}}function send(targetName,eventName,data,deferred){if("undefined"==typeof this.targets[targetName])throw"Cannot postMessage to undefined window ["+targetName+"]";var payload={type:"message",name:this.name,eventName:eventName,data:data};if("undefined"!=typeof deferred){var uuid=utils.uuid();this.deferreds[uuid]=deferred,payload.deferredUuid=uuid}var target=this.targets[targetName];target.ready.then(function(){target.window.postMessage(JSON.stringify(payload),target.origin)})}function routeMessage(ev){var data;try{data=JSON.parse(ev.data)}catch(e){return}messageHandlers.hasOwnProperty(data.type)&&messageHandlers[data.type].call(this,ev,data)}function handleHandshakeAck(ev,data){logger.log("PostMessageTransport#handleHandshakeAck");var self=this,target=self.targets[data.name];"undefined"!=typeof target&&(clearTimeout(target.timeout),target.window=ev.source,target.isReady=!0,self.pendingTargets[data.name].resolve())}function handleHandshake(ev,data){logger.log("PostMessageTransport#handleHandshake");var self=this,target=self.targets[data.name];"undefined"!=typeof target&&(target.window=ev.source,self.pendingTargets[data.name].resolve(),target.window.postMessage(JSON.stringify({type:"handshakeAck",name:self.name}),target.origin))}function handleDeferred(ev,data){"undefined"!=typeof this.deferreds[data.deferredUuid]&&(this.deferreds[data.deferredUuid][data.action].call(null,data.data),delete this.deferreds[data.deferredUuid])}function handleMessage(ev,data){var self=this;if("undefined"!=typeof data.name&&"undefined"!=typeof self.targets[data.name]){var target=self.targets[data.name];if("string"==typeof data.deferredUuid){var dfd=Q.defer();dfd.promise.then(function(response){resolveDeferredOnTarget(target.window,target.origin,data.deferredUuid,"resolve",response)},function(response){resolveDeferredOnTarget(target.window,target.origin,data.deferredUuid,"reject",response)}),self.emit(data.eventName,data.data,dfd)}else self.emit(data.eventName,data.data)}}function resolveDeferredOnTarget(target,origin,uuid,action,data){var payload={data:data,type:"deferred",deferredUuid:uuid,action:action};target.postMessage(JSON.stringify(payload),origin)}function logTimeout(){var messages=require("messages").getInstance();messages.publish("log.send",{conversation_id:utils.uuid(),correlation_id:utils.uuid(),action_name:"log:pmt-timeout",success:"false",process_time:0,anon:"true",swid:"",timestamp:new Date,error_codes:"UNKNOWN_ERROR",error_category:"UNKNOWN_ERROR",appid:"DTSS-DISNEYID-UI"})}var Q=require("../../../../assets/common/js/q"),logger=require("logger"),utils=require("../utils"),eventEmitter=require("../event-emitter"),HANDSHAKE_TIMEOUT=6e4;module.exports=PostMessageTransport;var messageHandlers={handshake:handleHandshake,handshakeAck:handleHandshakeAck,deferred:handleDeferred,message:handleMessage};PostMessageTransport.prototype.init=init,PostMessageTransport.prototype.registerChild=registerChild,PostMessageTransport.prototype.registerParent=registerParent,PostMessageTransport.prototype.send=send,PostMessageTransport.prototype.on=on,PostMessageTransport.prototype.emit=emit}()},{"../../../../assets/common/js/q":1,"../event-emitter":9,"../utils":29,logger:11,messages:12}],18:[function(require,module,exports){module.exports={fields:["email","firstName","gender","lastName","middleName","prefix","suffix","username","languagePreference","pronunciationName","address.billing","address.home","address.other","address.school","address.shipping","address.work","phone.day","phone.fax","phone.mobile","phone.night","displayName","proposedDisplayName","dateOfBirth","password"],disallowedFields:["email","username","address.other","phone.fax","dateOfBirth","password","displayName"],allowedAddressValues:["line1","line2","line3","city","stateProvince","postalCode","country","preferred"],allowedPhoneValues:["number","internationalPrefix","extension","preferred"]}},{}],19:[function(require,module,exports){!function(){"use strict";function getEditableAndRequiredFields(guest,siteConfig){var type,fields=fieldsConfig.fields.filter(function(currentField){return fieldsConfig.disallowedFields.indexOf(currentField)<0}),editableProfile={data:{},required:{}},profileConfigPath="compliance.ageBands."+guest.profile.ageBand+".UPDATE",updatableProfileFields=utils.get(siteConfig,profileConfigPath),existingProfileAddresses=ppcUtils.dictionaryFromKey(guest.profile.addresses,"type"),existingProfilePhones=ppcUtils.dictionaryFromKey(guest.profile.phones,"type"),addressTemplate=ppcUtils.createDataTemplate(utils.get(siteConfig,profileConfigPath+".addresses")),phoneTemplate=ppcUtils.createDataTemplate(utils.get(siteConfig,profileConfigPath+".phones")),displayNameConfig=utils.get(siteConfig,"displayName"),isDisplayNameEnabled=utils.get(displayNameConfig,"enabled");return fields.forEach(function(fieldValue){type=(fieldValue.split(".")[1]||"").toUpperCase(),fieldValue.indexOf("address")>-1&&updatableProfileFields.addresses?editableProfile=ppcUtils.flatten({existingProfile:existingProfileAddresses,template:addressTemplate,config:updatableProfileFields.addresses.type,allowedValues:fieldsConfig.allowedAddressValues,fieldValue:fieldValue,editableProfile:editableProfile,type:type}):fieldValue.indexOf("phone")>-1&&updatableProfileFields.phones?editableProfile=ppcUtils.flatten({existingProfile:existingProfilePhones,template:phoneTemplate,config:updatableProfileFields.phones.type,allowedValues:fieldsConfig.allowedPhoneValues,fieldValue:fieldValue,editableProfile:editableProfile,type:type}):fieldValue.toLowerCase().indexOf("displayname")>-1&&isDisplayNameEnabled?editableProfile.data[fieldValue]=utils.get(guest,"displayName."+fieldValue):updatableProfileFields[fieldValue]&&(editableProfile.data[fieldValue]=utils.get(guest,"profile."+fieldValue),editableProfile.required[fieldValue]=utils.get(updatableProfileFields,fieldValue).required||!1)}),editableProfile}var fieldsConfig=require("./fields.json"),ppcUtils=require("./ppc-utils.js"),utils=require("utils");module.exports={getEditableAndRequiredFields:getEditableAndRequiredFields}}()},{"./fields.json":18,"./ppc-utils.js":20,utils:29}],20:[function(require,module,exports){!function(){"use strict";function dictionaryFromKey(dataSet,key){return dataSet=dataSet||[],dataSet.reduce(function(dictionary,value){return"undefined"==typeof dictionary[value[key]]&&(dictionary[value[key]]=value),dictionary},{})}function createDataTemplate(dataSet){if(dataSet=dataSet||{},dataSet&&"EDITABLE"===dataSet.editable){var typesObj=dataSet.type||{};return Object.keys(typesObj).reduce(function(typeObject,typeValue){var typeContents=typesObj[typeValue]||{};return typeObject[typeValue]=Object.keys(typeContents).reduce(function(typeContentsObject,typeContentsValue){return"EDITABLE"===typeContents[typeContentsValue].editable&&"type"!==typeContentsValue&&(typeContentsObject[typeContentsValue]=null),typeContentsObject},{}),typeObject},{})}return null}function flatten(args){var current=args.existingProfile[args.type]||args.template[args.type]||args.template.DEFAULT||null,currentConfig=args.config[args.type]||args.config.DEFAULT||null;return current&&currentConfig&&Object.keys(current).forEach(function(value){if(args.allowedValues.indexOf(value)>-1){var keyName=args.fieldValue.split(".");keyName.push(value);var newKey=keyName.join(".");args.editableProfile.data[newKey]=current[value]||null,args.editableProfile.required[newKey]=(currentConfig[value]||{}).required||!1}}),args.editableProfile}module.exports={dictionaryFromKey:dictionaryFromKey,createDataTemplate:createDataTemplate,flatten:flatten}}()},{}],21:[function(require,module,exports){!function(){"use strict";function increment(state){return accumulator[state]=(accumulator[state]||0)+1,accumulator[state]}function reset(state){"undefined"==typeof state?accumulator={}:accumulator[state]=0}function getCount(state){return accumulator[state]||0}var accumulator={};module.exports={reset:reset,increment:increment,getCount:getCount}}()},{}],22:[function(require,module,exports){!function(){"use strict";function TimeSpan(start,end){this.start=start,this.end=end}module.exports=TimeSpan;var SECOND_IN_MILLIS=1e3;TimeSpan.prototype.getPercentElapsed=function(current){var endTime;return current instanceof Date?(endTime=this.end.getTime()-this.start.getTime(),(current.getTime()-this.start.getTime())/endTime):null},TimeSpan.prototype.getSecondsRemaining=function(current){return current instanceof Date?(this.end.getTime()-current.getTime())/SECOND_IN_MILLIS:null},TimeSpan.prototype.getDateAtPercent=function(pct){var max=this.end.getTime()-this.start.getTime();return new Date(this.start.getTime()+pct*max);

},TimeSpan.prototype.getDateNearestToMultipleOfSeconds=function(seconds){if(0>=seconds)return null;var duration=(this.end.getTime()-this.start.getTime())/SECOND_IN_MILLIS,offset=Math.ceil(duration/seconds)*seconds;return new Date(this.start.getTime()+offset*SECOND_IN_MILLIS)}}()},{}],23:[function(require,module,exports){!function(){"use strict";module.exports={TRUST_EXPIRY:18e5,STATES:{low:0,high:1},IGNORED_REAUTH_AUTHENTICATORS:["facebook_token","google_token","amazon_token","gamenetwork"]}}()},{}],24:[function(require,module,exports){!function(){"use strict";function isIE9(){return 9===ieVersion}function isIE10(){return Function("/*@cc_on return 10===document.documentMode@*/")()}function isAndroidBrowser(){var userAgent=navigator.userAgent.toLowerCase(),containsAndroid=-1!==userAgent.indexOf("android"),containsChrome=-1!==userAgent.indexOf("chrome"),containsWindowsPhone=-1!==userAgent.indexOf("windows phone");return containsAndroid&&!containsChrome&&!containsWindowsPhone}module.exports={isIE9:isIE9,isIE10:isIE10,isAndroidBrowser:isAndroidBrowser};var ieVersion=function(){try{for(var undef,v=3,div=document.createElement("div"),all=div.getElementsByTagName("i");div.innerHTML="<!--[if gt IE "+ ++v+"]><i></i><![endif]-->",all[0];);return v>4?v:undef}catch(e){return 0}}()}()},{}],25:[function(require,module,exports){!function(){"use strict";function crc32(str){for(var crc=-1,i=0;i<str.length;i++)crc=crc>>>8^table[255&(crc^str.charCodeAt(i))];return(-1^crc)>>>0}module.exports=crc32;var table=function(){for(var table=new Array(256),n=0;n<table.length;n++){for(var c=n,k=0;8>k;k++)c=1&c?3988292384^c>>>1:c>>>1;table[n]=c>>>0}return table}()}()},{}],26:[function(require,module,exports){!function(){"use strict";function once(fn,context){var returnValue,called=!1;return function(){return called===!1&&(called=!0,returnValue=fn.apply(context,arguments)),returnValue}}function memoize(fn,context,ttl){ttl="number"!=typeof ttl?1/0:ttl;var lookup=Object.create(null);return function(){var key=[].join.call(arguments,"-");return("undefined"==typeof lookup[key]||lookup[key].created+ttl<Date.now())&&(lookup[key]={created:Date.now(),value:fn.apply(context,arguments)}),lookup[key].value}}function debounceLeadingEdge(fn,context,threshold){var decay,returnValue;return function(){var now=Date.now();return("undefined"==typeof decay||now>=decay)&&(decay=now+threshold,returnValue=fn.apply(context,arguments),setTimeout(function(){decay=void 0,returnValue=void 0},threshold||0)),returnValue}}function debounceTrailingEdge(fn,context,threshold){var timeout,args;return function(){args=arguments,timeout||(timeout=setTimeout(function(){timeout=null,fn.apply(context,args),args=void 0},threshold))}}module.exports={once:once,memoize:memoize,debounceLeadingEdge:debounceLeadingEdge,debounce:debounceTrailingEdge}}()},{}],27:[function(require,module,exports){!function(){"use strict";function ready(){if(!readyFired){readyFired=!0;for(var i=0;i<readyList.length;i++)readyList[i].fn.call(window,readyList[i].ctx);readyList=[]}}function readyStateChange(){"complete"===document.readyState&&ready()}function docReady(callback,context){return readyFired?void setTimeout(function(){callback(context)},1):(readyList.push({fn:callback,ctx:context}),void("complete"===document.readyState||!document.attachEvent&&"interactive"===document.readyState?setTimeout(ready,1):readyEventHandlersInstalled||(document.addEventListener?(document.addEventListener("DOMContentLoaded",ready,!1),window.addEventListener("load",ready,!1)):(document.attachEvent("onreadystatechange",readyStateChange),window.attachEvent("onload",ready)),readyEventHandlersInstalled=!0)))}module.exports=docReady;var readyList=[],readyFired=!1,readyEventHandlersInstalled=!1}()},{}],28:[function(require,module,exports){!function(){function get(){return["ESPN-COACHES","ESPNCOM-ESPN.REGISTRATION","ESPN-DEPORTES","ESPN-ESPNARCADE","ESPN-ESPNCOM","ESPN-ESPNCONTESTS","ESPN-ESPNRADIO","ESPN-ESPNVIDEO","ESPN-ESPNW","ESPN-FANTASYEPRIZE","ESPN-FANTASYLM","ESPN-FC","ESPN-INSIDER","ESPN-XGAMES.WEB","DTSS-DEV.ESPN.WEB"]}function isWhitelisted(clientId){var clientIdBase=(clientId||"").replace(/(-DEV|-QA|-STAGE|-VALID|-PROD)$/,"");return-1!==get().indexOf(clientIdBase)}module.exports={isWhitelisted:isWhitelisted,get:get}}()},{}],29:[function(require,module,exports){!function(){"use strict";function set(obj,chain,value){var i,lastKey;for("string"==typeof chain&&(chain=chain.split(".")),i=0,lastKey=chain.length-1;lastKey>i;i++)("undefined"==typeof obj[chain[i]]||null===obj[chain[i]])&&(obj[chain[i]]={}),obj=obj[chain[i]];return obj[chain[lastKey]]=value,obj}function get(obj,chain,followArrays){for(followArrays&&chain.match(/^\[(\d+)\]/)&&(chain="a"+chain,obj={a:obj}),chain=chain.split(".");obj&&chain.length>0;){for(;followArrays&&(""+chain[0]).match(/.*\[\d+\]$/);)(""+chain[0]).replace(/(.*)\[(\d+)\]$/,function(match,p1,p2){chain.splice(0,1,p1,parseInt(p2,10))});obj=obj[chain.splice(0,1)]}return 0===chain.length?obj:void 0}function getQueryStringParams(url){var qs,params={};return qs=url?url.split("?")[1]:window.location.search.substr(1),qs&&qs.split("&").forEach(function(keyVal){keyVal=keyVal.split("="),params[decodeURIComponent(keyVal[0])]=decodeURIComponent(keyVal[1])}),params}function buildQueryString(props){var key,value,pairs=[];for(key in props)props.hasOwnProperty(key)&&props[key]&&(value=encodeURIComponent("object"==typeof props[key]?JSON.stringify(props[key]):props[key]),pairs.push(key+"="+value));return pairs.join("&")}function getCookie(key){return key?document.cookie.replace(new RegExp("(?:(?:^|.*;\\s*)"+key+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")||null:null}function setCookie(key,value,domain,path,expires,secure){var cookie;return!key||/^(?:expires|max\-age|path|domain|secure)$/i.test(key)?!1:(cookie=key+"="+value,expires&&expires.constructor===Date&&(cookie+="; expires="+expires.toUTCString()),domain&&(cookie+="; domain="+domain),path&&(cookie+="; path="+path),secure&&(cookie+="; secure"),document.cookie=cookie,!0)}function deleteCookie(key,domain,path){return document.cookie=encodeURIComponent(key)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(domain?"; domain="+domain:"")+(path?"; path="+path:""),!0}function getGuestControllerBaseUrl(method,path,globalConfiguration){var gcBaseUrl=globalConfiguration.services.guestController.url;if(globalConfiguration.services.guestController.ha&&globalConfiguration.services.guestController.ha.url&&globalConfiguration.services.guestController.ha.support&&!browserDetection.isIE9()){var haPaths=globalConfiguration.services.guestController.ha.support[method];haPaths&&-1!=haPaths.indexOf(path)&&(gcBaseUrl=globalConfiguration.services.guestController.ha.url)}return gcBaseUrl}function uuid(){return s4()+s4()+"-"+s4()+"-"+s4("4")+"-"+s4((Math.floor(10*Math.random())%4+8).toString(16))+"-"+s4()+s4()+s4()}function s4(sub){for(var hex=Math.floor(65535*Math.random()).toString(16),i=4-hex.length;i>0;i--)hex="0"+hex;return sub=(""+sub).substring(0,4),!isNaN(parseInt(sub,16))&&sub.length?sub+hex.substr(sub.length):hex}function clone(obj){if(null===obj||"object"!=typeof obj)return obj;var temp=new obj.constructor;for(var key in obj)obj.hasOwnProperty(key)&&(temp[key]=clone(obj[key]));return temp}function deepTrim(value){if(null!==value&&"object"==typeof value)Object.keys(value).forEach(function(name){value[name]=deepTrim(value[name])});else if("string"==typeof value)return value.trim();return value}function hasClass(node,className){var classNames=getClassArray(node);return-1!==classNames.indexOf(className)}function addClass(node,className){var classNames=getClassArray(node);-1===classNames.indexOf(className)&&(classNames.push(className),node.setAttribute("class",classNames.join(" ")))}function removeClass(node,className){var classNames=getClassArray(node),index=classNames.indexOf(className);-1!==index&&(classNames.splice(index,1),classNames.length?node.setAttribute("class",classNames.join(" ")):node.removeAttribute("class"))}function toggleClass(node,className){hasClass(node,className)?removeClass(node,className):addClass(node,className)}function getClassArray(node){var className=node.getAttribute("class")||"";return className?className.replace(/^[\s]*|[\s]*$/g,"").replace(/\s{2,}/g," ").split(" "):[]}function removeNode(node){node.parentNode.removeChild(node)}function assign(target){if(null==target)throw new TypeError("Cannot convert first argument to object");for(var pendingException,to=Object(target),hasPendingException=!1,i=1;i<arguments.length;i++){var nextSource=arguments[i];if(null!=nextSource){for(var keysArray=Object.keys(Object(nextSource)),nextIndex=0,len=keysArray.length;len>nextIndex;nextIndex++){var nextKey=keysArray[nextIndex];try{var desc=Object.getOwnPropertyDescriptor(nextSource,nextKey);void 0!==desc&&desc.enumerable&&(to[nextKey]=nextSource[nextKey])}catch(e){hasPendingException||(hasPendingException=!0,pendingException=e)}}if(hasPendingException)throw pendingException}}return to}function expires(date,ttl){var out=new Date(date);return isNaN(parseInt(ttl,10))||0>ttl||!(date instanceof Date)?null:(out.setSeconds(date.getSeconds()+ttl),out)}function isValidDate(d){return d instanceof Date&&!isNaN(d.getTime())}function uniqueArray(){var r=[],push=r.push;r.push=r.unshift=r.splice=function(){throw"not yet implemented for uniqueArray"};var unique=function(item){return-1===r.indexOf(item)};return r.addOnce=function(item,callBack){return unique(item)&&(push.call(r,item),"function"==typeof callBack&&callBack()),r.length},r}function objectDiff(previous,current){var changes={};for(var name in current)if(current.hasOwnProperty(name)){null!==previous&&"object"==typeof previous&&previous.hasOwnProperty(name)||(changes[name]=current[name]);var bothObjects=null!==current[name]&&null!==previous[name]&&!Array.isArray(current[name])&&!Array.isArray(previous[name])&&"object"==typeof current[name]&&"object"==typeof previous[name];if(bothObjects){var differences=objectDiff(previous[name],current[name]);Object.keys(differences||{}).length>0&&(changes[name]=differences)}else(previous[name]!==current[name]||Array.isArray(current[name]))&&(changes[name]=current[name]);null===previous[name]&&""===current[name]&&delete changes[name]}return changes}function filterAngularProperties(obj){return Array.isArray(obj)?obj.forEach(filterAngularProperties):null!==obj&&"object"==typeof obj&&Object.keys(obj).forEach(function(key){"$"===(key||"")[0]?delete obj[key]:filterAngularProperties(obj[key])}),obj}function makeElementAccessible(element,callback){element.attr("tabindex","0"),element.on("keypress",function(event){(32===event.keyCode||13===event.keyCode)&&callback(event)})}function getOS(){try{return new UAParser(navigator.userAgent).getOS()}catch(e){return navigator.platform}}function isIOS8(){return/(iphone|ipod|ipad).* os 8_/.test(navigator.userAgent.toLowerCase())}function isRetina(){var mediaQuery="(-webkit-min-device-pixel-ratio: 1.5), (min--moz-device-pixel-ratio: 1.5), (-o-min-device-pixel-ratio: 3/2), (min-resolution: 1.5dppx)";return window.devicePixelRatio>1||window.matchMedia&&window.matchMedia(mediaQuery).matches}function isFamilyFriendly(siteConfig){return!get(siteConfig,"uiConfig.adultAudience")}function getErrorCodesAndCategory(error){return{category:error.keyCategory,codes:(error.errors||[]).map(function(e){return e.code}).join(",")}}function containsInvalidAccessTokenError(error){return containsErrorCode(error,"AUTHORIZATION_INVALID_OR_EXPIRED_TOKEN")}function containsErrorCode(error,errorCode){return error&&(error.errors||[]).some(function(e){return e.code===errorCode})}function formatLogInfoBlock(info){info=info||{};var items=[];return Object.keys(info).forEach(function(key){var i=key;if(info[key]){var data=Array.isArray(info[key])?info[key].join(","):info[key].toString();i+="("+data+")"}items.push(i)}),items.join(",")}function heightHelper(){function lock(element,duration,cb){addClass(element,"no-animate"),element.style.height=measure(element)+"px",setTimeout(function(){removeClass(element,"no-animate"),(cb||function(){})()},0),duration&&setTimeout(function(){unlock(element)},duration)}function unlock(element){addClass(element,"no-animate"),element.style.height=null,setTimeout(function(){removeClass(element,"no-animate")},0)}function measure(element){var r=element.offsetHeight;return r||(addClass(element,"state-calculating"),r=element.offsetHeight,removeClass(element,"state-calculating")),r}return{lock:lock,unlock:unlock,measure:measure}}function maskToken(value){return"string"==typeof value?value.substring(0,6)+"...":""}function getSocialProviderFromNamespace(namespace){var NAMESPACE_TO_PROVIDER_NAME={"AM-FACEBOOK":"facebook","AM-GOOGLE":"google"};return NAMESPACE_TO_PROVIDER_NAME[namespace]}function extend(protoProps,staticProps){var extended,prop,parent=this,extender=function(){};extender.prototype=this.prototype,extended=protoProps&&protoProps.hasOwnProperty("constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)};for(prop in parent)parent.hasOwnProperty(prop)&&(extended[prop]=parent[prop]);if(staticProps)for(prop in staticProps)staticProps.hasOwnProperty(prop)&&(extended[prop]=staticProps[prop]);if(extended.prototype=new extender,extended.__super__=parent.prototype,protoProps)for(prop in protoProps)protoProps.hasOwnProperty(prop)&&(extended.prototype[prop]=protoProps[prop]);return extended.prototype.constructor=extended,extended}var UAParser=require("../../../../assets/common/js/ua-parser"),browserDetection=require("./browser-detection");module.exports={set:set,get:get,getQueryStringParams:getQueryStringParams,buildQueryString:buildQueryString,getCookie:getCookie,setCookie:setCookie,deleteCookie:deleteCookie,getGuestControllerBaseUrl:getGuestControllerBaseUrl,uuid:uuid,clone:clone,deepTrim:deepTrim,hasClass:hasClass,addClass:addClass,removeClass:removeClass,toggleClass:toggleClass,removeNode:removeNode,assign:assign,expires:expires,isValidDate:isValidDate,uniqueArray:uniqueArray,objectDiff:objectDiff,filterAngularProperties:filterAngularProperties,makeElementAccessible:makeElementAccessible,crc32:require("./crc32"),isEspnClientId:require("./espn-whitelist").isWhitelisted,getEspnWhitelist:require("./espn-whitelist").get,curry:require("./curry"),promise:require("./promise"),isIE9:browserDetection.isIE9,isIE10:browserDetection.isIE10,isAndroidBrowser:browserDetection.isAndroidBrowser,getOS:getOS,isIOS8:isIOS8,isRetina:isRetina,isFamilyFriendly:isFamilyFriendly,docReady:require("./doc-ready"),getErrorCodesAndCategory:getErrorCodesAndCategory,containsInvalidAccessTokenError:containsInvalidAccessTokenError,containsErrorCode:containsErrorCode,formatLogInfoBlock:formatLogInfoBlock,maskToken:maskToken,getSocialProviderFromNamespace:getSocialProviderFromNamespace,heightHelper:heightHelper(),extend:extend}}()},{"../../../../assets/common/js/ua-parser":3,"./browser-detection":24,"./crc32":25,"./curry":26,"./doc-ready":27,"./espn-whitelist":28,"./promise":30}],30:[function(require,module,exports){!function(){"use strict";function timeout(dfd,ttl){var args=[].slice.call(arguments,2);setTimeout(function(){dfd.reject.apply(dfd,args)},ttl)}function cache(fn,context,ttl){var promise=null;return ttl="number"!=typeof ttl?0:ttl,function(){return null===promise&&(promise=fn.apply(context,arguments),promise["finally"](function(){setTimeout(function(){promise=null},ttl)})),promise}}module.exports={timeout:timeout,cache:cache}}()},{}],31:[function(require,module,exports){!function(){"use strict";function get(){return SUPPORTED_LOCALES}function isValid(locale){return-1!==SUPPORTED_LOCALES.indexOf(locale)}module.exports={get:get,isValid:isValid};var SUPPORTED_LOCALES=["ar-XX","da-DK","de-DE","en-AU","en-US","es-ES","es-LA","fi-FI","fr-FR","id-ID","it-IT","ja-JP","ko-KR","ms-MY","nl-NL","nn-NO","pl-PL","pt-BR","ru-RU","sv-SE","th-TH","tl-PH","vi-VN","zh-CN","zh-HK"]}()},{}],32:[function(require,module,exports){!function(){"use strict";function init(attr){if(attr)for(var k in attr)attr.hasOwnProperty(k)&&(attributes[k]=attr[k])}function attachSubscribers(){messages.subscribe("log.send",sendLogs)}function applyThrottle(action){return action=(action||"").toLowerCase(),-1!==Object.keys(throttling).indexOf(action)?100*Math.random()>throttling[action]:!1}function sendLogs(data){applyThrottle(data.action_name)||prep(data).then(makeRequest)}function prep(data){var deferred=Q.defer();if("undefined"==typeof data.success&&(data.success=!0),data.info&&(data.info=utils.formatLogInfoBlock(data.info)),data.error_codes&&(data.error_codes=data.error_codes.replace(/\s/g,"_"),data.error_category||(data.error_category="FAILURE_BY_DESIGN")),data.success=""+data.success,data.appid="DTSS-DISNEYID-UI",data.timestamp=new Date,data.correlation_id=data.correlation_id||env.getCorrelationId(),data.conversation_id=data.conversation_id||utils.uuid(),data.swid)data.anon=!/{/.test(data.swid),deferred.resolve(data);else{var sdeferred=Q.defer();messages.publish("swid.read",null,sdeferred),sdeferred.promise.then(function(cookieData){data.swid=cookieData.swid,void 0===data.anon&&(data.anon=!/{/.test(data.swid)),deferred.resolve(data)})}return deferred.promise}function makeRequest(data){var path,params=[];for(var k in attributes)attributes.hasOwnProperty(k)&&(data[k]=attributes[k]);if(Object.keys(data).forEach(function(k){if("direct_flow_version"!==k){var value="object"==typeof data[k]?JSON.stringify(data[k]):data[k];params.push(encodeURIComponent(k)+"="+encodeURIComponent(value))}}),path=url+"?"+params.join("&"),utils.isIE9()){var beacon=new Image;beacon.src=path}else{var xhr=new XMLHttpRequest;xhr.open("GET",path),xhr.withCredentials=!0,xhr.send(null)}}var url="//log.go.com/log",messages=require("messages").getInstance(),utils=require("utils"),env=require("../../outer/environment"),Q=require("q"),codes={NOT_INITIALIZED:{category:"FAILURE_BY_DESIGN",code:"ONEID_NOT_YET_INITIALIZED"},SESSION_NOT_ESTABLISHED:{category:"FAILURE_BY_DESIGN",code:"SESSION_NOT_ESTABLISHED"},READ_TOKEN_FAILURE:{category:"UNKNOWN_ERROR",code:"READ_TOKEN_FAILURE"},UNKNOWN:{category:"UNKNOWN",code:"UNKNOWN_ERROR"}},attributes={},throttling={"event:init":2,"api:init":2,"api:getguest":2,"api:getloggedinstatus":2,"api:donotdisturb":2,"api:gettruststatestatus":2,"api:getguestnewsletters":2,"api:getactivitystatus":2};module.exports={init:init,attachSubscribers:attachSubscribers,codes:codes}}()},{"../../outer/environment":38,messages:12,q:1,utils:29}],33:[function(require,module,exports){!function(){"use strict";function read(){logger.log("AgebandCountryCookie#read");var cookieValue=utils.getCookie(getCookieName())||"",ageband=agebandMap[cookieValue.substring(0,1)],country=cookieValue.substring(1);return cookieValue&&ageband&&country?{ageBand:ageband,countryCode:country}:null}function write(guest){logger.log("AgebandCountryCookie#write");var cookieExpire,ageband=agebandInverseMap[utils.get(guest,"profile.ageBand")||""],country=utils.get(guest,"profile.region")||utils.get(guest,"profile.countryCodeDetected"),cookieValue=ageband+country;return ageband&&country?(cookieExpire=new Date,cookieExpire.setFullYear(cookieExpire.getFullYear()+33),utils.setCookie(getCookieName(),cookieValue,env.getCookieDomain(),"/",cookieExpire,!1),!0):(logger.debug("Failed to write country/ageband cookie"),!1)}function remove(){logger.log("AgebandCountryCookie#remove"),utils.deleteCookie(getCookieName(),env.getCookieDomain(),"/")}function getCookieName(){return env.getClientId()+"-ac"}module.exports={read:read,write:write,remove:remove};var utils=require("utils"),env=require("../environment"),logger=require("logger"),agebandMap={X:"ADULT",Y:"TEEN",Z:"CHILD"},agebandInverseMap={ADULT:"X",TEEN:"Y",CHILD:"Z"}}()},{"../environment":38,logger:11,utils:29}],34:[function(require,module,exports){!function(){"use strict";module.exports={AGEBAND_TIMEOUT:18e5,AGEBAND_DATA_SUFFIX:".ab2"}}()},{}],35:[function(require,module,exports){!function(){"use strict";function init(config){var cagootsInterval=util.get(config.site,"uiConfig.cagoots.interval"),enabled=util.get(config.site,"uiConfig.cagoots.enabled");"undefined"==typeof enabled&&(enabled=!0),logger.debug("CaGOOTS interval: "+(cagootsInterval||CAGOOTS_DEFAULT_INTERVAL_MINUTES)+" minutes"),intervalSeconds=(cagootsInterval||CAGOOTS_DEFAULT_INTERVAL_MINUTES)*MINUTE_IN_SECONDS,configDeferred.resolve()}function startTimer(){logger.log("Cagoots#startTimer");var deferred=Q.defer(),now=new Date(Date.now());return configDeferred.promise.then(function(){session.getToken().then(function(data){scheduleCheck(data,now,deferred)})}),deferred.promise}function scheduleCheck(guest,now,deferred){logger.log("Cagoots#scheduleCheck");var nextRefresh,nextCheck,timeoutIntervalMillis,delta,created=new Date(util.get(guest,"token.lastChecked")||util.get(guest,"token.created")),token=new Token(guest.token);return created instanceof Date||(created=now),timeoutIntervalMillis=getTimeoutSeconds(created,now,intervalSeconds)*SECOND_IN_MILLIS,nextRefresh=token.getNextRefreshAttempt(now,counter),nextCheck=new Date(now.getTime()+timeoutIntervalMillis),delta=(nextRefresh.date.getTime()-nextCheck.getTime())/SECOND_IN_MILLIS,CAGOOTS_REFRESH_OVERLAP_THRESHOLD_SECONDS>delta&&delta>=0?(logger.debug("Attempted to schedule a CaGOOTS check but aborted due to the next token refresh happening at the same time."),logger.debug("Next token refresh:"),logger.debug(nextRefresh),logger.debug("Next CaGOOTS check:"),logger.debug(nextCheck),logger.debug("Delta (seconds): "+delta),logger.debug("Threshold (seconds): "+CAGOOTS_REFRESH_OVERLAP_THRESHOLD_SECONDS),messages.publish("cagoots.aborted",{reason:"token_refresh_overlap"}),void deferred.reject()):(logger.debug("CaGOOTS check to happen in "+Math.floor(timeoutIntervalMillis/SECOND_IN_MILLIS/60)+" minutes "+(timeoutIntervalMillis/SECOND_IN_MILLIS%60).toFixed()+" seconds"),clearTimeout(timeout),timeout=setTimeout(function(){session.getToken().then(function(data){checkCagoots(data,now)}),attemptCount++},timeoutIntervalMillis),void deferred.resolve(timeoutIntervalMillis))}function notifyLogout(){clearTimeout(timeout)}function checkCagoots(guest,now){logger.log("Cagoots#checkCagoots");var tokenCreated,tokenExpires,tokenTimeSpan,deferred=Q.defer();if(!isNaN(Date.parse(guest.token.created))&&!isNaN(Date.parse(guest.token.expires))){if(tokenCreated=new Date(guest.token.created),tokenExpires=new Date(guest.token.expires),tokenTimeSpan=new TimeSpan(tokenCreated,tokenExpires),tokenTimeSpan.getPercentElapsed(now)>=1)return messages.publish("cagoots.aborted",{reason:"token_expired"}),void logger.debug("Token is expired - aborting CaGOOTS check");logger.debug("Attempting CaGOOTS check"),messages.publish("cagoots.check",guest,deferred),deferred.promise.then(handleCheckSuccess).fail(handleCheckError)}}function handleCheckSuccess(){logger.log("Cagoots#handleCheckSuccess"),updateLastChecked()}function handleCheckError(data){logger.log("Cagoots#handleCheckError");var errors=util.get(data,"response.error.errors")||[],codes=errors.reduce(function(p,c){return p.push(c.code),p},[]),sessionState=session.getState(),accessToken=util.get(data,"token.access_token"),loggedToken=codes.indexOf("AUTHORIZATION_INVALID_OR_EXPIRED_TOKEN")>-1?accessToken:accessToken.slice(0,6)+"...";"ppu"===data.reason&&logger.debug("cagoots check triggered ppu"),newrelic.sendLogs({action_name:"log:checkauthorization",error_category:util.get(data,"response.error.keyCategory"),error_codes:codes.join(","),info:{session:sessionState,token:loggedToken,ttl:Date.parse(util.get(data,"token.expires"))-Date.now(),attempt:attemptCount}}),updateLastChecked()}function updateLastChecked(){logger.log("Cagoots#updateLastChecked");var updateDeferred=Q.defer(),readDeferred=Q.defer(),now=new Date;messages.publish("session.updatelastchecked",null,updateDeferred),updateDeferred.promise.then(function(){messages.publish("token.read",null,readDeferred),readDeferred.promise.then(function(guest){startTimer({guest:guest,token:guest.token},now)})})}function getTimeoutSeconds(start,now,seconds){var endSeconds=start.getTime()/SECOND_IN_MILLIS+seconds,remaining=endSeconds-now.getTime()/SECOND_IN_MILLIS;return 0>remaining?0:remaining}var intervalSeconds,timeout,messages=require("../../common/messages").getInstance(),logger=require("logger"),Q=require("../../../../assets/common/js/q"),TimeSpan=require("../../common/time-span"),Token=require("../../outer/token"),session=require("../session/session"),counter=require("../../common/retry-counter"),util=require("../../common/utils/"),newrelic=require("../../outer/new-relic"),configDeferred=Q.defer(),attemptCount=0;module.exports={init:init,startTimer:startTimer,notifyLogout:notifyLogout,getTimeoutSeconds:getTimeoutSeconds};var SECOND_IN_MILLIS=1e3,MINUTE_IN_SECONDS=60,CAGOOTS_REFRESH_OVERLAP_THRESHOLD_SECONDS=60,CAGOOTS_DEFAULT_INTERVAL_MINUTES=1440}()},{"../../../../assets/common/js/q":1,"../../common/messages":12,"../../common/retry-counter":21,"../../common/time-span":22,"../../common/utils/":29,"../../outer/new-relic":45,"../../outer/token":56,"../session/session":54,logger:11}],36:[function(require,module,exports){!function(){"use strict";function handleTimerStartEvent(data){cagoots.startTimer(data)}var messages=require("../../common/messages").getInstance(),cagoots=require("./cagoots");messages.subscribe("token.refreshed",handleTimerStartEvent),messages.subscribe("session.loggedin",handleTimerStartEvent),messages.subscribe("session.reestablished",handleTimerStartEvent),messages.subscribe("config.ready",cagoots.init),messages.subscribe("session.delete",cagoots.notifyLogout)}()},{"../../common/messages":12,"./cagoots":35}],37:[function(require,module,exports){!function(){"use strict";function getSite(){var deferred=Q.defer();return messages.publish("siteconfig.read",null,deferred),utils.promise.timeout(deferred,9e4),deferred.promise}var Q=require("../../../../assets/common/js/q"),messages=require("messages").getInstance(),utils=require("utils");module.exports={getSite:getSite}}()},{"../../../../assets/common/js/q":1,messages:12,utils:29}],38:[function(require,module,exports){!function(){"use strict";function init(params,configurationOpts){var host,hostPattern=/https?:\/\/([^\/]*)\//;utils.assign(config,params),config.isDirectFlow=!!utils.get(configurationOpts,"isDirectFlow"),scriptPath=params.origin||(document.querySelector('script[src$="/outer/DisneyID.js"]')||{}).src||(document.getElementById("disneyid-script")||{}).src||document.location.href,config.environment=envHelper.getEnvironmentFromUrl(scriptPath),host=scriptPath.match(hostPattern)[1],origin=getOriginUrl(getPath()),protocol=-1===location.protocol.toLowerCase().indexOf("https")?"http":"https",config.cookieDomain?cookieDomain=config.cookieDomain:params.responderPage&&(cookieDomain=_getCommonHost(config.outerDomain||host,params.responderPage.match(hostPattern)[1])),blueCookie=!!config.blueCookie,messages.subscribe("env.correlation.read",function(data,deferred){deferred.resolve(config.correlationId)})}function getOrigin(){return origin}function getProtocol(){return protocol}function getEnvironment(){return config.environment}function blueCookieEnabled(){return blueCookie}function getClientId(){return"undefined"==typeof config.clientId||envHelper.clientIdHasSuffix(config.clientId)?config.clientId:[config.clientId,envHelper.getClientIdEnvironment(getEnvironment())].join("-")}function getClientIdEnvSuffix(){return envHelper.getClientIdEnvironment(getEnvironment())}function getCorrelationId(){return config.correlationId}function setCorrelationId(id){config.correlationId=id}function getCorrelationIdTimeStamp(){return config.correlationIdTimeStamp}function getLangPref(){return config.langPref}function getPath(){function pluck(prop,from){var r=from[prop];try{delete from[prop]}catch(ex){}return r}var clone=utils.clone(getStandardQueryParams()),clientId=pluck("clientId",clone),langPref=pluck("langPref",clone),l10nContent=pluck("l10nContent",clone),useQAContent=l10nContent?"content="+l10nContent+"&":"",path=scriptPath.replace("outer/DisneyID.js",clientId+"/"+langPref+"?include=config,l10n,js,html&"+useQAContent)+utils.buildQueryString(clone);if(logger.debug("Lightbox Path: "+path),logger.debug("Lightbox Params",clone),utils.isIE9()){logger.debug("IE9 detected - load inner from NAP7 instead of CDN");var parsingNode=document.createElement("a");parsingNode.setAttribute("href",path),path="https://"+parsingNode.host.replace(/:[0-9]+/,"").replace(/(^(?!\.)(?:(ui|cdn)[-.])|\.cdn)/,"")+"/"+parsingNode.pathname+parsingNode.search}return path}function getStandardQueryParams(){var configEnv,env=envHelper.getClientIdEnvironment(getEnvironment());configEnv="STAGE"===env?"STG":"VALID"===env?"VAL":env;var params=utils.assign({clientId:getClientId(),scheme:window.location.protocol.replace(":",""),postMessageOrigin:location.href,cookieDomain:cookieDomain,config:configEnv,ie9:utils.isIE9(),logLevel:logger.getLogLevel()},agebandCountryCookie.read()||{});["l10nContent","langPref","countryPref","continentPref","cssOverride","debug","responderPage","successPageAfterCreate","profileContext","siteURL"].forEach(function(prop){config[prop]&&(params[prop]=config[prop])});var optionalConfigs=config.optionalConfig||config.optionalConfigs;["sourceName","templateName","siteID","affiliateName"].forEach(function(prop){if(optionalConfigs&&void 0!==optionalConfigs[prop]){var value=optionalConfigs[prop];params[prop]=null===value?value:(value+"").trim()}});var country=debug.getCountry();country&&(params.countryCode=country);var geoIP=debug.getGeoIP();return geoIP&&(params.geoIP=geoIP),params.buildId=buildIdentifier,params}function getResponderPageUrl(baseUrl,additionalUrlParams){var urlParts,url,params={};return(baseUrl=baseUrl||config.responderPage)?(utils.assign(params,utils.getQueryStringParams(baseUrl),getStandardQueryParams(),additionalUrlParams||{}),urlParts=baseUrl.match(/(^[^\?]*)?(\?[^#]*)?(#.*$)?/),url=urlParts[1]+"?",url+=utils.buildQueryString(params),urlParts[3]&&(url+=urlParts[3]),url):void 0}function getMigrationResponderPageUrl(){return config.migrationResponderPage?getResponderPageUrl(config.migrationResponderPage,{"espn-migration":!0}):void 0}function getCookieDomain(){return cookieDomain}function _getCommonHost(hostA,hostB){for(var aryHostA=hostA.split(".").reverse(),aryHostB=hostB.split(".").reverse(),result=[],i=0;i<Math.min(aryHostA.length,aryHostB.length)&&aryHostA[i]===aryHostB[i];i++)result.push(aryHostA[i]);return result.length>1?result.reverse().join("."):null}function getOriginUrl(path){var parsingNode=document.createElement("a");return parsingNode.setAttribute("href",path),parsingNode.protocol+"//"+parsingNode.host}function isDirectFlow(){return config.isDirectFlow}module.exports={init:init,getOrigin:getOrigin,getProtocol:getProtocol,getPath:getPath,getClientId:getClientId,setCorrelationId:setCorrelationId,getClientIdEnvSuffix:getClientIdEnvSuffix,getCorrelationId:getCorrelationId,getCorrelationIdTimeStamp:getCorrelationIdTimeStamp,getCookieDomain:getCookieDomain,getLangPref:getLangPref,getResponderPageUrl:getResponderPageUrl,getMigrationResponderPageUrl:getMigrationResponderPageUrl,blueCookieEnabled:blueCookieEnabled,getStandardQueryParams:getStandardQueryParams,isDirectFlow:isDirectFlow};var origin,protocol,cookieDomain,scriptPath,blueCookie,messages=require("messages").getInstance(),utils=require("../common/utils"),debug=require("debug"),envHelper=require("../common/environment-helper"),agebandCountryCookie=require("./ageband-country-cookie"),logger=require("logger"),buildIdentifier=require("../common/build-identifier"),config={langPref:"en-US"}}()},{"../common/build-identifier":5,"../common/environment-helper":7,"../common/utils":29,"./ageband-country-cookie":33,debug:6,logger:11,messages:12}],39:[function(require,module,exports){!function(){"use strict";function init(opts){return logger.log("espn/migration#init"),initializationCount++,initializationCount>1?(2===initializationCount&&newrelic.sendLogs({action_name:"log:migration.responder.mismatch",
client_id:opts.clientId,timestamp:new Date,appid:"DTSS-DISNEYID-UI",success:"false"}),!1):(sessionFoundUnsubscribe=messages.subscribe("migration.session.found",function(data){logger.debug("OneID session found by migration responder"),handleSessionFound(data,opts.cookieDomain,opts.onMigrationSuccess)}),sessionNotFoundUnsubscribe=messages.subscribe("migration.session.notfound",function(){logger.debug("OneID session not found by migration responder")}),void loadMigrationResponderFrame(opts.responderPage))}function loadMigrationResponderFrame(url){responderEl=document.createElement("iframe"),responderEl.setAttribute("id","disneyid-secure-migration-responder"),responderEl.setAttribute("name","disneyid-secure-migration-responder"),responderEl.setAttribute("src",url),responderEl.style.display="none",document.body.appendChild(responderEl)}function handleSessionFound(data,cookieDomain,onMigrationSuccess){logger.log("espn/migration#handleSessionFound");var cookieDate=(q.defer(),q.defer(),new Date);isMigrating=!0,cookieDate.setFullYear(cookieDate.getFullYear()+33),Object.keys(data.cookies).forEach(function(key){var isSecure=key.indexOf(".token")>-1||key.indexOf(".idn")>-1;"swid"===key.toLowerCase()&&(swid=data.cookies[key]),utils.setCookie(key,data.cookies[key],cookieDomain,"/",cookieDate,isSecure)}),logger.debug("OneID session cookies copied to ."+cookieDomain),onMigrationSuccess()}function isMigratingSession(){return isMigrating}function getSwid(){return swid}function cleanup(){responderEl&&responderEl.parentElement&&responderEl.parentElement.removeChild(responderEl),isMigrating=!1,initializationCount=0,sessionFoundUnsubscribe(),sessionNotFoundUnsubscribe()}var swid,responderEl,messages=require("messages").getInstance(),utils=require("../../../common/utils"),logger=require("logger"),q=require("q"),newrelic=require("../../new-relic"),initializationCount=0,isMigrating=!1,sessionFoundUnsubscribe=function(){},sessionNotFoundUnsubscribe=function(){};module.exports={init:init,isMigratingSession:isMigratingSession,getSwid:getSwid,cleanup:cleanup}}()},{"../../../common/utils":29,"../../new-relic":45,logger:11,messages:12,q:1}],40:[function(require,module,exports){!function(){"use strict";function compress(data){var output="",repeating=data[0];return data.substr(1).split("").forEach(function(c){c!==repeating[0]?(output+=repeating.length>2?repeating.length+repeating[0]:repeating,repeating=c):repeating+=c}),output+=repeating.length>2?repeating.length+repeating[0]:repeating}function decompress(data){var i,j,numRepeatingChars,output="",chunks=data.split(/(\d+)/),numChunks=chunks.length;for(i=0;numChunks>i;i++)if(numRepeatingChars=parseInt(chunks[i],10),isNaN(numRepeatingChars))output+=chunks[i];else{for(j=0;numRepeatingChars>j;j++)output+=chunks[i+1][0];output+=chunks[i+1].substr(1),i++}return output}module.exports={compress:compress,decompress:decompress}}()},{}],41:[function(require,module,exports){!function(){"use strict";function encodeVal(item,prop){var val;if(item&&prop&&prop.key&&prop.type&&(val=utils.get(item,prop.key),"undefined"!=typeof val&&null!==val)){switch(prop.type){case schema.type.STRING:val=encodeStr(val);break;case schema.type.DATE:val=encodeDate(val);break;case schema.type.INT:val=encodeInt(val);break;case schema.type.BOOLEAN:val=encodeBoolean(val);break;case schema.type.ENUM:val=encodeEnum(val,prop.values);break;case schema.type.UUID:val=encodeUUID(val);break;case schema.type.LIST:val=encodeList(val,prop.schema);break;default:val=encodeStr(val)}return val}}function decodeVal(val,prop){if(""===val)return null;switch(prop.type){case schema.type.STRING:val=decodeStr(val);break;case schema.type.DATE:val=decodeDate(val);break;case schema.type.INT:val=decodeInt(val);break;case schema.type.BOOLEAN:val=decodeBoolean(val);break;case schema.type.ENUM:val=decodeEnum(val,prop.values);break;case schema.type.UUID:val=decodeUUID(val);break;case schema.type.LIST:val=decodeList(val,prop.schema)}return val}function encodeInt(num){var output="";if(num=parseInt(num,10),!isNaN(num)){if(0===num)return map.charAt(0);for(0>num&&(output=map.delimiter.NEGATIVE,num*=-1);num>0;){var div=Math.floor(num/map.base),rem=num-div*map.base;output+=map.charAt(rem),num=div}return output}}function decodeInt(chars){var output=0,sign=1,multiplier=1;return chars=(chars||"").split(""),0!==chars.length?(chars[0]===map.delimiter.NEGATIVE&&(sign=-1,chars.splice(0,1)),chars.forEach(function(c){output+=map.indexOf(c)*multiplier,multiplier*=map.base}),output*sign):void 0}function zeroPadEncodedInt(encodedValue,padLength){for(var i=0;padLength>i;i++)encodedValue+=map.charAt(0);return encodedValue}function encodeStr(str){var val,output="";if("undefined"!=typeof str&&null!==str)return(""+str).split("").forEach(function(c){val=encodeInt(c.charCodeAt()-32),2===val.length?val=map.delimiter.DOUBLE_CHAR+val:3===val.length&&(val=map.delimiter.TRIPLE_CHAR+val),output+=val}),output}function decodeStr(chars){var lookAheadTo,i=0,numChars=chars.length,output="";if(0!==numChars){for(;numChars>i;){switch(chars[i]){case map.delimiter.DOUBLE_CHAR:lookAheadTo=2,i++;break;case map.delimiter.TRIPLE_CHAR:lookAheadTo=3,i++;break;default:lookAheadTo=1}output+=String.fromCharCode(decodeInt(chars.substr(i,lookAheadTo))+32),i+=lookAheadTo}return output}}function encodeDate(date){return"[object Date]"!==Object.prototype.toString.call(date)&&(date=new Date(date)),encodeInt(date.getTime())}function decodeDate(data){return data=decodeInt(data),data?new Date(data):void 0}function encodeUUID(uuid){var length,output="",bitMask="",bytes=8;if("[object String]"!==Object.prototype.toString.call(uuid)||!uuidPattern.test(uuid))return encodeStr(uuid);bitMask+=/^{[^}]*}$/.test(uuid)?"1":"0",bitMask+=/[A-F]/.test(uuid)?"1":"0",uuid=uuid.replace(/[{\-}]/g,""),length=Math.floor(uuid.length/bytes);for(var i=0;length>i;i++){var hexValue=uuid.substr(i*bytes,bytes),value=parseInt(hexValue,16),chunk=encodeInt(value);output+=zeroPadEncodedInt(chunk,6-chunk.length)}return""+map.charAt(parseInt(bitMask,2))+output}function decodeUUID(data){var length,bitMask=parseInt(map.indexOf(data[0]),10),hasBraces=!1,isUpperCase=!1,output="",bytes=6,temp=data;isNaN(bitMask)||(bitMask=bitMask.toString(2),bitMask.length<2&&(bitMask="0"+bitMask),hasBraces="1"===bitMask[0],isUpperCase="1"===bitMask[1],data=data.substring(1)),length=Math.floor(data.length/bytes);for(var i=0;length>i;i++){for(var encodedValue=data.substr(i*bytes,bytes),decodedInt=decodeInt(encodedValue),hexValue=decodedInt.toString(16);hexValue.length<8;)hexValue="0"+hexValue;output+=hexValue}output=isUpperCase?output.toUpperCase():output.toLowerCase();var uuid=(hasBraces?"{":"")+output.substring(0,8)+"-"+output.substring(8,12)+"-"+output.substring(12,16)+"-"+output.substring(16,20)+"-"+output.substring(20)+(hasBraces?"}":"");return uuidPattern.test(uuid)?uuid:decodeStr(temp)}function encodeList(list,schema){var output=[];return schema&&"[object Array]"===Object.prototype.toString.call(list)&&"[object Array]"===Object.prototype.toString.call(schema)?(list.forEach(function(item){schema.forEach(function(prop){output.push(encodeVal(item,prop))})}),output.join(map.delimiter.LIST)):""}function decodeList(vals,schema){var prop,numProps=schema.length,list=[],item={};return vals=vals.split(map.delimiter.LIST),vals.length?(vals.forEach(function(val,i){prop=schema[i%numProps],val=decodeVal(val,prop),"undefined"!=typeof val&&null!==val&&utils.set(item,prop.key,val),(i+1)%numProps===0&&(list.push(item),item={})}),list):void 0}function encodeEnum(key,enumeration){return enumeration&&"undefined"!=typeof enumeration[key]?encodeInt(enumeration[key]):void 0}function decodeEnum(data,enumeration){var key,val=decodeInt(data);for(key in enumeration)if(enumeration.hasOwnProperty(key)&&enumeration[key]===val)return key}function encodeBoolean(b){if("true"===b||"1"===b||b===!0||1===b)b=1;else{if("false"!==b&&"0"!==b&&b!==!1&&0!==b)return;b=0}return encodeInt(b)}function decodeBoolean(data){var bool=decodeInt(data);return 1===bool}var schema=require("./schema"),map=require("./map"),utils=require("utils"),uuidPattern=/^{?[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}}?$/;module.exports={encodeVal:encodeVal,decodeVal:decodeVal}}()},{"./map":43,"./schema":44,utils:29}],42:[function(require,module,exports){!function(){"use strict";function encodeGuest(guest,version){return encode(guest,schema.guest,version)}function decodeGuest(data){return decode(data,schema.guest)}function encodeToken(token,version){return encode(token,schema.token,version)}function decodeToken(data){return decode(data,schema.token)}function encode(data,schemas,version){var schema;return version=version||schemas.currentVersion,(schema=schemas.versions[version])?compression.compress(version+map.delimiter.VERSION+serialize(data,schema)):void 0}function decode(data,schemas){var version,schema;if(data=data.split(map.delimiter.VERSION),version=data[0],schema=schemas.versions[version]){try{data=compression.decompress(data[1])}catch(e){return}if(data)try{return deserialize(data,schema)}catch(e){}}}function serialize(data,schema){return schema.map(function(prop){return encoding.encodeVal(data,prop)}).join(map.delimiter.TOP)}function deserialize(data,schema){var output={};return data.split("|").forEach(function(val,i){utils.set(output,schema[i].key,encoding.decodeVal(val,schema[i]))}),output}module.exports={encodeGuest:encodeGuest,decodeGuest:decodeGuest,encodeToken:encodeToken,decodeToken:decodeToken};var utils=require("../../common/utils"),map=require("./map"),schema=require("./schema"),encoding=require("./encoding"),compression=require("./compression")}()},{"../../common/utils":29,"./compression":40,"./encoding":41,"./map":43,"./schema":44}],43:[function(require,module,exports){!function(){"use strict";function charAt(i){return vals.charAt(i)}function indexOf(c){return vals.indexOf(c)}var vals=" !\"%&'()*+./<>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{}~",delimiter={TOP:"|",LIST:":",VERSION:"=",DOUBLE_CHAR:"#",TRIPLE_CHAR:"$",NEGATIVE:"-"};module.exports={delimiter:delimiter,base:vals.length,charAt:charAt,indexOf:indexOf}}()},{}],44:[function(require,module,exports){!function(){"use strict";var type={STRING:"string",DATE:"date",INT:"int",BOOLEAN:"boolean",ENUM:"enum",UUID:"uuid",LIST:"list",UNKNOWN:"unknown"};module.exports={currentVersion:"0",type:type,token:{currentVersion:"0",versions:{0:[{key:"token.access_token",type:type.STRING},{key:"token.swid",type:type.UUID},{key:"token.refresh_token",type:type.STRING},{key:"token.ttl",type:type.INT},{key:"token.refreshTtl",type:type.INT},{key:"token.sso",type:type.UUID},{key:"token.created",type:type.STRING},{key:"token.lastChecked",type:type.STRING},{key:"token.expires",type:type.STRING},{key:"token.refresh_expires",type:type.STRING},{key:"token.authenticator",type:type.STRING},{key:"token.blue_cookie",type:type.STRING}],1:[{key:"token.access_token",type:type.STRING},{key:"token.swid",type:type.STRING},{key:"token.refresh_token",type:type.STRING},{key:"token.ttl",type:type.INT},{key:"token.refreshTtl",type:type.INT},{key:"token.sso",type:type.UUID},{key:"token.created",type:type.STRING},{key:"token.lastChecked",type:type.STRING},{key:"token.expires",type:type.STRING},{key:"token.refresh_expires",type:type.STRING},{key:"token.authenticator",type:type.STRING},{key:"token.blue_cookie",type:type.STRING}]}}}}()},{}],45:[function(require,module,exports){!function(){"use strict";function sendLogs(data){messages.publish("log.send",data)}var metrics=require("../../metrics/newrelic"),messages=require("messages").getInstance();module.exports={attachSubscribers:metrics.attachSubscribers,sendLogs:sendLogs,init:metrics.init,codes:metrics.codes}}()},{"../../metrics/newrelic":32,messages:12}],46:[function(require,module,exports){!function(){"use strict";function getPMT(){return PMT}function init(environment){env=environment,PMT=new PostMessageTransport(PostMessageFrames.CLIENT),PMT.frames=PostMessageFrames,PMT.registerChild(PMT.frames.LIGHTBOX,env.getOrigin()),PMT.registerChild(PMT.frames.RESPONDER,"*"),PMT.registerChild(PMT.frames.MIGRATION_RESPONDER,"*"),messages.subscribe("responder.session.write",function(data,dfd){PMT.send(PMT.frames.RESPONDER,"responder.session.write",data,dfd)}),messages.subscribe("responder.session.read",function(data,dfd){PMT.send(PMT.frames.RESPONDER,"responder.session.read",data,dfd)}),messages.subscribe("responder.session.delete",function(notUsed,dfd){PMT.send(PMT.frames.RESPONDER,"responder.session.delete",null,dfd)}),messages.subscribe("responder.guest.identifier.write",function(data,dfd){PMT.send(PMT.frames.RESPONDER,"responder.guest.identifier.write",data,dfd)}),messages.subscribe("responder.guest.identifier.read",function(data,dfd){PMT.send(PMT.frames.RESPONDER,"responder.guest.identifier.read",data,dfd)}),messages.subscribe("responder.dateOfBirth.write",function(data,dfd){PMT.send(PMT.frames.RESPONDER,"responder.dateOfBirth.write",data,dfd)}),messages.subscribe("responder.dateOfBirth.read",function(notUsed,dfd){PMT.send(PMT.frames.RESPONDER,"responder.dateOfBirth.read",null,dfd)}),messages.subscribe("responder.authenticator.write",function(data,dfd){PMT.send(PMT.frames.RESPONDER,"responder.authenticator.write",data,dfd)}),messages.subscribe("responder.authenticator.read",function(notUsed,dfd){PMT.send(PMT.frames.RESPONDER,"responder.authenticator.read",null,dfd)}),messages.subscribe("siteconfig.read",function(data,dfd){PMT.send(PMT.frames.LIGHTBOX,"siteconfig.read",null,dfd)}),messages.subscribe("bluecookie.authenticate",function(data,dfd){PMT.send(PMT.frames.LIGHTBOX,"bluecookie.authenticate",data,dfd)}),messages.subscribe("bluecookie.delete",function(data,dfd){PMT.send(PMT.frames.LIGHTBOX,"bluecookie.delete",null,dfd)}),messages.subscribe("lightbox.show",function(){PMT.send(PMT.frames.LIGHTBOX,"lightbox.show",void 0)}),messages.subscribe("session.deleted",function(){PMT.send(PMT.frames.LIGHTBOX,"session.deleted")}),messages.subscribe("inner.setRoute",function(route,dfd){PMT.send(PMT.frames.LIGHTBOX,"inner.setRoute",route,dfd)}),messages.subscribe("guest.tokenrefresh",function(token,dfd){PMT.send(PMT.frames.LIGHTBOX,"guest.tokenrefresh",token,dfd)}),messages.subscribe("guest.reload",function(token,dfd){PMT.send(PMT.frames.LIGHTBOX,"guest.reload",token,dfd)}),messages.subscribe("guest.trustStateChanged",function(state,dfd){PMT.send(PMT.frames.LIGHTBOX,"guest.trustStateChanged",state,dfd)}),messages.subscribe("cagoots.check",function(guest,dfd){PMT.send(PMT.frames.LIGHTBOX,"cagoots.check",guest,dfd)}),messages.subscribe("newsletters.check-list",function(unused,deferred){PMT.send(PMT.frames.LIGHTBOX,"newsletters.check-list",unused,deferred)}),messages.subscribe("debug.geoIP",function(ip){PMT.send(PMT.frames.LIGHTBOX,"debug.geoIP",ip)}),messages.subscribe("debug.country",function(country){PMT.send(PMT.frames.LIGHTBOX,"debug.country",country)}),messages.subscribe("debug.clear",function(){PMT.send(PMT.frames.LIGHTBOX,"debug.clear")}),messages.subscribe("readyToClose",function(){PMT.send(PMT.frames.LIGHTBOX,"readyToClose")}),messages.subscribe("logger.enable",function(){PMT.send(PMT.frames.LIGHTBOX,"logger.enable")}),messages.subscribe("debug.clientConfigOverride",function(overrides){PMT.send(PMT.frames.LIGHTBOX,"debug.clientConfigOverride",overrides)}),messages.subscribe("authReloader.reloadIfChanged",function(data,dfd){PMT.send(PMT.frames.LIGHTBOX,"authReloader.reloadIfChanged",data,dfd)}),messages.subscribe("setLogLevel",function(data){PMT.send(PMT.frames.LIGHTBOX,"setLogLevel",data)}),messages.subscribe("validateDOB",function(data,dfd){PMT.send(PMT.frames.LIGHTBOX,"validateDOB",data,dfd)}),messages.subscribe("workflow.run",function(data,dfd){PMT.send(PMT.frames.LIGHTBOX,"workflow.run",data,dfd)}),messages.subscribe("workflow.execute",function(data,dfd){PMT.send(PMT.frames.LIGHTBOX,"workflow.execute",data,dfd)}),PMT.on("responder.log.send",function(data){messages.publish("log.send",data)}),PMT.on("cookielength",function(data){messages.publish("cookielength",data)}),PMT.on("session.isloggedin",function(data,dfd){messages.publish("session.isloggedin",null,dfd)}),PMT.on("session.reauth",function(data,dfd){messages.publish("session.reauth",null,dfd)}),PMT.on("apiEvent.reauth",function(data,dfd){messages.publish("apiEvent.reauth",null,dfd)}),PMT.on("lightbox.hide",function(){messages.publish("lightbox.hide")}),PMT.on("s2cookie.write",function(data,dfd){messages.publish("s2cookie.write",data,dfd)}),PMT.on("guest.write",function(data,dfd){messages.publish("guest.write",data,dfd)}),PMT.on("guest.read",function(data,dfd){messages.publish("guest.read",data,dfd)}),PMT.on("token.write",function(data,dfd){messages.publish("token.write",data,dfd)}),PMT.on("token.read",function(data,dfd){messages.publish("token.read",data,dfd)}),PMT.on("session.found",function(data){messages.publish("session.found",data)}),PMT.on("session.notfound",function(){messages.publish("session.notfound")}),PMT.on("migration.session.found",function(data){messages.publish("migration.session.found",data)}),PMT.on("migration.session.notfound",function(){messages.publish("migration.session.notfound")}),PMT.on("session.delete",function(data,dfd){messages.publish("session.delete",data,dfd)}),PMT.on("session.dateOfBirth.write",function(data,dfd){messages.publish("session.dateOfBirth.write",data,dfd)}),PMT.on("session.dateOfBirth.read",function(notUsed,dfd){messages.publish("session.dateOfBirth.read",null,dfd)}),PMT.on("session.authenticator.read",function(notUsed,dfd){messages.publish("session.authenticator.read",null,dfd)}),PMT.on("profile.create",function(data){messages.publish("profile.create",data)}),PMT.on("profile.primary-account",function(guest){messages.publish("profile.primary-account",guest)}),PMT.on("session.refreshed",function(guest){messages.publish("session.refreshed",guest)}),PMT.on("token.refreshed",function(guest){messages.publish("token.refreshed",guest)}),PMT.on("trustState.write",function(data,dfd){messages.publish("trustState.write",null,dfd)}),PMT.on("trustState.read",function(data,dfd){messages.publish("trustState.read",null,dfd)}),PMT.on("trustState.readHighestEspnTs",function(data,dfd){messages.publish("trustState.readHighestEspnTs",null,dfd)}),PMT.on("trustState.delete",function(data,dfd){messages.publish("trustState.delete",null,dfd)}),PMT.on("trustState.get",function(notUsed,dfd){messages.publish("trustState.get",null,dfd)}),PMT.on("config.ready",function(config){messages.publish("config.ready",config)}),PMT.on("lightbox.requestshow",function(state){messages.publish("lightbox.show",state)}),PMT.on("lightbox.heartbeat",function(){messages.publish("lightbox.heartbeat")}),PMT.on("lightbox.showError",function(data,dfd){messages.publish("lightbox.showError",data,dfd)}),PMT.on("marketing.opt-in",function(marketing){messages.publish("marketing.opt-in",marketing)}),PMT.on("metrics.actions.start",function(data){messages.publish("metrics.actions.start",data)}),PMT.on("swid.read",function(data,dfd){messages.publish("swid.read",data,dfd)}),PMT.on("navy.read",function(data,dfd){messages.publish("navy.read",data,dfd)}),PMT.on("inner.fatal",function(){messages.publish("inner.fatal")}),PMT.on("session.loggedin",function(data,dfd){messages.publish("session.loggedin",data,dfd)}),PMT.on("session.authenticator.write",function(data,dfd){messages.publish("session.authenticator.write",data,dfd)}),PMT.on("guest.updated",function(data){messages.publish("guest.updated",data)}),PMT.on("env.correlation.read",function(data,dfd){messages.publish("env.correlation.read",data,dfd)}),PMT.on("apiEvent.ppu",function(data,dfd){messages.publish("apiEvent.ppu",dfd,dfd)}),PMT.on("profile.deactivation-complete",function(data,dfd){messages.publish("profile.deactivation-complete",data,dfd)}),PMT.init()}module.exports={init:init,getPMT:getPMT};var PMT,env,messages=require("../../common/messages/index").getInstance(),PostMessageTransport=require("../../common/postmessage-transport"),PostMessageFrames=require("../../common/postmessage-transport/frames")}()},{"../../common/messages/index":12,"../../common/postmessage-transport":16,"../../common/postmessage-transport/frames":15}],47:[function(require,module,exports){!function(){"use strict";function getEditableProfileFields(){var dfd=Q.defer();return Q.spread([session.getGuest(),config.getSite()],function(guest,siteConfig){var data=ppc.getEditableAndRequiredFields(guest,siteConfig);dfd.resolve(data)},function(error){dfd.reject(error)}),dfd.promise}var config=require("../../../components/outer/config"),Q=require("q"),session=require("../../../components/outer/session/session"),ppc=require("../../../components/common/progressive-profile-collection");module.exports={get:getEditableProfileFields}}()},{"../../../components/common/progressive-profile-collection":19,"../../../components/outer/config":37,"../../../components/outer/session/session":54,q:1}],48:[function(require,module,exports){!function(){"use strict";function startTimer(guest){function doTokenRefresh(){logger.debug("In doTokenRefresh()"),mutex.aquire(function(){readToken().then(function(data){if(util.get(data,"token.access_token")!==util.get(guest,"token.access_token"))return logger.debug("Token has been refreshed by another tab/window"),logger.debug("Calling success, and firing a token.refreshed event"),messages.publish("token.refreshed",{token:data.token,previousToken:guest.token}),handleRefreshSuccess(data),mutex.release();if(!util.get(data,"token.refresh_token")&&!util.get(data,"token.blue_cookie "))return logger.debug("We have an invalid access token and refresh token, logging guest out"),newrelic.sendLogs({action_name:"event:refresh",process_time:-1,success:!1,anon:!1,swid:util.get(guest,"token.swid"),correlation_id:env.getCorrelationId(),error_category:"FAILURE_BY_DESIGN",error_codes:"AUTHORIZATION_MISSING_REFRESH_TOKEN"}),messages.publish("session.delete","invalidAccessAndRefreshToken"),mutex.release();var dfr=Q.defer();tokenRefresh(data,dfr),dfr.promise.then(function(response){handleRefreshSuccess(response),mutex.release()}).fail(function(response){var token=new Token(util.get(guest,"token")),haveInvalidRefreshToken=(util.get(response,"error.errors")||[]).some(function(error){return"AUTHORIZATION_INVALID_REFRESH_TOKEN"===(error||{}).code});logger.debug("Token refresh failed, checking response for errors"),logger.debug("Do Not Disturb Enabled?: "+!!doNotDisturb.getState()),logger.debug("Access Token Expired?: "+token.isExpired()),logger.debug("Have Invalid Refresh Token?: "+haveInvalidRefreshToken),!doNotDisturb.getState()&&haveInvalidRefreshToken?(logger.debug("We have an invalid access token and refresh token, logging guest out"),messages.publish("session.delete","invalidAccessAndRefreshToken")):handleRefreshFailure(guest,nextRefreshAttempt.state),mutex.release()})},function(){mutex.release(),doNotDisturb.getState()||(logger.debug("Guest was logged out in another tab"),messages.publish("session.delete","loggedOutInOtherTab"))})})}logger.log("RefreshTimer#startTimer"),guest=util.clone(guest);var nextRefreshAttempt,token=new Token(guest.token);return initMutex(),nextRefreshAttempt=token.getNextRefreshAttempt(new Date,counter),logger.debug("Next token refresh should occur at:"),logger.debug(nextRefreshAttempt),function(){var poll=function(){new Date>(nextRefreshAttempt.date||new Date)?doTokenRefresh():timeout=setTimeout(poll,1e4)};poll()}(),nextRefreshAttempt}function initMutex(){mutex||(mutex=new Mutex(env.getClientId()))}function readToken(){var dfd=Q.defer();return messages.publish("token.read",null,dfd),dfd.promise}function tokenRefresh(guest,dfr){return logger.debug("attempting token refresh"),messages.publish("guest.tokenrefresh",guest.token,dfr),dfr.promise}function handleRefreshSuccess(){logger.log("RefreshTimer#handleRefreshSuccess"),counter.reset()}function handleRefreshFailure(guest,state){logger.log("RefreshTimer#handleRefreshFailure"),counter.increment(state),startTimer(guest)}function clearTimer(){clearTimeout(timeout)}var mutex,timeout,util=require("utils"),logger=require("logger"),messages=require("../../common/messages").getInstance(),env=require("../environment"),Mutex=require("../../common/mutex"),Q=require("../../../../assets/common/js/q"),counter=require("../../common/retry-counter"),doNotDisturb=require("../ui/do-not-disturb"),Token=require("../token/"),newrelic=require("../../outer/new-relic");messages.subscribe("token.refreshed",startTimer),messages.subscribe("session.loggedin",startTimer),messages.subscribe("session.reestablished",startTimer),messages.subscribe("session.delete",clearTimer)}()},{"../../../../assets/common/js/q":1,"../../common/messages":12,"../../common/mutex":13,"../../common/retry-counter":21,"../../outer/new-relic":45,"../environment":38,"../token/":56,"../ui/do-not-disturb":59,logger:11,utils:29}],49:[function(require,module,exports){!function(){"use strict";function init(){reset(),messageSubscribers=[],messageSubscribers.push(messages.subscribe("s2cookie.write",writeHandler)),messageSubscribers.push(messages.subscribe("s2cookie.delete",deleteHandler))}function reset(){(messageSubscribers||[]).forEach(function(unsubscribe){unsubscribe()})}function writeHandler(data,dfd){getCookieInfo().then(function(cookieInfo){var cookieDate=new Date;cookieDate.setFullYear(cookieDate.getFullYear()+33),utils.setCookie(cookieInfo.name,data,cookieInfo.domain,"/",cookieDate),(dfd||Q.defer()).resolve(),logger.debug('Writing S2 Cookie "'+cookieInfo.name+'" to "'+cookieInfo.domain+'"')})}function deleteHandler(dfd){getCookieInfo().then(function(cookieInfo){utils.deleteCookie(cookieInfo.name,cookieInfo.domain,"/"),(dfd||Q.defer()).resolve()})}function getCookieInfo(){var deferred=Q.defer();return config.getSite().then(function(config){var name=utils.get(config,"clientInfo.s2-namespace"),domain=utils.get(config,"clientInfo.s2-domain");deferred.resolve({name:name?name+"_s2":"s2",domain:domain?domain:window.location.hostname})}),deferred.promise}module.exports={init:init};var messageSubscribers,utils=require("utils"),messages=require("messages").getInstance(),config=require("../config"),Q=require("../../../../assets/common/js/q"),logger=require("logger")}()},{"../../../../assets/common/js/q":1,"../config":37,logger:11,messages:12,utils:29}],50:[function(require,module,exports){!function(){"use strict";function encryptGuest(data,accessToken){var clone=utils.clone(data),stringified=JSON.stringify(clone),checksum=utils.crc32(JSON.stringify({guest:data.guest})).toString(16);return{data:sjcl.encrypt(checksum+accessToken,stringified),checksum:versionPrefix+checksum}}function decryptGuest(checksum,accessToken,encrypted){var decrypted;try{decrypted=JSON.parse(sjcl.decrypt(checksum.substring(2)+accessToken,encrypted))}catch(e){return null}return decrypted}function writeGuestData(data,accessToken,clientId){var guest={guest:data.guest,created:(new Date).toISOString()},encrypted=encryptGuest(guest,accessToken);try{localStorage.setItem(clientId+".guest",encrypted.data)}catch(e){}return encrypted.checksum}function readGuestData(checksum,accessToken,clientId){var dataFromStorage;try{dataFromStorage=localStorage.getItem(clientId+".guest")}catch(e){}return decryptGuest(""+checksum,accessToken,dataFromStorage)}function remove(clientId){try{localStorage.removeItem(clientId+".guest")}catch(e){}}var sjcl=require("../../../../../../assets/common/js/sjcl"),utils=require("utils"),versionPrefix="00";module.exports={write:writeGuestData,read:readGuestData,remove:remove}}()},{"../../../../../../assets/common/js/sjcl":2,utils:29}],51:[function(require,module,exports){!function(){"use strict";function init(){listeners.push(messages.subscribe("guest.write",guestWrite)),listeners.push(messages.subscribe("guest.read",guestRead)),listeners.push(messages.subscribe("session.delete",sessionDelete)),listeners.push(messages.subscribe("token.refreshed",tokenRefreshed))}function reset(){listeners.forEach(function(unsubscribe){unsubscribe()}),listeners=[]}function guestWrite(data,deferred){function writeGuestData(data,token,clientId){var identifierDfd=Q.defer(),checksum=guest.write(data,token.access_token,clientId);messages.publish("guest.identifier.write",checksum,identifierDfd),agebandCountryCookie.write(utils.get(data,"guest")),identifierDfd.promise["finally"](function(){deferred.resolve()})}var clientId=env.getClientId();if(!utils.get(data,"guest"))return deferred.resolve();if(!data.token||!data.token.access_token){var readDeferred=Q.defer();return messages.publish("token.read",null,readDeferred),void readDeferred.promise.then(function(token){writeGuestData(data,token.token,clientId)},function(){deferred.reject()})}writeGuestData(data,data.token,clientId)}function guestRead(data,deferred){function loadGuest(checksum,token,cacheTtl){cacheTtl="undefined"==typeof cacheTtl?216e5:cacheTtl;var guestCreated,guestCacheExpired;if(!utils.get(token,"access_token"))return failure();guestData=guest.read(checksum,token.access_token,clientId);try{guestCreated=Date.parse(guestData.created)}catch(e){}return(isNaN(guestCreated)||!isFinite(guestCreated))&&(guestCreated=Date.now()),guestCacheExpired=guestCreated+cacheTtl<=Date.now(),!guestData||guestCacheExpired?(loadGuestDeferred||(loadGuestDeferred=Q.defer(),called=Date.now(),callOriginatedHere=!0,messages.publish("guest.reload",token,loadGuestDeferred)),void loadGuestDeferred.promise.then(function(response){var checksum;if(guestData={guest:response.data,token:token},utils.get(guestData,"guest.token")&&delete guestData.guest.token,checksum=guest.write(guestData,token.access_token,clientId),messages.publish("guest.identifier.write",checksum),!data.forced&&data.context&&callOriginatedHere){var metricsData={action_name:"log:getguest",process_time:Date.now()-called,success:!0};newrelic.sendLogs(metricsData)}success()},failure)):void success()}function success(){deferred.resolve(guestData),loadGuestDeferred=null}function failure(response){if(!data.forced&&data.context&&callOriginatedHere){var error=utils.get(response,"error"),token=utils.get(tokenData,"token")||{};if(error){var errors=utils.get(error,"errors")||[],codes=errors.map(function(e){return e.code});newrelic.sendLogs({action_name:"log:getguest",error_category:utils.get(error,"keyCategory"),error_codes:codes.join(","),info:{session:""+data.sessionState,token:""+utils.maskToken(token.access_token),ttl:Date.parse(token.expires)-Date.now()}})}}deferred.reject(response),loadGuestDeferred=null}var guestData,called,callOriginatedHere,tokenData,clientId=env.getClientId(),checksumDfd=Q.defer(),tokenDfd=Q.defer();return data=data||{},data.token&&data.identifier?(tokenData=data,void loadGuest(data.identifier,data.token,data.cacheTtl)):(messages.publish("guest.identifier.read",null,checksumDfd),messages.publish("token.read",null,tokenDfd),void Q.spread([checksumDfd.promise,tokenDfd.promise],function(checksum,token){tokenData=token,loadGuest(checksum,(tokenData||{}).token,data.cacheTtl)},failure))}function sessionDelete(){guest.remove(env.getClientId()),agebandCountryCookie.remove()}function tokenRefreshed(data){var guestData,clientId=env.getClientId(),checksumDfd=Q.defer();messages.publish("guest.identifier.read",null,checksumDfd),checksumDfd.promise.then(function(checksum){guestData=guest.read(""+checksum,data.previousToken.access_token,clientId),guestData&&(checksum=guest.write({guest:guestData.guest,token:data.token},data.token.access_token,clientId),messages.publish("guest.identifier.write",checksum))})}module.exports={init:init,reset:reset};var guest=require("./index"),utils=require("utils"),messages=require("messages").getInstance(),Q=require("../../../../../../assets/common/js/q"),env=require("../../../environment"),agebandCountryCookie=require("../../../ageband-country-cookie"),newrelic=require("../../../../outer/new-relic"),loadGuestDeferred=null,listeners=[]}()},{"../../../../../../assets/common/js/q":1,"../../../../outer/new-relic":45,"../../../ageband-country-cookie":33,"../../../environment":38,
"./index":50,messages:12,utils:29}],52:[function(require,module,exports){!function(){"use strict";function Adapter(){}function appendResponderIframe(url){var responderEl=document.createElement("iframe");responderEl.setAttribute("id","disneyid-secure-responder"),responderEl.setAttribute("name","disneyid-secure-responder"),responderEl.setAttribute("src",url),responderEl.style.display="none",document.body.appendChild(responderEl)}var messages=require("../../common/messages").getInstance(),Emitter=require("../../common/event-emitter"),Q=require("../../../../assets/common/js/q");module.exports=Emitter.emittable(Adapter),Adapter.prototype.init=function(opts){var self=this;return this.watchSessionMismatches=!0,messages.subscribe("session.found",function(sessionData){self.emit("session.found",sessionData)}),messages.subscribe("session.notfound",function(){self.emit("session.notfound")}),document.body?void appendResponderIframe(opts.responderPage):void document.addEventListener("DOMContentLoaded",function(){appendResponderIframe(opts.responderPage)})},Adapter.prototype.writeSessionData=function(data,dfd){messages.publish("responder.session.write",data,dfd)},Adapter.prototype.readSessionData=function(data,dfd){return dfd=dfd||Q.defer(),messages.publish("responder.session.read",data,dfd),dfd.promise},Adapter.prototype.deleteSessionData=function(){var dfd=Q.defer();return messages.publish("responder.session.delete",null,dfd),dfd.promise},Adapter.prototype.writeIdentifier=function(identifier,dfd){return dfd=dfd||Q.defer(),messages.publish("responder.guest.identifier.write",identifier,dfd),dfd.promise},Adapter.prototype.readIdentifier=function(dfd){return dfd=dfd||Q.defer(),messages.publish("responder.guest.identifier.read",null,dfd),dfd.promise},Adapter.prototype.writeDateOfBirth=function(data,dfd){return dfd=dfd||Q.defer(),messages.publish("responder.dateOfBirth.write",data,dfd),dfd.promise},Adapter.prototype.readDateOfBirth=function(notUsed,dfd){return dfd=dfd||Q.defer(),messages.publish("responder.dateOfBirth.read",notUsed,dfd),dfd.promise},Adapter.prototype.writeAuthenticator=function(data,dfd){return dfd=dfd||Q.defer(),messages.publish("responder.authenticator.write",data,dfd),dfd.promise},Adapter.prototype.readAuthenticator=function(notUsed,dfd){return dfd=dfd||Q.defer(),messages.publish("responder.authenticator.read",notUsed,dfd),dfd.promise}}()},{"../../../../assets/common/js/q":1,"../../common/event-emitter":9,"../../common/messages":12}],53:[function(require,module,exports){!function(){"use strict";function Adapter(){}function writeNavyCookie(data){logger.log("Adapter#writeNavyCookie");var blue=utils.get(data,"token.blue_cookie"),cookieDate=new Date;utils.isEspnClientId(clientId)&&blue&&(cookieDate.setFullYear(cookieDate.getFullYear()+1),utils.setCookie("oidNAVY",blue,".go.com","/",cookieDate,!1))}function getSessionData(){logger.log("Adapter#getSessionData");var encodedTokenData=utils.getCookie(tokenCookieName);if(null===encodedTokenData)return null;var decodedTokenData=encoding.decodeToken(encodedTokenData);return decodedTokenData?decodedTokenData.token:null}var tokenCookieName,cookieDomain,identifierCookieName,dateOfBirthCookieName,authenticatorCookieName,clientId,utils=require("../../common/utils"),encoding=require("../guest-encoding"),emitter=require("../../common/event-emitter"),Q=require("../../../../assets/common/js/q"),ageBandGating=require("../ageband-gating"),envHelper=require("../../common/environment-helper"),newrelic=(require("messages").getInstance(),require("../new-relic")),logger=require("logger"),trustStateConst=require("../../common/trust-state/constants.js");module.exports=emitter.emittable(Adapter),Adapter.prototype.init=function(params){logger.log("Adapter#init"),clientId=params.clientId,tokenCookieName=params.clientId+".token",cookieDomain=params.cookieDomain,identifierCookieName=params.clientId+".idn",dateOfBirthCookieName=params.clientId+ageBandGating.AGEBAND_DATA_SUFFIX,authenticatorCookieName=params.clientId+".auth",this.watchSessionMismatches=!0;var token=getSessionData();null===token?this.emit("session.notfound"):this.emit("session.found",{token:token})},Adapter.prototype.readSessionData=function(data,dfd){logger.log("Adapter#readSessionData");var token=getSessionData();return dfd=dfd||Q.defer(),null!==token?dfd.resolve({token:token}):dfd.reject(),dfd.promise},Adapter.prototype.writeSessionData=function(data,dfd){logger.log("Adapter#writeSessionData");var cookieDate;if(cookieDate=new Date,cookieDate.setFullYear(cookieDate.getFullYear()+33),writeNavyCookie(data),"object"==typeof data.token){var originalValue,actualValue,newValue;data.token.blue_cookie=null,newValue=encoding.encodeToken({token:data.token}),originalValue=utils.getCookie(tokenCookieName)||"",utils.setCookie(tokenCookieName,newValue,cookieDomain,"/",cookieDate,!0);try{actualValue=utils.getCookie(tokenCookieName)||"",actualValue!==newValue&&newrelic.sendLogs({action_name:"log:cookie:write",anon:-1===(data.token.swid||"").indexOf("{"),success:!1,swid:data.token.swid,timestamp:new Date,info:{o_eq_a:""+(originalValue==actualValue),o_eq_n:""+(originalValue==newValue),o_size:""+originalValue.length,n_size:""+newValue.length,a_size:""+actualValue.length,cookieLength:""+document.cookie.length},appid:"DTSS-DISNEYID-UI"})}catch(e){}}dfd.resolve(data.token)},Adapter.prototype.deleteSessionData=function(){logger.log("Adapter#deleteSessionData");var dfd=Q.defer(),envSuffix=envHelper.getClientIdSuffix(clientId);if(utils.deleteCookie(tokenCookieName,cookieDomain,"/"),utils.deleteCookie(authenticatorCookieName,cookieDomain,"/"),utils.deleteCookie(identifierCookieName,cookieDomain,"/"),utils.deleteCookie("oidNAVY",".go.com","/"),utils.isEspnClientId(clientId)){var domains=[cookieDomain,".go.com",".espn.go.com"];utils.getEspnWhitelist().forEach(function(name){var cookieName=name+"-"+envSuffix;domains.forEach(function(value){utils.deleteCookie(cookieName+".token",value,"/"),utils.deleteCookie(cookieName+".auth",value,"/"),utils.deleteCookie(cookieName+".idn",value,"/")})})}else 0===clientId.indexOf("STUDIO-DISNEYMOVIEREWARDS.WEB")&&(utils.deleteCookie(tokenCookieName,"secure.disneymovierewards.go.com","/"),utils.deleteCookie(tokenCookieName,"www.disneymovierewards.go.com","/"),utils.deleteCookie(tokenCookieName,"disneymovierewards.go.com","/"));return dfd.resolve(),dfd.promise},Adapter.prototype.writeIdentifier=function(identifier,dfd){return logger.log("Adapter#writeIdentifier"),dfd=dfd||Q.defer(),utils.setCookie(identifierCookieName,identifier,cookieDomain,"/",0,!0),dfd.resolve(),dfd.promise},Adapter.prototype.readIdentifier=function(dfd){return logger.log("Adapter#readIdentifier"),dfd=dfd||Q.defer(),dfd.resolve(utils.getCookie(identifierCookieName)),dfd.promise},Adapter.prototype.writeDateOfBirth=function(data,dfd){logger.log("Adapter#writeDateOfBirth");var cookieDate;return cookieDate=new Date(Date.now()+ageBandGating.AGEBAND_TIMEOUT),dfd=dfd||Q.defer(),utils.setCookie(dateOfBirthCookieName,cookieDate.toISOString(),cookieDomain,"/",cookieDate,!1),dfd.resolve(),dfd.promise},Adapter.prototype.readDateOfBirth=function(notUsed,dfd){logger.log("Adapter#readDateOfBirth");var cookieVal=utils.getCookie(dateOfBirthCookieName);return dfd=dfd||Q.defer(),cookieVal?dfd.resolve(cookieVal):dfd.reject(cookieVal),dfd.promise},Adapter.prototype.writeAuthenticator=function(data,dfd){logger.log("Adapter#writeAuthenticator");var cookieDate;return cookieDate=new Date,cookieDate.setFullYear(cookieDate.getFullYear()+33),dfd=dfd||Q.defer(),data.token&&utils.setCookie(authenticatorCookieName,data.token.authenticator,cookieDomain,"/",cookieDate,!1),dfd.resolve(),dfd.promise},Adapter.prototype.readAuthenticator=function(notUsed,dfd){logger.log("Adapter#readAuthenticator"),dfd=dfd||Q.defer();var authenticator=utils.getCookie(authenticatorCookieName);if(utils.isEspnClientId(clientId)){var envSuffix=envHelper.getClientIdSuffix(clientId);utils.getEspnWhitelist().some(function(name){var value=utils.getCookie(name+"-"+envSuffix+".auth");return-1!==trustStateConst.IGNORED_REAUTH_AUTHENTICATORS.indexOf(value)?(authenticator=value,!0):void 0})}return dfd.resolve(authenticator),dfd.promise}}()},{"../../../../assets/common/js/q":1,"../../common/environment-helper":7,"../../common/event-emitter":9,"../../common/trust-state/constants.js":23,"../../common/utils":29,"../ageband-gating":34,"../guest-encoding":42,"../new-relic":45,logger:11,messages:12}],54:[function(require,module,exports){!function(){"use strict";function init(env,adapter){logger.log("Session#init"),environment=env,sessionAdapter=adapter,sessionState=SessionStates.NOT_KNOWN,dfrSessionStateKnown=Q.defer(),migrationResponderPageUrl=env.getMigrationResponderPageUrl(),cookieDomain=env.getCookieDomain(),mutex=new Mutex(env.getClientId()),sessionAdapter.on("session.found",handleSessionFound),sessionAdapter.on("session.notfound",handleSessionNotFound),messages.subscribe("guest.identifier.write",handleWriteIdentifierData),messages.subscribe("guest.identifier.read",handleReadIdentifierData),messages.subscribe("session.dateOfBirth.write",handleWriteDateOfBirth),messages.subscribe("session.dateOfBirth.read",handleReadDateOfBirth),messages.subscribe("session.authenticator.read",handleReadAuthenticator),messages.subscribe("session.authenticator.write",handleWriteAuthenticator),messages.subscribe("token.write",handleWriteSessionData),messages.subscribe("token.read",handleReadSessionData),messages.subscribe("navy.read",handleReadNavy),messages.subscribe("session.delete",handleDelete),messages.subscribe("session.isloggedin",handleIsLoggedIn),messages.subscribe("session.updatelastchecked",handleUpdateLastChecked),sessionAdapter.init({cookieDomain:env.getCookieDomain(),clientId:env.getClientId(),responderPage:env.getResponderPageUrl()})}function getState(){return sessionState}function getGuest(roundtrip,opts){var deferred=Q.defer();return opts=opts||{},getToken().then(function(tokenData){var guestDfd=Q.defer(),payload={identifier:utils.getCookie(environment.getClientId()+".idn"),token:tokenData.token,context:opts.context,forced:roundtrip,sessionState:sessionState};roundtrip&&(payload.cacheTtl=0),messages.publish("guest.read",payload,guestDfd),guestDfd.promise.then(function(data){data.guest.token=tokenData.token,deferred.resolve(data.guest)},function(response){var error=utils.get(response,"error");deferred.reject(error)})},function(){deferred.reject()}),deferred.promise}function getToken(){var deferred=Q.defer();return isLoggedIn().then(function(loggedIn){loggedIn?sessionAdapter.readSessionData().then(function(tokenData){deferred.resolve(tokenData)},function(){deferred.reject("Session not established")}):deferred.reject("Session not established")}),deferred.promise}function handleWriteIdentifierData(data,dfd){sessionAdapter.writeIdentifier(data,dfd)}function handleReadIdentifierData(data,dfd){sessionAdapter.readIdentifier(dfd)}function handleWriteDateOfBirth(data,dfd){sessionAdapter.writeDateOfBirth(data,dfd)}function handleReadDateOfBirth(notUsed,dfd){sessionAdapter.readDateOfBirth(notUsed,dfd)}function handleReadAuthenticator(notUsed,dfd){sessionAdapter.readAuthenticator(notUsed,dfd)}function handleWriteAuthenticator(data,dfd){sessionAdapter.writeAuthenticator(data,dfd)}function refreshToken(token){logger.log("Session#refreshToken");var dfd=Q.defer(),refreshDfd=Q.defer();return mutex.aquire(function(){messages.publish("guest.tokenrefresh",token,refreshDfd),refreshDfd.promise.then(function(data){dfd.resolve(data)},function(response){dfd.reject(response)})["finally"](function(){setTimeout(function(){mutex.release()},0)})}),dfd.promise}function handleSessionFound(sessionData){function reestablishSession(token){setSessionState(SessionStates.LOGGED_IN),messages.publish("session.reestablished",{guest:{token:token},token:token}),sessionMismatchTimer()}logger.log("Session#handleSessionFound"),new Token(sessionData.token).isExpired()&&!environment.isDirectFlow()?refreshToken(sessionData.token).then(function(data){reestablishSession(data||sessionData.token)},function(response){var token=utils.get(response,"data.token"),haveInvalidRefreshToken=(utils.get(response,"error.errors")||[]).some(function(error){return"AUTHORIZATION_INVALID_REFRESH_TOKEN"===(error||{}).code});return haveInvalidRefreshToken&&!token?void setTimeout(function(){messages.publish("session.delete","invalidRefreshToken")},1e3):void reestablishSession(token||sessionData.token)}):reestablishSession(sessionData.token)}function handleSessionNotFound(){logger.log("Session#handleSessionNotFound");var dfd=Q.defer();environment.blueCookieEnabled()&&(utils.getCookie("oidNAVY")||utils.getCookie("BLUE"))?messages.publish("bluecookie.authenticate",{blue:utils.getCookie("oidNAVY")||utils.getCookie("BLUE")},dfd):(migrationResponderPageUrl&&(logger.debug("OneID session not found on ."+cookieDomain+"; initializaing ESPN.com migration module"),espnMigration.init({responderPage:migrationResponderPageUrl,clientId:environment.getClientId(),cookieDomain:cookieDomain,onMigrationSuccess:function(){sessionMismatchTimer()}})),dfd.reject()),dfd.promise.then(function(){setSessionState(SessionStates.LOGGED_IN)},function(){setSessionState(SessionStates.NOT_LOGGED_IN)})["finally"](function(){sessionMismatchTimer()})}function handleWriteSessionData(data,dfd){logger.log("Session#handleWriteSessionData");var now=new Date;return data.token||sessionState!==SessionStates.NOT_LOGGED_IN?(data.token.created=now.toISOString(),data.token.lastChecked=data.token.created,data.token.expires=utils.expires(now,data.token.ttl).toISOString(),void writeTokenCookie(data).then(function(response){dfd.resolve(response)},function(response){dfd.reject(response)})):void dfd.resolve()}function writeTokenCookie(data){logger.log("Session#writeTokenCookie");var previousSessionState=sessionState,writeDeferred=Q.defer(),dfd=Q.defer();return"object"==typeof data.guest&&(data.guest.token=data.token),sessionAdapter.writeSessionData(data,writeDeferred),writeDeferred.promise.then(function(){setSessionState(SessionStates.LOGGED_IN),previousSessionState===SessionStates.NOT_KNOWN?(messages.publish("session.reestablished",data),dfd.resolve()):dfd.resolve()}),dfd.promise}function handleReadSessionData(data,dfd){logger.log("Session#handleReadSessionData"),getToken().then(function(data){dfd.resolve(data)}).fail(function(){dfd.reject()})}function handleReadNavy(data,dfd){logger.log("Session#handleReadNavy"),dfd.resolve({value:utils.getCookie("oidNAVY")})}function handleDelete(logoutType,dfd){logger.log("Session#handleDelete");var blueCookieDfd=Q.defer(),s2CookieDfd=Q.defer(),tsDeleteDfd=Q.defer(),sessionDeletePromise=sessionAdapter.deleteSessionData();messages.publish("bluecookie.delete",null,blueCookieDfd),messages.publish("s2cookie.delete",s2CookieDfd),messages.publish("trustState.delete",null,tsDeleteDfd),Q.all([blueCookieDfd.promise,s2CookieDfd.promise,tsDeleteDfd.promise,sessionDeletePromise])["finally"](function(){setSessionState(SessionStates.NOT_LOGGED_IN),messages.publish("session.deleted",logoutType),null!==dfd&&"object"==typeof dfd&&"function"==typeof dfd.resolve&&dfd.resolve()})}function handleIsLoggedIn(data,dfd){isLoggedIn().then(function(loggedin){dfd.resolve(loggedin)}).fail(function(){dfd.reject()})}function setSessionState(state){sessionState=state,state===SessionStates.LOGGED_IN?dfrSessionStateKnown.resolve(!0):state===SessionStates.NOT_LOGGED_IN&&dfrSessionStateKnown.resolve(!1)}function isLoggedIn(){var dfr=Q.defer();return sessionState===SessionStates.NOT_KNOWN?dfrSessionStateKnown.promise:(dfr.resolve(sessionState===SessionStates.LOGGED_IN),dfr.promise)}function handleUpdateLastChecked(data,deferred){logger.log("Session#handleUpdateLastChecked");var token;return getToken().then(function(data){token=utils.clone(data).token,token.lastChecked=(new Date).toISOString(),writeTokenCookie({token:token}).then(function(response){deferred.resolve(response)},function(response){deferred.reject(response)})}),deferred.promise}function sessionMismatchTimer(){function handleTimer(){sessionAdapter.watchSessionMismatches!==!0||retries>MAX_MISMATCH_RELOAD_RETRIES||(clearTimeout(sessionMismatchTimeout),sync({notifyLoginSuccess:!0}).then(function(){schedule(),retries=0},function(){schedule(),retries++}))}function schedule(){sessionMismatchTimeout=setTimeout(handleTimer,2e3)}var retries=0;handleTimer()}function sync(opts){function fulfilled(loggedIn,haveTokenData){loggedIn===!0&&haveTokenData===!1?(logger.debug("logged out from another window"),messages.publish("session.delete","tokenDataDeleted"),setSessionState(SessionStates.NOT_LOGGED_IN),deferred.resolve()):loggedIn===!1&&haveTokenData===!0?(logger.debug("logged in from another window"),setSessionState(SessionStates.LOGGED_IN),getGuest().then(function(data){var payload,reloadDeferred=Q.defer();payload={ageBand:utils.get(data,"profile.ageBand"),legalCountry:utils.get(data,"profile.countryCodeDetected")},messages.publish("authReloader.reloadIfChanged",payload,reloadDeferred),reloadDeferred.promise.then(function(){espnMigration.isMigratingSession()&&logMigrationSuccess(),opts.notifyLoginSuccess&&messages.publish("session.loggedin",data),deferred.resolve()},function(error){espnMigration.isMigratingSession()&&logMigrationFailure(error),deferred.reject()})},function(error){espnMigration.isMigratingSession()&&logMigrationFailure(error),deferred.reject()})):deferred.resolve()}function logMigrationSuccess(){newrelic.sendLogs({action_name:"event:migration",client_id:environment.getClientId(),swid:espnMigration.getSwid(),anon:"false",timestamp:new Date,appid:"DTSS-DISNEYID-UI",success:"true"})}function logMigrationFailure(error){var payload={action_name:"event:migration",client_id:environment.getClientId(),swid:espnMigration.getSwid(),timestamp:new Date,appid:"DTSS-DISNEYID-UI",success:"false",error_codes:utils.get(error.errors[0].code)};(error||{}).reason&&(payload.info={reason:error.reason}),newrelic.sendLogs(payload)}var deferred=Q.defer();return opts=opts||{},isLoggedIn().then(function(loggedIn){sessionAdapter.readSessionData().then(function(){fulfilled(loggedIn,!0)},function(){fulfilled(loggedIn,!1)})}),deferred.promise}module.exports={init:init,getToken:getToken,getGuest:getGuest,getState:getState,isLoggedIn:isLoggedIn,sync:sync,refreshToken:refreshToken};var mutex,dfrSessionStateKnown,sessionState,sessionAdapter,environment,sessionMismatchTimeout,migrationResponderPageUrl,cookieDomain,Q=require("../../../../assets/common/js/q"),Token=require("../token"),messages=require("../../common/messages").getInstance(),newrelic=require("../new-relic"),Mutex=require("../../common/mutex"),utils=require("utils"),logger=require("logger"),espnMigration=require("../espn/migration"),SessionStates={NOT_KNOWN:"not_known",LOGGED_IN:"logged_in",NOT_LOGGED_IN:"not_logged_in"},MAX_MISMATCH_RELOAD_RETRIES=5}()},{"../../../../assets/common/js/q":1,"../../common/messages":12,"../../common/mutex":13,"../espn/migration":39,"../new-relic":45,"../token":56,logger:11,utils:29}],55:[function(require,module,exports){!function(){"use strict";function anonymize(opts){opts=opts||{};var swid=utils.getCookie(cookieName);(!swid||bracketPattern.test(swid)&&!opts.dontAnonymizeRealSwid||opts.force)&&write(utils.uuid())}function checkBrackets(swid){return bracketPattern.test(swid)||(swid="{"+swid+"}"),swid}function write(swid,add_brackets){var cookieDate=new Date;cookieDate.setFullYear(cookieDate.getFullYear()+1),add_brackets===!0&&(swid=checkBrackets(swid)),utils.setCookie(cookieName,swid,domain,"/",cookieDate)}function read(){return checkBrackets(utils.getCookie(cookieName))}function setDomain(d){domain=d}var utils=require("utils"),messages=require("messages").getInstance(),cookieName="SWID",bracketPattern=/^\{[^}]+\}$/,cookieLength=-1,domain=function(host){var fallback=".go.com",m=host.match(/[^.]+(?:\.com?(?:\.[a-z]{2})?|(?:\.[a-z]+))?$/i);return m&&m.length?"."+m[0]:fallback}(window.location.hostname);!function(){messages.subscribe("cookielength",function(length){cookieLength=length}),messages.subscribe("swid.read",function(){var deferred=arguments[1];deferred&&deferred.resolve&&deferred.resolve({swid:utils.getCookie(cookieName),cookieLength:cookieLength})})}(),module.exports={anonymize:anonymize,write:write,read:read,setDomain:setDomain}}()},{messages:12,utils:29}],56:[function(require,module,exports){!function(){"use strict";function Token(tokenData){function getNextRefreshAttempt(now,counter){logger.log("Token#getNextRefreshAttempt");var created=new Date(self.data.created),expires=new Date(self.data.expires);if(!utils.isValidDate(created)||!utils.isValidDate(expires))return void logger.error("Invalid created or expires date in token object");var nextRefreshAttempt,state,tokenTimeSpan=new TimeSpan(created,expires),pctElapsed=tokenTimeSpan.getPercentElapsed(now),secondsRemaining=tokenTimeSpan.getSecondsRemaining(now),nowUntilExpires=new TimeSpan(now,tokenTimeSpan.end);if(pctElapsed>1){var expiredRetryCount=counter.getCount(TOKEN_LIFECYCLE_STATE.EXPIRED),expiresToNow=new TimeSpan(tokenTimeSpan.end,now);state=TOKEN_LIFECYCLE_STATE.EXPIRED,logger.debug("Token currently expired. Retries already attempted within this interval: "+expiredRetryCount),EXPIRED_TOKEN_RETRY_ATTEMPTS>expiredRetryCount?(logger.debug("token should be refreshed immedietly"),nextRefreshAttempt=now):(logger.debug("Too many attempts made within this interval. Get time nearest to interval of "+EXPIRED_TOKEN_RETRY_INTERVAL+" (round up)"),counter.reset(),nextRefreshAttempt=expiresToNow.getDateNearestToMultipleOfSeconds(EXPIRED_TOKEN_RETRY_INTERVAL))}else if(pctElapsed>=REFRESH_TIME_PCT&&1>pctElapsed||REFRESH_TIME_SECONDS>=secondsRemaining&&self.data.ttl>=REFRESH_TIME_SECONDS_TTL_THRESHOLD)state=TOKEN_LIFECYCLE_STATE.REFRESH_WINDOW,0===counter.getCount(TOKEN_LIFECYCLE_STATE.REFRESH_WINDOW)?(logger.debug("Token is active, we are within the token refresh window and a refresh attempt has not yet been made. Refresh immedietly."),nextRefreshAttempt=now):(logger.debug("Token is active, we are within the token refresh window, and an attempt has already been made."),nextRefreshAttempt=nowUntilExpires.getDateAtPercent(REFRESH_TIME_RETRY_PCT));else{logger.debug("Valid token"),state=TOKEN_LIFECYCLE_STATE.VALID;var pctTime=tokenTimeSpan.getDateAtPercent(REFRESH_TIME_PCT).getTime(),thresholdTime=self.data.ttl<=REFRESH_TIME_SECONDS_TTL_THRESHOLD?pctTime:tokenTimeSpan.end.getTime()-REFRESH_TIME_SECONDS*SECOND_IN_MILLIS;nextRefreshAttempt=new Date(Math.min(pctTime,thresholdTime))}return{date:nextRefreshAttempt,state:state}}function isExpired(){var expires=new Date(self.data.expires),expiresTime=expires.getTime();return!self.isValid()||isNaN(expiresTime)||expiresTime<(new Date).getTime()}function isValid(){return"string"==typeof self.data.access_token&&"string"==typeof self.data.swid&&"number"==typeof self.data.ttl}var self=this;this.data=tokenData||{},this.getNextRefreshAttempt=getNextRefreshAttempt,this.isValid=isValid,this.isExpired=isExpired;var SECOND_IN_MILLIS=1e3,REFRESH_TIME_PCT=.9,REFRESH_TIME_SECONDS=300,REFRESH_TIME_RETRY_PCT=.5,REFRESH_TIME_SECONDS_TTL_THRESHOLD=480,EXPIRED_TOKEN_RETRY_ATTEMPTS=3,EXPIRED_TOKEN_RETRY_INTERVAL=300}module.exports=Token;var TOKEN_LIFECYCLE_STATE={VALID:1,REFRESH_WINDOW:2,EXPIRED:3},TimeSpan=require("../../common/time-span"),utils=require("utils"),logger=require("logger");Token.TOKEN_LIFECYCLE_STATE=TOKEN_LIFECYCLE_STATE}()},{"../../common/time-span":22,logger:11,utils:29}],57:[function(require,module,exports){!function(){"use strict";function init(){messages.subscribe("session.loggedin",watch),messages.subscribe("session.reauth",watch),messages.subscribe("session.deleted",function(){currentState=void 0,reset()}),messages.subscribe("trustState.get",function(notUsed,deferred){get().then(function(state){deferred.resolve(state)})})}function watch(){logger.log("TrustState#watch");var deleteDfd=(Q.defer(),Q.defer());get().then(function(data){if(messages.publish("guest.trustStateChanged",data.state,data.timeLeft),reset(),data.state===constants.STATES.low)return void messages.publish("trustState.delete",null,deleteDfd);messages.publish("trustState.setTimer",data.timeLeft);var timerExpiredMsg=messages.subscribe("trustState.timerExpired",function(){messages.publish("guest.trustStateChanged",constants.STATES.low),messages.publish("trustState.delete"),timerExpiredMsg()})},function(){messages.publish("guest.trustStateChanged",constants.STATES.low),reset()})}function reset(){messages.publish("trustState.clearTimer")}function get(){var deferred=Q.defer(),readDfd=Q.defer();return messages.publish("trustState.read",null,readDfd),readDfd.promise.then(function(data){var timeLeft=Date.parse(data)-(new Date).getTime();deferred.resolve({state:1>timeLeft?constants.STATES.low:constants.STATES.high,timeLeft:timeLeft})},function(){deferred.resolve({state:constants.STATES.low,timeLeft:-1})}),deferred.promise}function getTrustLength(){return constants.TRUST_EXPIRY}var currentState,trustState={init:init,get:get,getTrustLength:getTrustLength},Q=require("../../../../assets/common/js/q"),messages=require("messages").getInstance(),constants=require("./../../common/trust-state/constants.js"),logger=require("logger");module.exports=trustState}()},{"../../../../assets/common/js/q":1,"./../../common/trust-state/constants.js":23,logger:11,messages:12}],58:[function(require,module,exports){!function(){"use strict";function init(){COOKIE_DOMAIN=env.getCookieDomain(),COOKIE_NAME=env.getClientId()+".ts",messages.subscribe("trustState.setTimer",setTimer),messages.subscribe("trustState.clearTimer",clearTimer),messages.subscribe("trustState.write",handleTrustStateWrite),messages.subscribe("trustState.read",handleTrustStateRead),messages.subscribe("trustState.readHighestEspnTs",handleReadHighestEspnTs),messages.subscribe("trustState.delete",handleTrustStateDelete)}function setTimer(timeLeft){trustStateTimer=setTimeout(function(){messages.publish("trustState.timerExpired")},timeLeft)}function clearTimer(){clearTimeout(trustStateTimer),trustStateTimer=void 0}function handleTrustStateWrite(data,dfd){dfd=dfd||Q.defer();var cookieDate=new Date(Date.now()+constants.TRUST_EXPIRY),cookieValue=utils.setCookie(COOKIE_NAME,cookieDate.toISOString(),COOKIE_DOMAIN,"/",cookieDate,!1);cookieValue?dfd.resolve(cookieValue):dfd.reject()}function handleTrustStateRead(data,dfd){dfd=dfd||Q.defer();var cookieValue=utils.getCookie(COOKIE_NAME);null===cookieValue?dfd.reject():dfd.resolve(cookieValue)}function handleReadHighestEspnTs(data,dfd){dfd=dfd||Q.defer();var cookieValue=findHighestTrustStateCookieForESPN();null===cookieValue?dfd.reject():dfd.resolve(cookieValue)}function findHighestTrustStateCookieForESPN(){var cookieValues=utils.getEspnWhitelist().map(function(name){return utils.getCookie(name+"-"+env.getClientIdEnvSuffix()+".ts")});return cookieValues.sort(function(a,b){try{a=new Date(a).getTime()}catch(e){a=0}try{b=new Date(b).getTime()}catch(e){b=0}return a-b}).pop()}function handleTrustStateDelete(data,dfd){utils.deleteCookie(COOKIE_NAME,COOKIE_DOMAIN,"/"),deleteTrustStateCookiesIfESPN(),(dfd||Q.defer()).resolve()}function deleteTrustStateCookiesIfESPN(){utils.isEspnClientId(env.getClientId())&&utils.getEspnWhitelist().forEach(function(name){utils.deleteCookie(name+"-"+env.getClientIdEnvSuffix()+".ts",COOKIE_DOMAIN,"/")})}var trustStateTimer,timer={init:init},Q=require("../../../../assets/common/js/q"),messages=require("messages").getInstance(),utils=require("utils"),env=require("../environment.js"),constants=require("./../../common/trust-state/constants.js"),COOKIE_DOMAIN="",COOKIE_NAME="";module.exports=timer}()},{"../../../../assets/common/js/q":1,"../environment.js":38,"./../../common/trust-state/constants.js":23,messages:12,utils:29}],59:[function(require,module,exports){!function(){"use strict";function setState(flag){doNotDisturbState=flag}function getState(){return doNotDisturbState}module.exports={setState:setState,getState:getState};var doNotDisturbState}()},{}],60:[function(require,module,exports){var environment=require("../../environment");!function(){"use strict";function innerLoadedListener(event){"inner.loaded"===event.data&&(innerLoaded=!0,window.removeEventListener("message",innerLoadedListener))}function _appendIframe(){logger.log("UI#appendIframe");var style=document.createElement("style");style.setAttribute("id","disneyid-style"),style.setAttribute("type","text/css"),style.innerHTML="div#disneyid-wrapper{position:absolute;display:none;opacity:0;top:0;left:0;width:100%;height:100%;}div#disneyid-wrapper.state-active {z-index: 9999999;opacity:1;transition:opacity 300ms;-webkit-transition:opacity 300ms;}iframe#disneyid-iframe{width:100%;height:100%;}",wrapper=document.createElement("div"),wrapper.setAttribute("id","disneyid-wrapper"),iframe=document.createElement("iframe"),iframe.setAttribute("id","disneyid-iframe"),iframe.setAttribute("name","disneyid-iframe"),iframe.setAttribute("frameborder","0");var path=env.getPath();iframe.setAttribute("src",path),wrapper.appendChild(iframe),document.head.appendChild(style),document.body.appendChild(wrapper);var iframeLoadTimeout=setTimeout(function(){messages.publish("lightbox.showError",{reason:"inner.timeout"})},9e4);messages.subscribe("lightbox.heartbeat",function(){clearTimeout(iframeLoadTimeout)})}function init(environment){env=environment,utils.docReady(_appendIframe)}function show(params,deferred){params&&params.deferWhenDoNotDisturbEnabled&&doNotDisturb.getState()||utils.docReady(function(){scroll.disable(),setFrameFocus(),setTimeout(function(){wrapper.className="state-active"},0),setTimeout(function(){wrapper.style.display="block",deferred&&deferred.resolve&&deferred.resolve()},50),staticErrorPageLoaded&&newrelic.sendLogs({action_name:"event:service-error",process_time:0,success:!1,error_codes:"UNKNOWN_ERROR",error_category:"UNKNOWN_ERROR",info:{"static":"true"}})})}function setFrameFocus(){logger.log("UI#setFrameFocus");var start=Date.now(),interval=setInterval(function(){if(document.activeElement!==iframe&&Date.now()-start<5e3)try{iframe.focus()}catch(e){}else clearInterval(interval)},100)}function clearFrameFocus(){logger.log("UI#clearFrameFocus");try{document.querySelector("body").focus()}catch(e){}}function hide(){logger.log("UI#hide"),wrapper&&(wrapper.style.display="none",wrapper.className=""),scroll.enable(),clearFrameFocus()}function showError(data){logger.log("UI#showError"),staticErrorPageLoaded=!0;var params=env.getStandardQueryParams(),reason=utils.get(data,"reason")||"outer",dest=environment.getOrigin()+"/v2/error/"+environment.getClientId()+"/"+environment.getLangPref()+"?reason="+encodeURIComponent(reason);params.cssOverride&&(dest+="&cssOverride="+encodeURIComponent(params.cssOverride)),iframe&&(iframe.src=dest),newrelic.sendLogs({action_name:"log:service-error.static",process_time:0,success:!1,error_category:"UNKNOWN_ERROR",error_codes:"UNKNOWN_ERROR",info:{reason:reason,innerLoaded:""+innerLoaded}})}module.exports={init:init,show:show,hide:hide};var env,iframe,wrapper,newrelic=require("../../../outer/new-relic"),messages=require("messages").getInstance(),utils=require("utils"),doNotDisturb=require("../do-not-disturb"),scroll=require("./scroll"),logger=require("logger"),staticErrorPageLoaded=!1,innerLoaded=!1;window.addEventListener("message",innerLoadedListener,!1),messages.subscribe("lightbox.show",show),messages.subscribe("lightbox.hide",hide),messages.subscribe("lightbox.showError",showError)}()},{"../../../outer/new-relic":45,"../../environment":38,"../do-not-disturb":59,"./scroll":61,logger:11,messages:12,utils:29}],61:[function(require,module,exports){!function(){"use strict";function disable(){enabled||(body=window.document.querySelector("body"),originalStyles={html:{overflow:body.style.overflow,height:body.style.height},body:{overflow:body.style.overflow,height:body.style.height}},html.style.overflow="hidden",html.style.height="100%",body.style.overflow="hidden",body.style.height="100%",
enabled=!0)}function enable(){enabled&&(html.style.overflow=originalStyles.html.overflow,html.style.height=originalStyles.html.height,body.style.overflow=originalStyles.body.overflow,body.style.height=originalStyles.body.height,enabled=!1)}module.exports={enable:enable,disable:disable};var originalStyles,body,enabled=!1,html=window.document.querySelector("html")}()},{}],62:[function(require,module,exports){!function(){"use strict";"etag-bump";function getSingleton(opts){if(!instance){if(!opts||!Object.keys(opts).length)throw new Error(ERRORS.NO_CONFIG_OPTIONS);if(!opts.clientId)throw new Error(ERRORS.NO_CLIENT_ID);if("string"!=typeof opts.responderPage)throw new Error(ERRORS.NO_RESPONDER_PAGE);initialConfig=utils.clone(opts),opts.correlationId||(opts.correlationId=utils.uuid()),opts.correlationId&&opts.correlationIdTimeStamp||(opts.correlationIdTimeStamp=(new Date).getTime())}if(opts&&instance)throw new Error(ERRORS.CONFIG_SET);return opts&&!instance&&(opts.logLevel&&logger.setLogLevel(opts.logLevel),instance=new DisneyID(opts),instance.on("error",function(reason){logger.error(reason)})),instance}function configure(opts){configurationOpts=opts||{},opts.isDirectFlow&&(DisneyID.prototype.launchSocialLoginExceptionHandler=launchSocialLoginExceptionHandler,DisneyID.prototype.launchPPU=launchPPU,DisneyID.prototype.sync=sync,DisneyID.prototype.launchReady=launchReady)}function deleteInstance(){instance=void 0}function launchSocialLoginExceptionHandler(opts){opts.interactionOpts=getRouteOptions(opts),messages.publish("bridge.handleSocialLoginException",opts)}function launchPPU(opts){opts=opts||{},opts.interactionOpts=getRouteOptions(opts),messages.publish("bridge.launchPPU",opts)}function sync(){return session.sync()}function launchReady(opts){if(opts=opts||{},state.initialized){var routeDeferred=Q.defer();setRoute("ready",opts,routeDeferred)}else instance.emit("error",ERRORS.NOT_INITIALIZED)}function runWorkflow(name,step,data,execute_only){var dfd=Q.defer(),evt=execute_only?"workflow.execute":"workflow.run";return messages.publish(evt,{name:name,step:step,data:data},dfd),dfd.promise}function setRoute(name,opts,deferred,routeParameters){messages.publish("inner.setRoute",{name:name,opts:getRouteOptions(opts),routeParameters:routeParameters},deferred),utils.promise.timeout(deferred,9e4)}function getOptionalConfigs(opts){var optionalConfigs=utils.get(opts,"optionalConfigs")||{},output={},props=["sourceName","templateName","siteID","affiliateName"],inputs=[optionalConfigs,utils.get(initialConfig,"optionalConfigs")||{},utils.get(initialConfig,"optionalConfig")||{}];return inputs.forEach(function(input){props.forEach(function(propName){"undefined"==typeof output[propName]&&input[propName]&&(output[propName]=input[propName])})}),Object.keys(optionalConfigs).forEach(function(propName){-1===props.indexOf(propName)&&(output[propName]=optionalConfigs[propName])}),output}function getRouteOptions(opts){return opts=opts||{},opts.conversationId=opts.conversationId||utils.uuid(),opts.conversationIdTimeStamp=opts.conversationIdTimeStamp||(new Date).getTime(),opts.correlationId=opts.correlationId||env.getCorrelationId(),opts.correlationIdTimeStamp=opts.correlationIdTimeStamp||env.getCorrelationIdTimeStamp(),state.conversationId=opts.conversationId,opts}function checkCagoots(){session.getToken().then(function(data){messages.publish("cagoots.check",data,Q.defer())})}function overrideClientConfig(overrides){messages.publish("debug.clientConfigOverride",overrides)}function sendLogs(params){params.error_codes&&(params.error_codes=params.error_codes.replace(/\s/g,"_"),params.error_category=ERRORS.FAILURE_BY_DESIGN),newrelic.sendLogs(utils.assign({correlation_id:env.getCorrelationId(),conversation_id:state.conversationId||utils.uuid(),swid:utils.getCookie("SWID")},params))}function recoverSession(opts){var deferred=Q.defer(),refreshCalled=Date.now(),metricsData={action_name:"log:token_invalid:refresh",info:{context:opts.context}};return session.getToken().then(function(sessionData){metricsData.info.token=utils.maskToken(utils.get(sessionData,"token.access_token")),session.refreshToken(sessionData.token).then(function(){metricsData.process_time=Date.now()-refreshCalled,metricsData.success=!0,sendLogs(metricsData),deferred.resolve()},function(response){var errorBlock=response?utils.getErrorCodesAndCategory(response):{};sendLogs(utils.assign(metricsData,{process_time:Date.now()-refreshCalled,success:!1,error_codes:errorBlock.codes||newrelic.codes.READ_TOKEN_FAILURE.code,error_category:errorBlock.category||newrelic.codes.READ_TOKEN_FAILURE.category})),deferred.reject(response)})},function(){sendLogs(utils.assign(metricsData,{process_time:Date.now()-refreshCalled,success:!1,error_codes:newrelic.codes.READ_TOKEN_FAILURE.code,error_category:newrelic.codes.READ_TOKEN_FAILURE.category})),deferred.resolve()}),deferred.promise}module.exports={configure:configure,get:getSingleton,deleteInstance:deleteInstance};var DisneyID,initialConfig,configurationOpts,instance,trustStateWeb,swid=require("../components/outer/swid"),appVersion="2.14.14",Q=require("../../assets/common/js/q"),utils=require("utils"),guestUpdated=require("./guest-updated"),messages=require("messages").getInstance(),env=require("../components/outer/environment"),session=require("../components/outer/session/session"),eventEmitter=require("../components/common/event-emitter"),languages=require("../components/inner/language-preferences/languages"),newrelic=require("../components/outer/new-relic"),doNotDisturb=require("../components/outer/ui/do-not-disturb"),trustState=require("../components/outer/trust-state"),trustStateConst=require("../components/common/trust-state/constants.js"),config=require("../components/outer/config"),progressiveProfileCollection=require("../components/outer/progressive-profile-collection"),logger=require("logger"),state={},timestamps={},ERRORS={NO_CONFIG_OPTIONS:"No configuration options provided",CONFIG_SET:"Configuration options have already been set",NO_CLIENT_ID:"clientId not provided",NO_RESPONDER_PAGE:"responderPage not provided",SESSION_ESTABLISHED:"Session already established",SESSION_NOT_ESTABLISHED:"Session not established",NOT_INITIALIZED:"Not initialized",ALREADY_INITIALIZED:"Already initialized",UNSUPPORTED_LOCALE:"Unsupported locale",NOT_IMPLEMENTED:"Not implemented",INVALID_ARGUMENT:"Invalid argument",FAILURE_BY_DESIGN:"FAILURE_BY_DESIGN",NOT_ENABLED:"Not enabled",NO_CALLBACK:"No Network Connect Callback URI passed",CALLBACK_MISMATCH:"Network Connect Callback URI does not match origin",UNKNOWN_ERROR:"An unknown error occurred"};DisneyID=function(opts){var self=this,os=utils.getOS();opts.outerDomain=window.location.hostname,env.init(opts,configurationOpts),newrelic.init({client_id:env.getClientId(),os:os.name?os.name+" "+os.version:os,sdk_version:"Web "+appVersion,appid:"DTSS-DISNEYID-UI",direct_flow_version:"Web "+appVersion}),utils.get(configurationOpts,"modules.patchBay")&&configurationOpts.modules.patchBay.init(env),utils.get(configurationOpts,"modules.trustStateWeb")&&(trustStateWeb=configurationOpts.modules.trustStateWeb.init()),messages.subscribe("session.loggedin",function(notUsed,dfd){session.getGuest().then(function(data){swid.write(data.token.swid,!0),guestUpdated.setGuest(data),self.emit("login",data),messages.publish("readyToClose"),dfd&&dfd.resolve()})}),messages.subscribe("apiEvent.ppu",function(data,dfd){messages.publish("bridge.ppuSuccess"),dfd.resolve()}),messages.subscribe("apiEvent.reauth",function(notUsed,dfd){session.getGuest().then(function(data){guestUpdated.setGuest(data),self.emit("reauth",data),dfd.resolve()})}),messages.subscribe("session.reestablished",function(){session.getGuest(!1,{context:"init"}).then(function(data){swid.write(data.token.swid,!0),guestUpdated.setGuest(data)})}),messages.subscribe("token.refreshed",function(data){logger.info("token refreshed"),self.emit("refresh",data.token)}),messages.subscribe("lightbox.hide",function(){self.emit("close")}),messages.subscribe("guest.updated",function(guestDelta){self.emit("update",guestDelta)}),messages.subscribe("profile.create",function(guest){self.emit("create",guest)}),messages.subscribe("profile.deactivation-complete",function(){self.emit("logout")}),messages.subscribe("session.deleted",function(logoutType){guestUpdated.setGuest();var registeredSwid=utils.getCookie("SWID");sendLogs({action_name:"event:logout."+logoutType,process_time:Date.now()-timestamps["logout.start"]||1,anon:!1,success:!0,swid:registeredSwid}),swid.anonymize(),"accountDeactivated"!==logoutType&&self.emit("logout"),env.setCorrelationId(utils.uuid())}),messages.subscribe("profile.primary-account",function(guest){self.emit("primary-account",guest)}),messages.subscribe("marketing.opt-in",function(marketing){self.emit("opt-in",marketing)}),messages.subscribe("guest.trustStateChanged",function(state){state===trustStateConst.STATES.low&&self.emit("low-trust")}),messages.subscribe("metrics.actions.start",function(data){timestamps[data.action]=data.ts}),state.initialized=!1,opts.initialize&&self.init()},eventEmitter.emittable(DisneyID),DisneyID.prototype.init=function(){var sessionAdapter,called=Date.now(),deferred=Q.defer();if(state.initialized)deferred.reject(ERRORS.ALREADY_INITIALIZED),instance.emit("error",ERRORS.ALREADY_INITIALIZED),sendLogs({action_name:"event:init",process_time:Date.now()-called,success:!0,error_codes:ERRORS.ALREADY_INITIALIZED});else{utils.get(configurationOpts,"modules")&&(configurationOpts.modules.ui.init(env),sessionAdapter=configurationOpts.modules.NativeClientSessionAdapter?new configurationOpts.modules.NativeClientSessionAdapter:"https"===env.getProtocol()?new configurationOpts.modules.SecureClientSessionAdapter:new configurationOpts.modules.InsecureClientSessionAdapter),session.init(env,sessionAdapter),trustState.init();var getTokenResolved=function(token){session.getGuest(!1,{context:"init"}).then(function(guestData){deferred.resolve({loggedIn:!0,guest:guestData}),instance.emit("init",{loggedIn:!0,guest:guestData}),sendLogs({action_name:"event:init",process_time:Date.now()-called,success:!0})},function(err){function finish(){deferred.resolve({loggedIn:!0,guest:null}),instance.emit("init",{loggedIn:!0,guest:null}),sendLogs({action_name:"event:init",process_time:Date.now()-called,success:!0,error_codes:"Logged in as unknown"})}utils.containsErrorCode(err,"AUTHORIZATION_INVALID_OR_EXPIRED_TOKEN")?(logger.debug("attempt to retrieve guest was made but access token was invalid or expired"),recoverSession({context:"init"}).then(function(err){logger.debug("token refreh success; finishing initialization"),finish()},function(response){utils.containsErrorCode(response.error,"AUTHORIZATION_INVALID_REFRESH_TOKEN")&&setTimeout(function(err){logger.error("access token invalid and token refresh failed - logging guest out"),messages.publish("session.delete","init")},1e3),finish()})):finish()})},getTokenRejected=function(){swid.anonymize({dontAnonymizeRealSwid:!0}),deferred.resolve({loggedIn:!1,guest:null}),instance.emit("init",{loggedIn:!1,guest:null}),sendLogs({action_name:"event:init",process_time:Date.now()-called,success:!0})};configurationOpts.isDirectFlow?deferred.resolve():session.getToken().then(getTokenResolved,getTokenRejected)["finally"](function(){logger.info("OneID Initialized")}),state.initialized=!0}return deferred.promise},DisneyID.prototype.setLanguage=function(locale){var deferred=Q.defer();return languages.isValid(locale)?(state.locale=locale,console.info(ERRORS.NOT_IMPLEMENTED)):(deferred.reject(ERRORS.UNSUPPORTED_LOCALE),instance.emit("error",ERRORS.UNSUPPORTED_LOCALE)),deferred.promise},DisneyID.prototype.getConfig=function(){return utils.clone(initialConfig)},DisneyID.prototype.getEditableProfileFields=function(opts){var called=(opts||{}).conversationIdTimeStamp||Date.now(),deferred=Q.defer();return state.initialized?session.isLoggedIn().then(function(isLoggedIn){isLoggedIn?progressiveProfileCollection.get().then(function(editableProfileFields){deferred.resolve(editableProfileFields)},function(){deferred.reject(ERRORS.UNKNOWN_ERROR),instance.emit("error",ERRORS.UNKNOWN_ERROR),sendLogs({action_name:"api:getEditableProfileFields",process_time:Date.now()-called,success:!0,error_codes:ERRORS.UNKNOWN_ERROR})}):(deferred.reject(ERRORS.SESSION_NOT_ESTABLISHED),instance.emit("error",ERRORS.SESSION_NOT_ESTABLISHED),sendLogs({action_name:"api:getEditableProfileFields",process_time:Date.now()-called,success:!0,error_codes:ERRORS.SESSION_NOT_ESTABLISHED}))}):(deferred.reject(ERRORS.NOT_INITIALIZED),instance.emit("error",ERRORS.NOT_INITIALIZED),sendLogs({action_name:"api:getEditableProfileFields",process_time:Date.now()-called,success:!0,error_codes:ERRORS.NOT_INITIALIZED})),deferred.promise},DisneyID.prototype.setEditableProfileFields=function(data,opts){var called=(opts||{}).conversationIdTimeStamp||Date.now(),deferred=Q.defer();return opts={conversation:getRouteOptions({conversationId:utils.get(opts,"conversationId"),correlationId:utils.get(opts,"correlationId"),conversationIdTimeStamp:utils.get(opts,"conversationIdTimeStamp"),correlationIdTimeStamp:utils.get(opts,"correlationIdTimeStamp")})},state.initialized?session.isLoggedIn().then(function(isLoggedIn){isLoggedIn?runWorkflow("ppc-api",null,{guestData:data,conversation:opts.conversation},!0).then(function(data){if(data.isUnresolvableError){var errorCode=utils.get(data,"output.failures[0].code",!0);deferred.reject(errorCode),instance.emit("error",errorCode),sendLogs({action_name:"api:setEditableProfileFields",process_time:Date.now()-called,success:!0,error_codes:ERRORS.UNKNOWN_ERROR})}else deferred.resolve(data.output),sendLogs({action_name:"api:setEditableProfileFields",process_time:Date.now()-called,success:!0})}):(deferred.reject(ERRORS.SESSION_NOT_ESTABLISHED),instance.emit("error",ERRORS.SESSION_NOT_ESTABLISHED),sendLogs({action_name:"api:setEditableProfileFields",process_time:Date.now()-called,success:!0,error_codes:ERRORS.SESSION_NOT_ESTABLISHED}))}):(deferred.reject(ERRORS.NOT_INITIALIZED),instance.emit("error",ERRORS.NOT_INITIALIZED),sendLogs({action_name:"api:setEditableProfileFields",process_time:Date.now()-called,success:!0,error_codes:ERRORS.NOT_INITIALIZED})),deferred.promise},DisneyID.prototype.launchLogin=function(opts){opts=opts||{};var called=opts.conversationIdTimeStamp||Date.now(),deferred=Q.defer();return messages.publish("lightbox.requestShowErrorOnFatal"),state.initialized?session.isLoggedIn().then(function(isLoggedIn){if(isLoggedIn)deferred.reject(ERRORS.SESSION_ESTABLISHED),instance.emit("error",ERRORS.SESSION_ESTABLISHED),sendLogs({action_name:"api:launchLogin",process_time:Date.now()-called,success:!0,error_codes:ERRORS.SESSION_ESTABLISHED});else{var conversation=getRouteOptions({conversationId:opts.conversationId,correlationId:opts.correlationId}),routePromise=runWorkflow("login","analytics-pageview",{conversation:conversation,optionalConfigs:opts.optionalConfigs});messages.publish("lightbox.show","login",deferred),Q.all([routePromise,deferred.promise]).then(function(){sendLogs({action_name:"api:launchLogin",process_time:Date.now()-called,success:!0})},function(reason){sendLogs({action_name:"api:launchLogin",process_time:Date.now()-called,success:!1,error_codes:reason||"UNKNOWN_ERROR"})})}}):(deferred.reject(ERRORS.NOT_INITIALIZED),instance.emit("error",ERRORS.NOT_INITIALIZED),sendLogs({action_name:"api:launchLogin",process_time:Date.now()-called,success:!0,error_codes:ERRORS.NOT_INITIALIZED})),deferred.promise},DisneyID.prototype.logout=function(){timestamps["logout.start"]=Date.now();var deferred=Q.defer(),deleteDfd=Q.defer();return session.isLoggedIn().then(function(isLoggedIn){var swid=utils.getCookie("SWID");messages.publish("session.delete","api",deleteDfd),deleteDfd.promise.then(function(){isLoggedIn?(deferred.resolve(),sendLogs({action_name:"api:logout",process_time:Date.now()-timestamps["logout.start"],anon:!1,success:!0,swid:swid})):(deferred.reject(ERRORS.SESSION_NOT_ESTABLISHED),instance.emit("error",ERRORS.SESSION_NOT_ESTABLISHED),sendLogs({action_name:"api:logout",process_time:Date.now()-timestamps["logout.start"],anon:!1,success:!0,error_codes:ERRORS.SESSION_NOT_ESTABLISHED,swid:swid}))})}),deferred.promise},DisneyID.prototype.launchRegistration=function(opts){{var called=(opts||{}).conversationIdTimeStamp||Date.now(),deferred=Q.defer();Q.defer(),Q.defer()}return messages.publish("lightbox.requestShowErrorOnFatal"),opts={optionalConfigs:getOptionalConfigs(opts),conversation:getRouteOptions({conversationId:utils.get(opts,"conversationId"),conversationIdTimeStamp:utils.get(opts,"conversationIdTimeStamp"),correlationId:utils.get(opts,"correlationId"),correlationIdTimeStamp:utils.get(opts,"correlationIdTimeStamp")})},utils.get(opts,"optionalConfigs.providedProfile.region")&&(opts.optionalConfigs.providedProfile.region=opts.optionalConfigs.providedProfile.region.toUpperCase()),state.initialized?session.isLoggedIn().then(function(isLoggedIn){if(isLoggedIn)deferred.reject(ERRORS.SESSION_ESTABLISHED),instance.emit("error",ERRORS.SESSION_ESTABLISHED),sendLogs({action_name:"api:launchRegistration",process_time:Date.now()-called,success:!0,error_codes:ERRORS.SESSION_ESTABLISHED});else{var routePromise=runWorkflow("register",void 0,opts);routePromise.then(function(){deferred.resolve(),sendLogs({action_name:"api:launchRegistration",process_time:Date.now()-called,success:!0})},function(reason){deferred.reject(),sendLogs({action_name:"api:launchRegistration",process_time:Date.now()-called,success:!1,error_codes:reason||"UNKNOWN_ERROR"})})}}):(deferred.reject(ERRORS.NOT_INITIALIZED),instance.emit("error",ERRORS.NOT_INITIALIZED),sendLogs({action_name:"api:launchRegistration",process_time:Date.now()-called,success:!0,error_codes:ERRORS.NOT_INITIALIZED})),deferred.promise},DisneyID.prototype.launchSocialRegistration=function(opts){{var called=(opts||{}).conversationIdTimeStamp||Date.now(),deferred=Q.defer();Q.defer(),Q.defer()}return messages.publish("lightbox.requestShowErrorOnFatal"),opts={optionalConfigs:getOptionalConfigs(opts),conversation:getRouteOptions({conversationId:utils.get(opts,"conversationId"),conversationIdTimeStamp:utils.get(opts,"conversationIdTimeStamp"),correlationId:utils.get(opts,"correlationId"),correlationIdTimeStamp:utils.get(opts,"correlationIdTimeStamp")})},utils.get(opts,"optionalConfigs.providedProfile.region")&&(opts.optionalConfigs.providedProfile.region=opts.optionalConfigs.providedProfile.region.toUpperCase()),state.initialized?session.isLoggedIn().then(function(isLoggedIn){if(isLoggedIn)deferred.reject(ERRORS.SESSION_ESTABLISHED),instance.emit("error",ERRORS.SESSION_ESTABLISHED),sendLogs({action_name:"api:launchSocialRegistration",process_time:Date.now()-called,success:!0,error_codes:ERRORS.SESSION_ESTABLISHED});else{var routePromise=runWorkflow("register-social",void 0,opts);routePromise.then(function(){deferred.resolve(),sendLogs({action_name:"api:launchSocialRegistration",process_time:Date.now()-called,success:!0})},function(reason){deferred.reject(reason),sendLogs({action_name:"api:launchSocialRegistration",process_time:Date.now()-called,success:!1,error_codes:reason||"UNKNOWN_ERROR"})})}}):(deferred.reject(ERRORS.NOT_INITIALIZED),instance.emit("error",ERRORS.NOT_INITIALIZED),sendLogs({action_name:"api:launchSocialRegistration",process_time:Date.now()-called,success:!0,error_codes:ERRORS.NOT_INITIALIZED})),deferred.promise},DisneyID.prototype.launchProfile=function(opts){opts=opts||{};var called=opts.conversationIdTimeStamp||Date.now(),deferred=Q.defer();return messages.publish("lightbox.requestShowErrorOnFatal"),state.initialized?session.isLoggedIn().then(function(isLoggedIn){if(isLoggedIn){var conversation=getRouteOptions({conversationId:opts.conversationId,correlationId:opts.correlationId}),routePromise=runWorkflow("updateProfile",void 0,{conversation:conversation});routePromise.then(function(){deferred.resolve(),sendLogs({action_name:"api:launchProfile",process_time:Date.now()-called,success:!0})},function(reason){deferred.reject(reason),sendLogs({action_name:"api:launchProfile",process_time:Date.now()-called,success:!1,error_codes:reason||"UNKNOWN_ERROR"})})}else deferred.reject(ERRORS.SESSION_NOT_ESTABLISHED),instance.emit("error",ERRORS.SESSION_NOT_ESTABLISHED),sendLogs({action_name:"api:launchProfile",process_time:Date.now()-called,success:!0,error_codes:ERRORS.SESSION_NOT_ESTABLISHED})}):(deferred.reject(ERRORS.NOT_INITIALIZED),instance.emit("error",ERRORS.NOT_INITIALIZED),sendLogs({action_name:"api:launchProfile",process_time:Date.now()-called,success:!0,error_codes:ERRORS.NOT_INITIALIZED})),deferred.promise},DisneyID.prototype.launchNetworkConnect=function(opts){var called=(opts||{}).conversationIdTimeStamp||Date.now(),deferred=Q.defer();return messages.publish("lightbox.requestShowErrorOnFatal"),state.initialized?session.isLoggedIn().then(function(isLoggedIn){if(isLoggedIn)if(void 0===(opts||{}).networkConnectCallbackURI)deferred.reject(ERRORS.NO_CALLBACK),instance.emit("error",ERRORS.NO_CALLBACK),sendLogs({action_name:"api:launchNetworkConnect",process_time:Date.now()-called,success:!0,error_codes:ERRORS.NO_CALLBACK});else if(0!==(opts||{}).networkConnectCallbackURI.indexOf(window.location.protocol+"//"+window.location.hostname))deferred.reject(ERRORS.CALLBACK_MISMATCH),instance.emit("error",ERRORS.CALLBACK_MISMATCH),sendLogs({action_name:"api:launchNetworkConnect",process_time:Date.now()-called,success:!0,error_codes:ERRORS.CALLBACK_MISMATCH});else{var routeDeferred=Q.defer();setRoute("network-connect",opts,routeDeferred),routeDeferred.promise.then(function(){messages.publish("lightbox.show","network-connect",deferred)}),Q.all([routeDeferred.promise,deferred.promise]).then(function(){sendLogs({action_name:"api:launchNetworkConnect",process_time:Date.now()-called,success:!0})},function(reason){sendLogs({action_name:"api:launchNetworkConnect",process_time:Date.now()-called,success:!1,error_codes:reason||"UNKNOWN_ERROR"})})}else deferred.reject(ERRORS.SESSION_NOT_ESTABLISHED),instance.emit("error",ERRORS.SESSION_NOT_ESTABLISHED),sendLogs({action_name:"api:launchNetworkConnect",process_time:Date.now()-called,success:!0,error_codes:ERRORS.SESSION_NOT_ESTABLISHED})}):(deferred.reject(ERRORS.NOT_INITIALIZED),instance.emit("error",ERRORS.NOT_INITIALIZED),sendLogs({action_name:"api:launchNetworkConnect",process_time:Date.now()-called,success:!0,error_codes:ERRORS.NOT_INITIALIZED})),deferred.promise},DisneyID.prototype.launchResetPassword=function(opts){opts=opts||{};var called=(opts||{}).conversationIdTimeStamp||Date.now(),deferred=Q.defer();return messages.publish("lightbox.requestShowErrorOnFatal"),state.initialized?session.isLoggedIn().then(function(isLoggedIn){if(isLoggedIn)deferred.reject(ERRORS.SESSION_ESTABLISHED),instance.emit("error",ERRORS.SESSION_ESTABLISHED),sendLogs({action_name:"api:launchResetPassword",process_time:Date.now()-called,success:!0,error_codes:ERRORS.SESSION_ESTABLISHED});else{var conversation=getRouteOptions({conversationId:opts.conversationId,correlationId:opts.correlationId});runWorkflow("recover-password",null,{conversation:conversation,fromAPI:!0}).then(function(){deferred.resolve(),sendLogs({action_name:"api:launchResetPassword",process_time:Date.now()-called,success:!0})}).fail(function(reason){deferred.reject(reason),instance.emit("error",reason),sendLogs({action_name:"api:launchResetPassword",process_time:Date.now()-called,success:!1,error_codes:reason||"UNKNOWN_ERROR"})})}}):(deferred.reject(ERRORS.NOT_INITIALIZED),instance.emit("error",ERRORS.NOT_INITIALIZED),sendLogs({action_name:"api:launchResetPassword",process_time:Date.now()-called,success:!0,error_codes:ERRORS.NOT_INITIALIZED})),deferred.promise},DisneyID.prototype.launchRecoverUsername=function(opts){opts=opts||{};var called=(opts||{}).conversationIdTimeStamp||Date.now(),deferred=Q.defer();return messages.publish("lightbox.requestShowErrorOnFatal"),state.initialized?session.isLoggedIn().then(function(isLoggedIn){if(isLoggedIn)deferred.reject(ERRORS.SESSION_ESTABLISHED),instance.emit("error",ERRORS.SESSION_ESTABLISHED),sendLogs({action_name:"api:launchRecoverUsername",process_time:Date.now()-called,success:!0,error_codes:ERRORS.SESSION_ESTABLISHED});else{var conversation=getRouteOptions({conversationId:opts.conversationId,correlationId:opts.correlationId});runWorkflow("recover-username",null,{conversation:conversation,fromAPI:!0}).then(function(){deferred.resolve(),sendLogs({action_name:"api:launchRecoverUsername",process_time:Date.now()-called,success:!0})}).fail(function(reason){deferred.reject(reason),instance.emit("error",reason),sendLogs({action_name:"api:launchRecoverUsername",process_time:Date.now()-called,success:!1,error_codes:reason||"UNKNOWN_ERROR"})})}}):(deferred.reject(ERRORS.NOT_INITIALIZED),instance.emit("error",ERRORS.NOT_INITIALIZED),sendLogs({action_name:"api:launchRecoverUsername",process_time:Date.now()-called,success:!0,error_codes:ERRORS.NOT_INITIALIZED})),deferred.promise},DisneyID.prototype.launchReauth=function(opts){opts=opts||{};var called=opts.conversationIdTimeStamp||Date.now(),deferred=Q.defer();if(messages.publish("lightbox.requestShowErrorOnFatal"),!state.initialized)return deferred.reject(ERRORS.NOT_INITIALIZED),instance.emit("error",ERRORS.NOT_INITIALIZED),sendLogs({action_name:"api:launchReauth",process_time:Date.now()-called,success:!0,error_codes:ERRORS.NOT_INITIALIZED}),deferred.promise;var conversation=getRouteOptions({conversationId:utils.get(opts,"conversationId"),correlationId:utils.get(opts,"correlationId"),conversationIdTimeStamp:utils.get(opts,"conversationIdTimeStamp"),correlationIdTimeStamp:utils.get(opts,"correlationIdTimeStamp")});return session.isLoggedIn().then(function(isLoggedIn){if(isLoggedIn){var params={conversation:conversation,isStandalone:!0},reauthUnsubscribe=messages.subscribe("session.reauth",function(){reauthUnsubscribe(),session.getGuest().then(deferred.resolve.bind(deferred))});runWorkflow("reauth",null,params).then(function(){sendLogs({action_name:"api:launchReauth",process_time:Date.now()-called,success:!0})},function(reason){deferred.reject(reason),sendLogs({action_name:"api:launchReauth",process_time:Date.now()-called,success:!1,error_codes:reason||"UNKNOWN_ERROR"})})}else deferred.reject(ERRORS.SESSION_NOT_ESTABLISHED),instance.emit("error",ERRORS.SESSION_NOT_ESTABLISHED),sendLogs({action_name:"api:launchReauth",process_time:Date.now()-called,success:!0,error_codes:ERRORS.SESSION_NOT_ESTABLISHED})}),deferred.promise},DisneyID.prototype.getGuest=function(fullPayload){var deferred=Q.defer(),called=Date.now(),metrics_data={action_name:"api:getGuest",info:{session:session.getState()}};return"undefined"!=typeof fullPayload&&fullPayload&&(metrics_data.action_name+=":force"),session.getGuest(fullPayload,{context:"getGuest"}).then(function(guest){metrics_data.process_time=Date.now()-called,metrics_data.success=!0,sendLogs(metrics_data),deferred.resolve(guest)},function(err){var errorBlock=err?utils.getErrorCodesAndCategory(err):{};metrics_data.process_time=Date.now()-called,metrics_data.success=!1,metrics_data.error_codes=errorBlock.codes||newrelic.codes.SESSION_NOT_ESTABLISHED.code,metrics_data.error_category=errorBlock.category||newrelic.codes.SESSION_NOT_ESTABLISHED.category,sendLogs(metrics_data),utils.containsErrorCode(err,"AUTHORIZATION_INVALID_OR_EXPIRED_TOKEN")?recoverSession({context:"getGuest"}).then(function(){deferred.reject()},function(response){utils.containsErrorCode(response.error,"AUTHORIZATION_INVALID_REFRESH_TOKEN")&&setTimeout(function(){messages.publish("session.delete","getGuest")},1e3)}):deferred.reject(err)}),deferred.promise},DisneyID.prototype.getLoggedInStatus=function(){var deferred=Q.defer(),called=Date.now(),metrics_data={action_name:"api:getLoggedInStatus"};return session.isLoggedIn().then(function(){deferred.resolve.apply(deferred,arguments),sendLogs(utils.assign(metrics_data,{process_time:Date.now()-called,success:!0}))}),deferred.promise},DisneyID.prototype.doNotDisturb=function(flag){var deferred=Q.defer(),called=Date.now(),metrics_data={action_name:"api:doNotDisturb"};return void 0===flag?(deferred.reject(ERRORS.INVALID_ARGUMENT),instance.emit("error",ERRORS.INVALID_ARGUMENT),sendLogs(utils.assign(metrics_data,{process_time:Date.now()-called,success:!0,error_codes:ERRORS.INVALID_ARGUMENT}))):session.isLoggedIn().then(function(isLoggedIn){isLoggedIn?(doNotDisturb.setState(flag),flag||checkCagoots(),sendLogs(utils.assign(metrics_data,{process_time:Date.now()-called,success:!0}))):(deferred.reject(ERRORS.SESSION_NOT_ESTABLISHED),instance.emit("error",ERRORS.SESSION_NOT_ESTABLISHED),sendLogs(utils.assign(metrics_data,{process_time:Date.now()-called,success:!0,error_codes:ERRORS.SESSION_NOT_ESTABLISHED})))}),deferred.promise},DisneyID.prototype.forceTokenRefresh=function(){var called=Date.now(),deferred=Q.defer();return session.isLoggedIn().then(function(isLoggedIn){isLoggedIn?session.getToken().then(function(guestCache){messages.publish("guest.tokenrefresh",guestCache.token,deferred)},deferred.reject.bind(deferred)):(deferred.reject(ERRORS.SESSION_NOT_ESTABLISHED),instance.emit("error",ERRORS.SESSION_NOT_ESTABLISHED),sendLogs({action_name:"api:forceTokenRefresh",process_time:Date.now()-called,success:!0,error_codes:ERRORS.SESSION_NOT_ESTABLISHED}))}),deferred.promise.then(function(){sendLogs({action_name:"api:forceTokenRefresh",process_time:Date.now()-called,success:!0})},function(response){var category=utils.get(response,"error.keyCategory")||"",isSuccessful=-1===["UNKNOWN_ERROR","SYSTEM_UNAVAILABLE"].indexOf(category),errorCodes=[];(utils.get(response,"error.errors")||[]).forEach(function(error){-1===errorCodes.indexOf(error.code)&&errorCodes.push(error.code)}),sendLogs({action_name:"api:forceTokenRefresh",process_time:Date.now()-called,success:isSuccessful,error_category:category,error_codes:errorCodes.join(",")})}),deferred.promise},DisneyID.prototype.launchDisplayName=function(opts){opts=opts||{};var called=opts.conversationIdTimeStamp||Date.now(),deferred=Q.defer();return messages.publish("lightbox.requestShowErrorOnFatal"),state.initialized?session.isLoggedIn().then(function(isLoggedIn){isLoggedIn?config.getSite().then(function(siteConfig){if(!(siteConfig.displayName||{}).enabled)return deferred.reject(ERRORS.NOT_ENABLED),instance.emit("error",ERRORS.NOT_ENABLED),void sendLogs({action_name:"api:launchDisplayName",process_time:Date.now()-called,success:!0,error_codes:ERRORS.NOT_ENABLED});var conversation=getRouteOptions({conversationId:opts.conversationId,correlationId:opts.correlationId,conversationIdTimeStamp:opts.conversationIdTimeStamp,correlationIdTimeStamp:opts.correlationIdTimeStamp}),routePromise=runWorkflow("updateDisplayName","prompt-reauth-if-low-trust",{conversation:conversation});messages.publish("lightbox.show","updateDisplayName",deferred),routePromise.then(function(){deferred.resolve(),sendLogs({action_name:"api:launchDisplayName",process_time:Date.now()-called,success:!0})},function(reason){deferred.resolve(reason),sendLogs({action_name:"api:launchDisplayName",process_time:Date.now()-called,success:!1,error_codes:reason||"UNKNOWN_ERROR"})})}):(deferred.reject(ERRORS.SESSION_NOT_ESTABLISHED),instance.emit("error",ERRORS.SESSION_NOT_ESTABLISHED),sendLogs({action_name:"api:launchDisplayName",process_time:Date.now()-called,success:!0,error_codes:ERRORS.SESSION_NOT_ESTABLISHED}))}):(deferred.reject(ERRORS.NOT_INITIALIZED),instance.emit("error",ERRORS.NOT_INITIALIZED),sendLogs({action_name:"api:launchDisplayName",process_time:Date.now()-called,success:!0,error_codes:ERRORS.NOT_INITIALIZED})),deferred.promise},DisneyID.prototype.launchNewsletters=function(promotionId,opts){opts=opts||{};var called=opts.conversationIdTimeStamp||Date.now(),deferred=Q.defer();if(messages.publish("lightbox.requestShowErrorOnFatal"),state.initialized)if(promotionId){var conversation=getRouteOptions({conversationId:opts.conversationId,correlationId:opts.correlationId,
conversationIdTimeStamp:opts.conversationIdTimeStamp,correlationIdTimeStamp:opts.correlationIdTimeStamp});runWorkflow("marketingOptIn","get-logged-in-status",{promotionId:promotionId,sourceName:opts&&opts.sourceName||null,conversation:conversation,pageName:"create-nrt"}).then(function(){deferred.resolve(),sendLogs({action_name:"api:launchNewsletters",process_time:Date.now()-called,success:!0})},function(reason){deferred.reject(reason),sendLogs({action_name:"api:launchNewsletters",process_time:Date.now()-called,success:!1,error_codes:reason||"UNKNOWN_ERROR"})})}else deferred.reject(ERRORS.INVALID_ARGUMENT),sendLogs({action_name:"api:launchNewsletters",process_time:Date.now()-called,success:!0,error_codes:ERRORS.INVALID_ARGUMENT});else deferred.reject(ERRORS.NOT_INITIALIZED),instance.emit("error",ERRORS.NOT_INITIALIZED),sendLogs({action_name:"api:launchNewsletters",process_time:Date.now()-called,success:!0,error_codes:ERRORS.NOT_INITIALIZED});return deferred.promise},DisneyID.prototype.getGuestNewsletters=function(){var deferred=Q.defer(),called=Date.now(),metrics_data={action_name:"api:getGuestNewsletters"};return session.isLoggedIn().then(function(isLoggedIn){isLoggedIn?session.getGuest().then(function(guestCache){deferred.resolve(guestCache.marketing),sendLogs(utils.assign(metrics_data,{process_time:Date.now()-called,success:!0}))}):(deferred.reject(ERRORS.SESSION_NOT_ESTABLISHED),instance.emit("error",ERRORS.SESSION_NOT_ESTABLISHED),sendLogs(utils.assign(metrics_data,{process_time:Date.now()-called,success:!0,error_codes:ERRORS.SESSION_NOT_ESTABLISHED})))}),deferred.promise},DisneyID.prototype.launchRequestActivity=function(activityCode,options){var deferred=Q.defer(),called=(options||{}).conversationIdTimeStamp||Date.now(),metrics_data={action_name:"api:launchRequestActivity"};return messages.publish("lightbox.requestShowErrorOnFatal"),state.initialized?session.isLoggedIn().then(function(isLoggedIn){if(isLoggedIn){{runWorkflow("request-activity",null,{activityCode:activityCode,opts:getRouteOptions(options)})}messages.publish("lightbox.show","activities",deferred),sendLogs(utils.assign(metrics_data,{process_time:Date.now()-called,success:!0}))}else deferred.reject(ERRORS.SESSION_NOT_ESTABLISHED),instance.emit("error",ERRORS.SESSION_NOT_ESTABLISHED),sendLogs(utils.assign(metrics_data,{process_time:Date.now()-called,success:!0,error_codes:ERRORS.SESSION_NOT_ESTABLISHED}))}):(deferred.reject(ERRORS.NOT_INITIALIZED),instance.emit("error",ERRORS.NOT_INITIALIZED),sendLogs(utils.assign(metrics_data,{process_time:Date.now()-called,success:!0,error_codes:ERRORS.NOT_INITIALIZED}))),deferred.promise},DisneyID.prototype.getActivityStatus=function(activity){var deferred=Q.defer(),called=Date.now(),metrics_data={action_name:"api:getActivityStatus"};return session.isLoggedIn().then(function(isLoggedIn){isLoggedIn?runWorkflow("check-activity",null,{activityCode:activity},!0).then(function(data){data.error_code?deferred.reject(data.error_code):(deferred.resolve(data.approvalStatus),sendLogs(utils.assign(metrics_data,{process_time:Date.now()-called,success:!0})))},function(err){deferred.reject(err);var errorBlock=err?utils.getErrorCodesAndCategory(err):{};sendLogs(utils.assign(metrics_data,{process_time:Date.now()-called,success:!1,error_codes:errorBlock.codes||newrelic.codes.UNKNOWN.code,error_category:errorBlock.category||newrelic.codes.UNKNOWN.category}))}):(deferred.reject(ERRORS.SESSION_NOT_ESTABLISHED),instance.emit("error",ERRORS.SESSION_NOT_ESTABLISHED),sendLogs(utils.assign(metrics_data,{process_time:Date.now()-called,success:!0,error_codes:ERRORS.SESSION_NOT_ESTABLISHED})))}),deferred.promise},DisneyID.prototype.getTrustStateStatus=function(){var deferred=Q.defer(),called=Date.now(),metrics_data={action_name:"api:getTrustStateStatus"};return session.isLoggedIn().then(function(isLoggedIn){isLoggedIn?trustState.get().then(function(data){deferred.resolve(data.state),sendLogs(utils.assign(metrics_data,{process_time:Date.now()-called}))}):(deferred.reject(ERRORS.SESSION_NOT_ESTABLISHED),instance.emit("error",ERRORS.SESSION_NOT_ESTABLISHED),sendLogs(utils.assign(metrics_data,{process_time:Date.now()-called,success:!0,error_codes:ERRORS.SESSION_NOT_ESTABLISHED})))}),deferred.promise},DisneyID.prototype.setDebug=function(opts,type){if(opts===!1)messages.publish("debug.clear");else{var geoIP=utils.get(opts,"geoIP");geoIP&&messages.publish("debug.geoIP",geoIP);var country=utils.get(opts,"country");country&&messages.publish("debug.country",country)}"CLIENT_CONFIG"!==type||/-PROD$/.test(env.getClientId())||overrideClientConfig(opts)},DisneyID.prototype.setLogLevel=function(level,preserve){logger.setLogLevel(level),messages.publish("setLogLevel",{level:level}),preserve&&"OFF"!==level.toUpperCase()?utils.setCookie("oid_loglevel",level,null,"/"):preserve&&"OFF"!==level.toUpperCase()||utils.deleteCookie("oid_loglevel",null,"/")},function(){var fatalStateDeferred=Q.defer();messages.subscribe("inner.fatal",function(){fatalStateDeferred.resolve()}),messages.subscribe("lightbox.requestShowErrorOnFatal",function(){fatalStateDeferred.promise.then(function(){messages.publish("lightbox.show")})})}()}()},{"../../assets/common/js/q":1,"../components/common/event-emitter":9,"../components/common/trust-state/constants.js":23,"../components/inner/language-preferences/languages":31,"../components/outer/config":37,"../components/outer/environment":38,"../components/outer/new-relic":45,"../components/outer/progressive-profile-collection":47,"../components/outer/session/session":54,"../components/outer/swid":55,"../components/outer/trust-state":57,"../components/outer/ui/do-not-disturb":59,"./guest-updated":63,logger:11,messages:12,utils:29}],63:[function(require,module,exports){!function(){"use strict";function setGuest(overrideGuest){originalGuest=utils.clone(overrideGuest)}function determineChanges(updatedGuest){var deferred=Q.defer();return updatedGuest.then(function(updatedGuest){deferred.resolve(guestDiff(originalGuest||{},updatedGuest))}),deferred.promise}function guestDiff(originalGuest,updatedGuest){var diff={};originalGuest=utils.filterAngularProperties(utils.clone(originalGuest)),updatedGuest=utils.filterAngularProperties(utils.clone(updatedGuest));var base=utils.assign(utils.clone(FIELDS),utils.objectDiff(originalGuest,updatedGuest));Object.keys(FIELDS).forEach(function(name){diff[name]=base[name]});var addresses=addressesDiff(originalGuest,updatedGuest),phones=phonesDiff(originalGuest,updatedGuest),marketing=marketingDiff(originalGuest,updatedGuest,{});return addresses.length?utils.set(diff,"profile.addresses",addresses):Array.isArray(utils.get(diff,"profile.addresses"))&&delete diff.profile.addresses,phones.length?utils.set(diff,"profile.phones",phones):Array.isArray(utils.get(diff,"profile.phones"))&&delete diff.profile.phones,marketing.length&&utils.set(diff,"marketing",marketing),diff}function profileCollectionDiff(collectionPath,guidName){return function(originalGuest,updatedGuest){function getByGuid(collection,guid){return collection.filter(function(item){return item[guidName]===guid})[0]}var originalCollection=utils.get(originalGuest,collectionPath)||[],updatedCollection=utils.get(updatedGuest,collectionPath)||[],differences=[];return updatedCollection.forEach(function(updated){var original=getByGuid(originalCollection,updated[guidName]);if(void 0===original)differences.push(updated);else{var diff=utils.objectDiff(original,updated);Object.keys(diff||{}).length>0&&differences.push(updated)}}),originalCollection.forEach(function(original,index){var updated=getByGuid(updatedCollection,original[guidName]);if(void 0===updated){for(var prop in original)original.hasOwnProperty(prop)&&-1===["type",guidName].indexOf(prop)&&(original[prop]=null);differences.splice(index,0,original)}}),differences}}var originalGuest,Q=require("../../assets/common/js/q"),utils=require("../components/common/utils"),addressesDiff=profileCollectionDiff("profile.addresses","addressGuid"),phonesDiff=profileCollectionDiff("profile.phones","phoneGuid"),marketingDiff=require("guest-utils").marketingDiff,FIELDS={profile:{},displayName:{}};module.exports={setGuest:setGuest,determineChanges:determineChanges,FIELDS:FIELDS}}()},{"../../assets/common/js/q":1,"../components/common/utils":29,"guest-utils":10}],64:[function(require,module,exports){!function(){"use strict";function sendPreInitMetrics(){function scriptUrl(){var scripts=document&&document.querySelectorAll&&document.querySelectorAll("script")||[],s=scripts[scripts.length-1];return s&&s.getAttribute&&s.getAttribute("src")||""}var denominator=2500,luckyNumber=747;if(Math.floor(Math.random()*denominator+1)===luckyNumber)try{newrelic.sendLogs({log_type:"preinit",page_url:window&&window.location&&window.location.href,disneyid_js_url:scriptUrl(),timestamp:new Date,appid:"DTSS-DISNEYID-UI"})}catch(ex){}}require("../components/common/polyfills/console");var api=require("./api"),patchBay=require("../components/outer/patch-bay"),ui=require("../components/outer/ui/web-ui"),SecureClientSessionAdapter=require("../components/outer/session/secure-client-session-adapter"),InsecureClientSessionAdapter=require("../components/outer/session/insecure-client-session-adapter"),S2Cookie=require("../components/outer/s2-cookie"),guestMessageHandlers=require("../components/outer/session/guest/web/message-handlers"),trustStateWeb=require("../components/outer/trust-state/web.js"),newrelic=require("../components/outer/new-relic/"),logger=require("logger"),utils=require("utils");logger.setLogLevel(utils.getCookie("oid_loglevel")||"INFO"),newrelic.attachSubscribers(),api.configure({modules:{patchBay:patchBay,ui:ui,SecureClientSessionAdapter:SecureClientSessionAdapter,InsecureClientSessionAdapter:InsecureClientSessionAdapter,trustStateWeb:trustStateWeb}}),S2Cookie.init(),guestMessageHandlers.init(),window.DisneyID={get:api.get},sendPreInitMetrics()}()},{"../components/common/polyfills/console":14,"../components/outer/new-relic/":45,"../components/outer/patch-bay":46,"../components/outer/s2-cookie":49,"../components/outer/session/guest/web/message-handlers":51,"../components/outer/session/insecure-client-session-adapter":52,"../components/outer/session/secure-client-session-adapter":53,"../components/outer/trust-state/web.js":58,"../components/outer/ui/web-ui":60,"./api":62,logger:11,utils:29}]},{},[64,48,36]);
//# sourceMappingURL=DisneyID.js.map