aRadar("additionalJSLoad",1),aRadar("additionalJSInit"),window.__portal={},function(){function e(e){return document.getElementById(e)}function t(){var e=/\s*(\S+)\s*/g,t="(?=(^|.*\\s)$1(\\s|$))",s=!/\[native\s+code\]/i.test(document.getElementsByClass+""),i=/\./g;return function(n,o,r){var _,a,h,l;if("string"==typeof n&&(r=o,o=n,n=document),r=r||"",!n||null==o)return[];if(o=o.replace(/\s+/gi,"."),"."!=o[0]&&(o="."+o),"querySelectorAll"in n){if(a=n.querySelectorAll(r+o),s){for(h=-1,_=[];l=a[++h];)_.push(l);return _}return a}for(a=n.getElementsByTagName(r||"*"),o&&(o=o.replace(i," "),o=new RegExp(o.replace(e,t))),h=-1,_=[];l=a[++h];)1!==l.nodeType||o&&!o.test(l.className)||_.push(l);return _}}function s(e,t){return function(){return e.apply(t,arguments)}}function i(e,t){e=e||{};for(var s=1,i=arguments.length;i>s;s++){var n=arguments[s];for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o])}return e}function n(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&!Object.prototype.hasOwnProperty.call(e,s)&&(e[s]=t[s]);return e}function o(e){return e&&1==e.nodeType}function r(e,t){var s;s=o(t)?function(e,t){return e==t}:function(e,t){return _(e,t)};for(var i=e.parentNode;i;){if(s(i,t))return i;i=i.parentNode}return!1}function _(e,t){return o(e)&&c?e.classList.contains(t):!!~(" "+e.className+" ").indexOf(" "+t+" ")}function a(e,t){o(e)&&(c?e.classList.add(t):!_(e,t)&&(e.className+=" "+t))}function h(e,t){o(e)&&(c?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\s)"+t+"(\\s|$)","g"),"$1"))}function l(e,t){return o(e)?c?e.classList.toggle(t):_(e,t)?(h(e,t),!1):(a(e,t),!0):void 0}var g=function(e,t){for(var s=0,i=e.length;i>s;s++)if(e[s]==t)return s;return-1},c="classList"in document.documentElement;window.__portal.__fn={byId:e,byClassName:t(),arrayIndexOf:g,bind:s,extend:i,append:n,isNode:o,hasParent:r,hasClass:_,addClass:a,removeClass:h,toggleClass:l}}();var p=__portal,fn=p.__fn;__portal.PortalEvents={};var PortalEvents=p.PortalEvents;void function(e,t){function s(e){if(!("__isFixed"in e)){_||(_=document.body);var t=this,i="button"in e&&e.button;return e.__isFixed=!0,"click"!==e.type&&"dblclick"!==e.type||(void 0===e.detail&&(e.detail="click"===e.type?1:2),e.button||void 0===s._clickButton||(i=s._clickButton)),a(e,m),e.defaultPrevented||(e.defaultPrevented=!1),e.target||(e.target=e.srcElement||document),void 0===e.relatedTarget&&e.fromElement&&(e.relatedTarget=e.fromElement==e.target?e.toElement:e.fromElement),"clientX"in e&&null==e.pageX&&(e.pageX=e.clientX+(r.scrollLeft||_&&_.scrollLeft||0)-(r.clientLeft||0),e.pageY=e.clientY+(r.scrollTop||_&&_.scrollTop||0)-(r.clientTop||0)),!e.which&&i&&(e.which=1&i?1:2&i?3:4&i?2:0),"timeStamp"in e||(e.timeStamp=+new Date),"eventPhase"in e||(e.eventPhase=e.target==t?2:3),"currentTarget"in e||(e.currentTarget=t),"isTrusted"in e||(e.isTrusted=!0),"keyCode"in e||(e.keyCode=e.charCode||e.which),e}}function i(e){if(void 0!==s){var t=this,i=t._,n=[],o=[],r=c;if(i&&i[r]){e||(e=window.event),s.call(this,e);var _=i[r][e.type];if(_){for(var a in _)if(u(_,a)){var h,l=_[a];"object"==typeof l&&(h=l,l=l.handleEvent);try{l&&(e.result=d.call(l,h||t,e))===!1&&(e.preventDefault(),e.stopPropagation())}catch(g){window.logError&&logError(g,"portalEventHandler"),n.push(g),o.push(g.message),window.console&&console.error(g)}if(e.__stopNow)break}if(_[0]=void 0,delete _[0],1==n.length)p(n[0]);else if(n.length>1){var g=new Error("Multiple errors thrown : "+e.type+" :  : "+o.join("|"));g.errors=n,p(g)}}}}}var n,o=window.eval&&window.eval("/*@cc_on 1;@*/")&&+((/msie (\d+)/i.exec(navigator.userAgent)||[])[1]||0)||void 0,r=document.documentElement,_=document.body,a=t.append,h="uuid",l=1,g="_h_9e2",c="_e_8vj",u=Function.prototype.call.bind(Object.prototype.hasOwnProperty),d=Function.prototype.call,p=function(e){throw e instanceof Error?e:new Error(e)},f=!("createEvent"in document),m={preventDefault:function(){this.cancelable!==!1&&(this.returnValue=!1,this.defaultPrevented=!0)},stopPropagation:function(){this.cancelBubble=!0}};m.stopImmediatePropagation=function(){this.__stopNow=!0,this.stopPropagation()},m.defaultPrevented=!1,o&&9>o&&(document.attachEvent("onmousedown",function(){s._clickButton=event.button}),document.attachEvent("onclick",function(){s._clickButton=void 0})),e.addListener=f?function(e,t,s){function r(){try{document.documentElement.doScroll("left")}catch(s){return void setTimeout(r,50)}i.call(e,{type:t,isTrusted:!0})}if("function"==typeof s||"object"==typeof s&&s.handleEvent){var _,a=e._,u=!1,d=c;if(a||(a=e._={}),o&&9>o){if("DOMContentLoaded"==t){if("complete"==document.readyState)return;if(e===global&&(e=document),u=!0,!n&&(n=!0,"createEventObject"in document&&"doScroll"in document.documentElement))try{global.frameElement||r()}catch(p){}}e.setInterval&&e!=global&&!e.frameElement&&(e=global)}s[h]||(s[h]=++l),(_=a[g])||(_=a[g]=i.bind(e)),a[d]||(a[d]={}),a[d][t]||(a[d][t]={},o&&9>o?u||e.attachEvent("on"+t,_):e.addEventListener(t,_,!1)),a[d][t][s[h]]=s}}:function(e,t,s){e.addEventListener(t,s,!1)},e.removeListener=f?function(e,t,s){var i,n,r,_=e._,a=c;if(("function"==typeof s||"object"==typeof s&&s.handleEvent)&&s[h]&&_&&(i=_[g])){n=_[a]&&_[a][t],delete n[s[h]];for(r in n)if(u(n,r))return;o&&9>o?e.detachEvent("on"+t,i):e.removeEventListener(t,i,!1),delete _[a][t];for(r in _[a])if(u(_[a],r))return;delete _[a]}}:function(e,t,s){e.removeEventListener(t,s,!1)}}(__portal.PortalEvents,window.__portal.__fn),void function(){function e(){}e.prototype={emit:function(t,s,i){function n(){--_||i&&i()}void 0==s&&(s={});var o=this.listeners(t);if(!o)return void(i&&i());o=o.slice();for(var r=new e.Event(t,s),_=o.length,a=0,h=_;h>a;a++){var l=o[a];if("function"==typeof l)try{l.call(this,r,n)}catch(g){window.logError&&logError(g,"emit"),window.console&&window.console.error&&window.console.error(g),n()}}},listeners:function(e){return this._events&&this._events[e]&&this._events[e].length&&this._events[e]},addListener:function(e,t){if("function"!=typeof t)throw new Error("invalid argument");return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),this._events[e].push(t),this},once:function(e,t){function s(){this.removeListener(e,s),t.apply(this,arguments)}if("function"!=typeof t)throw new Error("invalid argument");return this.on(e,s),this},removeListener:function(e,t){if("function"!=typeof t)throw new Error("invalid argument");if(!this._events[e])return this;var s=this._events[e],i=fn.arrayIndexOf(s,t);return 0>i?this:(s.splice(i,1),0===s.length&&delete this._events[e],this)}},e.prototype.on=e.prototype.addListener,e.Event=function(e,t){this.type=e,this.data=t},__portal.PortalEventEmitter=e}(),void function(){function e(t){return this instanceof e?(this.__settings=s.extend({},i,t),this.__baseClass="portal-overlay",void(this.__visible=!1)):new e}var t=__portal,s=t.__fn,i={hideByClick:!0};e.prototype=new t.PortalEventEmitter,s.extend(e.prototype,{show:function(){this.__visible||(this.__visible=!0,this.__init(),this.emit("beforeShow"),t.PortalEvents.addListener(document,"keyup",this.____hideByEsc||(this.____hideByEsc=s.bind(this.__hideByEsc,this))),s.addClass(this.__node,this.__baseClass+"_visible"),this.emit("show"))},hide:function(){this.__visible&&(this.__visible=!1,this.__init(),this.emit("beforeHide"),this.____hideByEsc&&t.PortalEvents.removeListener(document,"keyup",this.____hideByEsc),s.removeClass(this.__node,this.__baseClass+"_visible"),this.emit("hide"))},__hideByEsc:function(e){27==e.keyCode&&this.hide()},__init:function(){this.__node||(this.__node=document.createElement("div"),this.__node.className=this.__baseClass,this.__settings.hideByClick&&t.PortalEvents.addListener(this.__node,"click",s.bind(this.hide,this)),document.body.appendChild(this.__node))}}),t.PortalOverlay=e}(),void function(){function e(e){if(!e||!fn.isNode(e.node))throw new Error("Invalid arguments");this.__settings=fn.extend({},t,e),this.__baseClass="portal-popup",this.__wBaseClass="w-"+this.__baseClass,this.__node=this.__settings.node,this.__wNode=fn.hasParent(this.__node,this.__wBaseClass),this.__visible=!1,this.__settings.overlay&&(this.__overlay=new p.PortalOverlay,this.__overlay.on("hide",fn.bind(this.hide,this))),this.__wNode&&PortalEvents.addListener(this.__wNode,"click",fn.bind(this.__wHide,this)),this.__closeButton=fn.byClassName(this.__node,".js-close")[0],this.__closeButton&&PortalEvents.addListener(this.__closeButton,"click",fn.bind(this.__closeButtonHide,this)),this.__controls=fn.byClassName(this.__node,".js-controls")[0],this.__controls&&PortalEvents.addListener(this.__controls,"click",fn.bind(this.__controlsHandler,this))}var t={overlay:!0,node:null};e.prototype=new p.PortalEventEmitter,fn.extend(e.prototype,{__init:function(){this.__inited||(this.__inited=!0)},isVisible:function(){return this.__visible},show:function(){this.__visible||(this.__visible=!0,this.__init(),this.__overlay&&this.__overlay.show(),this.emit("beforeShow"),this.__wNode&&fn.addClass(this.__wNode,this.__wBaseClass+"_visible"),fn.addClass(this.__node,this.__baseClass+"_visible"),window.scrollTo(0,0),this.emit("show"))},hide:function(){this.__visible&&(this.__visible=!1,this.__overlay&&this.__overlay.hide(),this.emit("beforeHide"),this.__wNode&&fn.removeClass(this.__wNode,this.__wBaseClass+"_visible"),fn.removeClass(this.__node,this.__baseClass+"_visible"),this.emit("hide"))},__wHide:function(e){var t=e.target;fn.hasParent(t,this.__node)||this.hide()},__closeButtonHide:function(e){e.preventDefault(),this.hide()},__controlsHandler:function(e){var t,s=e.target,i=fn.hasParent(s,"js-control");!i&&fn.hasClass(s,"js-control")&&(i=s),i&&(t=i.getAttribute("data-action")),t&&(this.emit("action"+t.substr(0,1).toUpperCase()+t.substr(1)),e.preventDefault())}}),p.PortalPopup=e}(),void function(){function e(i){if(!(this instanceof e))return new e;if(t)return t;if(t=this,this.__settings=fn.extend({},s,i),this.__node=fn.byId("portal-region"),this.__form=fn.byClassName(this.__node,"js-region-form")[0],this.__autoCheckbox=fn.byId("regionAutoDetectInput"),this.__autoCheckboxCity=fn.byClassName(this.__node,"js-auto-city")[0],this.__manualCheckbox=fn.byId("regionManualInput"),this.__regionSearchInput=fn.byId("regionSearchInput"),this.__regionSearchInputWrap=fn.byId("regionSearchInputWrap"),this.__regionSearchInputBaseClass="portal-input",this.__regionSearchPlaceholderBaseClass="portal-input__placeholder",this.__regionSearchPlaceholder=fn.byClassName(this.__node,this.__regionSearchPlaceholderBaseClass)[0],this.__regionSuggestsBaseClass="portal-region__suggests",this.__regionSuggests=fn.byClassName(this.__node,this.__regionSuggestsBaseClass)[0],this.__regionSuggestsGroups={current:fn.byClassName(this.__regionSuggests,"js-current-regions")[0],russia:fn.byClassName(this.__regionSuggests,"js-russia-regions")[0],other:fn.byClassName(this.__regionSuggests,"js-other-regions")[0]},this.__regionSuggestsGroupLists={current:fn.byClassName(this.__regionSuggestsGroups.current,"js-region-items")[0],russia:fn.byClassName(this.__regionSuggestsGroups.russia,"js-region-items")[0],other:fn.byClassName(this.__regionSuggestsGroups.other,"js-region-items")[0]},this.__regionSuggestsGroupBaseClass="portal-region__suggests__group",this.__regionSuggestsGroupItemBaseClass="portal-region__suggests__group__item",this.__autoCheckboxCity.innerHTML=this.__settings.cityName||"",PortalEvents.addListener(this.__autoCheckbox,"click",fn.bind(this.__switchToAuto,this)),PortalEvents.addListener(this.__manualCheckbox,"click",fn.bind(function(){"manual"!==this.__currentState&&this.__switchToManual(),this.__regionSearchInput.focus()},this)),PortalEvents.addListener(this.__regionSearchInputWrap,"click",fn.bind(function(){"manual"!==this.__currentState&&(this.__switchToManual(),this.__regionSearchInput.focus(),this.__autoCheckbox.checked=!1,this.__manualCheckbox.checked=!0)},this)),PortalEvents.addListener(this.__regionSearchInput,"click",fn.bind(this.__searchInputKeys,this)),PortalEvents.addListener(this.__regionSearchInput,"keydown",fn.bind(this.__searchInputKeys,this)),PortalEvents.addListener(this.__regionSearchInput,"keyup",fn.bind(this.__searchInputKeys,this)),PortalEvents.addListener(this.__regionSearchInput,"paste",fn.bind(this.__searchInputKeys,this)),PortalEvents.addListener(this.__regionSearchInput,"cut",fn.bind(this.__searchInputKeys,this)),PortalEvents.addListener(this.__regionSearchInput,"input",fn.bind(function(){this.__validate()},this)),PortalEvents.addListener(this.__regionSearchInput,"paste",fn.bind(function(){this.__validate()},this)),PortalEvents.addListener(this.__regionSearchInput,"cut",fn.bind(function(){this.__validate()},this)),PortalEvents.addListener(this.__regionSuggests,"click",fn.bind(this.__searchInputKeys,this)),PortalEvents.addListener(this.__regionSuggests,"keydown",fn.bind(this.__searchInputKeys,this)),PortalEvents.addListener(this.__regionSuggests,"scroll",fn.bind(this.__onScroll,this)),this.__placeholderEmulation=!("placeholder"in document.createElement("input")),this.__placeholderEmulation){var n=this.__regionSearchInput.getAttribute("placeholder");n&&(this.__regionSearchPlaceholder.innerHTML=n),PortalEvents.addListener(this.__regionSearchInput,"keydown",fn.bind(this.__placeHolderKeys,this)),PortalEvents.addListener(this.__regionSearchInput,"keyup",fn.bind(this.__placeHolderKeys,this)),PortalEvents.addListener(this.__regionSearchInput,"paste",fn.bind(this.__togglePlaceholder,this)),PortalEvents.addListener(this.__regionSearchInput,"cut",fn.bind(this.__togglePlaceholder,this)),PortalEvents.addListener(this.__regionSearchInput,"input",fn.bind(this.__togglePlaceholder,this))}else this.__regionSearchPlaceholder.style.display="none";PortalEvents.addListener(fn.byClassName(this.__regionSuggests,"js-message-all")[0],"click",fn.bind(function(){this.__reset(),this.__regionSearchInput.focus()},this)),PortalEvents.addListener(fn.byClassName(this.__regionSuggests,"js-message-reload")[0],"click",fn.bind(this.__reload,this)),this.__popup=new __portal.PortalPopup({node:fn.byId("regional-popup")}),this.__popup.on("actionCancel",fn.bind(function(){this.__actionCancel=!0,mr.counter("clb1221592"),this.__popup.hide()},this)),this.__popup.on("hide",fn.bind(function(){this.__actionCancel||mr.counter("clb1264381"),this.__actionCancel=!1},this)),this.__popup.on("actionSave",fn.bind(function(){mr.counter("clb1221591"),this.__save()},this)),PortalEvents.addListener(this.__form,"submit",fn.bind(function(e){e&&e.preventDefault(),this.__save()},this)),this.on("beforeShow",this.__init),this.on("show",function(){this.__regionSuggestsOffsetHeight=this.__regionSuggests.offsetHeight,this.__regionSuggestsScrollHeight=this.__regionSuggests.scrollHeight}),this.__q="",this.__autocompletedValue="",this.__cacheQ={},this.__cacheNoQ=void 0,this.__regionsCache={}}var t,s={startRegion:null,auto:!0,notification:!1,cityName:"",pageSize:50,inputTimeout:400,lastItemsToLoad:15,preloaderPause:200,region:null,manualRegion:null};e.prototype=new __portal.PortalEventEmitter,fn.extend(e.prototype,{__init:function(){this.__settings.auto?(this.__autoCheckbox.checked=!0,this.__manualCheckbox.checked=!1,this.__switchToAuto(),this.once("show",fn.bind(function(){this.__manualCheckbox.focus()},this))):(this.__autoCheckbox.checked=!1,this.__manualCheckbox.checked=!0,this.__switchToManual(),this.once("show",fn.bind(function(){this.__regionSearchInput.focus()},this))),this.__page=0,this.once("show",fn.bind(function(){this.__regionSuggests.scrollTop=0},this)),this.__selectCity(),this.__loadRegions(0)},__reload:function(){this.__loadRegions(this.__page)},__reset:function(){this.__regionSuggests.scrollTop=0,this.__setQ(""),this.__loadRegions(0)},__save:function(){var e=mr.s_cookie.getGlobal("geo");mr.s_cookie.getGlobal("georb");if((new Image).src="//rs.mail.ru/f?new="+(this.__selectedCity?this.__selectedCity.getAttribute("data-id"):"auto")+"&old="+this.__settings.manualRegion.id+"&ipR="+this.__settings.region.id+"&ipLevel2="+this.__settings.region.level2+"&effLevel2="+this.__settings.manualRegion.level2+"&ipLevel1="+this.__settings.region.level1+"&effLevel1="+this.__settings.manualRegion.level1+"&geod="+mr.s_cookie.getGlobal("geod")+"&georb="+mr.s_cookie.getGlobal("georb")+"&geol1="+mr.s_cookie.getGlobal("geol1")+"&geo="+mr.s_cookie.getGlobal("geo"),this.__autoCheckbox.checked)mr.counter("clb1221593"),mr.s_cookie.removeGlobal("geo"),mr.s_cookie.removeGlobal("georb"),mr.s_cookie.removeGlobal("geol1"),mr.s_cookie.removeGlobal("geod");else{if(!this.__selectedCity)return void this.__setError(!0);this.__selectedCity.parentNode===this.__regionSuggestsGroupLists.current?mr.counter("clb1264632"):mr.counter("clb1221598"),mr.s_cookie.setGlobal("geo",this.__selectedCity.getAttribute("data-id")),mr.s_cookie[this.__settings.region.level2?"setGlobal":"removeGlobal"]("georb",this.__settings.region.level2),mr.s_cookie[this.__settings.region.level1?"setGlobal":"removeGlobal"]("geol1",this.__settings.region.level1),mr.s_cookie.removeGlobal("geod")}this.__popup.hide(),e!==mr.s_cookie.getGlobal("geo")&&setTimeout(function(){var e=window.location.toString();e=e.replace("#region",""),setTimeout(function(){try{window.location.replace(e)}catch(t){}setTimeout(function(){try{window.location.replace(e)}catch(t){}setTimeout(function(){try{window.location.reload()}catch(e){}},10)},10)},10)},50)},__cache:function(e,t,s){var i,n,o=s&&s.regionsCount&&Math.ceil(s.regionsCount/this.__settings.pageSize);return e=this.__getNormalizedQ(e),e?(i=this.__cacheQ[e],!i&&o?i=this.__cacheQ[e]=new Array(o):i||o||!s||(i=this.__cacheQ[e]=!1)):(i=this.__cacheNoQ,!i&&o&&(i=this.__cacheNoQ=new Array(o))),i?o&&t>o-1?null:(n=i[t],s&&(n||(i[t]=n={current:[],russia:[],other:[]}),n.current=s.current,n.russia=s.russia,n.other=s.other,i.regionsCount=s.regionsCount,fn.append(this.__regionsCache,s.regions)),n):i},__inCache:function(e,t){var s=this.__cache(e,t);return s},__pages:function(e){e=this.__getNormalizedQ(e);var t=""==e?this.__cacheNoQ:this.__cacheQ[e];return t?t.length:void 0},__scrollToCity:function(e,t){var s=fn.arrayIndexOf(this.__items,e),i=e.offsetTop,n=e.offsetHeight,o=this.__regionSuggests.scrollTop,r=this.__regionSuggestsOffsetHeight;if(0===s)return void(this.__regionSuggests.scrollTop=0);if(s===this.__items.length-1)return void(this.__regionSuggests.scrollTop=this.__regionSuggestsScrollHeight-r);var _=(t?n:0)+i-o;_>r?this.__regionSuggests.scrollTop=i+n-r:0>=_&&(this.__regionSuggests.scrollTop=i)},__onScroll:function(e){if(this.__items.length){var t=this.__items[0].offsetHeight,s=this.__regionSuggests.scrollTop,i=this.__regionSuggestsScrollHeight,n=this.__regionSuggestsOffsetHeight;s+n>i-t*this.__settings.lastItemsToLoad&&this.__loadRegions(this.__page+1)}},__selectCity:function(e,t){e||(this.__selectedCity=null,fn.removeClass(this.__selectedCity,"portal-region__suggests__group__item_selected")),this.__selectedCity&&fn.removeClass(this.__selectedCity,"portal-region__suggests__group__item_selected"),e&&(this.__selectedCity=e,t||this.__setQ(this.__getQ(),this.__regionsCache[e.getAttribute("data-id")].cityName),fn.addClass(this.__selectedCity,"portal-region__suggests__group__item_selected"))},__searchInputKeys:function(e){if("click"!==e.type||e.target!==this.__regionSuggests&&!fn.hasParent(e.target,this.__regionSuggests)){if("keydown"===e.type)switch(e.keyCode){case 13:if(this.__autoCheckbox.checked)return void e.preventDefault();e.target===this.__regionSuggests&&(this.__save(),this.__hasError()&&setTimeout(fn.bind(function(){this.__regionSearchInput.focus()},this),10));break;case 40:case 38:if(this.__autoCheckbox.checked||!this.__items.length)return void e.preventDefault();var t;if(40==e.keyCode)if(this.__selectedCity){if(t=fn.arrayIndexOf(this.__items,this.__selectedCity)+1,t>=this.__items.length){if(this.__loading)return;t=0}t=this.__items[t]}else t=this.__items[0];else this.__selectedCity?(t=fn.arrayIndexOf(this.__items,this.__selectedCity)-1,0>t&&(t=this.__items.length-1),t=this.__items[t]):t=this.__items[this.__items.length-1];this.__selectCity(t),this.__scrollToCity(this.__selectedCity,40==e.keyCode),e.preventDefault()}else if("keyup"===e.type||("paste"===e.type||"cut"===e.type)&&e.target===this.__regionSearchInput||"click"===e.type&&(e.target===this.__regionSearchInput||fn.hasParent(e.target,this.__regionSearchInput))){if(clearTimeout(this.__qEntertimeout),"cut"===e.type||"paste"===e.type)return void(this.__qEntertimeout=setTimeout(fn.bind(function(){this.__searchInputKeys({type:"keyup"})},this),0));if(13===e.keyCode)return;if(!this.__validate(this.__regionSearchInput.value))return;var s=this.__getSelection(),i=s?this.__regionSearchInput.value.substr(0,this.__regionSearchInput.value.toLowerCase().indexOf(s)):this.__regionSearchInput.value;if(i=i.toLowerCase(),i===this.__getNormalizedQ()||s===this.__regionSearchInput.value.toLowerCase()&&""!==this.__regionSearchInput.value)return;this.__qEntertimeout=setTimeout(fn.bind(function(){this.__q=this.__regionSearchInput.value,this.__autocompletedValue="",this.__getNormalizedQ()!==this.__getQLoaded()&&this.__loadRegions(0)},this),this.__settings.inputTimeout)}}else{if(this.__autoCheckbox.checked)return void e.preventDefault();var n=fn.hasParent(e.target,"portal-region__suggests__group__item")||fn.hasClass(e.target,"portal-region__suggests__group__item")&&e.target;n&&this.__selectCity(n)}},__placeHolderKeys:function(e){this.__placeholderEmulation&&("keydown"===e.type?91==e.keyCode||92==e.keyCode?this.__commandKey=!0:[8,46].indexOf(e.keyCode)>-1&&1==this.__getQ().length?this.__togglePlaceholder(!0):48<=e.keyCode&&e.keyCode<=90&&!e.altKey&&!e.ctrlKey&&!this.__commandKey&&this.__togglePlaceholder(!1):"keyup"===e.type&&(91==e.keyCode||92==e.keyCode?this.__commandKey=!1:this.__togglePlaceholder()))},__togglePlaceholder:function(e){this.__placeholderEmulation&&(e===!0||e===!1?this.__regionSearchPlaceholder.style.display=e?"block":"none":this.__regionSearchPlaceholder.style.display=this.__regionSearchInput.value?"none":"block")},__validate:function(e){e=void 0===e?this.__regionSearchInput.value:e;var t=""===e||/^[a-zA-Zа-яА-Яё() \-]+$/i.test(e);return t?this.__removeError(!0):this.__setError(),t},__getQ:function(e){return this.__q},__setQ:function(e,t){this.__autocompletedValue=t||"",this.__q=e,this.__regionSearchInput.value=this.__autocompletedValue?this.__autocompletedValue:this.__q;var s=this.__getNormalizedQ(this.__q).length,i=this.__autocompletedValue.length;if(this.__popup.isVisible())if(this.__regionSearchInput.setSelectionRange)this.__regionSearchInput.setSelectionRange(s,i);else if(this.__regionSearchInput.createTextRange){var n=this.__regionSearchInput.createTextRange();n.collapse(!0),n.moveEnd("character",i),n.moveStart("character",s),n.select()}this.__togglePlaceholder()},__getNormalizedQ:function(e){return e=void 0!==e?e:this.__getQ(),e.toLowerCase()},__getSelection:function(){var e=this.__getNormalizedQ(this.__q).length;return this.__autocompletedValue&&-1!==this.__regionSearchInput.value.toLowerCase().indexOf(this.__autocompletedValue.toLowerCase())?this.__autocompletedValue.substr(e).toLowerCase():""},__getQLoaded:function(){return this.__qLoaded},__setQLoaded:function(e){this.__qLoaded=e.toLowerCase()},__hasError:function(){return fn.hasClass(this.__regionSearchInput.parentNode.parentNode,this.__regionSearchInputBaseClass+"_error")},__setError:function(e){clearTimeout(this.__hightlightTimeout),fn.addClass(this.__regionSearchInput.parentNode.parentNode,this.__regionSearchInputBaseClass+"_error"),e?(this.__hightlightTimeout=setTimeout(fn.bind(function(){this.__validate()},this),1e3),fn.addClass(this.__regionSuggests.parentNode,"w-"+this.__regionSuggestsBaseClass+"_highlight")):this.__removeError(!0,!0)},__removeError:function(e,t){t||fn.removeClass(this.__regionSearchInput.parentNode.parentNode,this.__regionSearchInputBaseClass+"_error"),e&&fn.removeClass(this.__regionSuggests.parentNode,"w-"+this.__regionSuggestsBaseClass+"_highlight")},__switchToAuto:function(){this.__reset(),this.__regionSearchInput.setAttribute("disabled","disabled"),fn.addClass(this.__regionSuggests,this.__regionSuggestsBaseClass+"_disabled"),this.__currentState="auto"},__switchToManual:function(){this.__reset(),this.__regionSearchInput.removeAttribute("disabled"),fn.removeClass(this.__regionSuggests,this.__regionSuggestsBaseClass+"_disabled"),this.__currentState="manual"},__url:"//portal.mail.ru/RegionSuggest",__loadRegions:function(e){if(!this.__loading||this.__getQLoaded()!==this.__getNormalizedQ()){var t=this.__getParams(e),s=t.q;if(!(e>this.__pages(s)-1)){this.__setQLoaded(s),this.__page=e;var i=this.__inCache(s,e);if(void 0===i){for(var n,o=s;(o=o.substr(0,o.length-1)).length>=2&&void 0===(n=this.__inCache(o,e)););if(n===!1)return void this.__updateList()}else if(i===!1)return void this.__updateList();if(i)return void this.__updateList(i,e);clearTimeout(this.__loaderTimeout),e||(this.__loaderTimeout=setTimeout(fn.bind(function(){fn.addClass(this.__regionSuggests,this.__regionSuggestsBaseClass+"_loading")},this),this.__settings.preloaderPause)),this.__loading=!0,mr.JSONP({url:this.__url,params:t,callback:fn.bind(function(t){clearTimeout(this.__loaderTimeout),fn.removeClass(this.__regionSuggests,this.__regionSuggestsBaseClass+"_loading"),this.__loading=!1;var i=this.__cache(s,e,t);this.__getNormalizedQ()===this.__getQLoaded()&&this.__page===e&&this.__updateList(i,e)},this),error:fn.bind(function(t){clearTimeout(this.__loaderTimeout),fn.removeClass(this.__regionSuggests,this.__regionSuggestsBaseClass+"_loading"),this.__loading=!1,this.__getNormalizedQ()===this.__getQLoaded()&&this.__page===e&&this.__message(null,t)},this),timeout:6e4})}}},__message:function(e,t){t?(this.__scrollTop=this.__regionSuggests.scrollTop,fn.addClass(this.__regionSuggests,this.__regionSuggestsBaseClass+"_message"),fn.addClass(this.__regionSuggests,this.__regionSuggestsBaseClass+"_error"),fn.removeClass(this.__regionSuggests,this.__regionSuggestsBaseClass+"_empty")):e?(fn.addClass(this.__regionSuggests,this.__regionSuggestsBaseClass+"_message"),fn.addClass(this.__regionSuggests,this.__regionSuggestsBaseClass+"_empty"),fn.removeClass(this.__regionSuggests,this.__regionSuggestsBaseClass+"_error")):(fn.removeClass(this.__regionSuggests,this.__regionSuggestsBaseClass+"_message"),fn.removeClass(this.__regionSuggests,this.__regionSuggestsBaseClass+"_empty"),fn.removeClass(this.__regionSuggests,this.__regionSuggestsBaseClass+"_error")),!t&&this.__scrollTop&&(this.__regionSuggests.scrollTop=this.__scrollTop,this.__scrollTop=null)},__updateList:function(e,t){0!==t&&e||(this.__selectCity(),this.__regionSuggests.scrollTop=0,fn.removeClass(this.__regionSuggests,this.__regionSuggestsBaseClass+"_hasMore"),this.__regionSuggestsGroupLists.current.innerHTML="",this.__regionSuggestsGroupLists.russia.innerHTML="",this.__regionSuggestsGroupLists.other.innerHTML=""),this.__message(!e),e&&(e.current.length&&this.__regionSuggestsGroupLists.current.appendChild(this.__groupHTML(this.__regionsCache,e.current)),e.russia.length&&this.__regionSuggestsGroupLists.russia.appendChild(this.__groupHTML(this.__regionsCache,e.russia)),e.other.length&&this.__regionSuggestsGroupLists.other.appendChild(this.__groupHTML(this.__regionsCache,e.other)),void 0!==t&&t!==this.__pages(this.__getNormalizedQ())-1?fn.addClass(this.__regionSuggests,this.__regionSuggestsBaseClass+"_hasMore"):fn.removeClass(this.__regionSuggests,this.__regionSuggestsBaseClass+"_hasMore"),(this.__regionSuggestsGroupLists.current.childNodes.length?fn.removeClass:fn.addClass)(this.__regionSuggestsGroups.current,this.__regionSuggestsGroupBaseClass+"_empty"),(this.__regionSuggestsGroupLists.russia.childNodes.length?fn.removeClass:fn.addClass)(this.__regionSuggestsGroups.russia,this.__regionSuggestsGroupBaseClass+"_empty"),(this.__regionSuggestsGroupLists.other.childNodes.length?fn.removeClass:fn.addClass)(this.__regionSuggestsGroups.other,this.__regionSuggestsGroupBaseClass+"_empty"));var s=this.__items;this.__items=fn.byClassName(this.__regionSuggests,this.__regionSuggestsGroupItemBaseClass),1===this.__items.length&&this.__selectCity(this.__items[0],1==s.length&&s[0].getAttribute("data-id")===this.__items[0].getAttribute("data-id")),s=null,this.__regionSuggestsScrollHeight=this.__regionSuggests.scrollHeight},__groupHTML:function(e,t){if(!t||!t.length)return"";for(var s=document.createDocumentFragment(),i=0,n=t.length;n>i;i++){var o=t[i],r=e[o],_=r.parentId&&e[r.parentId],a=_&&_.parentId&&e[_.parentId],h=document.createElement("div"),l=document.createElement("span"),g=document.createElement("span");h.setAttribute("data-id",o),h.className="portal-region__suggests__group__item",l.className="portal-region__suggests__group__item__name",g.className="portal-region__suggests__group__item__info",l.innerHTML=r.cityName;var c=[];_&&(_.regionName&&c.push(_.regionName),a&&a.regionName&&c.push(a.regionName)),g.innerHTML=c.length?"("+c.join(", ")+")":"",h.appendChild(l),h.appendChild(g),s.appendChild(h)}return s},__getParams:function(e){var t={q:this.__getNormalizedQ()},s=this.__settings.pageSize*e,i=this.__settings.pageSize;return this.__settings.startRegion&&(t.rId=this.__settings.startRegion),void 0!==s&&(t.M=s),void 0!==i&&(t.N=i),t},show:function(){function e(){this.__popup.show(),this.emit("show"),mr.counter("d1221590")}this.__popup.isVisible()||(this.emit("beforeShow"),this.__inCache(this.__getNormalizedQ(),this.__page)?e.call(this):setTimeout(fn.bind(e,this),this.__settings.preloaderPause))},hide:function(){this.__popup.isVisible()&&(this.emit("beforeHide"),this.__popup.hide(),this.emit("hide"))}}),p.PortalRegion=e}(),function(e){function t(t){var i=this;this.__settings=e.extend({},s,t),this.showVariant=this.__settings.show,this.variant=0,this.container=mr.id("news"),this.linkforposition=mr.id("regional-info-link-0"),this.popup=mr.id("region-confirm"),this.choose=mr.id("region-confirm__choose"),this.closeButton=mr.id("region-confirm__close"),this.confirm=mr.id("region-confirm__confirm"),this.link=mr.id("region-confirm__link"),this.city=mr.id("region-confirm__city"),this.yes=mr.id("region-confirm__yes"),this.no=mr.id("region-confirm__no"),this.container.appendChild(this.popup),PortalEvents.addListener(this.closeButton,"click",e.bind(this.hideByButton,this)),PortalEvents.addListener(this.closeButton,"keyup",e.bind(function(e){13===e.keyCode&&this.hideByButton()},this));var n=mr.s_cookie.getGlobal("geo"),o=mr.s_cookie.getGlobal("georb"),r=mr.s_cookie.getGlobal("geod"),_=mr.s_cookie.getGlobal("geol1"),a={level1:_||null,level2:o||null},h=this.__settings.region,l=this.__settings.manualRegion;1===this.showVariant||0===this.__settings.region.id&&!n?this.variant=1:(2===this.showVariant||n&&n!==h.id&&(null!==a.level2&&l.level2!=h.level2&&a.level2!=h.level2&&null!==h.level2||null!==a.level1&&l.level1!=h.level1&&a.level1!=h.level1)&&(!r||r&&r!=h.level1))&&(this.variant=2),1===this.variant?(this.choose.style.display="inline-block",this.confirm.style.display="none",PortalEvents.addListener(this.link,"click",e.bind(this.showRegionalSelector,this))):2===this.variant?(this.choose.style.display="none",this.confirm.style.display="inline-block",this.city.innerHTML=this.__settings.cityName,PortalEvents.addListener(this.yes,"click",e.bind(this.save,this)),PortalEvents.addListener(this.no,"click",e.bind(this.save,this)),PortalEvents.addListener(this.yes,"keyup",e.bind(this.save,this)),PortalEvents.addListener(this.no,"keyup",e.bind(this.save,this))):this.__disabled=!0,newsTabs.on("tab:activate",function(){i.hide()})}var s={cityName:"",region:null,manualRegion:null};t.prototype={save:function(t){var s,i;("click"===t.type||"keyup"===t.type&&13===t.keyCode)&&(t.target===this.yes||e.hasParent(t.target,this.yes)?s="yes":(t.target===this.no||e.hasParent(t.target,this.no))&&(s="no"),s&&((new Image).src="//rs.mail.ru/f?geo="+mr.s_cookie.getGlobal("geo")+"&ipR="+this.__settings.region.id+"&ipLevel2="+this.__settings.region.level2+"&effLevel2="+this.__settings.manualRegion.level2+"&ipLevel1="+this.__settings.region.level1+"&effLevel1="+this.__settings.manualRegion.level1+"&geod="+mr.s_cookie.getGlobal("geod")+"&georb="+mr.s_cookie.getGlobal("georb")+"&geol1="+mr.s_cookie.getGlobal("geol1")+"&button="+s,
"yes"===s&&(mr.counter("clb1283927"),mr.s_cookie.removeGlobal("geo"),mr.s_cookie.removeGlobal("georb"),mr.s_cookie.removeGlobal("geol1"),mr.s_cookie.removeGlobal("geod"),setTimeout(function(){location.reload()},20),this.hide()),"no"===s&&(mr.counter("clb1283928"),i=mr.s_cookie.getGlobal("geod"),mr.s_cookie[this.__settings.region.level2?"setGlobal":"removeGlobal"]("georb",this.__settings.region.level2),mr.s_cookie[this.__settings.region.level1?"setGlobal":"removeGlobal"]("geol1",this.__settings.region.level1),-1==i?mr.s_cookie.setGlobal("geod",this.__settings.region.level1):mr.s_cookie.setGlobal("geod","-1"),this.hide())))},hideByButton:function(){this.hide(),this.variant&&mr.counter("clb"+(1==this.variant?"1283920":"1283930"))},hide:function(){this.popup.style.display="none"},show:function(){this.__disabled||(this.popup.style.display="block",this.popup.style.left=this.linkforposition.offsetWidth+20+"px",this.variant&&mr.counter("d"+(1==this.variant?"1283915":"1283926")))},showRegionalSelector:function(){showRegionSelector=!0,"regionalSelector"in window&&(mr.counter("clb1283918"),window.regionalSelector.show()),this.hide()}},window.RegionConfirm=t}(window.__portal.__fn),aRadar("additionalJSInit",1),mr.portalSriptLoaded=!0;