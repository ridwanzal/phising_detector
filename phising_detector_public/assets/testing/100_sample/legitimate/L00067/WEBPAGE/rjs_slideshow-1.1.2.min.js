/*
 rjs_slideshow.js 1.1.2
 Copyright (c) 2013 Rakuten.Inc
 Date : 2013-04-01 10:38:52
*/
(function(p,h){if(p.jQuery!==h){jQuery.noConflict();var g=jQuery;if(g.RJS_Helpers){var q=function(m,n){var a=this;m===h||n===h||(a.mainObj=m,g.extend(this,{settings:{maxitem:5,pagespeed:100,opacityspeed:100,autoslidetime:2,autoslideflag:"",autoslide:0,autoresize:0,verticalmode:0,indicator:0,indicatoralign:0},eobj:{itemsDisplay:!1,prevButton:!1,nextButton:!1,indicatorDisplay:!1},canvas:{front:!1,back:!1,autoPlayTimer:!1},itemPrototype:{html:"",height:0,width:0},indicatorPrototype:{html:"",height:0,
width:0},items:!1,itemIndex:[],itemEvents:{remove:!1},status:{animation:!1,preparingItems:!1,renderReset:!1,resizeCurrStart:!1,resizeCurrEnd:!1,callBackResize:!1,isStopAutoPlay:!1},pageConf:{maxAllowed:5,currStart:0,currEnd:0,currCnt:0,width:0,nowPage:0,maxPage:0},events:{startSlide:!1,afterSlide:!1,afterRemove:!1,onItemRemove:!1,afterFirstRender:!1,beforeFirstRender:!1,onZeroItems:!1,onResize:!1,changePageNumber:!1}},n),g.extend(this,{initialize:function(){var b=0,c,e;if(1>a.items.length||!a.eobj.itemsDisplay||
!a.eobj.prevButton||!a.eobj.nextButton)return a;for(c in a.items)a.itemIndex[b]=c,b++;b=a.itemIndex.length;for(e in a.events)!g.isFunction(a.events[e])&&(a.events[e]=!1);1===a.settings.autoslide&&!g.isFunction(a[a.settings.autoslideflag])?a.settings.autoslide=0:(a.eobj.itemsDisplay.hover(function(){a.isStopAutoPlay=!0;a.stop()},function(){a.isStopAutoPlay=!1;a.play()}),a.eobj.prevButton.hover(function(){a.stop()},function(){a.play()}),a.eobj.nextButton.hover(function(){a.stop()},function(){a.play()}),
a.eobj.backButton!=h&&0<a.eobj.backButton.length&&a.eobj.backButton.hover(function(){a.stop()},function(){a.play()}));a.pageConf.maxAllowed=Math.min(a.settings.maxitem,b);1===a.settings.autoresize&&(0===a.settings.verticalmode&&0<a.itemPrototype.width)&&(a.resize(!1),g(p).resize(function(){a.resize(!0)}));e=Math.min(a.pageConf.maxAllowed,b);a.prepareItems(0,e).updatePageNumber().prepareIndicator().render(0,e,!1).manageControls().prepareItems(e,b);return a},prepareItems:function(b,c){var e=a.itemPrototype.html,
d=a.itemPrototype.identifiers,f="",k,j,l;if(a.status.preparingItems)return a;if(a.status.animation)return setTimeout(function(){a.prepareItems(b,c)},a.settings.pagespeed),a;a.status.preparingItems=!0;for(j=b;j<c;j++){f=e;k=a.items[a.itemIndex[j]];for(l in d)f=f.replace(d[l][1],k[l]!=h?d[l][0]+k[l]+d[l][2]:"");k.ele=g(f)}if(""!=a.itemEvents.remove)for(j=b;j<c;j++)a.items[a.itemIndex[j]].ele.find(a.itemEvents.remove).attr("id","").bind("click",{index:j},function(b){b.preventDefault();a.removeItem(b.data.index);
return!1});a.status.preparingItems=!1;return a},render:function(b,c,e,d){if(a.status.animation||a.status.preparingItems)return a;e=typeof e!==h?!1===e?!1:!0:!0;d=typeof d!==h?!0===d?!0:!1:!1;if(0>b)return a;a.status.animation=!0;a.stop();if(c>a.itemIndex.length&&(c=a.itemIndex.length,c-b>a.pageConf.maxAllowed))return a;if(!1===e)a.canvas.front=a.prepareElements(b,c,2,1),a.events.beforeFirstRender&&a.events.beforeFirstRender(a.pageConf.maxAllowed,a.mainObj),a.eobj.itemsDisplay.append(a.canvas.front),
a.play(),a.status.animation=!1,a.events.afterFirstRender&&a.events.afterFirstRender(a.pageConf.maxAllowed,a.mainObj);else{a.status.renderReset&&a.canvas.front[0].parentNode.removeChild(a.canvas.front[0]);a.canvas.back=a.prepareElements(b,c,2,0);a.eobj.itemsDisplay.append(a.canvas.back);e=a.pageConf.maxAllowed;var f=1,k=c-b,j,g=!0;d?(d=a.pageConf.currCnt!=e?Math.ceil(a.pageConf.currEnd/e)*e-1:a.pageConf.currEnd-1,j=k!=e?Math.ceil(c/e)*e-1:c-1,a.status.renderReset&&(d=-1,k!=e&&(e=k,j=c-1)),f=-1):(d=
a.pageConf.currStart,j=b);for(k=0;g;k++,d+=f,j+=f)setTimeout(function(b,d,e){return function(){var c=b,f=d;(c=a.items[a.itemIndex[c]])&&c.ele.animate({opacity:0},a.settings.opacityspeed,"linear");(f=a.items[a.itemIndex[f]])&&f.ele.animate({opacity:1},a.settings.opacityspeed,"linear");e||setTimeout(function(){a.canvas.front[0]!==h&&null!==a.canvas.front[0].parentNode&&a.canvas.front[0].parentNode.removeChild(a.canvas.front[0]);a.canvas.front=a.canvas.back;a.play();a.status.animation=!1;a.status.renderReset=
!1;a.status.callBackResize&&a.resize(!0);a.events.afterSlide&&a.events.afterSlide(a.pageConf.currStart,a.mainObj)},a.settings.opacityspeed)}}(d,j,g=k+1<e),k*a.settings.pagespeed)}a.pageConf.currStart=b;a.pageConf.currEnd=c;a.pageConf.currCnt=c-b;a.manageControls();a.updatePageNumber();a.events.changePageNumber&&a.events.changePageNumber(a.pageConf.nowPage,a.pageConf.maxPage,a.mainObj);1===a.settings.indicator&&a.renderIndicator();return a},prepareElements:function(b,c,e,d){e={"z-index":e,opacity:d,
position:"relative"};var f;d=g("<div>").css({position:"absolute",width:"100%","float":"none"});for(f=b;f<c;f++)b=a.items[a.itemIndex[f]].ele,d.append(b.css(e));a.justifyElements(d);return d},manageControls:function(){0===a.pageConf.currStart&&a.pageConf.currEnd>=a.itemIndex.length?(a.eobj.prevButton.find("a").hide(),a.eobj.nextButton.find("a").hide()):(a.eobj.prevButton.find("a").show().focus(function(){this.blur()}).unbind("click").click(function(b){b.preventDefault();a.prev();return!1}),a.eobj.nextButton.find("a").show().focus(function(){this.blur()}).unbind("click").click(function(b){b.preventDefault();
a.next();return!1}));return a},prev:function(){if(0===a.pageConf.currStart&&a.pageConf.currEnd===a.itemIndex.length)return a;a.events.startSlide&&a.events.startSlide(a.pageConf.currStart,a.mainObj);0===a.pageConf.currStart?a.render(Math.floor((a.itemIndex.length-1)/a.pageConf.maxAllowed)*a.pageConf.maxAllowed,a.itemIndex.length):a.render(a.pageConf.currStart-a.pageConf.maxAllowed,a.pageConf.currStart);return a},next:function(){if(0===a.pageConf.currStart&&a.pageConf.currEnd===a.itemIndex.length)return a;
a.events.startSlide&&a.events.startSlide(a.pageConf.currStart,a.mainObj);a.pageConf.currEnd>=a.itemIndex.length?a.render(0,a.pageConf.maxAllowed,!0,!0):a.render(a.pageConf.currEnd,a.pageConf.currEnd+a.pageConf.maxAllowed,!0,!0);return a},removeItem:function(b){var c=a.canvas.front,e,d,f;e=!1;var k;if(a.status.animation||a.status.preparingItems)return!1;a.items[b].ele.fadeOut(a.settings.opacityspeed,function(){g(this).remove()});a.events.onItemRemove&&a.events.onItemRemove(b,a.mainObj);if(1==a.itemIndex.length)return a.events.onZeroItems&&
a.events.onZeroItems(a.mainObj),!1;b=g.inArray(b+"",a.itemIndex);if(-1==b)return!1;a.itemIndex.splice(b,1);a.pageConf.currEnd==a.itemIndex.length+1&&(a.pageConf.currEnd--,a.pageConf.currCnt--);if(b==a.itemIndex.length)a.events.afterRemove&&a.events.afterRemove(a.mainObj),0==b%a.pageConf.maxAllowed&&a.prev();else{a.status.animation=!0;d=b;for(f=0;!e;d++,f++){e=a.items[a.itemIndex[d]].ele;e.css({"z-index":1,opacity:0});if(k=d==a.pageConf.currEnd-1)c.append(e),d==b&&(f=1);setTimeout(function(b,d){return function(){b.animate({opacity:"1"},
a.settings.opacityspeed,"linear",function(){a.status.animation=d;!a.status.animation&&a.status.callBackResize&&a.resize(!0);d||a.events.afterRemove&&a.events.afterRemove(a.mainObj)})}}(e,!(e=d===a.itemIndex.length-1||k)),f*a.settings.pagespeed)}}a.justifyElements().manageControls();a.updatePageNumber();a.events.changePageNumber&&a.events.changePageNumber(n.nowPage,n.maxPage,a.mainObj);1===a.settings.indicator&&(a.prepareIndicator(),a.renderIndicator());return!1},play:function(){if(0===a.settings.autoslide||
a.isStopAutoPlay||a.autoPlayTimer==h||!1!=a.autoPlayTimer)return a;a.autoPlayTimer=setTimeout(function(){a[a.settings.autoslideflag]()},a.settings.autoslidetime);return a},stop:function(){if(0===a.settings.autoslide)return a;clearTimeout(a.autoPlayTimer);a.autoPlayTimer=!1;return a},justifyElements:function(b){var c=a.pageConf.maxAllowed;if(1!==a.settings.autoresize)return a;b===h&&(b=a.canvas.front);b.children("*").css("width",c>=a.settings.maxitem?Math.floor(1E4*(99/c))/1E4+"%":"");return a},resize:function(b){var c=
a.pageConf,e,d;if(a.status.animation||a.status.preparingItems)return a.status.callBackResize=!0,a;e=a.eobj.itemsDisplay.width();d=Math.floor(e/a.itemPrototype.width);d<a.settings.maxitem&&(d=a.settings.maxitem);if(d==c.maxAllowed)return a;e=c.maxAllowed;c.maxAllowed=d;if(!b)return a;a.status.animation=!0;a.stop();a.status.renderReset?(b=a.status.resizeCurrStart,d=a.status.resizeCurrEnd):(b=c.currStart,d=c.currEnd);cntItem=d-b;if(c.maxAllowed>e){if(d!=a.itemIndex.length){frontEle=a.canvas.front;for(e=
cntItem;e<c.maxAllowed;e++){d=b+e;if(d>=a.itemIndex.length)break;if(a.itemIndex[d]===h)break;d=a.items[a.itemIndex[d]].ele;d.css("z-index",2).animate({opacity:1},0);frontEle.append(d)}d=b+e}}else if(cntItem>c.maxAllowed){for(e=cntItem;e>c.maxAllowed;e--){d=b+e-1;if(a.itemIndex[d]===h)break;d=a.items[a.itemIndex[d]].ele;d[0].parentNode&&d[0].parentNode.removeChild(d[0])}d=b+e}a.status.resizeCurrStart=b;a.status.resizeCurrEnd=d;c.currCnt=d-b;a.status.renderReset=!0;a.justifyElements();e=b%c.maxAllowed;
0!=e&&(b+=c.maxAllowed-e);d=b+c.maxAllowed;d>a.itemIndex.length&&(d=a.itemIndex.length);c.currStart=b;c.currEnd=d;a.manageControls();a.events.onResize&&a.events.onResize(c.maxAllowed,a.mainObj);a.status.animation=a.status.callBackResize=!1;a.play();a.updatePageNumber();a.events.changePageNumber&&a.events.changePageNumber(c.nowPage,c.maxPage,a.mainObj);1===a.settings.indicator&&(a.prepareIndicator(),a.renderIndicator());return a},updatePageNumber:function(){var b=Math.ceil(a.itemIndex.length/a.pageConf.maxAllowed),
c;for(c=1;c<b&&!(a.pageConf.currEnd<=c*a.pageConf.maxAllowed);c++);a.pageConf.nowPage=c;a.pageConf.maxPage=b;return a},changePage:function(b){b=(b-1)*a.pageConf.maxAllowed;a.render(b,b+a.pageConf.maxAllowed);return this},prepareIndicator:function(){if(1!==a.settings.indicator||a.eobj.indicatorDisplay===h)return a;for(var b=a.pageConf.maxPage,c="<div>",e=1;e<=b;e++)c+=a.indicatorPrototype.html;a.eobj.indicatorDisplay.empty().append(c+"</div>");c=a.eobj.indicatorDisplay.children();0===a.settings.indicatoralign?
(b*=a.indicatorPrototype.width,c.css({position:"relative",width:b,height:"100%","float":"none"})):(b*=a.indicatorPrototype.height,c.css({position:"relative",width:"100%",height:b,"float":"none"}));c.children().each(function(b,c){g(c).bind("click",function(c){if(b+1!==a.pageConf.nowPage)return c.preventDefault(),a.changePage(b+1),!1})});return a},renderIndicator:function(){if(a.eobj.indicatorDisplay===h)return a;for(var b=a.pageConf.nowPage,c=a.eobj.indicatorDisplay.children().find("div").removeClass("on"),
e=0;e<c.length;e++){var d=g(c[e]);e+1==b&&d.addClass("on")}return a}}),a.initialize(),m.slideshow!==h&&(m.slideshow=a))};g.fn.RJS_Slideshow=function(g,h){this.each(function(){new q(g,h)})}}}})(this);