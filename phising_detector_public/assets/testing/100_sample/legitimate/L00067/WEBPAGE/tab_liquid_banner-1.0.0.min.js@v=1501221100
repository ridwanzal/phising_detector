/*
 tab_liquid_banner-1.0.0.js
 Copyright (c) 2015 Rakuten.Inc
 Date : 2015-01-22 11:36:17
*/
(function(){if(void 0!==window.jQuery){var f=jQuery.noConflict(),i=function(a){this.$root=a.show();this.tabSliderSelector=this.$root.attr("data-tab-slider-selector")||this.defaults.selectors.tabSlider;this.contentsSliderSelector=this.$root.attr("data-contents-slider-selector")||this.defaults.selectors.contentsSlider;this.useLazyLoading="false"!==this.$root.attr("data-useLazyLoading");this.tabSliderInstance=this.$contentsSliders=this.$tabs=this.$tabSlider=this.$window=void 0;this.contentsSliderInstances=
[];this.currentIndex=0;this.getElements()};i.prototype={defaults:{selectors:{tabSlider:".tabSlider",contentsSlider:".contentsSlider > *"},useLazyLoading:!0},getElements:function(){var a=this;this.$window=f(window);this.$tabSlider=this.$root.find(this.tabSliderSelector);this.$tabSlider.bind("sliderinitialized",function(b){a.$tabs=b.customData.$slides;a.$contentsSliders=a.$root.find(a.contentsSliderSelector);a.$contentsSliders.eq(0).show();a.loadLazyLoading(a.$contentsSliders.eq(0).find(".liquidBanner-list"));
b=new j(a.$contentsSliders.eq(0));b.initialize();a.contentsSliderInstances[0]=b;a.initTabs()});this.tabSliderInstance=new k(this.$tabSlider)},initTabs:function(){var a=this;this.$tabs.each(function(b,c){var d;f(c).hover(function(){d=setTimeout(function(){a.changeTab(a.currentIndex,b)},300)},function(){clearTimeout(d)}).bind("click",function(){clearTimeout(d);a.changeTab(a.currentIndex,b)})}).eq(0).addClass("active")},changeTab:function(a,b){if(a!==b){var c=this;this.$tabs.eq(b).addClass("active").end().eq(a).removeClass("active");
this.$contentsSliders.eq(a).fadeOut(300,function(){c.$contentsSliders.eq(b).show();if(!c.contentsSliderInstances[b]){c.loadLazyLoading(c.$contentsSliders.eq(b).find(".liquidBanner-list"));var a=new j(c.$contentsSliders.eq(b));a.initialize();c.contentsSliderInstances[b]=a}c.currentIndex=b;c.$window.trigger("resize")})}},loadLazyLoading:function(a){a.find("img[data-original]").each(function(a,c){var d=f(c),e=d.attr("data-original");d.attr("src",e)})},fireEvent:function(a,b,c){b=f.Event(b);b.customData=
c||{};a.trigger(b)}};var k=function(a){this.$root=f(a);this.itemFrameSelector=this.$root.attr("data-itemFrame")||this.defaults.selectors.itemFrame;this.itemBoxSelector=this.$root.attr("data-itemBox")||this.defaults.selectors.itemBox;this.itemSelector=this.$root.attr("data-item")||this.defaults.selectors.item;this.prevButtonSelector=this.$root.attr("data-prevButton")||this.defaults.selectors.prevButton;this.nextButtonSelector=this.$root.attr("data-nextButton")||this.defaults.selectors.nextButton;this.fadeFrameSelector=
this.$root.attr("data-fadeFrame")||this.defaults.selectors.fadeFrame;this.itemAlign=this.$root.attr("data-itemAlign")||this.defaults.itemAlign;this.hideButtons="false"!==this.$root.attr("data-hideButtons");this.fadeTime=+this.$root.attr("data-fadeTime")||this.defaults.fadeTime;this.$nextButton=this.$prevButton=this.$fadeFrame=this.$lastItem=this.$phantomItem=this.$itemPrototype=this.$items=this.$itemBox=this.$itemFrame=this.$window=void 0;this.itemPrototypeString="";this.inAnimation=this.perItemMargin=
this.currentPhantomItems=this.visibleItems=this.itemsLength=this.itemMargin=this.itemWidth=this.itemFrameWidth=0;this.getElements();this.fireEvent(this.$root,this.defaults.events.SLIDER_INITIALIZED,{$slides:this.$items})};k.prototype={defaults:{selectors:{itemFrame:".itemFrame",itemBox:".itemBox",item:"*",fadeFrame:".fadeFrame",prevButton:".prevButton",nextButton:".nextButton"},events:{MOVED_LEFT:"movedleft",MOVED_RIGHT:"movedright",ITEM_CHANGED:"itemchanged",SLIDER_INITIALIZED:"sliderinitialized"},
itemAlign:"left",fadeTime:100},getElements:function(){this.$window=f(window);this.$itemFrame=this.$root.find(this.itemFrameSelector);this.$itemBox=this.$itemFrame.find(this.itemBoxSelector);this.$items=this.$itemBox.children(this.itemSelector);this.$items.each(function(a,b){f(b).attr("data-originalIndex",a)});this.itemsLength=this.$items.length;this.$itemPrototype=this.$items.eq(0);this.itemPrototypeString=this.stringifyElement(this.$itemPrototype);this.itemWidth=this.$itemPrototype.width();this.itemFrameWidth=
this.$itemFrame.width();this.itemMargin=this.$itemPrototype.outerWidth(!0)-this.itemWidth;this.$phantomItem=this.$itemPrototype.clone().empty().addClass("phantom").css({visibility:"hidden",opacity:"0",width:this.itemWidth,height:this.$itemPrototype.outerHeight(!0),background:"none"}).removeAttr("id");this.$lastItem=this.$items.last();this.$fadeFrame=this.$itemFrame.find(this.fadeFrameSelector);this.$prevButton=this.$root.find(this.prevButtonSelector);this.$nextButton=this.$root.find(this.nextButtonSelector);
this.visibleItems=0;this.bindEvents()},bindEvents:function(){var a=this;this.fixMargin();this.$window.bind("load",function(){a.fixWidth();a.fixMargin()}).bind("resize",function(){a.fixMargin()});this.$prevButton.bind("click",function(){a.moveLeft()});this.$nextButton.bind("click",function(){a.moveRight()})},fixWidth:function(){if(this.$root.is(":visible"))this.itemFrameWidth=this.$itemFrame.width(),this.itemWidth=this.$itemPrototype.width()},fixMargin:function(){if(this.$root.is(":visible")){var a=
this.visibleItems;this.itemFrameWidth=this.$itemFrame.width();this.visibleItems=this.itemFrameWidth/(this.itemWidth+this.itemMargin)|0;var b=this.visibleItems-this.itemsLength%this.visibleItems===this.visibleItems?0:this.visibleItems-this.itemsLength%this.visibleItems;if(a!==this.visibleItems)a=this.$lastItem.index(),this.visibleItems>=this.itemsLength?(this.$itemBox.children(".phantom").remove(),this.$itemBox.prepend(this.$itemBox.children().slice(a+1)),this.$itemBox.children().css({visibility:"visible",
opacity:1}),this.hideButtons&&(this.$prevButton.hide(),this.$nextButton.hide())):(this.currentPhantomItems=a<this.visibleItems?this.addPhantomItems(this.visibleItems-(a+1)):this.addPhantomItems(b),this.$itemBox.children().slice(0,this.visibleItems).css("visibility","visible").end().slice(this.visibleItems).css("visibility","hidden"),this.hideButtons&&(this.$prevButton.show(),this.$nextButton.show())),this.fireEvent(this.$root,this.defaults.events.ITEM_CHANGED)}},addPhantomItems:function(a){var b=
a-this.$itemBox.children(".phantom").length;if(0<b)for(var c=0;c<b;c++)this.$lastItem.after(this.$phantomItem.clone());else 0>b&&this.$itemBox.children(".phantom").slice(b).remove();return a},moveRight:function(){var a=this;if(!this.inAnimation){this.inAnimation=!0;var b=this.$lastItem.index();if(b<2*this.visibleItems&&b>=this.visibleItems&&(b=2*this.visibleItems-(b+1),b!==this.currentPhantomItems))this.currentPhantomItems=this.addPhantomItems(b);b=this.$itemBox.children().slice(0,this.visibleItems);
this.$itemBox.append(b).children().not(".phantom").css("visibility","visible");this.$fadeFrame.append(b.clone()).show();this.$itemBox.children().slice(this.visibleItems).css("visibility","hidden").end().slice(0,this.visibleItems).css("opacity",0).each(function(b,d){var e=(a.visibleItems-b-1)*(a.fadeTime/2);f(d).delay(e).animate({opacity:1},a.fadeTime);a.$fadeFrame.children().eq(b).delay(e+a.fadeTime).animate({opacity:0},a.fadeTime,function(){if(0===b)a.$fadeFrame.hide().empty(),a.fireEvent(a.$root,
a.defaults.events.MOVED_RIGHT),a.inAnimation=!1})})}},moveLeft:function(){var a=this;if(!this.inAnimation){this.inAnimation=!0;var b=+this.$itemBox.children().first().attr("data-originalIndex"),c=!1;0!==b&&b<this.visibleItems&&(c=!0);if(c){c=this.visibleItems-this.itemsLength%this.visibleItems===this.visibleItems?0:this.visibleItems-this.itemsLength%this.visibleItems;if(c!==this.currentPhantomItems)this.currentPhantomItems=this.addPhantomItems(c);b=this.$itemBox.children().slice(0-b)}else b=this.$itemBox.children().slice(0-
this.visibleItems);c=this.$itemBox.children().slice(0,this.visibleItems).clone();this.$fadeFrame.append(c).show();this.$itemBox.children().not(".phantom").css({visibility:"visible",opacity:0});this.$itemBox.prepend(b).children().slice(this.visibleItems).css("visibility","hidden");c.each(function(b,c){var g=b*(a.fadeTime/2);f(c).delay(g+a.fadeTime).animate({opacity:0},a.fadeTime);a.$itemBox.children().eq(b).delay(g).animate({opacity:1},a.fadeTime,function(){if(b===a.visibleItems-1)a.$fadeFrame.hide().empty(),
a.fireEvent(a.$root,a.defaults.events.MOVED_LEFT),a.inAnimation=!1})})}},stringifyElement:function(a){return f("<div>").append(a.clone()).html()},fireEvent:function(a,b,c){b=f.Event(b);b.customData=c||{};a.trigger(b)}};var j=function(a){var b=this;f.extend(b,{slideshow:null,settings:{autoslidetime:[7E3,"Range","0,9999"],autoslideflag:["next","Str","^(next|prev)$"],autoslide:[1,"Int","^[0-1]$"],maxitem:[2,"Int","^[1-9]$"],pagespeed:[50,"Range","0,9999"],opacityspeed:[200,"Range","0,9999"],verticalmode:[0,
"Int","^[1]$"],autoresize:[1,"Int","^[0-1]$"],pagenumber:[0,"Int","^[0-1]$"],indicator:[1,"Int","^[0-1]$"],indicatoralign:[0,"Int","^[0-1]$"],singlemode:[0,"Int","^[0-1]$"],defaultcontent:[".flashcontent","Str","^[a-zA-Z0-9_-]{3,32}$"]},eobj:{config:a.find(".liquidBanner-config"),frame:a.find(".liquidBanner-frame"),prototypeItem:a.find(".liquidBanner-item"),itemsDisplay:a.find(".liquidBanner-body"),prevButton:a.find(".liquidBanner-prev"),nextButton:a.find(".liquidBanner-next"),backButton:a.find(".liquidBanner-back"),
nowPage:a.find(".liquidBanner-nowPage"),maxPage:a.find(".liquidBanner-maxPage"),indicatorDisplay:a.find(".liquidBanner-indicatorArea"),prototypeIndicator:a.find(".prototypeIndicator")},status:{error:!1,isTimeout:!1},props:{items:[],itemPrototype:{html:"",height:0,width:0,identifiers:{banner1:["",/\#BANNER1\#/g,""],banner2:["",/\#BANNER2\#/g,""]}},indicatorPrototype:{html:"",width:0,height:0}},initialize:function(){b.loadSettings();b.begin()},loadSettings:function(){b.settings=f.RJS_Helpers.readAttr(b.eobj.config,
b.settings);b.eobj.config.remove();return!0},begin:function(){b.status.error=!b.getPrototype();b.getData()},getData:function(){var c,d,e=a.find(".liquidBanner-list li");c=a.find(".liquidBanner-cBanner");if(1>e.length)return!1;if(1===b.settings.singlemode){var g=e.length;for(c=0;c<g;c++)b.props.items[c]=[],b.props.items[c].banner1=f(e[c]).html()}else{var g=Math.ceil(e.length/2),h=e[0]?f(e[0]).html():"";0<c.length&&1==e.length%2&&(h=c.html());for(c=0,d=0;c<g;c++)b.props.items[c]=[],b.props.items[c].banner1=
e[d]?f(e[d++]).html():h,b.props.items[c].banner2=e[d]?f(e[d++]).html():h}b.startSlideshow();b.eobj.backButton.bind("click",function(a){a.preventDefault();b.slideshow.changePage(1);return!1});return!0},getPrototype:function(){var a=b.eobj.prototypeItem,d=b.props.itemPrototype;if(0==a.length)return!1;d.width=a.outerWidth();d.height=a.outerHeight();d.html=a.html();if(""==d.html)return!1;a.remove();if(1==b.settings.indicator){a=b.eobj.prototypeIndicator;d=b.props.indicatorPrototype;if(0==a.length)return!1;
d.width=a.outerWidth();d.height=a.outerHeight();d.html=a.html();if(""==d.html)return!1;a.remove()}return!0},startSlideshow:function(){a.find(b.settings.defaultcontent).hide();b.eobj.frame.show();b.eobj.itemsDisplay.RJS_Slideshow(b,{settings:b.settings,itemPrototype:b.props.itemPrototype,indicatorPrototype:b.props.indicatorPrototype,eobj:b.eobj,items:b.props.items,events:{beforeFirstRender:b.beforeFirstRender,changePageNumber:1==b.settings.pagenumber?b.changePageNumber:!1}})},beforeFirstRender:function(a,
b){b.eobj.itemsDisplay.show();var e=setInterval(function(){if(b.props.items[b.props.items.length-1].ele){for(var a in b.props.items)b.props.items[a].ele.find("li div").each(function(){f(this).hover(function(){f(this).css("top","-2px")},function(){f(this).css("top","0px")})});clearInterval(e)}},100)},changePageNumber:function(a,b,e){e.eobj.nowPage.text(a);e.eobj.maxPage.text(b);1==a?e.eobj.backButton.hide():e.eobj.backButton.show()}})},l=f("#RJSTabLiquidBanner");0<l.length&&new i(l)}})();
