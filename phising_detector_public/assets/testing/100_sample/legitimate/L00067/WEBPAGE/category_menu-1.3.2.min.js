/*
 category_menu-1.3.2.js
 Copyright (c) 2015 Rakuten.Inc
 Date : 2015-07-23 14:31:03
*/
(function(){if(void 0!==window.jQuery){var d=jQuery.noConflict();d(function(){d(".RJSCategoryMenu").each(function(a,b){new f(b)})});var g=/iPad|(?!Android.*Mobile)Android/.test(navigator.userAgent),f=function(a){this.$menu=d(a);this.itemSelector=this.$menu.attr("data-item")||this.$menu.attr("data-itemSelector")||this.defaults.selectors.item;this.submenuSelector=this.$menu.attr("data-submenu")||this.$menu.attr("data-submenuSelector")||this.defaults.selectors.submenu;this.hiddenFromSelector=this.$menu.attr("data-hiddenFrom")||
this.$menu.attr("data-hiddenFromSelector")||this.defaults.selectors.hiddenFrom;this.floating="true"===this.$menu.attr("data-floating");this.menuMouseEnterTimeout=+this.$menu.attr("data-menuMouseEnterTimeout")||this.defaults.menuMouseEnterTimeout;this.menuMouseEnterInterval=+this.$menu.attr("data-menuMouseEnterInterval")||this.defaults.menuMouseEnterInterval;this.menuMouseEnterRange=+this.$menu.attr("data-menuMouseEnterRange")||this.defaults.menuMouseEnterRange;this.menuMouseEnterMinPixel=+this.$menu.attr("data-menuMouseEnterMinPixel")||
this.defaults.menuMouseEnterMinPixel;this.itemMouseEnterTimeout=+this.$menu.attr("data-itemMouseEnterTimeout")||this.defaults.itemMouseEnterTimeout;this.submenuDirection=this.$menu.attr("data-submenuDirection")||this.defaults.submenuDirection;this.activeMenuClassName=this.$menu.attr("data-activeMenuClassName")||this.defaults.activeMenuClassName;this.$hiddenFrom=this.$submenus=this.$items=this.$window=void 0;this.subMenuOnHover=this.menuOnHover=this.timeoutSet=this.overThresholdX=!1;this.thresholdID=
this.menuMouseEnterID=this.currentY=this.currentX=this.prevY=this.prevX=0;this.currentSubMenuIndex=this.currentItemIndex=-1;this.isMenuFloating=!1;this.isMenuVisible=!0;this.menuHeight=this.hiddenFromOffsetTop=this.menuOffsetTop=0;this.getElements()};f.prototype={defaults:{selectors:{item:".nav-one01",submenu:".riCmnSideDDMSecTree",hiddenFrom:""},activeMenuClassName:"active",floating:!1,menuMouseEnterTimeout:50,menuMouseEnterInterval:20,menuMouseEnterRange:0.3,menuMouseEnterMinPixel:2,itemMouseEnterTimeout:600,
submenuDirection:"right-bottom"},getElements:function(){this.$items=this.$menu.find(this.itemSelector);this.$submenus=this.$items.find(this.submenuSelector);if(this.floating){if(this.hiddenFromSelector)this.$hiddenFrom=d(this.hiddenFromSelector),this.hiddenFromOffsetTop=this.$hiddenFrom.offset().top,this.menuHeight=this.$menu.outerHeight(!0);this.menuOffsetTop=this.$menu.offset().top}this.bindEvents()},bindEvents:function(){var a=this;g?(this.$items.each(function(b,c){var e=d(c),f=a.$submenus.eq(b);
e.bind("click",function(){f.is(":visible")?a.$submenus.hide():a.$submenus.hide().eq(b).show()})}),d("body").bind("touchstart",function(){a.$submenus.hide()}),this.$menu.bind("touchstart",function(a){a.stopPropagation()})):(this.$menu.hover(function(){a.overThresholdX=!1;a.menuOnHover=!0;a.prevX=a.currentX;a.prevY=a.currentY;setTimeout(function(){a.menuMouseEnterID=setInterval(function(){var b,c;"right-bottom"===a.submenuDirection?(b=a.currentX-a.prevX,c=a.currentY-a.prevY):"right"===a.submenuDirection&&
(b=a.currentX-a.prevX,c=Math.abs(a.currentY-a.prevY));if(0<b)if(b/c>=a.menuMouseEnterRange){if(b+c>a.menuMouseEnterMinPixel)a.overThresholdX=!0}else a.overThresholdX=!1;a.prevX=a.currentX;a.prevY=a.currentY},a.menuMouseEnterInterval)},a.menuMouseEnterTimeout)},function(){a.menuOnHover=!1;clearInterval(a.menuMouseEnterID);a.$submenus.eq(a.currentSubMenuIndex).hide();a.$items.eq(a.currentSubMenuIndex).removeClass(a.activeMenuClassName);a.currentSubMenuIndex=-1}).bind("mousemove",function(b){a.currentX=
b.pageX;a.currentY=b.pageY}),a.$items.each(function(b,c){var e=d(c);e.bind("mouseenter",function(){a.currentItemIndex=b;if(a.overThresholdX){if(!a.timeoutSet)a.timeoutSet=!0,a.thresholdID=setTimeout(function(){a.overThresholdX=!1;a.timeoutSet=!1;a.menuOnHover&&a.$items.eq(a.currentItemIndex).trigger("mouseenter")},a.itemMouseEnterTimeout)}else-1===a.currentSubMenuIndex?(a.$submenus.eq(b).show(),e.addClass(a.activeMenuClassName),a.currentSubMenuIndex=b):(a.$submenus.eq(a.currentSubMenuIndex).hide(),
a.$items.eq(a.currentSubMenuIndex).removeClass(a.activeMenuClassName),a.currentSubMenuIndex=b,a.$submenus.eq(b).show(),e.addClass(a.activeMenuClassName))}).bind("mouseleave",function(){clearTimeout(a.itemMouseEnterTimeout)})}),a.$submenus.hover(function(){a.subMenuOnHover=!0;a.overThresholdX=!1},function(){a.subMenuOnHover=!1;clearTimeout(a.thresholdID);a.timeoutSet=!1;a.overThresholdX=!1}),this.floating&&this.$window.bind("scroll",function(){var b=a.$window.scrollTop();if(a.menuOffsetTop<=b){if(!a.isMenuFloating)a.$menu.css({position:"fixed",
top:"0px"}),a.isMenuFloating=!0}else if(a.isMenuFloating)a.$menu.css({position:"static",top:"auto"}),a.isMenuFloating=!1;if(a.hiddenFromSelector)if(b+a.menuHeight<a.hiddenFromOffsetTop){if(a.isMenuVisible)a.$menu.hide(),a.isMenuVisible=!1}else if(!isMenuVisible)a.$menu.show(),a.isMenuVisible=!0}))}}}})();
