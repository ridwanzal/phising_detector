var mainpage=mainpage||{};var pix=pix||{};var _gaq=_gaq||[];mainpage.popup_args=null;mainpage.popupLoader=function(url,args){$("#popup .popup-box").load(url,null,mainpage.showbox);mainpage.popup_args=args||{};return false};mainpage.showbox=function(){$("#page-body select").hide();$("#dimmer, #popup").show();if(mainpage.popup_args.top){$("#popup").css("top",mainpage.popup_args.top)}if(mainpage.popup_args.left){$("#popup").css("left",mainpage.popup_args.left)}if(mainpage.popup_args.right){$("#popup").css("right",mainpage.popup_args.right)}if(!mainpage.popup_args.noscroll){$(window).scrollTop($("#popup").offset().top-60)}return false};mainpage.hidebox=function(){$("#dimmer, #popup").hide();$("#page-body select").show();if(mainpage.popup_args.refresh){document.location=document.location}return false};mainpage.blog_spotlight_mouseover=function(){$(".spotlight-tabs li").mouseover(function(){$(".spotlight-feature").hide();$("#spotlight-feature-"+$(this).attr("data-top")).show()});$(".spotlight-tabs li:first").mouseover();return false};mainpage.blog_spotlight_slideto_left=function(){$("#LeftBtn").on("click",function(e){prev=$("#topic-spotlight-page").find("a.active span").html()-1;img_width=$(".topic-spotlight-image img").width();if(prev>0){$(".topic-spotlight-image img").css("position","relative").animate({left:"+="+img_width+"px"},{duration:100,queue:true})}else{$(".topic-spotlight-image img").css("position","relative").animate({left:"+="+-6*img_width+"px"},{duration:100,queue:true});prev=7}mainpage.blog_spotlight_activepage_set(prev);mainpage.blog_spotlight_title_set(prev);$("#spotlight_img_"+prev).css("visibility","visible")});return false};mainpage.blog_spotlight_slideto_right=function(){$("#RightBtn").on("click",function(e){next=parseInt($("#topic-spotlight-page").find("a.active span").html())+1;img_width=$(".topic-spotlight-image img").width();if(next<=7){$(".topic-spotlight-image img").css("position","relative").animate({left:"-="+img_width+"px"},{duration:100,queue:true})}else{$(".topic-spotlight-image img").css("position","relative").animate({left:"+="+6*img_width+"px"},{duration:100,queue:true});next=1}mainpage.blog_spotlight_activepage_set(next);mainpage.blog_spotlight_title_set(next);$("#spotlight_img_"+next).css("visibility","visible")});return false};mainpage.blog_spotlight_slideto_specific_page=function(){$(".pagetab").on("click",function(e){index=$(this).text();current=parseInt($("#topic-spotlight-page").find("a.active span").html());if(index>0&&index<=7){img_width=$(".topic-spotlight-image img").width();$(".topic-spotlight-image img").css("position","relative").animate({left:"+="+(current-index)*img_width+"px"},{duration:100,queue:true});mainpage.blog_spotlight_activepage_set(index);mainpage.blog_spotlight_title_set(index);$("#spotlight_img_"+index).css("visibility","visible")}});return false};mainpage.blog_spotlight_set=function(index){for(var i=1;i<=7;i++){$("#spotlight_img_"+i).css({position:"relative","z-index":"-1",left:"-"+(index-1)*590+"px"})}$("#spotlight_img_"+index).css("visibility","visible");return false};mainpage.blog_spotlight_activepage_set=function(index){for(var i=1;i<=7;i++){if(i==index){$("#pagetab_"+i).addClass("active")}else{$("#pagetab_"+i).removeClass("active")}}return false};mainpage.blog_spotlight_title_set=function(index){if(index>0&&index<=7){$.post("/blog/getTitle",{index:index},function(e){if(!e.error){$(".topic-spotlight-tag").css("color","#fff").html(e.tag);$(".topic-spotlight-title").html(e.title);$(".trace-click").attr("href",e.link);$(".trace-click").attr("data-counterlink",e.counterlink)}})}return false};mainpage.blog_display_more=function(){var show_more=function(e){var dom=$("#"+$(this).attr("data-id"));dom.text(dom.data("origin"));e.preventDefault()};$(".hide-more").each(function(){var self=$(this);if(self.attr("data-summary")){self.data("origin",self.text());self.text(self.attr("data-summary")+"...(");self.append($("<a></a>").attr("href","#").text(self.attr("data-wording-more")).attr("data-id",self.attr("id")).click(show_more));self.append(")")}});mainpage.blog_popup_click()};mainpage.blog_popup_click=function(){$(".popup-click:not(.popup-click-done)").each(function(){var self=$(this);var options={};if(self.attr("data-width")){options.width=self.attr("data-width")}if(self.attr("data-height")){options.height=self.attr("data-height")}pix.iframePopup.init("#popup-frame",self.attr("data-url"),self,$("#popup-frame .frame-close"),self.attr("data-title"),options);self.addClass("popup-click-done")})};mainpage.blog_sidebar_ga_event=function(){$("#blogger-articles-liked").find(".article-list li").on("click","h4 > a",function(){_gaq.push(["_trackEvent","ProfileClick","Push Title",""])});$("#blogger-feed").find("a.more").on("click",function(){_gaq.push(["_trackEvent","ProfileClick","Blogger Feed: More News Link",""])});$("#blogger-box").find(".box-header").on("click",".blogger-subscription",function(){_gaq.push(["_trackEvent","ProfileClick","Header: Follow Link",""])});$("#follow-recommend").on("click",".blogger-subscription",function(){_gaq.push(["_trackEvent","ProfileClick","Follow Recommend: Proposed Follow Link",""])})};mainpage.blog_blogger_subscription=function(panel_site){$("body").delegate(".blogger-subscription","click",function(){var user=$(this).attr("data-user");window.open("http://"+panel_site+"/pixfront/addsubspopup?fromuser="+user+"&user="+user+"&popup=1","pix_add_sub","width=340,height=236")})};mainpage.blog_blogger_celebrity=function(){$("#featured-bloggers .function_flip li").mouseover(function(){$("#featured-bloggers .list-feature").hide();$("#list-feature-"+$(this).attr("data-user")).show();$("#featured-bloggers .function_flip li").removeClass("active");$(this).addClass("active")});$("#featured-bloggers .function_flip .control .prev").click(function(e){e.preventDefault();var obj=$("#featured-bloggers .function_flip li.active").prev();if(obj.length){obj.mouseover()}else{$("#featured-bloggers .function_flip li:last").mouseover()}});$("#featured-bloggers .function_flip .control .next").click(function(e){e.preventDefault();var obj=$("#featured-bloggers .function_flip li.active").next();if(obj.length){obj.mouseover()}else{$("#featured-bloggers .function_flip li:first").mouseover()}});$("#featured-bloggers .function_flip li:first").mouseover()};mainpage.blog_friend_subscription=function(){$(".load-my-friend-subscription:not(.finished)").each(function(){var self=$(this);var user=self.attr("data-user");self.addClass("finished");self.hide();$.get("/blog/getmyfriendsubscription?blogger="+encodeURIComponent(user),function(ret){var id;self.text("");if(ret.count>2){id="#subscription-friends-more"}else if(2==ret.length){id="#subscription-friends-two"}else if(1==ret.length){id="#subscription-friends-one"}else{return}self.show();$(id).tmpl(ret).appendTo(self);mainpage.blog_popup_click()},"json")})};mainpage.blog_hot_list_update=function(){var funcLinksId="",bloggerArticles=$("#blogger-articles-hot"),bloggerArticlesList=bloggerArticles.find(".article-list"),bloggerArticlesListFunctions=bloggerArticles.find(".list-functions li"),switch_func=function(type){bloggerArticlesList.hide();$("#article-list-"+type).show();bloggerArticlesListFunctions.removeClass("active");$("#blogger-articles-hot-li-"+type).addClass("active")};bloggerArticlesListFunctions.click(function(e){e.preventDefault();funcLinksId=$(this).attr("id");if("blogger-articles-hot-li-total"==funcLinksId){_gaq.push(["_trackEvent","ProfileClick","Hot Article: All Hot",""])}else if("blogger-articles-hot-li-weekly"==funcLinksId){_gaq.push(["_trackEvent","ProfileClick","Hot Article: Recent Hot",""])}switch_func(funcLinksId.split("-")[4])});bloggerArticlesList.on("click","h4 > a",function(e){_gaq.push(["_trackEvent","ProfileClick","Hot Article Title",""])});switch_func("total")};mainpage.blog_blogger_articles_columns_more=function(){var bloggerArticlesColumns=$("#blogger-articles-columns"),bloggerArticlesColumnsList=bloggerArticlesColumns.find("ol.article-list"),loadMoreBtn=bloggerArticlesColumns.find(".load_more");bloggerArticlesColumnsList.find("li").on("click","h4 > a",function(){_gaq.push(["_trackEvent","ProfileClick","Column Title",""])});bloggerArticlesColumnsList.find("li:gt(1)").hide();if(bloggerArticlesColumnsList.find("li").length<2){loadMoreBtn.hide();return}loadMoreBtn.click(function(e){e.preventDefault();bloggerArticlesColumnsList.find("li").show();$(this).hide()})};mainpage.blog_blogger_get_recommend=function(blogger){var pushed_cb_count=0;var get_subscription_friends=function(dom,url,cb){var user_pools=dom.data("user_pools")||[];var loading=dom.data("loading")||false;var last_id=dom.data("last_id")||0;if(last_id!=-1&&user_pools.length<4&&!loading){dom.data("loading",true);$.get(url,{after:last_id},function(ret){if(ret.error){return}for(var i=0;i<ret.users.length;i++){user_pools.push(ret.users[i].data)}dom.data("user_pools",user_pools);dom.data("last_id",ret.last_id);var queues=dom.data("queues")||[];var queued_cb;while(queued_cb=queues.shift()){get_subscription_friends(dom,url,queued_cb)}dom.data("queues",[]);dom.data("loading",false)},"json")}if(user_pools.length>0){cb(dom,user_pools.shift());dom.data("user_pools",user_pools)}else{if(last_id==-1){return}if(pushed_cb_count++>1e3){return}var queues=dom.data("queues")||[];queues.push(cb);dom.data("queues",queues)}};var fill_users=function(dom,cb){get_subscription_friends(dom,dom.attr("data-url"),function(dom,data){$("#tmpl-follow-recommend").tmpl(data).appendTo(dom);if("undefined"!==typeof cb){cb()}mainpage.blog_friend_subscription();if(dom.children("li").length<2){fill_users(dom)}})};$("#follow-recommend").delegate(".delete","click",function(e){e.preventDefault();var self=$(this);var ul=self.parents("ul");self.parents("li").remove();fill_users(ul)});fill_users($("#follow-recommend-1"));fill_users($("#follow-recommend-2"),function(){if($("#follow-recommend-2 li").length>0){$("#follow-recommend .sub_title").show()}})};mainpage.famous_random=function(){var boxes=$("div#famous div.box-text div.famous-box");var pos=Math.floor(boxes.length*Math.random());boxes.hide();boxes.eq(pos).show();$("#famous .more a").attr("href",boxes.eq(pos).find(".famous-name span a").attr("href"))};mainpage.init_index_famous=function(){$.get("/",{block:"index_famous",nocache:pix.nocache,demo_ad_no:pix.demo_ad_no,demo_ad_sig:pix.demo_ad_sig},function(ret){$("div#famous div.box-text").html(ret);mainpage.famous_random()})};mainpage.rotateAnnounce=function(){var announces=$("div.announce a.announce-a");var index=announces.index($("div.announce a.announce-a.current"));announces.hide().removeClass("current");if(announces.eq(index+1).length){announces.eq(index+1).addClass("current").show()}else{announces.eq(0).addClass("current").show()}};mainpage.init_announce=function(){$(document).everyTime(5e3,"none",mainpage.rotateAnnounce)};mainpage.index_channel_loading=[];mainpage.index_channel_overed=[];mainpage.index_change_menu_channel=function(channel){$("#channel .menu-channel").each(function(index){var cha=$("#channel .menu-channel").eq(index).attr("id").split("-")[2];$("#channel #menu-channel-"+cha).removeClass("current").removeClass("current-"+cha)});$("#channel #menu-channel-"+channel).addClass("current").addClass("current-"+channel);if(!$("#channel div.bin-main#channel-bin-main-"+channel).length){if(mainpage.index_channel_loading[channel]){return}mainpage.index_channel_loading[channel]=true;$.get("/",{block:"index_channel",channel:channel,demo_ad_no:pix.demo_ad_no,demo_ad_sig:pix.demo_ad_sig,nocache:pix.nocache},function(ret){$("#channel").append(ret);$("#channel div.bin-main").hide();$("#channel div.bin-main#channel-bin-main-"+channel).show()})}else{$("#channel div.bin-main").hide();$("#channel div.bin-main#channel-bin-main-"+channel).show()}};mainpage.init_index_channel=function(){$("li.menu-channel").live("click",function(){var channel=$(this).attr("id").split("-")[2];if(!mainpage.index_channel_overed[channel]){$.get("/count.php?type=MainPage_FocusMenuClick&pos="+channel)}mainpage.index_channel_overed[channel]=true;mainpage.index_change_menu_channel(channel)});var data_assigned_focus_id=parseInt($("#assigned-focus").attr("data-assigned-focus-id"),10);var data_assigned_focus_channel=$("#assigned-focus").attr("data-assigned-focus-channel");if(!isNaN(data_assigned_focus_id)&&data_assigned_focus_id!=$.cookie("stored_assigned_focus_id")){mainpage.index_change_menu_channel(data_assigned_focus_channel);$.cookie("stored_assigned_focus_id",data_assigned_focus_id,{path:"/",expires:365})}else{mainpage.index_change_menu_channel($(".menu-channel").eq(Math.floor($(".menu-channel").length*Math.random())).attr("id").split("-")[2])}};mainpage.index_blog_menu=null;mainpage.index_blog_loading=[];mainpage.index_blog_overed=[];mainpage.index_blog_column_overed=[];mainpage.index_blog_change_menu=function(id){mainpage.index_blog_menu=id;$("#blog .menu .menu-option").removeClass("current");$("#blog .menu #blog-menu-"+id).addClass("current")};mainpage.index_blog_fetch_content=function(){var id="";if(mainpage.index_blog_menu=="column"){id="#blog .bin-main .inner#blog-content-"+mainpage.index_blog_menu+"-"+mainpage.index_blog_menu2}else{id="#blog .bin-main .inner#blog-content-"+mainpage.index_blog_menu}if(0===$(id).length){if(mainpage.index_blog_loading[id]){return}mainpage.index_blog_loading[id]=true;$.get("/",{block:"index_blog",menu:mainpage.index_blog_menu,type:mainpage.index_blog_menu2,demo_ad_no:pix.demo_ad_no,demo_ad_sig:pix.demo_ad_sig,nocache:pix.nocache,preview_model:pix.preview_model,preview_id:pix.preview_id,preview_sig:pix.preview_sig},function(ret){$("#blog .bin-main").prepend(ret);$("#blog .bin-main .inner").hide();$("#blog .bin-main .bin-footer").hide();if(-1==mainpage.index_blog_menu2){mainpage.index_blog_menu2=$("#blog .inner.column").attr("id").split("-",4)[3];id="#blog .bin-main .inner#blog-content-"+mainpage.index_blog_menu+"-"+mainpage.index_blog_menu2}$(id).show();if("column"==mainpage.index_blog_menu){$("#blog-footer-column-"+mainpage.index_blog_menu2).show()}else{$("#blog-footer-"+mainpage.index_blog_menu).show()}$("#blog-menu-option-"+mainpage.index_blog_menu2).addClass("current")})}else{$("#blog .bin-main .inner").hide();$("#blog .bin-main .bin-footer").hide();$(id).show();if("column"==mainpage.index_blog_menu){$("#blog-footer-column-"+mainpage.index_blog_menu2).show()}else{$("#blog-footer-"+mainpage.index_blog_menu).show()}}};mainpage.init_index_blog=function(){mainpage.index_blog_menu="column";mainpage.index_blog_menu2=-1;$("#blog .menu-2 .menu-option").live("click",function(){var id=$(this).attr("id").split("-")[3];if(!mainpage.index_blog_column_overed[id]){$.get("/count.php?type=MainPage_ArticleColumnIndexClick&pos=column-"+id);mainpage.index_blog_column_overed[id]=true}});$("#blog .menu .menu-option").live("click",function(){var id=$(this).attr("id").split("-")[2];if(!mainpage.index_blog_overed[id]){$.get("/count.php?type=MainPage_ArticleColumnIndexClick&pos="+id)}mainpage.index_blog_overed[id]=true;mainpage.index_blog_change_menu(id);mainpage.index_blog_fetch_content()});mainpage.index_blog_change_menu(mainpage.index_blog_menu);mainpage.index_blog_fetch_content()};mainpage.init_recommend_search_result=function(){$("div.recommended-result a").click(function(){var id=$(this).parents("div.blog-grid, div.activity-grid").attr("id");$.get("/count.php?type=MainPage_SearchResultRecommend&id="+id)})};mainpage.topicCountdown=function(deadline,div){var info="",now=parseInt((new Date).getTime()/1e3,10),target=$(div),format=function(diff){if(0>=diff){return"Live 直播中"}var str="倒數 "+parseInt(diff/(60*60),10)%(60*60)+" 小時 ";str+=parseInt(diff/60,10)%60+" 分 ";str+=diff%60+" 秒";return str};info=format(deadline-now);target.find(".countdown").text(info);if(info!="Live 直播中"){setTimeout("mainpage.topicCountdown("+deadline+",'"+div+"')",1e3)}};mainpage.bind_index_ga_event=function(){var hotArticles=$("#hot-articles").find("li"),hotBloggers=$("#hot-bloggers"),hotBloggersList=hotBloggers.find("li > h3"),eventLable="";$("#navigation").on("click","li",function(){_gaq.push(["_trackEvent","IndexClick","Tab",eventLable])});hotArticles.find("h3").on("click","a",function(){_gaq.push(["_trackEvent","IndexClick","Hot Article: Title",eventLable])});hotArticles.find(".author").on("click",function(){_gaq.push(["_trackEvent","IndexClick","Hot Article: Blogger Name",eventLable])});hotBloggersList.on("click","a.author",function(){_gaq.push(["_trackEvent","IndexClick","Hot Blogger: Blogger Name",eventLable])});hotBloggersList.on("click","a.blog-title",function(){_gaq.push(["_trackEvent","IndexClick","Hot Blogger: Blog Name",eventLable])});hotBloggers.on("click","a.more",function(){_gaq.push(["_trackEvent","IndexClick","Hot Top 100 Bloggers Blog",eventLable])});$("#category-index").find(".category-headlines").on("click","li > a, h3 > a",function(){_gaq.push(["_trackEvent","IndexClick","Category Index: Hot Article Title",eventLable])})};mainpage.autoCheckKeepLogin=function(){var neverAutoKeepLogin="never-auto-check-keep-login";$("#keeplogin").on("change",function(){localStorage.setItem(neverAutoKeepLogin,1)});if(1==localStorage.getItem(neverAutoKeepLogin)){$("#keeplogin").prop("checked",false)}};
