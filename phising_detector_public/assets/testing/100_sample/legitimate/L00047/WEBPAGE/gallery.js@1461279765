function flashElement(a,b,c){"undefined"==typeof b&&(b=100),null==c&&(c="#181817"),$(a).animate({backgroundColor:"#85BF25"},b,function(){$(this).animate({backgroundColor:c},b)})}!function(a,b){function c(b,c){var e,f,g,h=b.nodeName.toLowerCase();return"area"===h?(e=b.parentNode,f=e.name,b.href&&f&&"map"===e.nodeName.toLowerCase()?(g=a("img[usemap=#"+f+"]")[0],!!g&&d(g)):!1):(/input|select|textarea|button|object/.test(h)?!b.disabled:"a"===h?b.href||c:c)&&d(b)}function d(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}var e=0,f=/^ui-id-\d+$/;a.ui=a.ui||{},a.extend(a.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({focus:function(b){return function(c,d){return"number"==typeof c?this.each(function(){var b=this;setTimeout(function(){a(b).focus(),d&&d.call(b)},c)}):b.apply(this,arguments)}}(a.fn.focus),scrollParent:function(){var b;return b=a.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.css(this,"position"))&&/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(c){if(c!==b)return this.css("zIndex",c);if(this.length)for(var d,e,f=a(this[0]);f.length&&f[0]!==document;){if(d=f.css("position"),("absolute"===d||"relative"===d||"fixed"===d)&&(e=parseInt(f.css("zIndex"),10),!isNaN(e)&&0!==e))return e;f=f.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})},removeUniqueId:function(){return this.each(function(){f.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(c){return!!a.data(c,b)}}):function(b,c,d){return!!a.data(b,d[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var d=a.attr(b,"tabindex"),e=isNaN(d);return(e||d>=0)&&c(b,!e)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(c,d){function e(b,c,d,e){return a.each(f,function(){c-=parseFloat(a.css(b,"padding"+this))||0,d&&(c-=parseFloat(a.css(b,"border"+this+"Width"))||0),e&&(c-=parseFloat(a.css(b,"margin"+this))||0)}),c}var f="Width"===d?["Left","Right"]:["Top","Bottom"],g=d.toLowerCase(),h={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+d]=function(c){return c===b?h["inner"+d].call(this):this.each(function(){a(this).css(g,e(this,c)+"px")})},a.fn["outer"+d]=function(b,c){return"number"!=typeof b?h["outer"+d].call(this,b):this.each(function(){a(this).css(g,e(this,b,!0,c)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=function(b){return function(c){return arguments.length?b.call(this,a.camelCase(c)):b.call(this)}}(a.fn.removeData)),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.support.selectstart="onselectstart"in document.createElement("div"),a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.extend(a.ui,{plugin:{add:function(b,c,d){var e,f=a.ui[b].prototype;for(e in d)f.plugins[e]=f.plugins[e]||[],f.plugins[e].push([c,d[e]])},call:function(a,b,c){var d,e=a.plugins[b];if(e&&a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType)for(d=0;d<e.length;d++)a.options[e[d][0]]&&e[d][1].apply(a.element,c)}},hasScroll:function(b,c){if("hidden"===a(b).css("overflow"))return!1;var d=c&&"left"===c?"scrollLeft":"scrollTop",e=!1;return b[d]>0?!0:(b[d]=1,e=b[d]>0,b[d]=0,e)}})}(jQuery),function(a,b){var c=0,d=Array.prototype.slice,e=a.cleanData;a.cleanData=function(b){for(var c,d=0;null!=(c=b[d]);d++)try{a(c).triggerHandler("remove")}catch(f){}e(b)},a.widget=function(b,c,d){var e,f,g,h,i={},j=b.split(".")[0];b=b.split(".")[1],e=j+"-"+b,d||(d=c,c=a.Widget),a.expr[":"][e.toLowerCase()]=function(b){return!!a.data(b,e)},a[j]=a[j]||{},f=a[j][b],g=a[j][b]=function(a,b){return this._createWidget?void(arguments.length&&this._createWidget(a,b)):new g(a,b)},a.extend(g,f,{version:d.version,_proto:a.extend({},d),_childConstructors:[]}),h=new c,h.options=a.widget.extend({},h.options),a.each(d,function(b,d){return a.isFunction(d)?void(i[b]=function(){var a=function(){return c.prototype[b].apply(this,arguments)},e=function(a){return c.prototype[b].apply(this,a)};return function(){var b,c=this._super,f=this._superApply;return this._super=a,this._superApply=e,b=d.apply(this,arguments),this._super=c,this._superApply=f,b}}()):void(i[b]=d)}),g.prototype=a.widget.extend(h,{widgetEventPrefix:f?h.widgetEventPrefix||b:b},i,{constructor:g,namespace:j,widgetName:b,widgetFullName:e}),f?(a.each(f._childConstructors,function(b,c){var d=c.prototype;a.widget(d.namespace+"."+d.widgetName,g,c._proto)}),delete f._childConstructors):c._childConstructors.push(g),a.widget.bridge(b,g)},a.widget.extend=function(c){for(var e,f,g=d.call(arguments,1),h=0,i=g.length;i>h;h++)for(e in g[h])f=g[h][e],g[h].hasOwnProperty(e)&&f!==b&&(c[e]=a.isPlainObject(f)?a.isPlainObject(c[e])?a.widget.extend({},c[e],f):a.widget.extend({},f):f);return c},a.widget.bridge=function(c,e){var f=e.prototype.widgetFullName||c;a.fn[c]=function(g){var h="string"==typeof g,i=d.call(arguments,1),j=this;return g=!h&&i.length?a.widget.extend.apply(null,[g].concat(i)):g,this.each(h?function(){var d,e=a.data(this,f);return e?a.isFunction(e[g])&&"_"!==g.charAt(0)?(d=e[g].apply(e,i),d!==e&&d!==b?(j=d&&d.jquery?j.pushStack(d.get()):d,!1):void 0):a.error("no such method '"+g+"' for "+c+" widget instance"):a.error("cannot call methods on "+c+" prior to initialization; attempted to call method '"+g+"'")}:function(){var b=a.data(this,f);b?b.option(g||{})._init():a.data(this,f,new e(g,this))}),j}},a.Widget=function(){},a.Widget._childConstructors=[],a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,d){d=a(d||this.defaultElement||this)[0],this.element=a(d),this.uuid=c++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=a.widget.extend({},this.options,this._getCreateOptions(),b),this.bindings=a(),this.hoverable=a(),this.focusable=a(),d!==this&&(a.data(d,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===d&&this.destroy()}}),this.document=a(d.style?d.ownerDocument:d.document||d),this.window=a(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},option:function(c,d){var e,f,g,h=c;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof c)if(h={},e=c.split("."),c=e.shift(),e.length){for(f=h[c]=a.widget.extend({},this.options[c]),g=0;g<e.length-1;g++)f[e[g]]=f[e[g]]||{},f=f[e[g]];if(c=e.pop(),1===arguments.length)return f[c]===b?null:f[c];f[c]=d}else{if(1===arguments.length)return this.options[c]===b?null:this.options[c];h[c]=d}return this._setOptions(h),this},_setOptions:function(a){var b;for(b in a)this._setOption(b,a[b]);return this},_setOption:function(a,b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!b).attr("aria-disabled",b),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(b,c,d){var e,f=this;"boolean"!=typeof b&&(d=c,c=b,b=!1),d?(c=e=a(c),this.bindings=this.bindings.add(c)):(d=c,c=this.element,e=this.widget()),a.each(d,function(d,g){function h(){return b||f.options.disabled!==!0&&!a(this).hasClass("ui-state-disabled")?("string"==typeof g?f[g]:g).apply(f,arguments):void 0}"string"!=typeof g&&(h.guid=g.guid=g.guid||h.guid||a.guid++);var i=d.match(/^(\w+)\s*(.*)$/),j=i[1]+f.eventNamespace,k=i[2];k?e.delegate(k,j,h):c.bind(j,h)})},_off:function(a,b){b=(b||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,a.unbind(b).undelegate(b)},_delay:function(a,b){function c(){return("string"==typeof a?d[a]:a).apply(d,arguments)}var d=this;return setTimeout(c,b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b),this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b),this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,c,d){var e,f,g=this.options[b];if(d=d||{},c=a.Event(c),c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase(),c.target=this.element[0],f=c.originalEvent)for(e in f)e in c||(c[e]=f[e]);return this.element.trigger(c,d),!(a.isFunction(g)&&g.apply(this.element[0],[c].concat(d))===!1||c.isDefaultPrevented())}},a.each({show:"fadeIn",hide:"fadeOut"},function(b,c){a.Widget.prototype["_"+b]=function(d,e,f){"string"==typeof e&&(e={effect:e});var g,h=e?e===!0||"number"==typeof e?c:e.effect||c:b;e=e||{},"number"==typeof e&&(e={duration:e}),g=!a.isEmptyObject(e),e.complete=f,e.delay&&d.delay(e.delay),g&&a.effects&&a.effects.effect[h]?d[b](e):h!==b&&d[h]?d[h](e.duration,e.easing,f):d.queue(function(c){a(this)[b](),f&&f.call(d[0]),c()})}})}(jQuery),function(a){var b=!1;a(document).mouseup(function(){b=!1}),a.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){return!0===a.data(c.target,b.widgetName+".preventClickEvent")?(a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(c){if(!b){this._mouseStarted&&this._mouseUp(c),this._mouseDownEvent=c;var d=this,e=1===c.which,f="string"==typeof this.options.cancel&&c.target.nodeName?a(c.target).closest(this.options.cancel).length:!1;return e&&!f&&this._mouseCapture(c)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(c)&&this._mouseDelayMet(c)&&(this._mouseStarted=this._mouseStart(c)!==!1,!this._mouseStarted)?(c.preventDefault(),!0):(!0===a.data(c.target,this.widgetName+".preventClickEvent")&&a.removeData(c.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),c.preventDefault(),b=!0,!0)):!0}},_mouseMove:function(b){return a.ui.ie&&(!document.documentMode||document.documentMode<9)&&!b.button?this._mouseUp(b):this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted)},_mouseUp:function(b){return a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target===this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(a,b){function c(a,b,c){return[parseFloat(a[0])*(n.test(a[0])?b/100:1),parseFloat(a[1])*(n.test(a[1])?c/100:1)]}function d(b,c){return parseInt(a.css(b,c),10)||0}function e(b){var c=b[0];return 9===c.nodeType?{width:b.width(),height:b.height(),offset:{top:0,left:0}}:a.isWindow(c)?{width:b.width(),height:b.height(),offset:{top:b.scrollTop(),left:b.scrollLeft()}}:c.preventDefault?{width:0,height:0,offset:{top:c.pageY,left:c.pageX}}:{width:b.outerWidth(),height:b.outerHeight(),offset:b.offset()}}a.ui=a.ui||{};var f,g=Math.max,h=Math.abs,i=Math.round,j=/left|center|right/,k=/top|center|bottom/,l=/[\+\-]\d+(\.[\d]+)?%?/,m=/^\w+/,n=/%$/,o=a.fn.position;a.position={scrollbarWidth:function(){if(f!==b)return f;var c,d,e=a("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),g=e.children()[0];return a("body").append(e),c=g.offsetWidth,e.css("overflow","scroll"),d=g.offsetWidth,c===d&&(d=e[0].clientWidth),e.remove(),f=c-d},getScrollInfo:function(b){var c=b.isWindow||b.isDocument?"":b.element.css("overflow-x"),d=b.isWindow||b.isDocument?"":b.element.css("overflow-y"),e="scroll"===c||"auto"===c&&b.width<b.element[0].scrollWidth,f="scroll"===d||"auto"===d&&b.height<b.element[0].scrollHeight;return{width:f?a.position.scrollbarWidth():0,height:e?a.position.scrollbarWidth():0}},getWithinInfo:function(b){var c=a(b||window),d=a.isWindow(c[0]),e=!!c[0]&&9===c[0].nodeType;return{element:c,isWindow:d,isDocument:e,offset:c.offset()||{left:0,top:0},scrollLeft:c.scrollLeft(),scrollTop:c.scrollTop(),width:d?c.width():c.outerWidth(),height:d?c.height():c.outerHeight()}}},a.fn.position=function(b){if(!b||!b.of)return o.apply(this,arguments);b=a.extend({},b);var f,n,p,q,r,s,t=a(b.of),u=a.position.getWithinInfo(b.within),v=a.position.getScrollInfo(u),w=(b.collision||"flip").split(" "),x={};return s=e(t),t[0].preventDefault&&(b.at="left top"),n=s.width,p=s.height,q=s.offset,r=a.extend({},q),a.each(["my","at"],function(){var a,c,d=(b[this]||"").split(" ");1===d.length&&(d=j.test(d[0])?d.concat(["center"]):k.test(d[0])?["center"].concat(d):["center","center"]),d[0]=j.test(d[0])?d[0]:"center",d[1]=k.test(d[1])?d[1]:"center",a=l.exec(d[0]),c=l.exec(d[1]),x[this]=[a?a[0]:0,c?c[0]:0],b[this]=[m.exec(d[0])[0],m.exec(d[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===b.at[0]?r.left+=n:"center"===b.at[0]&&(r.left+=n/2),"bottom"===b.at[1]?r.top+=p:"center"===b.at[1]&&(r.top+=p/2),f=c(x.at,n,p),r.left+=f[0],r.top+=f[1],this.each(function(){var e,j,k=a(this),l=k.outerWidth(),m=k.outerHeight(),o=d(this,"marginLeft"),s=d(this,"marginTop"),y=l+o+d(this,"marginRight")+v.width,z=m+s+d(this,"marginBottom")+v.height,A=a.extend({},r),B=c(x.my,k.outerWidth(),k.outerHeight());"right"===b.my[0]?A.left-=l:"center"===b.my[0]&&(A.left-=l/2),"bottom"===b.my[1]?A.top-=m:"center"===b.my[1]&&(A.top-=m/2),A.left+=B[0],A.top+=B[1],a.support.offsetFractions||(A.left=i(A.left),A.top=i(A.top)),e={marginLeft:o,marginTop:s},a.each(["left","top"],function(c,d){a.ui.position[w[c]]&&a.ui.position[w[c]][d](A,{targetWidth:n,targetHeight:p,elemWidth:l,elemHeight:m,collisionPosition:e,collisionWidth:y,collisionHeight:z,offset:[f[0]+B[0],f[1]+B[1]],my:b.my,at:b.at,within:u,elem:k})}),b.using&&(j=function(a){var c=q.left-A.left,d=c+n-l,e=q.top-A.top,f=e+p-m,i={target:{element:t,left:q.left,top:q.top,width:n,height:p},element:{element:k,left:A.left,top:A.top,width:l,height:m},horizontal:0>d?"left":c>0?"right":"center",vertical:0>f?"top":e>0?"bottom":"middle"};l>n&&h(c+d)<n&&(i.horizontal="center"),m>p&&h(e+f)<p&&(i.vertical="middle"),i.important=g(h(c),h(d))>g(h(e),h(f))?"horizontal":"vertical",b.using.call(this,a,i)}),k.offset(a.extend(A,{using:j}))})},a.ui.position={fit:{left:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollLeft:d.offset.left,f=d.width,h=a.left-b.collisionPosition.marginLeft,i=e-h,j=h+b.collisionWidth-f-e;b.collisionWidth>f?i>0&&0>=j?(c=a.left+i+b.collisionWidth-f-e,a.left+=i-c):a.left=j>0&&0>=i?e:i>j?e+f-b.collisionWidth:e:i>0?a.left+=i:j>0?a.left-=j:a.left=g(a.left-h,a.left)},top:function(a,b){var c,d=b.within,e=d.isWindow?d.scrollTop:d.offset.top,f=b.within.height,h=a.top-b.collisionPosition.marginTop,i=e-h,j=h+b.collisionHeight-f-e;b.collisionHeight>f?i>0&&0>=j?(c=a.top+i+b.collisionHeight-f-e,a.top+=i-c):a.top=j>0&&0>=i?e:i>j?e+f-b.collisionHeight:e:i>0?a.top+=i:j>0?a.top-=j:a.top=g(a.top-h,a.top)}},flip:{left:function(a,b){var c,d,e=b.within,f=e.offset.left+e.scrollLeft,g=e.width,i=e.isWindow?e.scrollLeft:e.offset.left,j=a.left-b.collisionPosition.marginLeft,k=j-i,l=j+b.collisionWidth-g-i,m="left"===b.my[0]?-b.elemWidth:"right"===b.my[0]?b.elemWidth:0,n="left"===b.at[0]?b.targetWidth:"right"===b.at[0]?-b.targetWidth:0,o=-2*b.offset[0];0>k?(c=a.left+m+n+o+b.collisionWidth-g-f,(0>c||c<h(k))&&(a.left+=m+n+o)):l>0&&(d=a.left-b.collisionPosition.marginLeft+m+n+o-i,(d>0||h(d)<l)&&(a.left+=m+n+o))},top:function(a,b){var c,d,e=b.within,f=e.offset.top+e.scrollTop,g=e.height,i=e.isWindow?e.scrollTop:e.offset.top,j=a.top-b.collisionPosition.marginTop,k=j-i,l=j+b.collisionHeight-g-i,m="top"===b.my[1],n=m?-b.elemHeight:"bottom"===b.my[1]?b.elemHeight:0,o="top"===b.at[1]?b.targetHeight:"bottom"===b.at[1]?-b.targetHeight:0,p=-2*b.offset[1];0>k?(d=a.top+n+o+p+b.collisionHeight-g-f,a.top+n+o+p>k&&(0>d||d<h(k))&&(a.top+=n+o+p)):l>0&&(c=a.top-b.collisionPosition.marginTop+n+o+p-i,a.top+n+o+p>l&&(c>0||h(c)<l)&&(a.top+=n+o+p))}},flipfit:{left:function(){a.ui.position.flip.left.apply(this,arguments),a.ui.position.fit.left.apply(this,arguments)},top:function(){a.ui.position.flip.top.apply(this,arguments),a.ui.position.fit.top.apply(this,arguments)}}},function(){var b,c,d,e,f,g=document.getElementsByTagName("body")[0],h=document.createElement("div");b=document.createElement(g?"div":"body"),d={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},g&&a.extend(d,{position:"absolute",left:"-1000px",top:"-1000px"});for(f in d)b.style[f]=d[f];b.appendChild(h),c=g||document.documentElement,c.insertBefore(b,c.firstChild),h.style.cssText="position: absolute; left: 10.7432222px;",e=a(h).offset().left,a.support.offsetFractions=e>10&&11>e,b.innerHTML="",c.removeChild(b)}()}(jQuery),function(a){a.widget("ui.draggable",a.ui.mouse,{version:"1.10.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(b){var c=this.options;return this.helper||c.disabled||a(b.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(b),this.handle?(a(c.iframeFix===!0?"iframe":c.iframeFix).each(function(){a("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(a(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(b){var c=this.options;return this.helper=this._createHelper(b),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),a.ui.ddmanager&&(a.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,c.cursorAt&&this._adjustOffsetFromHelper(c.cursorAt),this._setContainment(),this._trigger("start",b)===!1?(this._clear(),!1):(this._cacheHelperProportions(),a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this._mouseDrag(b,!0),a.ui.ddmanager&&a.ui.ddmanager.dragStart(this,b),!0)},_mouseDrag:function(b,c){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),!c){var d=this._uiHash();if(this._trigger("drag",b,d)===!1)return this._mouseUp({}),!1;this.position=d.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),!1},_mouseStop:function(b){var c=this,d=!1;return a.ui.ddmanager&&!this.options.dropBehaviour&&(d=a.ui.ddmanager.drop(this,b)),this.dropped&&(d=this.dropped,this.dropped=!1),"original"!==this.options.helper||a.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!d||"valid"===this.options.revert&&d||this.options.revert===!0||a.isFunction(this.options.revert)&&this.options.revert.call(this.element,d)?a(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){c._trigger("stop",b)!==!1&&c._clear()}):this._trigger("stop",b)!==!1&&this._clear(),!1):!1},_mouseUp:function(b){return a("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),a.ui.ddmanager&&a.ui.ddmanager.dragStop(this,b),a.ui.mouse.prototype._mouseUp.call(this,b)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(b){return this.options.handle?!!a(b.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b])):"clone"===c.helper?this.element.clone().removeAttr("id"):this.element;return d.parents("body").length||d.appendTo("parent"===c.appendTo?this.element[0].parentNode:c.appendTo),d[0]===this.element[0]||/(fixed|absolute)/.test(d.css("position"))||d.css("position","absolute"),d},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){var b=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.element.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options;return e.containment?"window"===e.containment?void(this.containment=[a(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,a(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,a(window).scrollLeft()+a(window).width()-this.helperProportions.width-this.margins.left,a(window).scrollTop()+(a(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===e.containment?void(this.containment=[0,0,a(document).width()-this.helperProportions.width-this.margins.left,(a(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):e.containment.constructor===Array?void(this.containment=e.containment):("parent"===e.containment&&(e.containment=this.helper[0].parentNode),c=a(e.containment),d=c[0],void(d&&(b="hidden"!==c.css("overflow"),this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(b?Math.max(d.scrollWidth,d.offsetWidth):d.offsetWidth)-(parseInt(c.css("borderRightWidth"),10)||0)-(parseInt(c.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(b?Math.max(d.scrollHeight,d.offsetHeight):d.offsetHeight)-(parseInt(c.css("borderBottomWidth"),10)||0)-(parseInt(c.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=c))):void(this.containment=null)},_convertPositionTo:function(b,c){c||(c=this.position);var d="absolute"===b?1:-1,e="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:e.scrollTop(),left:e.scrollLeft()}),{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*d,left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*d}},_generatePosition:function(b){var c,d,e,f,g=this.options,h="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=b.pageX,j=b.pageY;return this.offset.scroll||(this.offset.scroll={top:h.scrollTop(),left:h.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(d=this.relative_container.offset(),c=[this.containment[0]+d.left,this.containment[1]+d.top,this.containment[2]+d.left,this.containment[3]+d.top]):c=this.containment,b.pageX-this.offset.click.left<c[0]&&(i=c[0]+this.offset.click.left),b.pageY-this.offset.click.top<c[1]&&(j=c[1]+this.offset.click.top),b.pageX-this.offset.click.left>c[2]&&(i=c[2]+this.offset.click.left),b.pageY-this.offset.click.top>c[3]&&(j=c[3]+this.offset.click.top)),g.grid&&(e=g.grid[1]?this.originalPageY+Math.round((j-this.originalPageY)/g.grid[1])*g.grid[1]:this.originalPageY,j=c?e-this.offset.click.top>=c[1]||e-this.offset.click.top>c[3]?e:e-this.offset.click.top>=c[1]?e-g.grid[1]:e+g.grid[1]:e,f=g.grid[0]?this.originalPageX+Math.round((i-this.originalPageX)/g.grid[0])*g.grid[0]:this.originalPageX,i=c?f-this.offset.click.left>=c[0]||f-this.offset.click.left>c[2]?f:f-this.offset.click.left>=c[0]?f-g.grid[0]:f+g.grid[0]:f)),{top:j-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:i-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(b,c,d){return d=d||this._uiHash(),a.ui.plugin.call(this,b,[c,d]),"drag"===b&&(this.positionAbs=this._convertPositionTo("absolute")),a.Widget.prototype._trigger.call(this,b,c,d)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),a.ui.plugin.add("draggable","connectToSortable",{start:function(b,c){var d=a(this).data("ui-draggable"),e=d.options,f=a.extend({},c,{item:d.element});d.sortables=[],a(e.connectToSortable).each(function(){var c=a.data(this,"ui-sortable");c&&!c.options.disabled&&(d.sortables.push({instance:c,shouldRevert:c.options.revert}),c.refreshPositions(),c._trigger("activate",b,f))})},stop:function(b,c){var d=a(this).data("ui-draggable"),e=a.extend({},c,{item:d.element});a.each(d.sortables,function(){this.instance.isOver?(this.instance.isOver=0,d.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(b),this.instance.options.helper=this.instance.options._helper,"original"===d.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",b,e))})},drag:function(b,c){var d=a(this).data("ui-draggable"),e=this;a.each(d.sortables,function(){var f=!1,g=this;this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(f=!0,a.each(d.sortables,function(){return this.instance.positionAbs=d.positionAbs,this.instance.helperProportions=d.helperProportions,this.instance.offset.click=d.offset.click,this!==g&&this.instance._intersectsWith(this.instance.containerCache)&&a.contains(g.instance.element[0],this.instance.element[0])&&(f=!1),f})),f?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=a(e).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return c.helper[0]
},b.target=this.instance.currentItem[0],this.instance._mouseCapture(b,!0),this.instance._mouseStart(b,!0,!0),this.instance.offset.click.top=d.offset.click.top,this.instance.offset.click.left=d.offset.click.left,this.instance.offset.parent.left-=d.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=d.offset.parent.top-this.instance.offset.parent.top,d._trigger("toSortable",b),d.dropped=this.instance.element,d.currentItem=d.element,this.instance.fromOutside=d),this.instance.currentItem&&this.instance._mouseDrag(b)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",b,this.instance._uiHash(this.instance)),this.instance._mouseStop(b,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),d._trigger("fromSortable",b),d.dropped=!1)})}}),a.ui.plugin.add("draggable","cursor",{start:function(){var b=a("body"),c=a(this).data("ui-draggable").options;b.css("cursor")&&(c._cursor=b.css("cursor")),b.css("cursor",c.cursor)},stop:function(){var b=a(this).data("ui-draggable").options;b._cursor&&a("body").css("cursor",b._cursor)}}),a.ui.plugin.add("draggable","opacity",{start:function(b,c){var d=a(c.helper),e=a(this).data("ui-draggable").options;d.css("opacity")&&(e._opacity=d.css("opacity")),d.css("opacity",e.opacity)},stop:function(b,c){var d=a(this).data("ui-draggable").options;d._opacity&&a(c.helper).css("opacity",d._opacity)}}),a.ui.plugin.add("draggable","scroll",{start:function(){var b=a(this).data("ui-draggable");b.scrollParent[0]!==document&&"HTML"!==b.scrollParent[0].tagName&&(b.overflowOffset=b.scrollParent.offset())},drag:function(b){var c=a(this).data("ui-draggable"),d=c.options,e=!1;c.scrollParent[0]!==document&&"HTML"!==c.scrollParent[0].tagName?(d.axis&&"x"===d.axis||(c.overflowOffset.top+c.scrollParent[0].offsetHeight-b.pageY<d.scrollSensitivity?c.scrollParent[0].scrollTop=e=c.scrollParent[0].scrollTop+d.scrollSpeed:b.pageY-c.overflowOffset.top<d.scrollSensitivity&&(c.scrollParent[0].scrollTop=e=c.scrollParent[0].scrollTop-d.scrollSpeed)),d.axis&&"y"===d.axis||(c.overflowOffset.left+c.scrollParent[0].offsetWidth-b.pageX<d.scrollSensitivity?c.scrollParent[0].scrollLeft=e=c.scrollParent[0].scrollLeft+d.scrollSpeed:b.pageX-c.overflowOffset.left<d.scrollSensitivity&&(c.scrollParent[0].scrollLeft=e=c.scrollParent[0].scrollLeft-d.scrollSpeed))):(d.axis&&"x"===d.axis||(b.pageY-a(document).scrollTop()<d.scrollSensitivity?e=a(document).scrollTop(a(document).scrollTop()-d.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<d.scrollSensitivity&&(e=a(document).scrollTop(a(document).scrollTop()+d.scrollSpeed))),d.axis&&"y"===d.axis||(b.pageX-a(document).scrollLeft()<d.scrollSensitivity?e=a(document).scrollLeft(a(document).scrollLeft()-d.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<d.scrollSensitivity&&(e=a(document).scrollLeft(a(document).scrollLeft()+d.scrollSpeed)))),e!==!1&&a.ui.ddmanager&&!d.dropBehaviour&&a.ui.ddmanager.prepareOffsets(c,b)}}),a.ui.plugin.add("draggable","snap",{start:function(){var b=a(this).data("ui-draggable"),c=b.options;b.snapElements=[],a(c.snap.constructor!==String?c.snap.items||":data(ui-draggable)":c.snap).each(function(){var c=a(this),d=c.offset();this!==b.element[0]&&b.snapElements.push({item:this,width:c.outerWidth(),height:c.outerHeight(),top:d.top,left:d.left})})},drag:function(b,c){var d,e,f,g,h,i,j,k,l,m,n=a(this).data("ui-draggable"),o=n.options,p=o.snapTolerance,q=c.offset.left,r=q+n.helperProportions.width,s=c.offset.top,t=s+n.helperProportions.height;for(l=n.snapElements.length-1;l>=0;l--)h=n.snapElements[l].left,i=h+n.snapElements[l].width,j=n.snapElements[l].top,k=j+n.snapElements[l].height,h-p>r||q>i+p||j-p>t||s>k+p||!a.contains(n.snapElements[l].item.ownerDocument,n.snapElements[l].item)?(n.snapElements[l].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,b,a.extend(n._uiHash(),{snapItem:n.snapElements[l].item})),n.snapElements[l].snapping=!1):("inner"!==o.snapMode&&(d=Math.abs(j-t)<=p,e=Math.abs(k-s)<=p,f=Math.abs(h-r)<=p,g=Math.abs(i-q)<=p,d&&(c.position.top=n._convertPositionTo("relative",{top:j-n.helperProportions.height,left:0}).top-n.margins.top),e&&(c.position.top=n._convertPositionTo("relative",{top:k,left:0}).top-n.margins.top),f&&(c.position.left=n._convertPositionTo("relative",{top:0,left:h-n.helperProportions.width}).left-n.margins.left),g&&(c.position.left=n._convertPositionTo("relative",{top:0,left:i}).left-n.margins.left)),m=d||e||f||g,"outer"!==o.snapMode&&(d=Math.abs(j-s)<=p,e=Math.abs(k-t)<=p,f=Math.abs(h-q)<=p,g=Math.abs(i-r)<=p,d&&(c.position.top=n._convertPositionTo("relative",{top:j,left:0}).top-n.margins.top),e&&(c.position.top=n._convertPositionTo("relative",{top:k-n.helperProportions.height,left:0}).top-n.margins.top),f&&(c.position.left=n._convertPositionTo("relative",{top:0,left:h}).left-n.margins.left),g&&(c.position.left=n._convertPositionTo("relative",{top:0,left:i-n.helperProportions.width}).left-n.margins.left)),!n.snapElements[l].snapping&&(d||e||f||g||m)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,b,a.extend(n._uiHash(),{snapItem:n.snapElements[l].item})),n.snapElements[l].snapping=d||e||f||g||m)}}),a.ui.plugin.add("draggable","stack",{start:function(){var b,c=this.data("ui-draggable").options,d=a.makeArray(a(c.stack)).sort(function(b,c){return(parseInt(a(b).css("zIndex"),10)||0)-(parseInt(a(c).css("zIndex"),10)||0)});d.length&&(b=parseInt(a(d[0]).css("zIndex"),10)||0,a(d).each(function(c){a(this).css("zIndex",b+c)}),this.css("zIndex",b+d.length))}}),a.ui.plugin.add("draggable","zIndex",{start:function(b,c){var d=a(c.helper),e=a(this).data("ui-draggable").options;d.css("zIndex")&&(e._zIndex=d.css("zIndex")),d.css("zIndex",e.zIndex)},stop:function(b,c){var d=a(this).data("ui-draggable").options;d._zIndex&&a(c.helper).css("zIndex",d._zIndex)}})}(jQuery),function(a){function b(a,b,c){return a>b&&b+c>a}a.widget("ui.droppable",{version:"1.10.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var b,c=this.options,d=c.accept;this.isover=!1,this.isout=!0,this.accept=a.isFunction(d)?d:function(a){return a.is(d)},this.proportions=function(){return arguments.length?void(b=arguments[0]):b?b:b={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},a.ui.ddmanager.droppables[c.scope]=a.ui.ddmanager.droppables[c.scope]||[],a.ui.ddmanager.droppables[c.scope].push(this),c.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var b=0,c=a.ui.ddmanager.droppables[this.options.scope];b<c.length;b++)c[b]===this&&c.splice(b,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(b,c){"accept"===b&&(this.accept=a.isFunction(c)?c:function(a){return a.is(c)}),a.Widget.prototype._setOption.apply(this,arguments)},_activate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),c&&this._trigger("activate",b,this.ui(c))},_deactivate:function(b){var c=a.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),c&&this._trigger("deactivate",b,this.ui(c))},_over:function(b){var c=a.ui.ddmanager.current;c&&(c.currentItem||c.element)[0]!==this.element[0]&&this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",b,this.ui(c)))},_out:function(b){var c=a.ui.ddmanager.current;c&&(c.currentItem||c.element)[0]!==this.element[0]&&this.accept.call(this.element[0],c.currentItem||c.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",b,this.ui(c)))},_drop:function(b,c){var d=c||a.ui.ddmanager.current,e=!1;return d&&(d.currentItem||d.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var b=a.data(this,"ui-droppable");return b.options.greedy&&!b.options.disabled&&b.options.scope===d.options.scope&&b.accept.call(b.element[0],d.currentItem||d.element)&&a.ui.intersect(d,a.extend(b,{offset:b.element.offset()}),b.options.tolerance)?(e=!0,!1):void 0}),e?!1:this.accept.call(this.element[0],d.currentItem||d.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",b,this.ui(d)),this.element):!1):!1},ui:function(a){return{draggable:a.currentItem||a.element,helper:a.helper,position:a.position,offset:a.positionAbs}}}),a.ui.intersect=function(a,c,d){if(!c.offset)return!1;var e,f,g=(a.positionAbs||a.position.absolute).left,h=(a.positionAbs||a.position.absolute).top,i=g+a.helperProportions.width,j=h+a.helperProportions.height,k=c.offset.left,l=c.offset.top,m=k+c.proportions().width,n=l+c.proportions().height;switch(d){case"fit":return g>=k&&m>=i&&h>=l&&n>=j;case"intersect":return k<g+a.helperProportions.width/2&&i-a.helperProportions.width/2<m&&l<h+a.helperProportions.height/2&&j-a.helperProportions.height/2<n;case"pointer":return e=(a.positionAbs||a.position.absolute).left+(a.clickOffset||a.offset.click).left,f=(a.positionAbs||a.position.absolute).top+(a.clickOffset||a.offset.click).top,b(f,l,c.proportions().height)&&b(e,k,c.proportions().width);case"touch":return(h>=l&&n>=h||j>=l&&n>=j||l>h&&j>n)&&(g>=k&&m>=g||i>=k&&m>=i||k>g&&i>m);default:return!1}},a.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(b,c){var d,e,f=a.ui.ddmanager.droppables[b.options.scope]||[],g=c?c.type:null,h=(b.currentItem||b.element).find(":data(ui-droppable)").addBack();a:for(d=0;d<f.length;d++)if(!(f[d].options.disabled||b&&!f[d].accept.call(f[d].element[0],b.currentItem||b.element))){for(e=0;e<h.length;e++)if(h[e]===f[d].element[0]){f[d].proportions().height=0;continue a}f[d].visible="none"!==f[d].element.css("display"),f[d].visible&&("mousedown"===g&&f[d]._activate.call(f[d],c),f[d].offset=f[d].element.offset(),f[d].proportions({width:f[d].element[0].offsetWidth,height:f[d].element[0].offsetHeight}))}},drop:function(b,c){var d=!1;return a.each((a.ui.ddmanager.droppables[b.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&a.ui.intersect(b,this,this.options.tolerance)&&(d=this._drop.call(this,c)||d),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],b.currentItem||b.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,c)))}),d},dragStart:function(b,c){b.element.parentsUntil("body").bind("scroll.droppable",function(){b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)})},drag:function(b,c){b.options.refreshPositions&&a.ui.ddmanager.prepareOffsets(b,c),a.each(a.ui.ddmanager.droppables[b.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var d,e,f,g=a.ui.intersect(b,this,this.options.tolerance),h=!g&&this.isover?"isout":g&&!this.isover?"isover":null;h&&(this.options.greedy&&(e=this.options.scope,f=this.element.parents(":data(ui-droppable)").filter(function(){return a.data(this,"ui-droppable").options.scope===e}),f.length&&(d=a.data(f[0],"ui-droppable"),d.greedyChild="isover"===h)),d&&"isover"===h&&(d.isover=!1,d.isout=!0,d._out.call(d,c)),this[h]=!0,this["isout"===h?"isover":"isout"]=!1,this["isover"===h?"_over":"_out"].call(this,c),d&&"isout"===h&&(d.isout=!1,d.isover=!0,d._over.call(d,c)))}})},dragStop:function(b,c){b.element.parentsUntil("body").unbind("scroll.droppable"),b.options.refreshPositions||a.ui.ddmanager.prepareOffsets(b,c)}}}(jQuery),function(a){function b(a){return parseInt(a,10)||0}function c(a){return!isNaN(parseInt(a,10))}a.widget("ui.resizable",a.ui.mouse,{version:"1.10.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var b,c,d,e,f,g=this,h=this.options;if(this.element.addClass("ui-resizable"),a.extend(this,{_aspectRatio:!!h.aspectRatio,aspectRatio:h.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:h.helper||h.ghost||h.animate?h.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(a("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=h.handles||(a(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),b=this.handles.split(","),this.handles={},c=0;c<b.length;c++)d=a.trim(b[c]),f="ui-resizable-"+d,e=a("<div class='ui-resizable-handle "+f+"'></div>"),e.css({zIndex:h.zIndex}),"se"===d&&e.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[d]=".ui-resizable-"+d,this.element.append(e);this._renderAxis=function(b){var c,d,e,f;b=b||this.element;for(c in this.handles)this.handles[c].constructor===String&&(this.handles[c]=a(this.handles[c],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(d=a(this.handles[c],this.element),f=/sw|ne|nw|se|n|s/.test(c)?d.outerHeight():d.outerWidth(),e=["padding",/ne|nw|n/.test(c)?"Top":/se|sw|s/.test(c)?"Bottom":/^e$/.test(c)?"Right":"Left"].join(""),b.css(e,f),this._proportionallyResize()),a(this.handles[c]).length},this._renderAxis(this.element),this._handles=a(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){g.resizing||(this.className&&(e=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),g.axis=e&&e[1]?e[1]:"se")}),h.autoHide&&(this._handles.hide(),a(this.element).addClass("ui-resizable-autohide").mouseenter(function(){h.disabled||(a(this).removeClass("ui-resizable-autohide"),g._handles.show())}).mouseleave(function(){h.disabled||g.resizing||(a(this).addClass("ui-resizable-autohide"),g._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var b,c=function(b){a(b).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(c(this.element),b=this.element,this.originalElement.css({position:b.css("position"),width:b.outerWidth(),height:b.outerHeight(),top:b.css("top"),left:b.css("left")}).insertAfter(b),b.remove()),this.originalElement.css("resize",this.originalResizeStyle),c(this.originalElement),this},_mouseCapture:function(b){var c,d,e=!1;for(c in this.handles)d=a(this.handles[c])[0],(d===b.target||a.contains(d,b.target))&&(e=!0);return!this.options.disabled&&e},_mouseStart:function(c){var d,e,f,g=this.options,h=this.element.position(),i=this.element;return this.resizing=!0,/absolute/.test(i.css("position"))?i.css({position:"absolute",top:i.css("top"),left:i.css("left")}):i.is(".ui-draggable")&&i.css({position:"absolute",top:h.top,left:h.left}),this._renderProxy(),d=b(this.helper.css("left")),e=b(this.helper.css("top")),g.containment&&(d+=a(g.containment).scrollLeft()||0,e+=a(g.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:d,top:e},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:i.width(),height:i.height()},this.originalSize=this._helper?{width:i.outerWidth(),height:i.outerHeight()}:{width:i.width(),height:i.height()},this.originalPosition={left:d,top:e},this.sizeDiff={width:i.outerWidth()-i.width(),height:i.outerHeight()-i.height()},this.originalMousePosition={left:c.pageX,top:c.pageY},this.aspectRatio="number"==typeof g.aspectRatio?g.aspectRatio:this.originalSize.width/this.originalSize.height||1,f=a(".ui-resizable-"+this.axis).css("cursor"),a("body").css("cursor","auto"===f?this.axis+"-resize":f),i.addClass("ui-resizable-resizing"),this._propagate("start",c),!0},_mouseDrag:function(b){var c,d=this.helper,e={},f=this.originalMousePosition,g=this.axis,h=this.position.top,i=this.position.left,j=this.size.width,k=this.size.height,l=b.pageX-f.left||0,m=b.pageY-f.top||0,n=this._change[g];return n?(c=n.apply(this,[b,l,m]),this._updateVirtualBoundaries(b.shiftKey),(this._aspectRatio||b.shiftKey)&&(c=this._updateRatio(c,b)),c=this._respectSize(c,b),this._updateCache(c),this._propagate("resize",b),this.position.top!==h&&(e.top=this.position.top+"px"),this.position.left!==i&&(e.left=this.position.left+"px"),this.size.width!==j&&(e.width=this.size.width+"px"),this.size.height!==k&&(e.height=this.size.height+"px"),d.css(e),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),a.isEmptyObject(e)||this._trigger("resize",b,this.ui()),!1):!1},_mouseStop:function(b){this.resizing=!1;var c,d,e,f,g,h,i,j=this.options,k=this;return this._helper&&(c=this._proportionallyResizeElements,d=c.length&&/textarea/i.test(c[0].nodeName),e=d&&a.ui.hasScroll(c[0],"left")?0:k.sizeDiff.height,f=d?0:k.sizeDiff.width,g={width:k.helper.width()-f,height:k.helper.height()-e},h=parseInt(k.element.css("left"),10)+(k.position.left-k.originalPosition.left)||null,i=parseInt(k.element.css("top"),10)+(k.position.top-k.originalPosition.top)||null,j.animate||this.element.css(a.extend(g,{top:i,left:h})),k.helper.height(k.size.height),k.helper.width(k.size.width),this._helper&&!j.animate&&this._proportionallyResize()),a("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",b),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(a){var b,d,e,f,g,h=this.options;g={minWidth:c(h.minWidth)?h.minWidth:0,maxWidth:c(h.maxWidth)?h.maxWidth:1/0,minHeight:c(h.minHeight)?h.minHeight:0,maxHeight:c(h.maxHeight)?h.maxHeight:1/0},(this._aspectRatio||a)&&(b=g.minHeight*this.aspectRatio,e=g.minWidth/this.aspectRatio,d=g.maxHeight*this.aspectRatio,f=g.maxWidth/this.aspectRatio,b>g.minWidth&&(g.minWidth=b),e>g.minHeight&&(g.minHeight=e),d<g.maxWidth&&(g.maxWidth=d),f<g.maxHeight&&(g.maxHeight=f)),this._vBoundaries=g},_updateCache:function(a){this.offset=this.helper.offset(),c(a.left)&&(this.position.left=a.left),c(a.top)&&(this.position.top=a.top),c(a.height)&&(this.size.height=a.height),c(a.width)&&(this.size.width=a.width)},_updateRatio:function(a){var b=this.position,d=this.size,e=this.axis;return c(a.height)?a.width=a.height*this.aspectRatio:c(a.width)&&(a.height=a.width/this.aspectRatio),"sw"===e&&(a.left=b.left+(d.width-a.width),a.top=null),"nw"===e&&(a.top=b.top+(d.height-a.height),a.left=b.left+(d.width-a.width)),a},_respectSize:function(a){var b=this._vBoundaries,d=this.axis,e=c(a.width)&&b.maxWidth&&b.maxWidth<a.width,f=c(a.height)&&b.maxHeight&&b.maxHeight<a.height,g=c(a.width)&&b.minWidth&&b.minWidth>a.width,h=c(a.height)&&b.minHeight&&b.minHeight>a.height,i=this.originalPosition.left+this.originalSize.width,j=this.position.top+this.size.height,k=/sw|nw|w/.test(d),l=/nw|ne|n/.test(d);return g&&(a.width=b.minWidth),h&&(a.height=b.minHeight),e&&(a.width=b.maxWidth),f&&(a.height=b.maxHeight),g&&k&&(a.left=i-b.minWidth),e&&k&&(a.left=i-b.maxWidth),h&&l&&(a.top=j-b.minHeight),f&&l&&(a.top=j-b.maxHeight),a.width||a.height||a.left||!a.top?a.width||a.height||a.top||!a.left||(a.left=null):a.top=null,a},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var a,b,c,d,e,f=this.helper||this.element;for(a=0;a<this._proportionallyResizeElements.length;a++){if(e=this._proportionallyResizeElements[a],!this.borderDif)for(this.borderDif=[],c=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],d=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")],b=0;b<c.length;b++)this.borderDif[b]=(parseInt(c[b],10)||0)+(parseInt(d[b],10)||0);e.css({height:f.height()-this.borderDif[0]-this.borderDif[2]||0,width:f.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var b=this.element,c=this.options;this.elementOffset=b.offset(),this._helper?(this.helper=this.helper||a("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++c.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(a,b){return{width:this.originalSize.width+b}},w:function(a,b){var c=this.originalSize,d=this.originalPosition;return{left:d.left+b,width:c.width-b}},n:function(a,b,c){var d=this.originalSize,e=this.originalPosition;return{top:e.top+c,height:d.height-c}},s:function(a,b,c){return{height:this.originalSize.height+c}},se:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},sw:function(b,c,d){return a.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[b,c,d]))},ne:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[b,c,d]))},nw:function(b,c,d){return a.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[b,c,d]))}},_propagate:function(b,c){a.ui.plugin.call(this,b,[c,this.ui()]),"resize"!==b&&this._trigger(b,c,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),a.ui.plugin.add("resizable","animate",{stop:function(b){var c=a(this).data("ui-resizable"),d=c.options,e=c._proportionallyResizeElements,f=e.length&&/textarea/i.test(e[0].nodeName),g=f&&a.ui.hasScroll(e[0],"left")?0:c.sizeDiff.height,h=f?0:c.sizeDiff.width,i={width:c.size.width-h,height:c.size.height-g},j=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null,k=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null;c.element.animate(a.extend(i,k&&j?{top:k,left:j}:{}),{duration:d.animateDuration,easing:d.animateEasing,step:function(){var d={width:parseInt(c.element.css("width"),10),height:parseInt(c.element.css("height"),10),top:parseInt(c.element.css("top"),10),left:parseInt(c.element.css("left"),10)};e&&e.length&&a(e[0]).css({width:d.width,height:d.height}),c._updateCache(d),c._propagate("resize",b)}})}}),a.ui.plugin.add("resizable","containment",{start:function(){var c,d,e,f,g,h,i,j=a(this).data("ui-resizable"),k=j.options,l=j.element,m=k.containment,n=m instanceof a?m.get(0):/parent/.test(m)?l.parent().get(0):m;n&&(j.containerElement=a(n),/document/.test(m)||m===document?(j.containerOffset={left:0,top:0},j.containerPosition={left:0,top:0},j.parentData={element:a(document),left:0,top:0,width:a(document).width(),height:a(document).height()||document.body.parentNode.scrollHeight}):(c=a(n),d=[],a(["Top","Right","Left","Bottom"]).each(function(a,e){d[a]=b(c.css("padding"+e))}),j.containerOffset=c.offset(),j.containerPosition=c.position(),j.containerSize={height:c.innerHeight()-d[3],width:c.innerWidth()-d[1]},e=j.containerOffset,f=j.containerSize.height,g=j.containerSize.width,h=a.ui.hasScroll(n,"left")?n.scrollWidth:g,i=a.ui.hasScroll(n)?n.scrollHeight:f,j.parentData={element:n,left:e.left,top:e.top,width:h,height:i}))},resize:function(b){var c,d,e,f,g=a(this).data("ui-resizable"),h=g.options,i=g.containerOffset,j=g.position,k=g._aspectRatio||b.shiftKey,l={top:0,left:0},m=g.containerElement;m[0]!==document&&/static/.test(m.css("position"))&&(l=i),j.left<(g._helper?i.left:0)&&(g.size.width=g.size.width+(g._helper?g.position.left-i.left:g.position.left-l.left),k&&(g.size.height=g.size.width/g.aspectRatio),g.position.left=h.helper?i.left:0),j.top<(g._helper?i.top:0)&&(g.size.height=g.size.height+(g._helper?g.position.top-i.top:g.position.top),k&&(g.size.width=g.size.height*g.aspectRatio),g.position.top=g._helper?i.top:0),g.offset.left=g.parentData.left+g.position.left,g.offset.top=g.parentData.top+g.position.top,c=Math.abs((g._helper?g.offset.left-l.left:g.offset.left-l.left)+g.sizeDiff.width),d=Math.abs((g._helper?g.offset.top-l.top:g.offset.top-i.top)+g.sizeDiff.height),e=g.containerElement.get(0)===g.element.parent().get(0),f=/relative|absolute/.test(g.containerElement.css("position")),e&&f&&(c-=Math.abs(g.parentData.left)),c+g.size.width>=g.parentData.width&&(g.size.width=g.parentData.width-c,k&&(g.size.height=g.size.width/g.aspectRatio)),d+g.size.height>=g.parentData.height&&(g.size.height=g.parentData.height-d,k&&(g.size.width=g.size.height*g.aspectRatio))},stop:function(){var b=a(this).data("ui-resizable"),c=b.options,d=b.containerOffset,e=b.containerPosition,f=b.containerElement,g=a(b.helper),h=g.offset(),i=g.outerWidth()-b.sizeDiff.width,j=g.outerHeight()-b.sizeDiff.height;b._helper&&!c.animate&&/relative/.test(f.css("position"))&&a(this).css({left:h.left-e.left-d.left,width:i,height:j}),b._helper&&!c.animate&&/static/.test(f.css("position"))&&a(this).css({left:h.left-e.left-d.left,width:i,height:j})}}),a.ui.plugin.add("resizable","alsoResize",{start:function(){var b=a(this).data("ui-resizable"),c=b.options,d=function(b){a(b).each(function(){var b=a(this);b.data("ui-resizable-alsoresize",{width:parseInt(b.width(),10),height:parseInt(b.height(),10),left:parseInt(b.css("left"),10),top:parseInt(b.css("top"),10)})})};"object"!=typeof c.alsoResize||c.alsoResize.parentNode?d(c.alsoResize):c.alsoResize.length?(c.alsoResize=c.alsoResize[0],d(c.alsoResize)):a.each(c.alsoResize,function(a){d(a)})},resize:function(b,c){var d=a(this).data("ui-resizable"),e=d.options,f=d.originalSize,g=d.originalPosition,h={height:d.size.height-f.height||0,width:d.size.width-f.width||0,top:d.position.top-g.top||0,left:d.position.left-g.left||0},i=function(b,d){a(b).each(function(){var b=a(this),e=a(this).data("ui-resizable-alsoresize"),f={},g=d&&d.length?d:b.parents(c.originalElement[0]).length?["width","height"]:["width","height","top","left"];a.each(g,function(a,b){var c=(e[b]||0)+(h[b]||0);c&&c>=0&&(f[b]=c||null)}),b.css(f)})};"object"!=typeof e.alsoResize||e.alsoResize.nodeType?i(e.alsoResize):a.each(e.alsoResize,function(a,b){i(a,b)})},stop:function(){a(this).removeData("resizable-alsoresize")}}),a.ui.plugin.add("resizable","ghost",{start:function(){var b=a(this).data("ui-resizable"),c=b.options,d=b.size;b.ghost=b.originalElement.clone(),b.ghost.css({opacity:.25,display:"block",position:"relative",height:d.height,width:d.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof c.ghost?c.ghost:""),b.ghost.appendTo(b.helper)},resize:function(){var b=a(this).data("ui-resizable");b.ghost&&b.ghost.css({position:"relative",height:b.size.height,width:b.size.width})},stop:function(){var b=a(this).data("ui-resizable");b.ghost&&b.helper&&b.helper.get(0).removeChild(b.ghost.get(0))}}),a.ui.plugin.add("resizable","grid",{resize:function(){var b=a(this).data("ui-resizable"),c=b.options,d=b.size,e=b.originalSize,f=b.originalPosition,g=b.axis,h="number"==typeof c.grid?[c.grid,c.grid]:c.grid,i=h[0]||1,j=h[1]||1,k=Math.round((d.width-e.width)/i)*i,l=Math.round((d.height-e.height)/j)*j,m=e.width+k,n=e.height+l,o=c.maxWidth&&c.maxWidth<m,p=c.maxHeight&&c.maxHeight<n,q=c.minWidth&&c.minWidth>m,r=c.minHeight&&c.minHeight>n;c.grid=h,q&&(m+=i),r&&(n+=j),o&&(m-=i),p&&(n-=j),/^(se|s|e)$/.test(g)?(b.size.width=m,b.size.height=n):/^(ne)$/.test(g)?(b.size.width=m,b.size.height=n,b.position.top=f.top-l):/^(sw)$/.test(g)?(b.size.width=m,b.size.height=n,b.position.left=f.left-k):(n-j>0?(b.size.height=n,b.position.top=f.top-l):(b.size.height=j,b.position.top=f.top+e.height-j),m-i>0?(b.size.width=m,b.position.left=f.left-k):(b.size.width=i,b.position.left=f.left+e.width-i))}})}(jQuery),function(a){a.widget("ui.selectable",a.ui.mouse,{version:"1.10.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var b,c=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){b=a(c.options.filter,c.element[0]),b.addClass("ui-selectee"),b.each(function(){var b=a(this),c=b.offset();a.data(this,"selectable-item",{element:this,$element:b,left:c.left,top:c.top,right:c.left+b.outerWidth(),bottom:c.top+b.outerHeight(),startselected:!1,selected:b.hasClass("ui-selected"),selecting:b.hasClass("ui-selecting"),unselecting:b.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=b.addClass("ui-selectee"),this._mouseInit(),this.helper=a("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(b){var c=this,d=this.options;this.opos=[b.pageX,b.pageY],this.options.disabled||(this.selectees=a(d.filter,this.element[0]),this._trigger("start",b),a(d.appendTo).append(this.helper),this.helper.css({left:b.pageX,top:b.pageY,width:0,height:0}),d.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var d=a.data(this,"selectable-item");d.startselected=!0,b.metaKey||b.ctrlKey||(d.$element.removeClass("ui-selected"),d.selected=!1,d.$element.addClass("ui-unselecting"),d.unselecting=!0,c._trigger("unselecting",b,{unselecting:d.element}))}),a(b.target).parents().addBack().each(function(){var d,e=a.data(this,"selectable-item");return e?(d=!b.metaKey&&!b.ctrlKey||!e.$element.hasClass("ui-selected"),e.$element.removeClass(d?"ui-unselecting":"ui-selected").addClass(d?"ui-selecting":"ui-unselecting"),e.unselecting=!d,e.selecting=d,e.selected=d,d?c._trigger("selecting",b,{selecting:e.element}):c._trigger("unselecting",b,{unselecting:e.element}),!1):void 0}))},_mouseDrag:function(b){if(this.dragged=!0,!this.options.disabled){var c,d=this,e=this.options,f=this.opos[0],g=this.opos[1],h=b.pageX,i=b.pageY;return f>h&&(c=h,h=f,f=c),g>i&&(c=i,i=g,g=c),this.helper.css({left:f,top:g,width:h-f,height:i-g}),this.selectees.each(function(){var c=a.data(this,"selectable-item"),j=!1;c&&c.element!==d.element[0]&&("touch"===e.tolerance?j=!(c.left>h||c.right<f||c.top>i||c.bottom<g):"fit"===e.tolerance&&(j=c.left>f&&c.right<h&&c.top>g&&c.bottom<i),j?(c.selected&&(c.$element.removeClass("ui-selected"),c.selected=!1),c.unselecting&&(c.$element.removeClass("ui-unselecting"),c.unselecting=!1),c.selecting||(c.$element.addClass("ui-selecting"),c.selecting=!0,d._trigger("selecting",b,{selecting:c.element}))):(c.selecting&&((b.metaKey||b.ctrlKey)&&c.startselected?(c.$element.removeClass("ui-selecting"),c.selecting=!1,c.$element.addClass("ui-selected"),c.selected=!0):(c.$element.removeClass("ui-selecting"),c.selecting=!1,c.startselected&&(c.$element.addClass("ui-unselecting"),c.unselecting=!0),d._trigger("unselecting",b,{unselecting:c.element}))),c.selected&&(b.metaKey||b.ctrlKey||c.startselected||(c.$element.removeClass("ui-selected"),c.selected=!1,c.$element.addClass("ui-unselecting"),c.unselecting=!0,d._trigger("unselecting",b,{unselecting:c.element})))))
}),!1}},_mouseStop:function(b){var c=this;return this.dragged=!1,a(".ui-unselecting",this.element[0]).each(function(){var d=a.data(this,"selectable-item");d.$element.removeClass("ui-unselecting"),d.unselecting=!1,d.startselected=!1,c._trigger("unselected",b,{unselected:d.element})}),a(".ui-selecting",this.element[0]).each(function(){var d=a.data(this,"selectable-item");d.$element.removeClass("ui-selecting").addClass("ui-selected"),d.selecting=!1,d.selected=!0,d.startselected=!0,c._trigger("selected",b,{selected:d.element})}),this._trigger("stop",b),this.helper.remove(),!1}})}(jQuery),function(a){function b(a,b,c){return a>b&&b+c>a}function c(a){return/left|right/.test(a.css("float"))||/inline|table-cell/.test(a.css("display"))}a.widget("ui.sortable",a.ui.mouse,{version:"1.10.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var a=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===a.axis||c(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var a=this.items.length-1;a>=0;a--)this.items[a].item.removeData(this.widgetName+"-item");return this},_setOption:function(b,c){"disabled"===b?(this.options[b]=c,this.widget().toggleClass("ui-sortable-disabled",!!c)):a.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(b,c){var d=null,e=!1,f=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(b),a(b.target).parents().each(function(){return a.data(this,f.widgetName+"-item")===f?(d=a(this),!1):void 0}),a.data(b.target,f.widgetName+"-item")===f&&(d=a(b.target)),d&&(!this.options.handle||c||(a(this.options.handle,d).find("*").addBack().each(function(){this===b.target&&(e=!0)}),e))?(this.currentItem=d,this._removeCurrentsFromItems(),!0):!1)},_mouseStart:function(b,c,d){var e,f,g=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(b),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,g.cursorAt&&this._adjustOffsetFromHelper(g.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),g.containment&&this._setContainment(),g.cursor&&"auto"!==g.cursor&&(f=this.document.find("body"),this.storedCursor=f.css("cursor"),f.css("cursor",g.cursor),this.storedStylesheet=a("<style>*{ cursor: "+g.cursor+" !important; }</style>").appendTo(f)),g.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",g.opacity)),g.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",g.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",b,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!d)for(e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("activate",b,this._uiHash(this));return a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!g.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(b),!0},_mouseDrag:function(b){var c,d,e,f,g=this.options,h=!1;for(this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<g.scrollSensitivity?this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop+g.scrollSpeed:b.pageY-this.overflowOffset.top<g.scrollSensitivity&&(this.scrollParent[0].scrollTop=h=this.scrollParent[0].scrollTop-g.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<g.scrollSensitivity?this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft+g.scrollSpeed:b.pageX-this.overflowOffset.left<g.scrollSensitivity&&(this.scrollParent[0].scrollLeft=h=this.scrollParent[0].scrollLeft-g.scrollSpeed)):(b.pageY-a(document).scrollTop()<g.scrollSensitivity?h=a(document).scrollTop(a(document).scrollTop()-g.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<g.scrollSensitivity&&(h=a(document).scrollTop(a(document).scrollTop()+g.scrollSpeed)),b.pageX-a(document).scrollLeft()<g.scrollSensitivity?h=a(document).scrollLeft(a(document).scrollLeft()-g.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<g.scrollSensitivity&&(h=a(document).scrollLeft(a(document).scrollLeft()+g.scrollSpeed))),h!==!1&&a.ui.ddmanager&&!g.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),c=this.items.length-1;c>=0;c--)if(d=this.items[c],e=d.item[0],f=this._intersectsWithPointer(d),f&&d.instance===this.currentContainer&&e!==this.currentItem[0]&&this.placeholder[1===f?"next":"prev"]()[0]!==e&&!a.contains(this.placeholder[0],e)&&("semi-dynamic"===this.options.type?!a.contains(this.element[0],e):!0)){if(this.direction=1===f?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(d))break;this._rearrange(b,d),this._trigger("change",b,this._uiHash());break}return this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b,c){if(b){if(a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,b),this.options.revert){var d=this,e=this.placeholder.offset(),f=this.options.axis,g={};f&&"x"!==f||(g.left=e.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),f&&"y"!==f||(g.top=e.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,a(this.helper).animate(g,parseInt(this.options.revert,10)||500,function(){d._clear(b)})}else this._clear(b,c);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var b=this.containers.length-1;b>=0;b--)this.containers[b]._trigger("deactivate",null,this._uiHash(this)),this.containers[b].containerCache.over&&(this.containers[b]._trigger("out",null,this._uiHash(this)),this.containers[b].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},a(c).each(function(){var c=(a(b.item||this).attr(b.attribute||"id")||"").match(b.expression||/(.+)[\-=_](.+)/);c&&d.push((b.key||c[1]+"[]")+"="+(b.key&&b.expression?c[1]:c[2]))}),!d.length&&b.key&&d.push(b.key+"="),d.join("&")},toArray:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},c.each(function(){d.push(a(b.item||this).attr(b.attribute||"id")||"")}),d},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,e=d+this.helperProportions.height,f=a.left,g=f+a.width,h=a.top,i=h+a.height,j=this.offset.click.top,k=this.offset.click.left,l="x"===this.options.axis||d+j>h&&i>d+j,m="y"===this.options.axis||b+k>f&&g>b+k,n=l&&m;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?n:f<b+this.helperProportions.width/2&&c-this.helperProportions.width/2<g&&h<d+this.helperProportions.height/2&&e-this.helperProportions.height/2<i},_intersectsWithPointer:function(a){var c="x"===this.options.axis||b(this.positionAbs.top+this.offset.click.top,a.top,a.height),d="y"===this.options.axis||b(this.positionAbs.left+this.offset.click.left,a.left,a.width),e=c&&d,f=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();return e?this.floating?g&&"right"===g||"down"===f?2:1:f&&("down"===f?2:1):!1},_intersectsWithSides:function(a){var c=b(this.positionAbs.top+this.offset.click.top,a.top+a.height/2,a.height),d=b(this.positionAbs.left+this.offset.click.left,a.left+a.width/2,a.width),e=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return this.floating&&f?"right"===f&&d||"left"===f&&!d:e&&("down"===e&&c||"up"===e&&!c)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return 0!==a&&(a>0?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return 0!==a&&(a>0?"right":"left")},refresh:function(a){return this._refreshItems(a),this.refreshPositions(),this},_connectWith:function(){var a=this.options;return a.connectWith.constructor===String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(b){function c(){h.push(this)}var d,e,f,g,h=[],i=[],j=this._connectWith();if(j&&b)for(d=j.length-1;d>=0;d--)for(f=a(j[d]),e=f.length-1;e>=0;e--)g=a.data(f[e],this.widgetFullName),g&&g!==this&&!g.options.disabled&&i.push([a.isFunction(g.options.items)?g.options.items.call(g.element):a(g.options.items,g.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),g]);for(i.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),d=i.length-1;d>=0;d--)i[d][0].each(c);return a(h)},_removeCurrentsFromItems:function(){var b=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=a.grep(this.items,function(a){for(var c=0;c<b.length;c++)if(b[c]===a.item[0])return!1;return!0})},_refreshItems:function(b){this.items=[],this.containers=[this];var c,d,e,f,g,h,i,j,k=this.items,l=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]],m=this._connectWith();if(m&&this.ready)for(c=m.length-1;c>=0;c--)for(e=a(m[c]),d=e.length-1;d>=0;d--)f=a.data(e[d],this.widgetFullName),f&&f!==this&&!f.options.disabled&&(l.push([a.isFunction(f.options.items)?f.options.items.call(f.element[0],b,{item:this.currentItem}):a(f.options.items,f.element),f]),this.containers.push(f));for(c=l.length-1;c>=0;c--)for(g=l[c][1],h=l[c][0],d=0,j=h.length;j>d;d++)i=a(h[d]),i.data(this.widgetName+"-item",g),k.push({item:i,instance:g,width:0,height:0,left:0,top:0})},refreshPositions:function(b){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var c,d,e,f;for(c=this.items.length-1;c>=0;c--)d=this.items[c],d.instance!==this.currentContainer&&this.currentContainer&&d.item[0]!==this.currentItem[0]||(e=this.options.toleranceElement?a(this.options.toleranceElement,d.item):d.item,b||(d.width=e.outerWidth(),d.height=e.outerHeight()),f=e.offset(),d.left=f.left,d.top=f.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(c=this.containers.length-1;c>=0;c--)f=this.containers[c].element.offset(),this.containers[c].containerCache.left=f.left,this.containers[c].containerCache.top=f.top,this.containers[c].containerCache.width=this.containers[c].element.outerWidth(),this.containers[c].containerCache.height=this.containers[c].element.outerHeight();return this},_createPlaceholder:function(b){b=b||this;var c,d=b.options;d.placeholder&&d.placeholder.constructor!==String||(c=d.placeholder,d.placeholder={element:function(){var d=b.currentItem[0].nodeName.toLowerCase(),e=a("<"+d+">",b.document[0]).addClass(c||b.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===d?b.currentItem.children().each(function(){a("<td>&#160;</td>",b.document[0]).attr("colspan",a(this).attr("colspan")||1).appendTo(e)}):"img"===d&&e.attr("src",b.currentItem.attr("src")),c||e.css("visibility","hidden"),e},update:function(a,e){(!c||d.forcePlaceholderSize)&&(e.height()||e.height(b.currentItem.innerHeight()-parseInt(b.currentItem.css("paddingTop")||0,10)-parseInt(b.currentItem.css("paddingBottom")||0,10)),e.width()||e.width(b.currentItem.innerWidth()-parseInt(b.currentItem.css("paddingLeft")||0,10)-parseInt(b.currentItem.css("paddingRight")||0,10)))}}),b.placeholder=a(d.placeholder.element.call(b.element,b.currentItem)),b.currentItem.after(b.placeholder),d.placeholder.update(b,b.placeholder)},_contactContainers:function(d){var e,f,g,h,i,j,k,l,m,n,o=null,p=null;for(e=this.containers.length-1;e>=0;e--)if(!a.contains(this.currentItem[0],this.containers[e].element[0]))if(this._intersectsWith(this.containers[e].containerCache)){if(o&&a.contains(this.containers[e].element[0],o.element[0]))continue;o=this.containers[e],p=e}else this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",d,this._uiHash(this)),this.containers[e].containerCache.over=0);if(o)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",d,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(g=1e4,h=null,n=o.floating||c(this.currentItem),i=n?"left":"top",j=n?"width":"height",k=this.positionAbs[i]+this.offset.click[i],f=this.items.length-1;f>=0;f--)a.contains(this.containers[p].element[0],this.items[f].item[0])&&this.items[f].item[0]!==this.currentItem[0]&&(!n||b(this.positionAbs.top+this.offset.click.top,this.items[f].top,this.items[f].height))&&(l=this.items[f].item.offset()[i],m=!1,Math.abs(l-k)>Math.abs(l+this.items[f][j]-k)&&(m=!0,l+=this.items[f][j]),Math.abs(l-k)<g&&(g=Math.abs(l-k),h=this.items[f],this.direction=m?"up":"down"));if(!h&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return;h?this._rearrange(d,h,null,!0):this._rearrange(d,null,this.containers[p].element,!0),this._trigger("change",d,this._uiHash()),this.containers[p]._trigger("change",d,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",d,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b,this.currentItem])):"clone"===c.helper?this.currentItem.clone():this.currentItem;return d.parents("body").length||a("parent"!==c.appendTo?c.appendTo:this.currentItem[0].parentNode)[0].appendChild(d[0]),d[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!d[0].style.width||c.forceHelperSize)&&d.width(this.currentItem.width()),(!d[0].style.height||c.forceHelperSize)&&d.height(this.currentItem.height()),d},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)&&(b={top:0,left:0}),{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,c,d,e=this.options;"parent"===e.containment&&(e.containment=this.helper[0].parentNode),("document"===e.containment||"window"===e.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a("document"===e.containment?document:window).width()-this.helperProportions.width-this.margins.left,(a("document"===e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(e.containment)||(b=a(e.containment)[0],c=a(e.containment).offset(),d="hidden"!==a(b).css("overflow"),this.containment=[c.left+(parseInt(a(b).css("borderLeftWidth"),10)||0)+(parseInt(a(b).css("paddingLeft"),10)||0)-this.margins.left,c.top+(parseInt(a(b).css("borderTopWidth"),10)||0)+(parseInt(a(b).css("paddingTop"),10)||0)-this.margins.top,c.left+(d?Math.max(b.scrollWidth,b.offsetWidth):b.offsetWidth)-(parseInt(a(b).css("borderLeftWidth"),10)||0)-(parseInt(a(b).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,c.top+(d?Math.max(b.scrollHeight,b.offsetHeight):b.offsetHeight)-(parseInt(a(b).css("borderTopWidth"),10)||0)-(parseInt(a(b).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(b,c){c||(c=this.position);var d="absolute"===b?1:-1,e="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,f=/(html|body)/i.test(e[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():f?0:e.scrollTop())*d,left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():f?0:e.scrollLeft())*d}},_generatePosition:function(b){var c,d,e=this.options,f=b.pageX,g=b.pageY,h="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,i=/(html|body)/i.test(h[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(g=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(g=this.containment[3]+this.offset.click.top)),e.grid&&(c=this.originalPageY+Math.round((g-this.originalPageY)/e.grid[1])*e.grid[1],g=this.containment?c-this.offset.click.top>=this.containment[1]&&c-this.offset.click.top<=this.containment[3]?c:c-this.offset.click.top>=this.containment[1]?c-e.grid[1]:c+e.grid[1]:c,d=this.originalPageX+Math.round((f-this.originalPageX)/e.grid[0])*e.grid[0],f=this.containment?d-this.offset.click.left>=this.containment[0]&&d-this.offset.click.left<=this.containment[2]?d:d-this.offset.click.left>=this.containment[0]?d-e.grid[0]:d+e.grid[0]:d)),{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():i?0:h.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():i?0:h.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?b.item[0]:b.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var e=this.counter;this._delay(function(){e===this.counter&&this.refreshPositions(!d)})},_clear:function(a,b){function c(a,b,c){return function(d){c._trigger(a,d,b._uiHash(b))}}this.reverting=!1;var d,e=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(d in this._storedCSS)("auto"===this._storedCSS[d]||"static"===this._storedCSS[d])&&(this._storedCSS[d]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!b&&e.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||b||e.push(function(a){this._trigger("update",a,this._uiHash())}),this!==this.currentContainer&&(b||(e.push(function(a){this._trigger("remove",a,this._uiHash())}),e.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.currentContainer)),e.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.currentContainer)))),d=this.containers.length-1;d>=0;d--)b||e.push(c("deactivate",this,this.containers[d])),this.containers[d].containerCache.over&&(e.push(c("out",this,this.containers[d])),this.containers[d].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!b){for(this._trigger("beforeStop",a,this._uiHash()),d=0;d<e.length;d++)e[d].call(this,a);this._trigger("stop",a,this._uiHash())}return this.fromOutside=!1,!1}if(b||this._trigger("beforeStop",a,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!b){for(d=0;d<e.length;d++)e[d].call(this,a);this._trigger("stop",a,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(b){var c=b||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:b?b.element:null}}})}(jQuery),function(a){var b=5;a.widget("ui.slider",a.ui.mouse,{version:"1.10.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var b,c,d=this.options,e=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),f="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",g=[];for(c=d.values&&d.values.length||1,e.length>c&&(e.slice(c).remove(),e=e.slice(0,c)),b=e.length;c>b;b++)g.push(f);this.handles=e.add(a(g.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(b){a(this).data("ui-slider-handle-index",b)})},_createRange:function(){var b=this.options,c="";b.range?(b.range===!0&&(b.values?b.values.length&&2!==b.values.length?b.values=[b.values[0],b.values[0]]:a.isArray(b.values)&&(b.values=b.values.slice(0)):b.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=a("<div></div>").appendTo(this.element),c="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(c+("min"===b.range||"max"===b.range?" ui-slider-range-"+b.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){var a=this.handles.add(this.range).filter("a");this._off(a),this._on(a,this._handleEvents),this._hoverable(a),this._focusable(a)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(b){var c,d,e,f,g,h,i,j,k=this,l=this.options;return l.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),c={x:b.pageX,y:b.pageY},d=this._normValueFromMouse(c),e=this._valueMax()-this._valueMin()+1,this.handles.each(function(b){var c=Math.abs(d-k.values(b));(e>c||e===c&&(b===k._lastChangedValue||k.values(b)===l.min))&&(e=c,f=a(this),g=b)}),h=this._start(b,g),h===!1?!1:(this._mouseSliding=!0,this._handleIndex=g,f.addClass("ui-state-active").focus(),i=f.offset(),j=!a(b.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=j?{left:0,top:0}:{left:b.pageX-i.left-f.width()/2,top:b.pageY-i.top-f.height()/2-(parseInt(f.css("borderTopWidth"),10)||0)-(parseInt(f.css("borderBottomWidth"),10)||0)+(parseInt(f.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(b,g,d),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(a){var b={x:a.pageX,y:a.pageY},c=this._normValueFromMouse(b);return this._slide(a,this._handleIndex,c),!1},_mouseStop:function(a){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(a,this._handleIndex),this._change(a,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(a){var b,c,d,e,f;return"horizontal"===this.orientation?(b=this.elementSize.width,c=a.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(b=this.elementSize.height,c=a.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),d=c/b,d>1&&(d=1),0>d&&(d=0),"vertical"===this.orientation&&(d=1-d),e=this._valueMax()-this._valueMin(),f=this._valueMin()+d*e,this._trimAlignValue(f)},_start:function(a,b){var c={handle:this.handles[b],value:this.value()};return this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("start",a,c)},_slide:function(a,b,c){var d,e,f;this.options.values&&this.options.values.length?(d=this.values(b?0:1),2===this.options.values.length&&this.options.range===!0&&(0===b&&c>d||1===b&&d>c)&&(c=d),c!==this.values(b)&&(e=this.values(),e[b]=c,f=this._trigger("slide",a,{handle:this.handles[b],value:c,values:e}),d=this.values(b?0:1),f!==!1&&this.values(b,c))):c!==this.value()&&(f=this._trigger("slide",a,{handle:this.handles[b],value:c}),f!==!1&&this.value(c))},_stop:function(a,b){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._trigger("stop",a,c)},_change:function(a,b){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[b],value:this.value()};this.options.values&&this.options.values.length&&(c.value=this.values(b),c.values=this.values()),this._lastChangedValue=b,this._trigger("change",a,c)}},value:function(a){return arguments.length?(this.options.value=this._trimAlignValue(a),this._refreshValue(),void this._change(null,0)):this._value()},values:function(b,c){var d,e,f;if(arguments.length>1)return this.options.values[b]=this._trimAlignValue(c),this._refreshValue(),void this._change(null,b);if(!arguments.length)return this._values();if(!a.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(b):this.value();for(d=this.options.values,e=arguments[0],f=0;f<d.length;f+=1)d[f]=this._trimAlignValue(e[f]),this._change(null,f);this._refreshValue()},_setOption:function(b,c){var d,e=0;switch("range"===b&&this.options.range===!0&&("min"===c?(this.options.value=this._values(0),this.options.values=null):"max"===c&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),a.isArray(this.options.values)&&(e=this.options.values.length),a.Widget.prototype._setOption.apply(this,arguments),b){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),d=0;e>d;d+=1)this._change(null,d);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var a=this.options.value;return a=this._trimAlignValue(a)},_values:function(a){var b,c,d;if(arguments.length)return b=this.options.values[a],b=this._trimAlignValue(b);if(this.options.values&&this.options.values.length){for(c=this.options.values.slice(),d=0;d<c.length;d+=1)c[d]=this._trimAlignValue(c[d]);return c}return[]},_trimAlignValue:function(a){if(a<=this._valueMin())return this._valueMin();if(a>=this._valueMax())return this._valueMax();var b=this.options.step>0?this.options.step:1,c=(a-this._valueMin())%b,d=a-c;return 2*Math.abs(c)>=b&&(d+=c>0?b:-b),parseFloat(d.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var b,c,d,e,f,g=this.options.range,h=this.options,i=this,j=this._animateOff?!1:h.animate,k={};
this.options.values&&this.options.values.length?this.handles.each(function(d){c=(i.values(d)-i._valueMin())/(i._valueMax()-i._valueMin())*100,k["horizontal"===i.orientation?"left":"bottom"]=c+"%",a(this).stop(1,1)[j?"animate":"css"](k,h.animate),i.options.range===!0&&("horizontal"===i.orientation?(0===d&&i.range.stop(1,1)[j?"animate":"css"]({left:c+"%"},h.animate),1===d&&i.range[j?"animate":"css"]({width:c-b+"%"},{queue:!1,duration:h.animate})):(0===d&&i.range.stop(1,1)[j?"animate":"css"]({bottom:c+"%"},h.animate),1===d&&i.range[j?"animate":"css"]({height:c-b+"%"},{queue:!1,duration:h.animate}))),b=c}):(d=this.value(),e=this._valueMin(),f=this._valueMax(),c=f!==e?(d-e)/(f-e)*100:0,k["horizontal"===this.orientation?"left":"bottom"]=c+"%",this.handle.stop(1,1)[j?"animate":"css"](k,h.animate),"min"===g&&"horizontal"===this.orientation&&this.range.stop(1,1)[j?"animate":"css"]({width:c+"%"},h.animate),"max"===g&&"horizontal"===this.orientation&&this.range[j?"animate":"css"]({width:100-c+"%"},{queue:!1,duration:h.animate}),"min"===g&&"vertical"===this.orientation&&this.range.stop(1,1)[j?"animate":"css"]({height:c+"%"},h.animate),"max"===g&&"vertical"===this.orientation&&this.range[j?"animate":"css"]({height:100-c+"%"},{queue:!1,duration:h.animate}))},_handleEvents:{keydown:function(c){var d,e,f,g,h=a(c.target).data("ui-slider-handle-index");switch(c.keyCode){case a.ui.keyCode.HOME:case a.ui.keyCode.END:case a.ui.keyCode.PAGE_UP:case a.ui.keyCode.PAGE_DOWN:case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(c.preventDefault(),!this._keySliding&&(this._keySliding=!0,a(c.target).addClass("ui-state-active"),d=this._start(c,h),d===!1))return}switch(g=this.options.step,e=f=this.options.values&&this.options.values.length?this.values(h):this.value(),c.keyCode){case a.ui.keyCode.HOME:f=this._valueMin();break;case a.ui.keyCode.END:f=this._valueMax();break;case a.ui.keyCode.PAGE_UP:f=this._trimAlignValue(e+(this._valueMax()-this._valueMin())/b);break;case a.ui.keyCode.PAGE_DOWN:f=this._trimAlignValue(e-(this._valueMax()-this._valueMin())/b);break;case a.ui.keyCode.UP:case a.ui.keyCode.RIGHT:if(e===this._valueMax())return;f=this._trimAlignValue(e+g);break;case a.ui.keyCode.DOWN:case a.ui.keyCode.LEFT:if(e===this._valueMin())return;f=this._trimAlignValue(e-g)}this._slide(c,h,f)},click:function(a){a.preventDefault()},keyup:function(b){var c=a(b.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(b,c),this._change(b,c),a(b.target).removeClass("ui-state-active"))}}})}(jQuery),function(a,b){var c="ui-effects-";a.effects={effect:{}},function(a,b){function c(a,b,c){var d=l[b.type]||{};return null==a?c||!b.def?null:b.def:(a=d.floor?~~a:parseFloat(a),isNaN(a)?b.def:d.mod?(a+d.mod)%d.mod:0>a?0:d.max<a?d.max:a)}function d(b){var c=j(),d=c._rgba=[];return b=b.toLowerCase(),o(i,function(a,e){var f,g=e.re.exec(b),h=g&&e.parse(g),i=e.space||"rgba";return h?(f=c[i](h),c[k[i].cache]=f[k[i].cache],d=c._rgba=f._rgba,!1):void 0}),d.length?("0,0,0,0"===d.join()&&a.extend(d,f.transparent),c):f[b]}function e(a,b,c){return c=(c+1)%1,1>6*c?a+(b-a)*c*6:1>2*c?b:2>3*c?a+(b-a)*(2/3-c)*6:a}var f,g="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",h=/^([\-+])=\s*(\d+\.?\d*)/,i=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(a){return[a[1],a[2]/100,a[3]/100,a[4]]}}],j=a.Color=function(b,c,d,e){return new a.Color.fn.parse(b,c,d,e)},k={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},l={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},m=j.support={},n=a("<p>")[0],o=a.each;n.style.cssText="background-color:rgba(1,1,1,.5)",m.rgba=n.style.backgroundColor.indexOf("rgba")>-1,o(k,function(a,b){b.cache="_"+a,b.props.alpha={idx:3,type:"percent",def:1}}),j.fn=a.extend(j.prototype,{parse:function(e,g,h,i){if(e===b)return this._rgba=[null,null,null,null],this;(e.jquery||e.nodeType)&&(e=a(e).css(g),g=b);var l=this,m=a.type(e),n=this._rgba=[];return g!==b&&(e=[e,g,h,i],m="array"),"string"===m?this.parse(d(e)||f._default):"array"===m?(o(k.rgba.props,function(a,b){n[b.idx]=c(e[b.idx],b)}),this):"object"===m?(e instanceof j?o(k,function(a,b){e[b.cache]&&(l[b.cache]=e[b.cache].slice())}):o(k,function(b,d){var f=d.cache;o(d.props,function(a,b){if(!l[f]&&d.to){if("alpha"===a||null==e[a])return;l[f]=d.to(l._rgba)}l[f][b.idx]=c(e[a],b,!0)}),l[f]&&a.inArray(null,l[f].slice(0,3))<0&&(l[f][3]=1,d.from&&(l._rgba=d.from(l[f])))}),this):void 0},is:function(a){var b=j(a),c=!0,d=this;return o(k,function(a,e){var f,g=b[e.cache];return g&&(f=d[e.cache]||e.to&&e.to(d._rgba)||[],o(e.props,function(a,b){return null!=g[b.idx]?c=g[b.idx]===f[b.idx]:void 0})),c}),c},_space:function(){var a=[],b=this;return o(k,function(c,d){b[d.cache]&&a.push(c)}),a.pop()},transition:function(a,b){var d=j(a),e=d._space(),f=k[e],g=0===this.alpha()?j("transparent"):this,h=g[f.cache]||f.to(g._rgba),i=h.slice();return d=d[f.cache],o(f.props,function(a,e){var f=e.idx,g=h[f],j=d[f],k=l[e.type]||{};null!==j&&(null===g?i[f]=j:(k.mod&&(j-g>k.mod/2?g+=k.mod:g-j>k.mod/2&&(g-=k.mod)),i[f]=c((j-g)*b+g,e)))}),this[e](i)},blend:function(b){if(1===this._rgba[3])return this;var c=this._rgba.slice(),d=c.pop(),e=j(b)._rgba;return j(a.map(c,function(a,b){return(1-d)*e[b]+d*a}))},toRgbaString:function(){var b="rgba(",c=a.map(this._rgba,function(a,b){return null==a?b>2?1:0:a});return 1===c[3]&&(c.pop(),b="rgb("),b+c.join()+")"},toHslaString:function(){var b="hsla(",c=a.map(this.hsla(),function(a,b){return null==a&&(a=b>2?1:0),b&&3>b&&(a=Math.round(100*a)+"%"),a});return 1===c[3]&&(c.pop(),b="hsl("),b+c.join()+")"},toHexString:function(b){var c=this._rgba.slice(),d=c.pop();return b&&c.push(~~(255*d)),"#"+a.map(c,function(a){return a=(a||0).toString(16),1===a.length?"0"+a:a}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),j.fn.parse.prototype=j.fn,k.hsla.to=function(a){if(null==a[0]||null==a[1]||null==a[2])return[null,null,null,a[3]];var b,c,d=a[0]/255,e=a[1]/255,f=a[2]/255,g=a[3],h=Math.max(d,e,f),i=Math.min(d,e,f),j=h-i,k=h+i,l=.5*k;return b=i===h?0:d===h?60*(e-f)/j+360:e===h?60*(f-d)/j+120:60*(d-e)/j+240,c=0===j?0:.5>=l?j/k:j/(2-k),[Math.round(b)%360,c,l,null==g?1:g]},k.hsla.from=function(a){if(null==a[0]||null==a[1]||null==a[2])return[null,null,null,a[3]];var b=a[0]/360,c=a[1],d=a[2],f=a[3],g=.5>=d?d*(1+c):d+c-d*c,h=2*d-g;return[Math.round(255*e(h,g,b+1/3)),Math.round(255*e(h,g,b)),Math.round(255*e(h,g,b-1/3)),f]},o(k,function(d,e){var f=e.props,g=e.cache,i=e.to,k=e.from;j.fn[d]=function(d){if(i&&!this[g]&&(this[g]=i(this._rgba)),d===b)return this[g].slice();var e,h=a.type(d),l="array"===h||"object"===h?d:arguments,m=this[g].slice();return o(f,function(a,b){var d=l["object"===h?a:b.idx];null==d&&(d=m[b.idx]),m[b.idx]=c(d,b)}),k?(e=j(k(m)),e[g]=m,e):j(m)},o(f,function(b,c){j.fn[b]||(j.fn[b]=function(e){var f,g=a.type(e),i="alpha"===b?this._hsla?"hsla":"rgba":d,j=this[i](),k=j[c.idx];return"undefined"===g?k:("function"===g&&(e=e.call(this,k),g=a.type(e)),null==e&&c.empty?this:("string"===g&&(f=h.exec(e),f&&(e=k+parseFloat(f[2])*("+"===f[1]?1:-1))),j[c.idx]=e,this[i](j)))})})}),j.hook=function(b){var c=b.split(" ");o(c,function(b,c){a.cssHooks[c]={set:function(b,e){var f,g,h="";if("transparent"!==e&&("string"!==a.type(e)||(f=d(e)))){if(e=j(f||e),!m.rgba&&1!==e._rgba[3]){for(g="backgroundColor"===c?b.parentNode:b;(""===h||"transparent"===h)&&g&&g.style;)try{h=a.css(g,"backgroundColor"),g=g.parentNode}catch(i){}e=e.blend(h&&"transparent"!==h?h:"_default")}e=e.toRgbaString()}try{b.style[c]=e}catch(i){}}},a.fx.step[c]=function(b){b.colorInit||(b.start=j(b.elem,c),b.end=j(b.end),b.colorInit=!0),a.cssHooks[c].set(b.elem,b.start.transition(b.end,b.pos))}})},j.hook(g),a.cssHooks.borderColor={expand:function(a){var b={};return o(["Top","Right","Bottom","Left"],function(c,d){b["border"+d+"Color"]=a}),b}},f=a.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function c(b){var c,d,e=b.ownerDocument.defaultView?b.ownerDocument.defaultView.getComputedStyle(b,null):b.currentStyle,f={};if(e&&e.length&&e[0]&&e[e[0]])for(d=e.length;d--;)c=e[d],"string"==typeof e[c]&&(f[a.camelCase(c)]=e[c]);else for(c in e)"string"==typeof e[c]&&(f[c]=e[c]);return f}function d(b,c){var d,e,g={};for(d in c)e=c[d],b[d]!==e&&(f[d]||(a.fx.step[d]||!isNaN(parseFloat(e)))&&(g[d]=e));return g}var e=["add","remove","toggle"],f={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};a.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(b,c){a.fx.step[c]=function(a){("none"!==a.end&&!a.setAttr||1===a.pos&&!a.setAttr)&&(jQuery.style(a.elem,c,a.end),a.setAttr=!0)}}),a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}),a.effects.animateClass=function(b,f,g,h){var i=a.speed(f,g,h);return this.queue(function(){var f,g=a(this),h=g.attr("class")||"",j=i.children?g.find("*").addBack():g;j=j.map(function(){var b=a(this);return{el:b,start:c(this)}}),f=function(){a.each(e,function(a,c){b[c]&&g[c+"Class"](b[c])})},f(),j=j.map(function(){return this.end=c(this.el[0]),this.diff=d(this.start,this.end),this}),g.attr("class",h),j=j.map(function(){var b=this,c=a.Deferred(),d=a.extend({},i,{queue:!1,complete:function(){c.resolve(b)}});return this.el.animate(this.diff,d),c.promise()}),a.when.apply(a,j.get()).done(function(){f(),a.each(arguments,function(){var b=this.el;a.each(this.diff,function(a){b.css(a,"")})}),i.complete.call(g[0])})})},a.fn.extend({addClass:function(b){return function(c,d,e,f){return d?a.effects.animateClass.call(this,{add:c},d,e,f):b.apply(this,arguments)}}(a.fn.addClass),removeClass:function(b){return function(c,d,e,f){return arguments.length>1?a.effects.animateClass.call(this,{remove:c},d,e,f):b.apply(this,arguments)}}(a.fn.removeClass),toggleClass:function(c){return function(d,e,f,g,h){return"boolean"==typeof e||e===b?f?a.effects.animateClass.call(this,e?{add:d}:{remove:d},f,g,h):c.apply(this,arguments):a.effects.animateClass.call(this,{toggle:d},e,f,g)}}(a.fn.toggleClass),switchClass:function(b,c,d,e,f){return a.effects.animateClass.call(this,{add:c,remove:b},d,e,f)}})}(),function(){function d(b,c,d,e){return a.isPlainObject(b)&&(c=b,b=b.effect),b={effect:b},null==c&&(c={}),a.isFunction(c)&&(e=c,d=null,c={}),("number"==typeof c||a.fx.speeds[c])&&(e=d,d=c,c={}),a.isFunction(d)&&(e=d,d=null),c&&a.extend(b,c),d=d||c.duration,b.duration=a.fx.off?0:"number"==typeof d?d:d in a.fx.speeds?a.fx.speeds[d]:a.fx.speeds._default,b.complete=e||c.complete,b}function e(b){return!b||"number"==typeof b||a.fx.speeds[b]?!0:"string"!=typeof b||a.effects.effect[b]?a.isFunction(b)?!0:"object"!=typeof b||b.effect?!1:!0:!0}a.extend(a.effects,{version:"1.10.4",save:function(a,b){for(var d=0;d<b.length;d++)null!==b[d]&&a.data(c+b[d],a[0].style[b[d]])},restore:function(a,d){var e,f;for(f=0;f<d.length;f++)null!==d[f]&&(e=a.data(c+d[f]),e===b&&(e=""),a.css(d[f],e))},setMode:function(a,b){return"toggle"===b&&(b=a.is(":hidden")?"show":"hide"),b},getBaseline:function(a,b){var c,d;switch(a[0]){case"top":c=0;break;case"middle":c=.5;break;case"bottom":c=1;break;default:c=a[0]/b.height}switch(a[1]){case"left":d=0;break;case"center":d=.5;break;case"right":d=1;break;default:d=a[1]/b.width}return{x:d,y:c}},createWrapper:function(b){if(b.parent().is(".ui-effects-wrapper"))return b.parent();var c={width:b.outerWidth(!0),height:b.outerHeight(!0),"float":b.css("float")},d=a("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),e={width:b.width(),height:b.height()},f=document.activeElement;try{f.id}catch(g){f=document.body}return b.wrap(d),(b[0]===f||a.contains(b[0],f))&&a(f).focus(),d=b.parent(),"static"===b.css("position")?(d.css({position:"relative"}),b.css({position:"relative"})):(a.extend(c,{position:b.css("position"),zIndex:b.css("z-index")}),a.each(["top","left","bottom","right"],function(a,d){c[d]=b.css(d),isNaN(parseInt(c[d],10))&&(c[d]="auto")}),b.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),b.css(e),d.css(c).show()},removeWrapper:function(b){var c=document.activeElement;return b.parent().is(".ui-effects-wrapper")&&(b.parent().replaceWith(b),(b[0]===c||a.contains(b[0],c))&&a(c).focus()),b},setTransition:function(b,c,d,e){return e=e||{},a.each(c,function(a,c){var f=b.cssUnit(c);f[0]>0&&(e[c]=f[0]*d+f[1])}),e}}),a.fn.extend({effect:function(){function b(b){function d(){a.isFunction(f)&&f.call(e[0]),a.isFunction(b)&&b()}var e=a(this),f=c.complete,h=c.mode;(e.is(":hidden")?"hide"===h:"show"===h)?(e[h](),d()):g.call(e[0],c,d)}var c=d.apply(this,arguments),e=c.mode,f=c.queue,g=a.effects.effect[c.effect];return a.fx.off||!g?e?this[e](c.duration,c.complete):this.each(function(){c.complete&&c.complete.call(this)}):f===!1?this.each(b):this.queue(f||"fx",b)},show:function(a){return function(b){if(e(b))return a.apply(this,arguments);var c=d.apply(this,arguments);return c.mode="show",this.effect.call(this,c)}}(a.fn.show),hide:function(a){return function(b){if(e(b))return a.apply(this,arguments);var c=d.apply(this,arguments);return c.mode="hide",this.effect.call(this,c)}}(a.fn.hide),toggle:function(a){return function(b){if(e(b)||"boolean"==typeof b)return a.apply(this,arguments);var c=d.apply(this,arguments);return c.mode="toggle",this.effect.call(this,c)}}(a.fn.toggle),cssUnit:function(b){var c=this.css(b),d=[];return a.each(["em","px","%","pt"],function(a,b){c.indexOf(b)>0&&(d=[parseFloat(c),b])}),d}})}(),function(){var b={};a.each(["Quad","Cubic","Quart","Quint","Expo"],function(a,c){b[c]=function(b){return Math.pow(b,a+2)}}),a.extend(b,{Sine:function(a){return 1-Math.cos(a*Math.PI/2)},Circ:function(a){return 1-Math.sqrt(1-a*a)},Elastic:function(a){return 0===a||1===a?a:-Math.pow(2,8*(a-1))*Math.sin((80*(a-1)-7.5)*Math.PI/15)},Back:function(a){return a*a*(3*a-2)},Bounce:function(a){for(var b,c=4;a<((b=Math.pow(2,--c))-1)/11;);return 1/Math.pow(4,3-c)-7.5625*Math.pow((3*b-2)/22-a,2)}}),a.each(b,function(b,c){a.easing["easeIn"+b]=c,a.easing["easeOut"+b]=function(a){return 1-c(1-a)},a.easing["easeInOut"+b]=function(a){return.5>a?c(2*a)/2:1-c(-2*a+2)/2}})}()}(jQuery),function(a){a.effects.effect.slide=function(b,c){var d,e=a(this),f=["position","top","bottom","left","right","width","height"],g=a.effects.setMode(e,b.mode||"show"),h="show"===g,i=b.direction||"left",j="up"===i||"down"===i?"top":"left",k="up"===i||"left"===i,l={};a.effects.save(e,f),e.show(),d=b.distance||e["top"===j?"outerHeight":"outerWidth"](!0),a.effects.createWrapper(e).css({overflow:"hidden"}),h&&e.css(j,k?isNaN(d)?"-"+d:-d:d),l[j]=(h?k?"+=":"-=":k?"-=":"+=")+d,e.animate(l,{queue:!1,duration:b.duration,easing:b.easing,complete:function(){"hide"===g&&e.hide(),a.effects.restore(e,f),a.effects.removeWrapper(e),c()}})}}(jQuery),function(a){var b=function(b){var c=a('<div class="selection"></div>'),d=a('<input type="hidden" name="" value="" />'),e=a('<div class="triangle"></div>'),f=null,g={onChange:function(){return null}},h=function(){var a=!1;if(b.hasClass("opened"))b.removeClass("opened"),f.css({height:""});else{a=!0,i(),b.addClass("opened");var c=m(f),d=b.children(".nano"),e=parseInt(f.css("max-height"),10);f.css({height:c}),d.length&&e&&setTimeout(function(){d.css("position","relative"),d.nanoScroller({preventPageScrolling:!0,alwaysVisible:!0}),d.css("position",""),b.hide().show(0)},125),b.trigger("open")}if(a){var g;(g=f.find(".filter"))&&g.focus()}},i=function(){var b=a(".combobox, .opened");b.find(".options").css({height:""}),b.removeClass("opened")},j=function(a){return a||(a=window.event),a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0,a.preventDefault&&a.preventDefault(),a.returnValue=!1,!1},k=function(a,b){return b.filter(function(){return-1!==this.textContent.toLowerCase().indexOf(a)})},l=function(a,b){return b},m=function(b){var c=0;return b.children(":not(.pane)").each(function(){var b=a(this);"none"!=b.css("display")&&(c+=a(this).outerHeight(!0))}),c};this.run=function(){f=b.children(".options"),f.removeClass("opened"),0==b.find(".selection").length?b.prepend(e).prepend(c).append(d):(c=b.find(".selection"),d=b.find('input[type="hidden"]')),b.find(".triangle").unbind("click"),b.find(".triangle").click(function(a){h(),this.lazyload(),j(a)}.bind(this)),c.unbind("click"),c.click(function(a){h(),this.lazyload(),j(a)}.bind(this)),a("body").click(function(){b.hasClass("opened")&&(h(),b.trigger("close"))}),f.off("click",".item"),f.on("click",".item",function(){("function"!=typeof g.maybe||g.maybe(a(this),a(this).attr("data-value"),a(this)))&&(a('div[name="'+b.attr("name")+'"]').find(".selection").html(a(this).html()),d.attr("value",a(this).attr("data-value")),f.find(".item").removeClass("selected"),a(this).addClass("selected"),h(),g.onChange(b.attr("name"),a(this).attr("data-value"),a(this)))}),c.html(b.find(".selected").html()),d.attr("name",b.attr("name")).attr("value",b.find(".selected").attr("value"))},this.lazyload=function(){f.find("img.lazyload").each(function(){a(this).attr("src",a(this).attr("data-src")),a(this).removeClass("lazyload")})},this.init=function(b){b&&a.extend(g,b),this.run()},this.setupFilter=function(b){var c=f.children(".item[data-value]").filter(function(){return a(this).attr("data-value").length});this._original_options=c.clone(!0);var d=a(document.createElement("input")).attr({type:"text","class":"filter placeholder-onkeydown",title:b}).keyup(this.filterKeyUp.bind(this)).click(function(a){a.preventDefault(),a.stopPropagation()});Imgur.getInstance().runPlaceholder(d),f.prepend(d)},this.setFilter=function(a,b){a||(a=k),this.filter?this.filter=a:(this.filter=a,this.setupFilter(b))},this.filterKeyUp=function(b){var c=a(b.target).val();if(c.length)var d=this.applyFilter(c);else var d=this.applyFilter(c,l);f.find(".item").remove(),f.append(d),f.css("height",Math.max(m(d),a(b.target).outerHeight())),this.lazyload()},this.applyFilter=function(a,b){return(b=b||this.filter)(a,this._original_options)}};methods={init:function(c){return this.each(function(){var d=new b(a(this));d.init(c);var e=a(this);e.data("combobox",d)})},filter:function(b){return b||(b={}),this.each(function(){var c=a(this);if(c.data("combobox")){var d=c.data("combobox");d.setFilter(b.filter,b.placeholder)}})}},a.fn.combobox=function(b){return methods[b]?methods[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?a.error("Method "+b+" does not exist"):methods.init.apply(this,arguments)}}(jQuery),function(){var a={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},b="webkit moz o ms khtml".split(" ");if("undefined"!=typeof document.cancelFullScreen)a.supportsFullScreen=!0;else for(var c=0,d=b.length;d>c;c++)if(a.prefix=b[c],"undefined"!=typeof document[a.prefix+"CancelFullScreen"]){a.supportsFullScreen=!0;break}a.supportsFullScreen&&(a.fullScreenEventName=a.prefix+"fullscreenchange",a.isFullScreen=function(){switch(this.prefix){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}},a.requestFullScreen=function(a){return""===this.prefix?a.requestFullScreen():a[this.prefix+"RequestFullScreen"]()},a.cancelFullScreen=function(){return""===this.prefix?document.cancelFullScreen():document[this.prefix+"CancelFullScreen"]()}),"undefined"!=typeof jQuery&&(jQuery.fn.requestFullScreen=function(){return this.each(function(){a.supportsFullScreen&&a.requestFullScreen(this)})}),window.fullScreenApi=a}(),function(a){a.extend(a.fn,{validate:function(b){if(!this.length)return void(b&&b.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing"));var c=a.data(this[0],"validator");return c?c:(c=new a.validator(b,this[0]),a.data(this[0],"validator",c),c.settings.onsubmit&&(this.find("input, button").filter(".cancel").click(function(){c.cancelSubmit=!0}),c.settings.submitHandler&&this.find("input, button").filter(":submit").click(function(){c.submitButton=this}),this.submit(function(b){function d(){if(c.settings.submitHandler){if(c.submitButton)var b=a("<input type='hidden'/>").attr("name",c.submitButton.name).val(c.submitButton.value).appendTo(c.currentForm);return c.settings.submitHandler.call(c,c.currentForm),c.submitButton&&b.remove(),!1}return!0}return c.settings.debug&&b.preventDefault(),c.cancelSubmit?(c.cancelSubmit=!1,d()):c.form()?c.pendingRequest?(c.formSubmitted=!0,!1):d():(c.focusInvalid(),!1)})),c)},valid:function(){if(a(this[0]).is("form"))return this.validate().form();var b=!0,c=a(this[0].form).validate();return this.each(function(){b&=c.element(this)}),b},removeAttrs:function(b){var c={},d=this;return a.each(b.split(/\s/),function(a,b){c[b]=d.attr(b),d.removeAttr(b)}),c},rules:function(b,c){var d=this[0];if(b){var e=a.data(d.form,"validator").settings,f=e.rules,g=a.validator.staticRules(d);switch(b){case"add":a.extend(g,a.validator.normalizeRule(c)),f[d.name]=g,c.messages&&(e.messages[d.name]=a.extend(e.messages[d.name],c.messages));break;case"remove":if(!c)return delete f[d.name],g;var h={};return a.each(c.split(/\s/),function(a,b){h[b]=g[b],delete g[b]}),h}}var i=a.validator.normalizeRules(a.extend({},a.validator.metadataRules(d),a.validator.classRules(d),a.validator.attributeRules(d),a.validator.staticRules(d)),d);if(i.required){var j=i.required;delete i.required,i=a.extend({required:j},i)}return i}}),a.extend(a.expr[":"],{blank:function(b){return!a.trim(""+b.value)},filled:function(b){return!!a.trim(""+b.value)},unchecked:function(a){return!a.checked}}),a.validator=function(b,c){this.settings=a.extend(!0,{},a.validator.defaults,b),this.currentForm=c,this.init()},a.validator.format=function(b,c){return 1==arguments.length?function(){var c=a.makeArray(arguments);return c.unshift(b),a.validator.format.apply(this,c)}:(arguments.length>2&&c.constructor!=Array&&(c=a.makeArray(arguments).slice(1)),c.constructor!=Array&&(c=[c]),a.each(c,function(a,c){b=b.replace(new RegExp("\\{"+a+"\\}","g"),c)}),b)},a.extend(a.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:!0,errorContainer:a([]),errorLabelContainer:a([]),onsubmit:!0,ignore:[],ignoreTitle:!1,onfocusin:function(a){this.lastActive=a,this.settings.focusCleanup&&!this.blockFocusCleanup&&(this.settings.unhighlight&&this.settings.unhighlight.call(this,a,this.settings.errorClass,this.settings.validClass),this.addWrapper(this.errorsFor(a)).hide())},onfocusout:function(a){this.checkable(a)||!(a.name in this.submitted)&&this.optional(a)||this.element(a)},onkeyup:function(a){(a.name in this.submitted||a==this.lastElement)&&this.element(a)},onclick:function(a){a.name in this.submitted?this.element(a):a.parentNode.name in this.submitted&&this.element(a.parentNode)},highlight:function(b,c,d){"radio"===b.type?this.findByName(b.name).addClass(c).removeClass(d):a(b).addClass(c).removeClass(d)},unhighlight:function(b,c,d){"radio"===b.type?this.findByName(b.name).removeClass(c).addClass(d):a(b).removeClass(c).addClass(d)}},setDefaults:function(b){a.extend(a.validator.defaults,b)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:a.validator.format("Please enter no more than {0} characters."),minlength:a.validator.format("Please enter at least {0} characters."),rangelength:a.validator.format("Please enter a value between {0} and {1} characters long."),range:a.validator.format("Please enter a value between {0} and {1}."),max:a.validator.format("Please enter a value less than or equal to {0}."),min:a.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:!1,prototype:{init:function(){function b(b){var c=a.data(this[0].form,"validator"),d="on"+b.type.replace(/^validate/,"");c.settings[d]&&c.settings[d].call(c,this[0])}this.labelContainer=a(this.settings.errorLabelContainer),this.errorContext=this.labelContainer.length&&this.labelContainer||a(this.currentForm),this.containers=a(this.settings.errorContainer).add(this.settings.errorLabelContainer),this.submitted={},this.valueCache={},this.pendingRequest=0,this.pending={},this.invalid={},this.reset();var c=this.groups={};a.each(this.settings.groups,function(b,d){a.each(d.split(/\s/),function(a,d){c[d]=b})});var d=this.settings.rules;a.each(d,function(b,c){d[b]=a.validator.normalizeRule(c)}),a(this.currentForm).validateDelegate(":text, :password, :file, select, textarea","focusin focusout keyup",b).validateDelegate(":radio, :checkbox, select, option","click",b),this.settings.invalidHandler&&a(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)},form:function(){return this.checkForm(),a.extend(this.submitted,this.errorMap),this.invalid=a.extend({},this.errorMap),this.valid()||a(this.currentForm).triggerHandler("invalid-form",[this]),this.showErrors(),this.valid()},checkForm:function(){this.prepareForm();for(var a=0,b=this.currentElements=this.elements();b[a];a++)this.check(b[a]);return this.valid()},element:function(b){b=this.clean(b),this.lastElement=b,this.prepareElement(b),this.currentElements=a(b);var c=this.check(b);return c?delete this.invalid[b.name]:this.invalid[b.name]=!0,this.numberOfInvalids()||(this.toHide=this.toHide.add(this.containers)),this.showErrors(),c},showErrors:function(b){if(b){a.extend(this.errorMap,b),this.errorList=[];for(var c in b)this.errorList.push({message:b[c],element:this.findByName(c)[0]});this.successList=a.grep(this.successList,function(a){return!(a.name in b)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){a.fn.resetForm&&a(this.currentForm).resetForm(),this.submitted={},this.prepareForm(),this.hideErrors(),this.elements().removeClass(this.settings.errorClass)},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(a){var b=0;for(var c in a)b++;return b},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return 0==this.size()},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid)try{a(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(b){}},findLastActive:function(){var b=this.lastActive;return b&&1==a.grep(this.errorList,function(a){return a.element.name==b.name}).length&&b},elements:function(){var b=this,c={};return a(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){return!this.name&&b.settings.debug&&window.console&&console.error("%o has no name assigned",this),this.name in c||!b.objectLength(a(this).rules())?!1:(c[this.name]=!0,!0)})},clean:function(b){return a(b)[0]},errors:function(){return a(this.settings.errorElement+"."+this.settings.errorClass,this.errorContext)},reset:function(){this.successList=[],this.errorList=[],this.errorMap={},this.toShow=a([]),this.toHide=a([]),this.currentElements=a([])},prepareForm:function(){this.reset(),this.toHide=this.errors().add(this.containers)},prepareElement:function(a){this.reset(),this.toHide=this.errorsFor(a)},check:function(b){b=this.clean(b),this.checkable(b)&&(b=this.findByName(b.name).not(this.settings.ignore)[0]);var c=a(b).rules(),d=!1;for(var e in c){var f={method:e,parameters:c[e]};try{var g=a.validator.methods[e].call(this,b.value.replace(/\r/g,""),b,f.parameters);if("dependency-mismatch"==g){d=!0;continue}if(d=!1,"pending"==g)return void(this.toHide=this.toHide.not(this.errorsFor(b)));if(!g)return this.formatAndAdd(b,f),!1}catch(h){throw this.settings.debug&&window.console&&console.log("exception occured when checking element "+b.id+", check the '"+f.method+"' method",h),h}}return d?void 0:(this.objectLength(c)&&this.successList.push(b),!0)},customMetaMessage:function(b,c){if(a.metadata){var d=this.settings.meta?a(b).metadata()[this.settings.meta]:a(b).metadata();return d&&d.messages&&d.messages[c]}},customMessage:function(a,b){var c=this.settings.messages[a];return c&&(c.constructor==String?c:c[b])},findDefined:function(){for(var a=0;a<arguments.length;a++)if(void 0!==arguments[a])return arguments[a];return void 0},defaultMessage:function(b,c){return this.findDefined(this.customMessage(b.name,c),this.customMetaMessage(b,c),!this.settings.ignoreTitle&&b.title||void 0,a.validator.messages[c],"<strong>Warning: No message defined for "+b.name+"</strong>")},formatAndAdd:function(a,b){var c=this.defaultMessage(a,b.method),d=/\$?\{(\d+)\}/g;"function"==typeof c?c=c.call(this,b.parameters,a):d.test(c)&&(c=jQuery.format(c.replace(d,"{$1}"),b.parameters)),this.errorList.push({message:c,element:a}),this.errorMap[a.name]=c,this.submitted[a.name]=c},addWrapper:function(a){return this.settings.wrapper&&(a=a.add(a.parent(this.settings.wrapper))),a},defaultShowErrors:function(){for(var a=0;this.errorList[a];a++){var b=this.errorList[a];this.settings.highlight&&this.settings.highlight.call(this,b.element,this.settings.errorClass,this.settings.validClass),this.showLabel(b.element,b.message)}if(this.errorList.length&&(this.toShow=this.toShow.add(this.containers)),this.settings.success)for(var a=0;this.successList[a];a++)this.showLabel(this.successList[a]);if(this.settings.unhighlight)for(var a=0,c=this.validElements();c[a];a++)this.settings.unhighlight.call(this,c[a],this.settings.errorClass,this.settings.validClass);this.toHide=this.toHide.not(this.toShow),this.hideErrors(),this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return a(this.errorList).map(function(){return this.element})},showLabel:function(b,c){var d=this.errorsFor(b);d.length?(d.removeClass().addClass(this.settings.errorClass),d.attr("generated")&&d.html(c)):(d=a("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(b),generated:!0}).addClass(this.settings.errorClass).html(c||""),this.settings.wrapper&&(d=d.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()),this.labelContainer.append(d).length||(this.settings.errorPlacement?this.settings.errorPlacement(d,a(b)):d.insertAfter(b))),!c&&this.settings.success&&(d.text(""),"string"==typeof this.settings.success?d.addClass(this.settings.success):this.settings.success(d)),this.toShow=this.toShow.add(d)
},errorsFor:function(b){var c=this.idOrName(b);return this.errors().filter(function(){return a(this).attr("for")==c})},idOrName:function(a){return this.groups[a.name]||(this.checkable(a)?a.name:a.id||a.name)},checkable:function(a){return/radio|checkbox/i.test(a.type)},findByName:function(b){var c=this.currentForm;return a(document.getElementsByName(b)).map(function(a,d){return d.form==c&&d.name==b&&d||null})},getLength:function(b,c){switch(c.nodeName.toLowerCase()){case"select":return a("option:selected",c).length;case"input":if(this.checkable(c))return this.findByName(c.name).filter(":checked").length}return b.length},depend:function(a,b){return this.dependTypes[typeof a]?this.dependTypes[typeof a](a,b):!0},dependTypes:{"boolean":function(a){return a},string:function(b,c){return!!a(b,c.form).length},"function":function(a,b){return a(b)}},optional:function(b){return!a.validator.methods.required.call(this,a.trim(b.value),b)&&"dependency-mismatch"},startRequest:function(a){this.pending[a.name]||(this.pendingRequest++,this.pending[a.name]=!0)},stopRequest:function(b,c){this.pendingRequest--,this.pendingRequest<0&&(this.pendingRequest=0),delete this.pending[b.name],c&&0==this.pendingRequest&&this.formSubmitted&&this.form()?(a(this.currentForm).submit(),this.formSubmitted=!1):!c&&0==this.pendingRequest&&this.formSubmitted&&(a(this.currentForm).triggerHandler("invalid-form",[this]),this.formSubmitted=!1)},previousValue:function(b){return a.data(b,"previousValue")||a.data(b,"previousValue",{old:null,valid:!0,message:this.defaultMessage(b,"remote")})}},classRuleSettings:{required:{required:!0},email:{email:!0},url:{url:!0},date:{date:!0},dateISO:{dateISO:!0},dateDE:{dateDE:!0},number:{number:!0},numberDE:{numberDE:!0},digits:{digits:!0},creditcard:{creditcard:!0}},addClassRules:function(b,c){b.constructor==String?this.classRuleSettings[b]=c:a.extend(this.classRuleSettings,b)},classRules:function(b){var c={},d=a(b).attr("class");return d&&a.each(d.split(" "),function(){this in a.validator.classRuleSettings&&a.extend(c,a.validator.classRuleSettings[this])}),c},attributeRules:function(b){var c={},d=a(b);for(var e in a.validator.methods){var f=d.attr(e);f&&(c[e]=f)}return c.maxlength&&/-1|2147483647|524288/.test(c.maxlength)&&delete c.maxlength,c},metadataRules:function(b){if(!a.metadata)return{};var c=a.data(b.form,"validator").settings.meta;return c?a(b).metadata()[c]:a(b).metadata()},staticRules:function(b){var c={},d=a.data(b.form,"validator");return d.settings.rules&&(c=a.validator.normalizeRule(d.settings.rules[b.name])||{}),c},normalizeRules:function(b,c){return a.each(b,function(d,e){if(e===!1)return void delete b[d];if(e.param||e.depends){var f=!0;switch(typeof e.depends){case"string":f=!!a(e.depends,c.form).length;break;case"function":f=e.depends.call(c,c)}f?b[d]=void 0!==e.param?e.param:!0:delete b[d]}}),a.each(b,function(d,e){b[d]=a.isFunction(e)?e(c):e}),a.each(["minlength","maxlength","min","max"],function(){b[this]&&(b[this]=Number(b[this]))}),a.each(["rangelength","range"],function(){b[this]&&(b[this]=[Number(b[this][0]),Number(b[this][1])])}),a.validator.autoCreateRanges&&(b.min&&b.max&&(b.range=[b.min,b.max],delete b.min,delete b.max),b.minlength&&b.maxlength&&(b.rangelength=[b.minlength,b.maxlength],delete b.minlength,delete b.maxlength)),b.messages&&delete b.messages,b},normalizeRule:function(b){if("string"==typeof b){var c={};a.each(b.split(/\s/),function(){c[this]=!0}),b=c}return b},addMethod:function(b,c,d){a.validator.methods[b]=c,a.validator.messages[b]=void 0!=d?d:a.validator.messages[b],c.length<3&&a.validator.addClassRules(b,a.validator.normalizeRule(b))},methods:{required:function(b,c,d){if(!this.depend(d,c))return"dependency-mismatch";switch(c.nodeName.toLowerCase()){case"select":var e=a(c).val();return e&&e.length>0;case"input":if(this.checkable(c))return this.getLength(b,c)>0;default:return a.trim(b).length>0}},remote:function(b,c,d){if(this.optional(c))return"dependency-mismatch";var e=this.previousValue(c);if(this.settings.messages[c.name]||(this.settings.messages[c.name]={}),e.originalMessage=this.settings.messages[c.name].remote,this.settings.messages[c.name].remote=e.message,d="string"==typeof d&&{url:d}||d,this.pending[c.name])return"pending";if(e.old===b)return e.valid;e.old=b;var f=this;this.startRequest(c);var g={};return g[c.name]=b,a.ajax(a.extend(!0,{url:d,mode:"abort",port:"validate"+c.name,dataType:"json",data:g,success:function(d){f.settings.messages[c.name].remote=e.originalMessage;var g=d===!0;if(g){var h=f.formSubmitted;f.prepareElement(c),f.formSubmitted=h,f.successList.push(c),f.showErrors()}else{var i={},j=d||f.defaultMessage(c,"remote");i[c.name]=e.message=a.isFunction(j)?j(b):j,f.showErrors(i)}e.valid=g,f.stopRequest(c,g)}},d)),"pending"},minlength:function(b,c,d){return this.optional(c)||this.getLength(a.trim(b),c)>=d},maxlength:function(b,c,d){return this.optional(c)||this.getLength(a.trim(b),c)<=d},rangelength:function(b,c,d){var e=this.getLength(a.trim(b),c);return this.optional(c)||e>=d[0]&&e<=d[1]},min:function(a,b,c){return this.optional(b)||a>=c},max:function(a,b,c){return this.optional(b)||c>=a},range:function(a,b,c){return this.optional(b)||a>=c[0]&&a<=c[1]},email:function(a,b){return this.optional(b)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i.test(a)},url:function(a,b){return this.optional(b)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)},date:function(a,b){return this.optional(b)||!/Invalid|NaN/.test(new Date(a))},dateISO:function(a,b){return this.optional(b)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(a)},number:function(a,b){return this.optional(b)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(a)},digits:function(a,b){return this.optional(b)||/^\d+$/.test(a)},creditcard:function(a,b){if(this.optional(b))return"dependency-mismatch";if(/[^0-9-]+/.test(a))return!1;var c=0,d=0,e=!1;a=a.replace(/\D/g,"");for(var f=a.length-1;f>=0;f--){var g=a.charAt(f),d=parseInt(g,10);e&&(d*=2)>9&&(d-=9),c+=d,e=!e}return c%10==0},accept:function(a,b,c){return c="string"==typeof c?c.replace(/,/g,"|"):"png|jpe?g|gif",this.optional(b)||a.match(new RegExp(".("+c+")$","i"))},equalTo:function(b,c,d){var e=a(d).unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){a(c).valid()});return b==e.val()}}}),a.format=a.validator.format}(jQuery),function(a){var b={};if(a.ajaxPrefilter)a.ajaxPrefilter(function(a,c,d){var e=a.port;"abort"==a.mode&&(b[e]&&b[e].abort(),b[e]=d)});else{var c=a.ajax;a.ajax=function(d){var e=("mode"in d?d:a.ajaxSettings).mode,f=("port"in d?d:a.ajaxSettings).port;return"abort"==e?(b[f]&&b[f].abort(),b[f]=c.apply(this,arguments)):c.apply(this,arguments)}}}(jQuery),function(a){jQuery.event.special.focusin||jQuery.event.special.focusout||!document.addEventListener||a.each({focus:"focusin",blur:"focusout"},function(b,c){function d(b){return b=a.event.fix(b),b.type=c,a.event.handle.call(this,b)}a.event.special[c]={setup:function(){this.addEventListener(b,d,!0)},teardown:function(){this.removeEventListener(b,d,!0)},handler:function(b){return arguments[0]=a.event.fix(b),arguments[0].type=c,a.event.handle.apply(this,arguments)}}}),a.extend(a.fn,{validateDelegate:function(b,c,d){return this.bind(c,function(c){var e=a(c.target);return e.is(b)?d.apply(e,arguments):void 0})}})}(jQuery);var ZeroClipboard={version:"1.0.7",clients:{},moviePath:"/include/flash/zeroclipboard.swf",nextId:1,$:function(a){return"string"==typeof a&&(a=document.getElementById(a)),a.addClass||(a.hide=function(){this.style.display="none"},a.show=function(){this.style.display=""},a.addClass=function(a){this.removeClass(a),this.className+=" "+a},a.removeClass=function(a){for(var b=this.className.split(/\s+/),c=-1,d=0;d<b.length;d++)b[d]==a&&(c=d,d=b.length);return c>-1&&(b.splice(c,1),this.className=b.join(" ")),this},a.hasClass=function(a){return!!this.className.match(new RegExp("\\s*"+a+"\\s*"))}),a},setMoviePath:function(a){this.moviePath=a},dispatch:function(a,b,c){var d=this.clients[a];d&&d.receiveEvent(b,c)},register:function(a,b){this.clients[a]=b},getDOMObjectPosition:function(a,b){for(var c={left:0,top:0,width:a.width?a.width:a.offsetWidth,height:a.height?a.height:a.offsetHeight};a&&a!=b;)c.left+=a.offsetLeft,c.top+=a.offsetTop,a=a.offsetParent;return c},Client:function(a){this.handlers={},this.id=ZeroClipboard.nextId++,this.movieId="ZeroClipboardMovie_"+this.id,ZeroClipboard.register(this.id,this),a&&this.glue(a)}};ZeroClipboard.Client.prototype={id:0,ready:!1,movie:null,clipText:"",handCursorEnabled:!0,cssEffects:!0,handlers:null,glue:function(a,b,c){this.domElement=ZeroClipboard.$(a);var d=99;this.domElement.style.zIndex&&(d=parseInt(this.domElement.style.zIndex,10)+1),"string"==typeof b?b=ZeroClipboard.$(b):"undefined"==typeof b&&(b=document.getElementsByTagName("body")[0]);var e=ZeroClipboard.getDOMObjectPosition(this.domElement,b);this.div=document.createElement("div");var f=this.div.style;if(f.position="absolute",f.left=""+e.left+"px",f.top=""+e.top-5+"px",f.width=""+e.width+"px",f.height=""+e.height+"px",f.zIndex=d,"object"==typeof c)for(addedStyle in c)f[addedStyle]=c[addedStyle];b.appendChild(this.div),this.div.innerHTML=this.getHTML(e.width,e.height)},getHTML:function(a,b){var c="",d="id="+this.id+"&width="+a+"&height="+b;if(navigator.userAgent.match(/MSIE/)){var e=location.href.match(/^https/i)?"https://":"http://";c+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+e+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+a+'" height="'+b+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="always" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+ZeroClipboard.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+d+'"/><param name="wmode" value="transparent"/></object>'}else c+='<embed id="'+this.movieId+'" src="'+ZeroClipboard.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+a+'" height="'+b+'" name="'+this.movieId+'" align="middle" allowScriptAccess="always" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+d+'" wmode="transparent" />';return c},hide:function(){this.div&&(this.div.style.left="-2000px")},show:function(){this.reposition()},destroy:function(){if(this.domElement&&this.div){this.hide(),this.div.innerHTML="";var a=document.getElementsByTagName("body")[0];try{a.removeChild(this.div)}catch(b){}this.domElement=null,this.div=null}},reposition:function(a){if(a&&(this.domElement=ZeroClipboard.$(a),this.domElement||this.hide()),this.domElement&&this.div){var b=ZeroClipboard.getDOMObjectPosition(this.domElement),c=this.div.style;c.left=""+b.left+"px",c.top=""+b.top+"px"}},setText:function(a){this.clipText=a,this.ready&&this.movie.setText(a)},addEventListener:function(a,b){a=a.toString().toLowerCase().replace(/^on/,""),this.handlers[a]||(this.handlers[a]=[]),this.handlers[a].push(b)},setHandCursor:function(a){this.handCursorEnabled=a,this.ready&&this.movie.setHandCursor(a)},setCSSEffects:function(a){this.cssEffects=!!a},receiveEvent:function(a,b){switch(a=a.toString().toLowerCase().replace(/^on/,"")){case"load":if(this.movie=document.getElementById(this.movieId),!this.movie){var c=this;return void setTimeout(function(){c.receiveEvent("load",null)},1)}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){var c=this;return setTimeout(function(){c.receiveEvent("load",null)},100),void(this.ready=!0)}this.ready=!0,this.movie.setText(this.clipText),this.movie.setHandCursor(this.handCursorEnabled);break;case"mouseover":this.domElement&&this.cssEffects&&(this.domElement.addClass("hover"),this.recoverActive&&this.domElement.addClass("active"));break;case"mouseout":this.domElement&&this.cssEffects&&(this.recoverActive=!1,this.domElement.hasClass("active")&&(this.domElement.removeClass("active"),this.recoverActive=!0),this.domElement.removeClass("hover"));break;case"mousedown":this.domElement&&this.cssEffects&&this.domElement.addClass("active");break;case"mouseup":this.domElement&&this.cssEffects&&(this.domElement.removeClass("active"),this.recoverActive=!1)}if(this.handlers[a])for(var d=0,e=this.handlers[a].length;e>d;d++){var f=this.handlers[a][d];"function"==typeof f?f(this,b):"object"==typeof f&&2==f.length?f[0][f[1]](this,b):"string"==typeof f&&window[f](this,b)}}},function(a){for(var b=0,c=["webkit","moz"],d=a.requestAnimationFrame,e=a.cancelAnimationFrame,f=c.length;--f>=0&&!d;)d=a[c[f]+"RequestAnimationFrame"],e=a[c[f]+"CancelAnimationFrame"];d&&e||(d=function(a){var c=+new Date,d=Math.max(b+16,c);return setTimeout(function(){a(b=d)},d-c)},e=clearTimeout),a.requestAnimationFrame=d,a.cancelAnimationFrame=e}(window),Namespace("Imgur.History"),Imgur.History=Class.extend({init:function(a){this._=$.extend({popStates:{}},a),this.onPopState()},onPopState:function(){var a=this;window.onpopstate=function(b){try{a._.popStates[b.state].call(this,b)}catch(c){}}},addPopState:function(a,b){this._.popStates[a]=b},removePopState:function(a){delete this._.popStates[a]},addWindowState:function(a,b,c){if(window.history.replaceState){window.history.state||window.history.replaceState(a,"initial",window.location.href);var d={state:window.history.state,title:document.title,url:window.location.href},e={state:a,title:b,url:c};window.history.pushState(a,b,c);var f=$.Event("pushstate");f.previousState=d,f.currentState=e,$(window).trigger(f)}}}),Class.addSingleton(Imgur.History),Namespace("Imgur.InfiniteScroll"),Imgur.InfiniteScroll=Class.extend({init:function(a){this._=$.extend(!0,{speed:200,height:300,cont:!0,calcRight:!0},a)},levelReached:function(){var a=Math.max(document.body.scrollHeight||document.body.offsetHeight),b=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight||0,c=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;return this._.calcRight||(a-=$("#content").children(".right").height()),0>=a?!1:a-b-c<this._.height},stopInfiniteScroll:function(){this._.cont=!1},continueInfiniteScroll:function(){this._.cont=!0},infiniteScroll:function(a){this.levelReached()?this._.cont&&a.call():this._.cont&&this.pollLevel(a)},pollLevel:function(a){var b=this;setTimeout(function(){b.infiniteScroll(a)},this._.speed)}}),Class.addSingleton(Imgur.InfiniteScroll),Namespace("Imgur.Utilities.ColorboxConfirm"),Imgur.Utilities.ColorboxConfirm=Class.extend({init:function(a){this._=$.extend(!0,{el:{$confirmation:$(".colorbox-confirm"),$noConfirm:$(".colorbox-no-confirm"),confirmed:"colorbox-confirmed"}},a),this.setupHandlers()},setupHandlers:function(){this._.el.$confirmation.unbind("click"),this._.el.$noConfirm.unbind("click");var a=this;this._.el.$confirmation.click(function(){$("."+a._.el.confirmed).val(!0),$.colorbox.close()}),this._.el.$noConfirm.click(function(){$.colorbox.close()})},show:function(a,b){var c=this;$.colorbox({href:$(a),open:!0,inline:!0,top:"15%",transition:"none",scrolling:!1,onComplete:function(){c.onComplete(a)},onClosed:function(){c.onClose(a,b)}})},onComplete:function(a){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty();var b=$(a).children("."+this._.el.confirmed);b.length||(b=$("<input/>",{type:"hidden","class":this._.el.confirmed}),$(a).append(b)),b.val(!1)},onClose:function(a,b){var c=$(a).children("."+this._.el.confirmed);"false"!==c.val()&&b.call()}}),Class.addSingleton(Imgur.Utilities.ColorboxConfirm),Namespace("Imgur.Util"),Imgur.Util.Base64={PADCHAR:"=",ALPHA:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",getbyte64:function(a,b){var c=Imgur.Util.Base64.ALPHA.indexOf(a.charAt(b));if(-1==c)throw"Cannot decode base64";return c},getbyte:function(a,b){var c=a.charCodeAt(b);if(c>255)throw"INVALID_CHARACTER_ERR: DOM Exception 5";return c},encode:function(a){if(1!=arguments.length)throw"SyntaxError: Not enough arguments";var b,c,d=Imgur.Util.Base64.PADCHAR,e=Imgur.Util.Base64.ALPHA,f=Imgur.Util.Base64.getbyte,g=[];a=""+a;var h=a.length-a.length%3;if(0==a.length)return a;for(b=0;h>b;b+=3)c=f(a,b)<<16|f(a,b+1)<<8|f(a,b+2),g.push(e.charAt(c>>18)),g.push(e.charAt(c>>12&63)),g.push(e.charAt(c>>6&63)),g.push(e.charAt(63&c));switch(a.length-h){case 1:c=f(a,b)<<16,g.push(e.charAt(c>>18)+e.charAt(c>>12&63)+d+d);break;case 2:c=f(a,b)<<16|f(a,b+1)<<8,g.push(e.charAt(c>>18)+e.charAt(c>>12&63)+e.charAt(c>>6&63)+d)}return g.join("")},decode:function(a){a=""+a;var b,c,d,e=Imgur.Util.Base64.getbyte64,f=a.length;if(0==f)return a;if(f%4!=0)throw"Cannot decode base64";b=0,a.charAt(f-1)==Imgur.Util.Base64.PADCHAR&&(b=1,a.charAt(f-2)==Imgur.Util.Base64.PADCHAR&&(b=2),f-=4);var g=[];for(c=0;f>c;c+=4)d=e(a,c)<<18|e(a,c+1)<<12|e(a,c+2)<<6|e(a,c+3),g.push(String.fromCharCode(d>>16,d>>8&255,255&d));switch(b){case 1:d=e(a,c)<<18|e(a,c+1)<<12|e(a,c+2)<<6,g.push(String.fromCharCode(d>>16,d>>8&255));break;case 2:d=e(a,c)<<18|e(a,c+1)<<12,g.push(String.fromCharCode(d>>16))}return g.join("")}},Namespace("Imgur.Utilities.Embed"),Imgur.Utilities.Embed={themes:{dark:{background:"292929",text:"ffffff",link:"4e76c9"},light:{background:"f2f2f2",text:"1a1a1a",link:"4e76c9"},custom:{background:"292929",text:"ffffff",link:"4e76c9"}},elColorboxEmbed:function(){return{id:"#embed-post",form:$("#new-embed-post"),checkbox:$("#data-context"),embedCodeInput:$("#new-embed-post #embedcode"),clipboardLink:$("#new-embed-post #embed-clipboard-link"),clipboardContainer:$("#new-embed-post .clipboard-container"),preview:$("#embed-preview"),oldEmbed:$("#old-embed-view")}},elEmbedAlbumForm:function(){return{id:"#embed-album-form",form:$("#embed-album-form"),embedCodeInput:$("#embed-album-form #embedcode"),embedCodePreview:$("#embed-album-form #embedcodePreview a"),clipboardContainer:$("#embed-album-form .clipboard-container"),themurInput:$("#embed-album-form #themur input"),themurTextInput:$("#embed-album-form #themur input[type=text]"),themurThumbnails:$("#tThumbs"),themurSelect:$("#tTheme"),themurList:$("#embed-album-form #themur ul"),newEmbed:$("#new-embed-view"),hashRegex:new RegExp("/a/(.*?)/")}},embedModal:function(){Imgur.Utilities.Embed.setupEmbedImage.call(this),this._.el.colorboxEmbed.form.removeClass("nodisplay"),this._.el.embedAlbumForm.form.addClass("nodisplay"),this._.el.colorboxEmbed.oldEmbed.addClass("nodisplay"),this._.el.colorboxEmbed.checkbox.change(_.partial(Imgur.Utilities.Embed.onEmbedCheckboxClick,this)),$.colorbox({href:this._.el.colorboxEmbed.id,open:!0,width:"580px",inline:!0,top:"15%",className:"embed-post-colorbox",transition:"none",scrolling:!1,onComplete:_.bind(Imgur.Utilities.Embed.bindEmbedImage,this)})},getPostMetadata:function(){var a={event:"openEmbedModal"};if(this.imgurInsideNav){var b=this.imgurInsideNav.getHash();if(b){var c=this.imgurInsideNav._.sideGallery.getImage(b);return c||(c=this._.image),this._.album=c.is_album?c:{},Imgur.Util.jafoLog(_.extend(a,{meta:{inGallery:_.isNumber(c.comment_count)?!0:!1,hash:b,isAlbum:!!c.is_album,nsfw:!!c.nsfw,control:"postOptions"}})),{id:(c.is_album?"a/":"")+b,title:c.is_album?c.title:c.description}}}return Imgur.Util.jafoLog(_.extend(a,{meta:{inGallery:!1,hash:this._.album.id||this._.id,isAlbum:!0,nsfw:!1,control:"albumOptions"}})),{id:"a/"+(this._.album.id||this._.id),title:this._.album.title}},getSnippet:function(a,b,c,d){var e=Imgur.Environment.host,f=("imgur.com"===e?"s.imgur.com/min":e+"/include/minified")+"/embed.js",g=c===!1?' data-context="'+c+'"':"",h=d?"":' data-analytics="false"';return'<blockquote class="imgur-embed-pub" lang="en" data-id="'+a+'"'+g+h+'><a href="//'+e+"/"+a+'">'+_.escape(b)+'</a></blockquote><script async src="//'+f+'" charset="utf-8"></script>'},bindEmbedImage:function(a){this._.album=this._.album||{};var b=Imgur.Utilities.Embed.getPostMetadata.call(this);b.title||(b.title="View post on imgur.com");var c=Imgur.Utilities.Embed.getSnippet(b.id,b.title,a,!0);if(this._.el.colorboxEmbed.preview.html(Imgur.Utilities.Embed.getSnippet(b.id,b.title,a,!1)),this._.el.colorboxEmbed.embedCodeInput.val(c),flashElement(this._.el.colorboxEmbed.embedCodeInput),Imgur.Utilities.Embed.initEmbedClipboard.call(this,this._.el.colorboxEmbed.clipboardContainer),!this._.vars.newEmbedAlbumFormLoaded){this._.el.colorboxEmbed.embedCodeInput.focus(),_.defer(_.bind(this._.el.colorboxEmbed.embedCodeInput.selectAll,this));try{this._.vars.embedClipboard.glue("new-embedcode-clipboard","new-embedcode-container"),this._.vars.embedClipboard.addEventListener("onMouseUp",_.bind(function(){this._.vars.embedClipboard.setText(this._.el.colorboxEmbed.embedCodeInput.val())},this)),this._.vars.newEmbedAlbumFormLoaded=!0}catch(d){}}$.colorbox.resize()},viewOldEmbed:function(){var a;if(this._.el.colorboxEmbed.form.addClass("nodisplay"),this._.el.embedAlbumForm.form.removeClass("nodisplay"),a="/gallery"===this._.baseURL?this.imgurInsideNav.getHash():this._.album.id||this._.id,Imgur.Utilities.Embed.setEmbedUrl.call(this,"//"+this._.host+"/a/"+a+"/embed"),this._.el.embedAlbumForm.newEmbed.click(_.bind(function(){this._.el.colorboxEmbed.form.removeClass("nodisplay"),this._.el.embedAlbumForm.form.addClass("nodisplay"),Imgur.Utilities.Embed.initEmbedClipboard.call(this,this._.el.colorboxEmbed.clipboardContainer),$.colorbox.resize()},this)),Imgur.Utilities.Embed.initEmbedClipboard.call(this,this._.el.embedAlbumForm.clipboardContainer),flashElement(this._.el.embedAlbumForm.embedCodeInput),Imgur.Util.jafoLog({event:"oldEmbed",meta:{hash:this._.id}}),Imgur.Utilities.Embed.setEmbedCode.call(this),!this._.vars.embedAlbumFormLoaded){this._.el.embedAlbumForm.embedCodeInput.focus(),setTimeout(_.bind(function(){this._.el.embedAlbumForm.embedCodeInput.selectAll()},this),10);try{this._.vars.embedClipboard.glue("embedcode-clipboard","embedcode-container"),this._.vars.embedClipboard.addEventListener("onMouseUp",_.bind(function(){this._.vars.embedClipboard.setText(this._.el.embedAlbumForm.embedCodeInput.val())},this)),this._.vars.embedAlbumFormLoaded=!0}catch(b){}}$.colorbox.resize()},setupEmbedImage:function(){var a=window.addEventListener?"addEventListener":"attachEvent",b=window[a],c="attachEvent"==a?"onmessage":"message";b(c,_.bind(function(a){var b=JSON.parse(a.data);"resize_imgur"===b.message&&(this._.album.id&&(this._.el.colorboxEmbed.oldEmbed.removeClass("nodisplay"),this._.el.colorboxEmbed.oldEmbed.click(_.bind(Imgur.Utilities.Embed.viewOldEmbed,this))),this._.el.colorboxEmbed.preview.css("height",b.height+"px"),$(".imgur-embed-iframe-pub").height=b.height+"px",0===$(".cboxIframe").length&&$.colorbox.resize())},this),!1)},onEmbedCheckboxClick:function(a){$(this).is(":checked")?Imgur.Utilities.Embed.bindEmbedImage.call(a,!1):Imgur.Utilities.Embed.bindEmbedImage.call(a)},setupThemur:function(){var a=this._.el.embedAlbumForm.embedCodePreview,b=this._.el.embedAlbumForm.themurInput,c=this._.el.embedAlbumForm.themurSelect;this._.vars.currentTheme=c.val(),"custom"==this._.vars.currentTheme?this._.el.embedAlbumForm.themurList.show(400,_.bind(function(){$.colorbox.resize({height:$(this._.el.embedAlbumForm.id).innerHeight()+42})},this)):Imgur.Utilities.Embed.setEmbedColors.call(this,Imgur.Utilities.Embed.themes[this._.vars.currentTheme]),a.on("click",_.bind(function(b){b.preventDefault();var c=$(a).attr("href");$.colorbox({open:!0,href:c,transition:"none",top:"15%",className:"noHeader",fixed:!0,width:"600px",height:"400px",iframe:!0,onClosed:_.bind(Imgur.Utilities.Embed.viewOldEmbed,this)})},this)),b.on("change",_.bind(function(a){var b={},c=$(a.target).attr("name");if($(a.target).is(":checkbox"))b[c]=$(a.target).is(":checked");else{var d=$(a.target).val();b[c]=d,$(a.target).css("border-right-color","#"+d),Imgur.Utilities.Embed.themes.custom[c]=d}Imgur.Utilities.Embed.setEmbedUrl.call(this,Imgur.Util.createQueryUrl(this._.embedUrl,b)),Imgur.Utilities.Embed.setEmbedCode.call(this),flashElement(this._.el.embedAlbumForm.embedCodeInput)},this)),this._.el.embedAlbumForm.themurTextInput.each(function(){$(this).colpick({layout:"hex",colorScheme:"dark",color:$(this).val(),onBeforeShow:function(a){$(a).css("z-index",9999)},onChange:function(a,b,c,d){$(d).css("border-right-color","#"+b).val(b)},onSubmit:function(a,b,c,d){$(d).css("border-right-color","#"+b).val(b).trigger("change").colpickHide()},onHide:function(a){$($(a).data("colpick").el).trigger("change")}})}),c.on("change",_.bind(function(){this._.vars.currentTheme=$(c).val(),this._.el.embedAlbumForm.themurThumbnails.prop("checked",!1),"custom"==this._.vars.currentTheme?this._.el.embedAlbumForm.themurList.slideDown(400,$.colorbox.resize):this._.el.embedAlbumForm.themurList.slideUp(400,$.colorbox.resize);var a=Imgur.Utilities.Embed.themes[this._.vars.currentTheme];Imgur.Utilities.Embed.setEmbedUrl.call(this,Imgur.Util.createQueryUrl(this._.embedUrl,a)),Imgur.Utilities.Embed.setEmbedCode.call(this),flashElement(this._.el.embedAlbumForm.embedCodeInput)},this))},initEmbed:function(){this._.layout==this._.layouts.grid&&this.initGrid(),Imgur.Utilities.Embed.setupEmbedCss.call(this),this._.el.layout.global.thumbsCarouselContainer.length&&this.initThumbsCarousel(),this.initMainCarousel(),Imgur.Utilities.Embed.setupEmbedScreen.call(this),$(window).resize(_.bind(function(){Imgur.Utilities.Embed.setupEmbedCss.call(this),Imgur.Utilities.Embed.setupEmbedScreen.call(this)},this))},setupEmbedCss:function(){$("head").append("<style>.main-carousel ul li { width: "+$(".embed").parent().width()+"px; }</style>"),this._.vars.bodyHeight=$(".embed").parent().height();var a=Imgur.Util.getQueryParams(window.location.search),b=$(_.templates["album.embedStyles"]({background:a.background,text:a.text,link:a.link}));this.chooseLogoColor(a.background)&&this._.el.layout.embed.offsite.addClass("light"),b.appendTo("head")},setupEmbedScreen:function(){var a=$(".embed").parent().width(),b=$(".embed").parent().height(),c=1,d=!0;this._.el.layout.global.thumbsCarouselContainer.length?c+=this._.el.layout.global.thumbsCarousel.height()+18:(d=!1,this._.el.layout.global.description.css("maxHeight",121)),this._.el.layout.global.title.is(":visible")&&(c+=$("#title").height()+10),this._.el.layout.global.container.css({lineHeight:b-c+"px",height:this._.vars.bodyHeight-c}),null!==this._.el.layout.global.mainImage&&this._.el.layout.global.mainImage.setProps({maxHeight:b-c,maxWidth:a}),$(".embed #thumbs-top").css({width:Math.min(79*this._.images.count,a-65)}),$(".embed .thumbs-carousel").css({width:Math.min(79*this._.images.count+45,a-20)});var e=$(".embed .image").height();this._.el.layout.global.description.css({top:e-(d?48:Math.min(121,this._.el.layout.global.description.innerHeight()))})},setEmbedUrlAlbumId:function(a){Imgur.Utilities.Embed.setEmbedUrl.call(this,this._.embedUrl.replace(this._.el.embedAlbumForm.hashRegex,"/a/"+a+"/"))},setEmbedUrl:function(a){this._.embedUrl=a},setEmbedCode:function(){this._.el.embedAlbumForm.embedCodeInput.val('<iframe class="imgur-album" width="100%" height="550" frameborder="0" src="'+this._.embedUrl+'"></iframe>'),this._.el.embedAlbumForm.embedCodePreview.attr("href",this._.embedUrl)},setEmbedColors:function(a){this._.el.embedAlbumForm.themurInput.each(function(){var b=a[$(this).attr("name")];$(this).val(b),$(this).css("border-right-color","#"+b)})},clipboardClick:function(a){flashElement($(a).siblings("input")),$(a).attr("title","copied"),$(a).tipsy("show"),$(a).attr("original-title","copy")},initEmbedClipboard:function(a){this._.vars.embedClipboard=new ZeroClipboard.Client,this._.vars.embedClipboard.addEventListener("onMouseUp",_.partial(Imgur.Utilities.Embed.clipboardClick,a)),a.tipsy({gravity:"e",opacity:1,html:!0})}},Namespace("ImgurIface"),ImgurIface.NextImageReceiver=new Iface(["handleSelectEvent"]),Namespace("Imgur.Album"),Imgur.Album=Class.extend({init:function(a){a=a||{},this._=$.extend(!0,{id:null,album:null,images:null,cover:null,layout:null,cdnUrl:null,preloadCount:4,operation:null,mobile:!1,initialImage:!0,el:{links:{createAlbum:$(".album-create-link"),changeSettings:$(".album-settings-link"),viewStats:$(".album-stats-link"),nonAuthorChangeSettings:$(".album-layout-link"),changeImages:$(".album-images-link"),changeCover:$(".album-cover-link"),deleteAlbum:$(".album-delete-link"),embedAlbum:$(".album-embed-link"),titleDesc:$(".album-titledesc-link"),rearrange:$(".album-rearrange-link"),downloadAlbum:$(".album-download-link"),gallerySubmit:$(".gallery-submit-link"),hideAlbum:$(".album-hide-link")},embedAlbumForm:Imgur.Utilities.Embed.elEmbedAlbumForm(),colorboxEmbed:Imgur.Utilities.Embed.elColorboxEmbed(),downloadAlbumForm:{id:"#download-album-form",emailInput:$("#download-album-form #email"),form:$("#download-album-form #download-form"),message:$("#message"),save:$("#download-album-form #save"),loader:$("#download-loader")},createAlbumForm:{id:"#create-album-form",form:$("#create-album-form form"),header:$("#create-album-form h1"),titleInput:$("#album-title"),descriptionInput:$("#album-description"),layoutInput:$("#album-layout input[type=radio]"),privacyInput:$("#album-privacy input[type=radio]"),loader:$("#create-album-loader"),cover:$("#album-cover"),hiddenIcon:$(".privacy-icon.hidden"),secretIcon:$(".privacy-icon.secret"),exlanationPublic:$(".privacy-explanation.public"),exlanationHidden:$(".privacy-explanation.hidden"),exlanationSecret:$(".privacy-explanation.secret"),privacyTitle:$(".privacy-title"),errorbox:$("#create-album-form .error"),submitButton:$('#create-album-form input[type="submit"]')},changeLayout:{layoutButton:$(".userSessionLayout"),layoutForm:$("#userLayoutForm")},albumImagesForm:{id:"#album-images",form:$("#album-images form"),selectHeader:$("#album-images-select-header"),coverHeader:$("#album-images-cover-header"),menuFirstItemId:"#album-images .mode.start",imagesMenu:$("#images-menu"),mainColumn:$("#main-column")},deleteAlbumForm:{id:"#delete-album-form",yes:$("#delete-album-yes"),no:$("#delete-album-no"),loader:$("#delete-album-form .small-loader")},hideAlbumForm:{id:"#hide-album-form",yes:$("#hide-album-yes"),no:$("#hide-album-no"),loader:$("#hide-album-form .small-loader")},layout:{global:{title:$("#title"),description:$("#description"),container:$("#image-container"),mainImage:null,thumbsCarousel:$("#thumbs-top, #thumbs-bottom"),thumbsCarouselContainer:$(".thumbs-carousel"),thumbsCarouselNext:$(".thumbs-carousel .carousel-button.next"),thumbsCarouselPrev:$(".thumbs-carousel .carousel-button.prev"),thumbsCarouselTop:$("#thumbs-top"),thumbsCarouselBottom:$("#thumbs-bottom"),nextImage:$("#next"),prevImage:$("#prev"),imageHoverIconClass:".image-hover",actionButtonOpenClass:"opened",actionButton:$(".action-button"),actionOptionsClass:".action-options",actionOptionsItems:$(".image-hover .options .item")},blog:{leftPanel:$("#content .main"),sidebar:$("#scrollpanel")},horizontal:{imageCounter:$("#current-index")},grid:{imageClass:".post",imageEmptyClass:".post.empty",noMorePagesID:"#nomore",loaderID:"#imagelist-loader",loadMoreID:"#load-more",content:$("#imagelist")},rearrange:{sortableItem:".sortable-image",saveLink:$("#save"),loader:$("#loader"),sorts:$(".sort"),orders:$(".order"),orderMenu:$("#order-menu")},titledesc:{title:$(".image-title"),desc:$(".image-desc"),save:$("#save"),cancel:$("#cancel"),form:$("#image-container form"),loader:$("#loader"),items:$(".item")},embed:{offsite:$("#offsite")}},subdomain:{container:$(".left .panel"),albumClass:".album",editButton:$(".edit-button"),editOptionsClass:".edit-options",editOptionsItems:$(".options .item")}},layouts:{blog:"b",grid:"g",horizontal:"h"},operations:{embed:"embed",rearrange:"rearrange",titledesc:"titledesc",all:"all"},messages:{createAlbum:"Create an album",albumSettings:"Change album settings",switchLayout:"Switch album layout",updateSettings:"Album settings have been updated",updateImages:"Album images have been updated",updateCover:"Album cover has been updated",rearrangeImages:"Images have been rearranged",updateTitleDesc:"Titles and/or descriptions have been updated",deleteAlbum:"Album has been deleted",hideAlbum:"Album has been hidden",privateGalleryMessage:"This album is in the gallery, please remove it before making it secret.",privateGalleryError:"A gallery album's privacy cannot be set to secret."},vars:{currentImageIndex:0,ajaxURL:"/ajaxalbums/",albumImages:null,interval:null,loadingViewport:!1,bodyHeight:0,thumbsSpeed:400,embedClipboard:null,scrolling:!1,rearrangeOrder:1,creatingAlbum:!1,scrolledPage:0,bindings:{create:!1,images:!1,del:!1,thumbs:!1,main:!1},currentTheme:"dark",embedAlbumFormLoaded:!1,newEmbedAlbumFormLoaded:!1,needCaptchaToProceed:!1},analytics:a.analytics,themes:{dark:{background:"292929",text:"ffffff",link:"4e76c9"},light:{background:"f2f2f2",text:"1a1a1a",link:"4e76c9"},custom:{background:"292929",text:"ffffff",link:"4e76c9"}}},a),this._=$.extend(this._,Imgur.getInstance().getSettings()),this._.el.colorboxEmbed.embedCodeInput.click($(this).selectAll),null!=Imgur.TitleDesc&&(this._.el=$.extend(this._.el,Imgur.TitleDesc.getInstance().getElements()))
},getImageSuffix:function(a){var b=Imgur.getIntance().getImageSizes();return a.width<=b.hugeThumb.width||a.animated?b.original.suffix:b.hugeThumb.suffix},findImageIndex:function(a){for(var b=0;b<this._.images.count;++b)if(this._.images.images[b].hash==a)return b;return 0},getStartingIndex:function(){var a=Imgur.getInstance().getPageHash();return a?isNaN(a)?this.findImageIndex(a):parseInt(a):0},loadImage:function(a){if(a&&a.hasClass("unloaded")){a.attr("src",a.attr("data-src")),a.removeClass("unloaded");var b=new Image;b.src=a.attr("src");var c=this;b.onload=function(){c._.album.album_layout!=c._.layouts.horizontal||c._.operation||$(document).height()>c._.vars.bodyHeight&&(c._.vars.bodyHeight=$(document).height(),$("body").css("height",c._.vars.bodyHeight));{var a=$(this).attr("src");a.substring(a.lastIndexOf("/")+1,a.lastIndexOf("."))}},b.onerror=function(){var b=$(this).attr("src"),c=b.substring(b.lastIndexOf("/")+1,b.lastIndexOf(".")).length;if(8===c||6===c){var d=b.substring(0,b.lastIndexOf(".")-1);d&&(d+=".jpg",this.src=d,$(a).attr("src",d),$(a).parent().hasClass("zoom")&&$(a).parent().attr("href",this.src))}}}},initAlbumImages:function(a,b,c,d){var e=this;null==this._.images?$.getJSON("/ajax/images",{album:this._.id,sort:0,order:1,page:1,perPage:999999},function(f){var g=f.data;e._.images={},e._.images.images=g.images,e._.images.count=g.count,d?"function"==typeof c&&c():e.setupAlbumImages(a,b,c),e._.images=null}):d?"function"==typeof c&&c():e.setupAlbumImages(a,b,c)},setupAlbumImages:function(a,b,c){var d=[];if(a)d[this._.cover]=!0,this._.el.albumImagesForm.coverHeader.show(),this._.el.albumImagesForm.selectHeader.hide();else{for(i=0;i<this._.images.count;++i)d[this._.images.images[i].hash]=!0;this._.el.albumImagesForm.coverHeader.hide(),this._.el.albumImagesForm.selectHeader.show()}var e=this,f=1;(this._.images.count&&this._.images.count>0||this._.images.images&&this._.images.images.length&&this._.images.images.length>0)&&(f=this._.id);var g={host:this._.host,album:this._.id,images:d,cdnUrl:this._.cdnUrl,totalCounter:$("<div/>"),totalCounterSuffix:$("<div/>"),imagesPerPage:64,changeCover:a,mode:f,onSubmitComplete:function(d){$.colorbox.close(),b&&humanMsg.displayMsg(a?e._.messages.updateCover:e._.messages.updateImages);var f=e;a?$(document).bind("cbox_closed",function(){$(document).unbind("cbox_closed"),f._.cover=d.data[0][0],$("#album-"+e._.id).attr("data-cover",d.data[0][0]+"b.jpg").find(".cover img").attr("src",f._.cdnUrl+"/"+d.data[0][0]+"s.jpg"),f.changeSettings()}):"function"==typeof c?c(data):0!=location.pathname&&location.reload()}};this._.vars.albumImages=Imgur.Album.Images.getInstance(),this._.vars.albumImages.init(g)},bindchangeImages:function(){var a=this;this._.vars.bindings.images=!0;var b=a._.id;this._.el.albumImagesForm.form.submit(function(){return a._.vars.albumImages._.album=b,a._.vars.albumImages.submit(),!1})},bindDeleteAlbum:function(a){this._.vars.bindings.del=!0,this._.el.deleteAlbumForm.no.click(function(){$.colorbox.close()});var b=this;this._.el.deleteAlbumForm.yes.click(function(){b._.el.deleteAlbumForm.yes.disable(),b._.el.deleteAlbumForm.loader.show();var c=b;$.post(c._.vars.ajaxURL+"delete/"+c._.id,{msid:Imgur.Environment.msid},function(b){if(c._.el.deleteAlbumForm.loader.hide(),c._.el.deleteAlbumForm.yes.enable(),$.colorbox.close(),humanMsg.displayMsg(c._.messages.deleteAlbum),"function"==typeof a)a(b);else if("/"==location.pathname&&$("#album-"+c._.id).fadeOut(),"/"!=location.pathname){var d=c;setTimeout(function(){window.location=d._.signed?location.protocol+"//"+Imgur.getInstance()._.auth.url+"."+d._.host:"/"},1e3)}}).error(function(){b._.el.deleteAlbumForm.yes.enable(),b._.el.deleteAlbumForm.loader.hide()})})},bindHideAlbum:function(a){this._.vars.bindings.del=!0,this._.el.hideAlbumForm.no.click(function(){$.colorbox.close()});var b=this;this._.el.hideAlbumForm.yes.click(function(){b._.el.hideAlbumForm.yes.disable(),b._.el.hideAlbumForm.loader.show(),$.post(b._.vars.ajaxURL+"hide/"+b._.id,{msid:Imgur.Environment.msid},function(c){b._.el.hideAlbumForm.loader.hide(),b._.el.hideAlbumForm.yes.enable(),$.colorbox.close(),humanMsg.displayMsg(b._.messages.hideAlbum),"function"==typeof a?a(c):("/"==location.pathname&&$("#album-"+b._.id).fadeOut(),"/"!=location.pathname&&setTimeout(function(){window.location=b._.signed?location.protocol+"//"+Imgur.getInstance()._.auth.url+"."+b._.host:"/"},1e3))}).error(function(){b._.el.hideAlbumForm.yes.enable(),b._.el.hideAlbumForm.loader.hide()})})},bindCreateAlbum:function(a){this._.vars.bindings.create=!0;var b=this;this._.el.createAlbumForm.form.submit(function(){return b.createAlbumSubmitHandler(a),!1}),this._.el.createAlbumForm.form.change(function(a){$(a.target).attr("data-changed","true")}),this._.el.createAlbumForm.privacyInput.change(function(){b.hideAlbumPrivacy(),b.showAlbumPrivacy()}),this._.el.createAlbumForm.privacyTitle.tipsy({html:!1,opacity:1,gravity:"w"})},initCreateAlbum:function(){this._.vars.creatingAlbum=!0,$(this._.el.createAlbumForm.id).addClass("create"),this._.el.createAlbumForm.header.text(this._.messages.createAlbum),this._.el.createAlbumForm.titleInput.val(""),this._.el.createAlbumForm.descriptionInput.val(""),this._.el.createAlbumForm.layoutInput.removeAttr("checked").filter(":first").attr("checked","checked"),this._.el.createAlbumForm.cover.removeAttr("src"),this._.signed&&this._.auth?this._.el.createAlbumForm.privacyInput.removeAttr("checked").filter("[value="+this._.auth.album_privacy+"]").attr("checked","checked"):this._.el.createAlbumForm.privacyInput.removeAttr("checked").filter(":first").attr("checked","checked"),this._.el.createAlbumForm.titleInput.showPlaceholder(),this._.el.createAlbumForm.descriptionInput.showPlaceholder()},initChangeSettings:function(a){var b=this._.id?$("#album-"+this._.id):$(a).parents("[data-privacy]");if(this._.id||(this._.id=$(a).parents("[data-privacy]").attr("id").split("-")[1]),this._.vars.creatingAlbum=!1,b.length){this._.signed?$(this._.el.createAlbumForm.id).removeClass("create"):$(this._.el.createAlbumForm.id).addClass("create"),this._.el.createAlbumForm.header.text(this._.el.createAlbumForm.titleInput.length>0?this._.messages.albumSettings:this._.messages.switchLayout),this._.el.createAlbumForm.titleInput.val(b.attr("data-title")),this._.el.createAlbumForm.descriptionInput.val(b.attr("data-description")),this._.el.createAlbumForm.privacyInput.removeAttr("checked").filter('[value="'+b.attr("data-privacy")+'"]').attr("checked","checked"),this._.el.createAlbumForm.layoutInput.removeAttr("checked").filter('[value="'+b.attr("data-layout")+'"]').attr("checked","checked");var c=b.attr("data-cover");if(c){var d=this._.cdnUrl+"/"+b.attr("data-cover");-1==Imgur.Util.basename(d).indexOf(".")&&(d+="b.jpg"),this._.el.createAlbumForm.cover.attr("src",d)}this._.el.createAlbumForm.titleInput.val()?this._.el.createAlbumForm.titleInput.removeClass("placeholder"):this._.el.createAlbumForm.titleInput.showPlaceholder(),this._.el.createAlbumForm.descriptionInput.val()?this._.el.createAlbumForm.descriptionInput.removeClass("placeholder"):this._.el.createAlbumForm.descriptionInput.showPlaceholder()}},showAlbumPrivacy:function(){switch(this.hideAlbumPrivacy(),this._.el.createAlbumForm.privacyInput.filter(":checked").val()){case"0":this._.el.createAlbumForm.exlanationPublic.show();break;case"1":this._.el.createAlbumForm.hiddenIcon.show(),this._.el.createAlbumForm.exlanationHidden.show();break;case"2":this._.el.createAlbumForm.secretIcon.show(),this._.el.createAlbumForm.exlanationSecret.show()}this.resizeCreateAlbumForm()},hideAlbumPrivacy:function(){this._.el.createAlbumForm.hiddenIcon.hide(),this._.el.createAlbumForm.secretIcon.hide(),this._.el.createAlbumForm.exlanationPublic.hide(),this._.el.createAlbumForm.exlanationHidden.hide(),this._.el.createAlbumForm.exlanationSecret.hide()},resizeCreateAlbumForm:function(){var a=$(this._.el.createAlbumForm.id);$.colorbox.resize({innerWidth:a.width()+20,innerHeight:a.height()+20})},createAlbumSubmitHandler:function(a){var b=Imgur.Album.getInstance();if(this._.el.createAlbumForm.errorbox.is(":hidden")||(this._.el.createAlbumForm.errorbox.hide(),this.resizeCreateAlbumForm()),this._.el.createAlbumForm.titleInput.length>0&&"album title (optional)"==this._.el.createAlbumForm.titleInput.val().toLowerCase()&&this._.el.createAlbumForm.titleInput.val(""),this._.el.createAlbumForm.descriptionInput.length>0&&"album description (optional)"==this._.el.createAlbumForm.descriptionInput.val().toLowerCase()&&this._.el.createAlbumForm.descriptionInput.val(""),this._.vars.needCaptchaToProceed){var c=b._.el.createAlbumForm.form.serializeObject();return void $.ajax({url:"//"+Imgur.Environment.host+"/clearprotection",method:"POST",data:{recaptcha_challenge_field:c.recaptcha_challenge_field,recaptcha_response_field:c.recaptcha_response_field}}).success(function(c){c.data.error?(humanMsg.displayMsg("Captcha invalid: "+c.data.error),Recaptcha.reload()):(b._.vars.needCaptchaToProceed=!1,b.createAlbumSubmitHandler(a))}).error(function(){humanMsg.displayMsg("An error occurred when trying to submit the Captcha."),Recaptcha.reload()})}this._.el.createAlbumForm.submitButton.disable(),this._.el.createAlbumForm.loader.show();var d=this._.vars.creatingAlbum?"create":"settings/"+this._.id,c=this._.el.createAlbumForm.form.serialize();if(!(this._.el.createAlbumForm.titleInput.length>0))return window.location=window.location.protocol+"//"+Imgur.Environment.host+"/a/"+this._.id+"/layout/"+this._.el.changeLayout.layoutForm.find(":radio:checked").attr("id"),a?a.stopPropagation():void 0,!1;var b=this;return $.post(this._.vars.ajaxURL+d,c,function(c){if("object"!=typeof c&&(c=$.parseJSON(c)),c=c.data,b._.el.createAlbumForm.submitButton.enable(),b._.el.createAlbumForm.loader.hide(),b._.vars.creatingAlbum)if($.colorbox.close(),"function"==typeof a)a(c);else if("/"==location.pathname){var d=b;$(document).bind("cbox_closed",function(){$(document).unbind("cbox_closed"),d._.id=c.id,d._.images=[],d.changeImages(!1,!1),$(document).bind("cbox_closed",function(){setTimeout(location.reload,1e3)})})}else window.location="/a/"+c.id;else if(c.id){$.colorbox.close(),humanMsg.displayMsg(b._.messages.updateSettings);var e=$("#album-"+c.id);e.attr("data-description",c.description).attr("data-layout",c.layout).attr("data-privacy",c.privacy).attr("data-title",c.title),"function"==typeof a?a(c):location.reload()}else{var f="";for(key in errors)""!=f&&(f+="\n"),f+=errors[key];b._.el.createAlbumForm.errorbox.text(f).show(),b.resizeCreateAlbumForm()}}).error(function(a){b._.el.createAlbumForm.submitButton.enable(),b._.el.createAlbumForm.loader.hide(),a=$.parseJSON(a.responseText),a.data.error==b._.messages.privateGalleryError?humanMsg.displayMsg(b._.messages.privateGalleryMessage):429==a.status&&(b._.vars.needCaptchaToProceed=!0,"undefined"==typeof Recaptcha?$.getScript("//www.google.com/recaptcha/api/js/recaptcha_ajax.js",function(){Recaptcha.create(Imgur.Environment.recaptcha_key,"albumCreateCaptcha",{theme:"clean",callback:function(){humanMsg.displayMsg(a.data.error.message),$.colorbox.resize()}})}):Recaptcha.reload())}),!1},openCreateAlbumColorbox:function(a,b){var c=this;$.colorbox({href:this._.el.createAlbumForm.id,open:!0,top:"15%",inline:!0,transition:"none",preloading:!1,scrolling:!1,onComplete:function(){c._.vars.bindings.create||c.bindCreateAlbum(a),c.showAlbumPrivacy(),c._.el.createAlbumForm.titleInput.focus()},onCleanup:function(){$(".tipsy").remove(),b&&(c._.id=null)}})},positonScrollPanel:function(){var a=50,b=10,c=this,d=function(){c._.el.layout.blog.sidebar.css($(window).scrollTop()>a?{top:b,position:"fixed","-webkit-transform":"translateZ(0)"}:{position:"static"})};$(window).scroll(d),$(window).resize(d)},toggleOptionsPane:function(){var a=$(this).siblings();a.slideToggle(100)},carouselItemFirstIn:function(a,b,c){0==a.index()?c.addClass("disabled"):c.removeClass("disabled")},carouselItemLastIn:function(a,b,c){var d=b.jcarousel("items").length;a.index()==d-1?c.addClass("disabled"):c.removeClass("disabled")},shrinkThumbsCarousel:function(){this._.el.layout.global.thumbsCarouselBottom.remove(),this._.el.layout.global.thumbsCarouselContainer.addClass("shrunk")},getThumbsCarouselScroll:function(){var a=this._.operations,b=this._.layouts;if(this._.operation==a.embed){var c=$(".embed").parent().width(),d=82;return Math.floor(c/d/2)}if(this._.operation==a.titledesc)return 3;switch(this._.album.album_layout){case b.blog:return 6;case b.horizontal:return 5}return 0},thumbsCarouselScroll:function(a,b){var c=this._.operations,d=this._.layouts;try{if(!this._.operation&&this._.album.album_layout==d.horizontal||this._.operation==c.embed){var e=this.getThumbsCarouselScroll();a>=e&&a<this._.images.count-e?this._.el.layout.global.thumbsCarousel.jcarousel("scroll",a-e,b):e>a?this._.el.layout.global.thumbsCarousel.jcarousel("scroll",0,b):this._.el.layout.global.thumbsCarousel.jcarousel("scroll",this._.images.count-1,b)}}catch(f){}},thumbsCarouselBind:function(){var a=this._.operations,b=this._.layouts;if(!this._.operation&&this._.album.album_layout==b.horizontal&&this._.images.count<11){var c=Math.round(84*(11-this._.images.count)/2);this._.el.layout.global.thumbsCarouselTop.css({borderLeft:c.toString()+"px solid transparent",width:this._.el.layout.global.thumbsCarouselTop.width()-c}),$.browser.chrome=$.browser.webkit&&!!window.chrome,$.browser.safari=$.browser.webkit&&!window.chrome,($.browser.chrome||$.browser.safari)&&this._.el.layout.global.thumbsCarouselTop.hide().each(function(){this.offsetHeight}).show()}var d=this;this._.el.layout.global.thumbsCarouselNext.click(function(){var c=d.getThumbsCarouselScroll();return d._.operation!=a.embed&&d._.album.album_layout==b.blog&&(c/=2),d._.el.layout.global.thumbsCarousel.jcarousel("scroll","+="+c),!1}),this._.el.layout.global.thumbsCarouselPrev.click(function(){var c=d.getThumbsCarouselScroll();return d._.operation!=a.embed&&d._.album.album_layout==b.blog&&(c/=2),d._.el.layout.global.thumbsCarousel.jcarousel("scroll","-="+c),!1}),this._.el.layout.global.thumbsCarousel.find("img").click(function(){var c=parseInt($(this).attr("data-index")),e=d._.images.images[c];!d._.operation&&d._.album.album_layout==b.horizontal||d._.operation==a.embed?d.scrollMainImage(c):(d._.album.album_layout==b.blog||d._.operation==a.titledesc)&&(Imgur.getInstance().setPageHash(e.hash),d.scrollImage("#"+e.hash,-10))}),$(".thumb-title-embed").tipsy({gravity:"s",opacity:.95,html:!0,live:!0});var e=this._.album.album_layout==b.blog?this.getThumbsCarouselScroll()/2:this.getThumbsCarouselScroll();this._.images.count<=e&&(this._.album.album_layout!=b.horizontal&&this._.album.album_layout!=b.grid||this._.operation==a.titledesc)&&this.shrinkThumbsCarousel()},thumbsCarouselItemVisibleIn:function(){Imgur.Album.getInstance().loadImage($(this).find("img"))},initThumbsCarousel:function(){var a=this;this._.el.layout.global.thumbsCarousel.find("li").bind("jcarouselitemvisiblein",a.thumbsCarouselItemVisibleIn),this._.el.layout.global.thumbsCarouselTop.find("li").bind("jcarouselitemfirstin",function(){a.carouselItemFirstIn($(this),a._.el.layout.global.thumbsCarouselTop,a._.el.layout.global.thumbsCarouselPrev)}).bind("jcarouselitemlastin",function(){a.carouselItemLastIn($(this),a._.el.layout.global.thumbsCarouselTop,a._.el.layout.global.thumbsCarouselNext)}),this._.el.layout.global.thumbsCarousel.jcarousel({animation:this._.vars.thumbsSpeed}),this.thumbsCarouselBind()},getImageSrc:function(a){a>=this._.images.count&&(a=this._.images.count-1),0>a&&(a=0);var b=this._.images.images[a];return this._.cdnUrl+"/"+b.hash+b.ext},scrollMainImage:function(a){if(0!=this._.images.count){a>=this._.images.count&&(a=this._.images.count-1),0>a&&(a=0);var b=(this.getImageSrc(a),this._.images.images[a]);this._.vars.currentImageIndex=a;var c=$("#image-container-inner"),d="";if(this._.operation==this._.operations.embed&&!b.animated){var e=this._.el.layout.global.container.height(),f=this._.el.layout.global.container.width(),g=e>f?e:f;160>=g?d="t":320>=g?d="m":640>=g?d="l":1024>=g&&(d="h")}this._.el.layout.global.mainImage=React.render(React.createElement(Imgur.ImageViewer,{item:b,thumbsize:d,discarding_referrer:!this._.initialImage}),c.get(0));var h=$(".jquery-image-zoom");h.length&&h.click(),this.mainCarouselItemVisible(),Imgur.getInstance().setPageHash(a),this._.initialImage=!1}},mainCarouselSetup:function(){{var a=this,b=this._.operations;this._.layouts}this._.el.layout.global.description.tipsy({gravity:$.fn.tipsy.autoNS,opacity:.95,offset:-10,html:!0,delayOut:1200,live:!0}),this._.el.layout.global.nextImage.click(function(){return a.scrollMainImage(a._.vars.currentImageIndex+1),$("."+a._.el.layout.global.actionButtonOpenClass).removeClass("opened"),!1}),this._.el.layout.global.prevImage.click(function(){return a.scrollMainImage(a._.vars.currentImageIndex-1),$("."+a._.el.layout.global.actionButtonOpenClass).removeClass("opened"),!1}),$(document).keydown(function(b){return b.ctrlKey||b.altKey||b.metaKey?!0:(37==b.keyCode?a.scrollMainImage(a._.vars.currentImageIndex-1):39==b.keyCode&&a.scrollMainImage(a._.vars.currentImageIndex+1),!0)}),this._.operation==b.embed&&0==this._.el.layout.embed.offsite.length&&this._.el.layout.global.container.parent().mousewheel(function(b,c){return c=c?detla:b.originalEvent.wheelDeltaY||b.originalEvent.detail,a.scrollMainImage(c>0?a._.vars.currentImageIndex-1:a._.vars.currentImageIndex+1),b.preventDefault(),b.stopPropagation(),!1});var c=a.getStartingIndex();"g"==this._.album.album_layout&&isNaN(parseInt(window.location.hash.substr(1)))||a.scrollMainImage(c)},mainCarouselItemVisible:function(){var a=this._.vars.currentImageIndex,b=this._.images.images[a],c=(this._.layouts,b.prefer_video?".gifv":b.ext);$(".tipsy").remove(),b.title?this._.el.layout.global.title.html(b.title).show():this._.el.layout.global.title.hide(),b.description?this._.el.layout.global.description.html(b.description).show():this._.el.layout.global.description.hide(),this._.el.layout.global.description.attr("title","").attr("original-title",""),this._.operation==this._.operations.embed?Imgur.Utilities.Embed.setupEmbedScreen.call(this):$(document).height()>this._.vars.bodyHeight&&(this._.vars.bodyHeight=$(document).height(),$("body").css("height",this._.vars.bodyHeight)),this.thumbsCarouselScroll(a,!1),this._.el.layout.global.thumbsCarousel.find("img").removeClass("selected"),$("#thumb-"+b.hash).addClass("selected"),this._.el.layout.horizontal.imageCounter.text(a+1),$(this._.el.layout.global.imageHoverIconClass).find(".album-view-link").html('<a href="/a/'+this._.id+'" target="_blank">View album on Imgur</a>'),$(this._.el.layout.global.imageHoverIconClass).find(".album-view-image-link").html('<a href="'+this._.cdnUrl+"/"+b.hash+c+'" target="_blank">View full resolution</a>'),$(this._.el.layout.global.imageHoverIconClass).find(".download").html('<a href="/download/'+b.hash+(b.title?"/"+encodeURIComponent(b.title):"")+'">Download full resolution</a>'),a==this._.images.count-1?this._.el.layout.global.nextImage.addClass("disabled"):this._.el.layout.global.nextImage.removeClass("disabled"),0==a?this._.el.layout.global.prevImage.addClass("disabled"):this._.el.layout.global.prevImage.removeClass("disabled");for(var d=a-1;d<a+this._.preloadCount&&d<=this._.images.count;++d)"undefined"!=typeof this._.images.images[d]&&(this._.images.images[d].animated&&".gif"===this._.images.images[d].ext||$.preloadImages(this.getImageSrc(d)))},initMainCarousel:function(){this.mainCarouselSetup()},scrollImage:function(a,b,c){if(!this._.vars.scrolling){this._.vars.scrolling=!0;var d=this,e=c?0:400;$.smoothScroll({speed:e,offset:b,scrollTarget:a,afterScroll:function(){d._.vars.scrolling=!1}})}},getCurrentBlogImage:function(){var a=[];return this._.el.layout.global.container.find("img").each(function(){$.inviewport($(this),{threshold:0})&&a.push($(this))}),a[0]?a[0].parents(".image"):null},initHorizontal:function(){this.initThumbsCarousel(),this.initMainCarousel()},bindGridThumbsClick:function(){return $(this._.el.layout.grid.imageClass).unbind("click"),$(this._.el.layout.grid.imageClass).click(_.bind(function(a){var b=$(a.target),c=b.is("img")?b.closest("div").attr("id"):b.attr("id");return $.colorbox({href:"#embed",inline:!0,open:!0,width:"90%",height:"90%",scrolling:!1,transition:"none",onLoad:function(){$(".tipsy").remove()},onComplete:_.bind(function(){Imgur.Utilities.Embed.setupEmbedCss.call(this),Imgur.Utilities.Embed.setupEmbedScreen.call(this),this.scrollMainImage(this.findImageIndex(c))},this),onClosed:$(".tipsy").remove}),a.preventDefault(),a.stopPropagation(),!1},this)),$(this._.el.layout.grid.imageEmptyClass).unbind("click"),!1},loadMoreGrid:function(){if($(this._.el.layout.grid.loaderID).length>0){var a=this,b=this._.id+"/all/page/"+ ++this._.vars.scrolledPage+"?scrolled";$.ajax({url:b,success:function(b){$(a._.el.layout.grid.noMorePagesID).length>0||($(a._.el.layout.grid.loaderID).remove(),a._.el.layout.grid.content.append(b),a._.el.layout.grid.content.find("img").tipsy({gravity:"n",opacity:.95,offset:-15,html:!0}),a._.operation!=a._.operations.all&&a.bindGridThumbsClick(),$(a._.el.layout.grid.loaderID).length>0&&Imgur.InfiniteScroll.getInstance().infiniteScroll(function(){a.loadMoreGrid()}))}})}},initGrid:function(){var a=this;a._.el.layout.grid.content.find("img").tipsy({gravity:"n",opacity:.95,offset:-15,html:!0}),this._.operation!=this._.operations.all&&this.bindGridThumbsClick(),Imgur.InfiniteScroll.getInstance().infiniteScroll(function(){a.loadMoreGrid()})},initTitleDesc:function(){var a=this;this._.el.layout.titledesc.form.find("textarea").each(function(a,b){var c=$(b),d=$("div[data-desc-id="+c.attr("tabindex")+"]").text();""!=d&&c.html(d).val(d).removeClass("placeholder")}),this.positonScrollPanel(),this.initThumbsCarousel(),this._.el.layout.titledesc.desc.keydown(function(b){9!=b.keyCode||b.shiftKey||a.scrollImage($(this).parent().parent().next().next(),-13)}).change(function(){$(this).parent().parent().removeClass("unchanged")}),this._.el.layout.titledesc.title.keydown(function(b){9==b.keyCode&&b.shiftKey&&a.scrollImage($(this).parent().parent().prev().prev(),-13)}).change(function(){$(this).parent().parent().removeClass("unchanged")}),this._.el.layout.titledesc.save.click(function(){a._.el.layout.titledesc.form.submit()}),this._.el.layout.titledesc.form.submit(function(){a._.el.layout.titledesc.save.disable(),a._.el.layout.titledesc.loader.show(),a._.el.layout.titledesc.items.filter(".unchanged").each(function(){$(this).find("input").removeAttr("name"),$(this).find("textarea").removeAttr("name")});var b=a;return $.post(a._.vars.ajaxURL+"titledesc/"+a._.id,a._.el.layout.titledesc.form.serialize(),function(){humanMsg.displayMsg(b._.messages.updateTitleDesc),setTimeout(function(){window.location="/a/"+b._.id},1e3)}).error(function(){b._.el.layout.titledesc.save.enable(),b._.el.layout.titledesc.loader.hide()}),!1}),this._.el.layout.titledesc.cancel.click(function(){window.location="/a/"+a._.id})},rearrangeSortClick:function(){var a=Imgur.Album.getInstance(),b=$(this).attr("id");a._.el.layout.rearrange.loader.show(),setTimeout(function(){var c=a._.el.layout.global.container.find(a._.el.layout.rearrange.sortableItem);a._.el.layout.rearrange.sorts.removeClass("current-selected"),$("#"+b).addClass("current-selected");var d=a;switch(b){case"none":a._.el.layout.rearrange.orderMenu.hide(),c.sortElements(function(a,b){return parseInt($(a).attr("data-i"))>parseInt($(b).attr("data-i"))?1:-1});break;case"filename":a._.el.layout.rearrange.orderMenu.show(),c.sortElements(function(a,b){return $(a).attr("data-filename").toLowerCase()>$(b).attr("data-filename").toLowerCase()?d._.vars.rearrangeOrder:-d._.vars.rearrangeOrder});break;case"time":a._.el.layout.rearrange.orderMenu.show(),c.sortElements(function(a,b){return $(a).attr("data-datetime")>$(b).attr("data-datetime")?d._.vars.rearrangeOrder:-d._.vars.rearrangeOrder})}a._.el.layout.rearrange.loader.hide(),$(window).scroll()},50)},rearrangeOrderClick:function(){var a=Imgur.Album.getInstance(),b=$(this).attr("id");switch(a._.el.layout.rearrange.orders.removeClass("current-selected"),$(this).addClass("current-selected"),b){case"asc":a._.vars.rearrangeOrder=1;break;case"desc":a._.vars.rearrangeOrder=-1}a._.el.layout.rearrange.sorts.filter(".current-selected").click()},initRearrange:function(){this._.el.layout.global.container.sortable({items:this._.el.layout.rearrange.sortableItem});var a=this;this._.el.layout.rearrange.saveLink.click(function(){if(a._.el.layout.rearrange.saveLink.disable(),a._.el.layout.rearrange.loader.show(),a._.el.layout.global.container.find(a._.el.layout.rearrange.sortableItem).length>0){var b=a._.el.layout.global.container.sortable("toArray"),c=a;$.post(a._.vars.ajaxURL+"rearrange/"+a._.id,{order:b.join(","),msid:Imgur.Environment.msid},function(){humanMsg.displayMsg(c._.messages.rearrangeImages);var a=c;setTimeout(function(){window.location="/a/"+a._.id},1e3)}).error(function(){c._.el.layout.rearrange.saveLink.enable(),c._.el.layout.rearrange.loader.hide()})}}),this._.el.layout.rearrange.sorts.click(this.rearrangeSortClick),this._.el.layout.rearrange.orders.click(this.rearrangeOrderClick),this._.el.layout.titledesc.cancel.click(function(){window.location="/a/"+a._.id})},chooseLogoColor:function(a){if(a){var b=parseInt(a.substr(0,2),16),c=parseInt(a.substr(2,2),16),d=parseInt(a.substr(4,2),16),e=(299*b+587*c+114*d)/1e3;return e>=128?!0:!1}return!1},initDownloadForm:function(){Imgur.Environment.auth.email&&(this._.el.downloadAlbumForm.emailInput.val(Imgur.Environment.auth.email),this._.el.downloadAlbumForm.emailInput.removeClass("placeholder")),this._.el.downloadAlbumForm.form.length>0&&this._.el.downloadAlbumForm.form.validate({onkeyup:!1,focusCleanup:!0,errorPlacement:_.bind(function(a){this._.el.downloadAlbumForm.message.html(a)},this),rules:{email:{required:!0,email:!0}},messages:{email:"Enter a valid email address."}}),this._.el.downloadAlbumForm.form.unbind("submit"),this._.el.downloadAlbumForm.form.submit(_.bind(function(){this._.el.downloadAlbumForm.form.valid()&&$.post(this._.vars.ajaxURL+"zip/"+this._.id,this._.el.downloadAlbumForm.save.attr("name")+"=true&email="+this._.el.downloadAlbumForm.emailInput.val(),_.bind(function(a){"success"==a.data?(this._.el.downloadAlbumForm.message.html('<strong><div class="green">Done!</div></strong>'),this._.el.downloadAlbumForm.message.show(),setTimeout($.colorbox.close,900),setTimeout(this._.el.downloadAlbumForm.message.hide,1e3)):(this._.el.downloadAlbumForm.message.html('<div class="error">Oops! Something went wrong.</div>'),this._.el.downloadAlbumForm.message.show())},this))},this))},albumSortStop:function(){var a=Imgur.Album.getInstance();if(a._.el.subdomain.container.find(a._.el.subdomain.albumClass).length>0){for(var b=a._.el.subdomain.container.sortable("toArray"),c=[],d=0,e=b.length;e>d;++d)c[d]=b[d].substr(b[d].indexOf("-")+1);$.post(a._.vars.ajaxURL+"rearrange","order="+c+"&msid="+Imgur.Environment.msid)}},toggleEditButton:function(a){a.toggleClass("opened"),a.siblings(this._.el.subdomain.editOptionsClass).toggle()},editButtonClickHandler:function(a){$("body").unbind("click");var b=Imgur.Album.getInstance();return/album-/.test($(a.target).parent().attr("id"))&&b.setAlbumID($(a.target).parent().attr("id").replace(/album-/,"")),$("body").click(function(){var a=b;$("body").find(".opened").each(function(){a.toggleEditButton($(this))})}),b.toggleEditButton($(this)),0==$(a.target).closest(".gallery-submit-link").length?(a.stopPropagation(),a.preventDefault(),!1):!0},toggleActionButton:function(a){a.toggleClass("opened")},actionButtonClickHandler:function(a){var b=Imgur.Album.getInstance();$("body").unbind("click"),b.toggleEditButton($(this)),$("body").bind("click",function(){b.toggleEditButton($(b._.el.layout.global.imageHoverIconClass+"."+b._.el.layout.global.actionButtonOpenClass))}),a.stopPropagation()},downloadAlbum:function(){var a=Imgur.Album.getInstance();a._.el.downloadAlbumForm.loader.show(),$.post(a._.vars.ajaxURL+"zipexists/"+a._.id,function(b){if("available"==b)window.location="//"+Imgur.getInstance()._.host+"/a/"+a._.id+"/zip",a._.el.downloadAlbumForm.loader.hide();else{var c=a;$.colorbox({open:!0,href:a._.el.downloadAlbumForm.id,transition:"none",top:"15%",inline:!0,onComplete:function(){c.initDownloadForm(),c._.el.downloadAlbumForm.emailInput.focus(),c._.el.downloadAlbumForm.loader.hide()}})}})},createAlbum:function(a){var b=Imgur.Album.getInstance();b.initCreateAlbum(),b.openCreateAlbumColorbox(a)},changeSettings:function(a,b){var c=Imgur.Album.getInstance(),d=null===this._.id;c.initChangeSettings(b),c.openCreateAlbumColorbox(a,d)},showAlbumStats:function(){this._.album.is_album=!0,this._.analytics.popAndLoad(this._.album)},changeImages:function(a,b,c){if(Imgur.Environment.published)return!1;var d=this;$.colorbox({href:this._.el.albumImagesForm.id,open:!0,inline:!0,transition:"none",scrolling:!1,onComplete:function(){d._.vars.bindings.images||d.bindchangeImages(),a?(d._.el.albumImagesForm.imagesMenu.hide(),$.colorbox.resize({innerWidth:d._.el.albumImagesForm.mainColumn.width()+20,innerHeight:d._.el.albumImagesForm.form.height()+20}),d._.el.albumImagesForm.coverHeader.width(d._.el.albumImagesForm.mainColumn.width()+20)):d._.el.albumImagesForm.imagesMenu.show(),d.initAlbumImages(a,b,c)},onCleanup:function(){d._.vars.albumImages.destroy(),d._.vars.albumImages=null}})},deleteAlbum:function(a){var b=Imgur.Album.getInstance();$.colorbox({href:b._.el.deleteAlbumForm.id,open:!0,inline:!0,top:"15%",transition:"none",scrolling:!1,onComplete:function(){b._.vars.bindings.del||b.bindDeleteAlbum(a)}})},hideAlbum:function(a){var b=Imgur.Album.getInstance();$.colorbox({href:b._.el.hideAlbumForm.id,open:!0,inline:!0,top:"15%",transition:"none",scrolling:!1,onComplete:function(){b._.vars.bindings.del||b.bindHideAlbum(a)}})},rearrangeAlbum:function(){var a=Imgur.Album.getInstance();window.location=location.protocol+"//"+a._.host+"/a/"+a._.id+"/rearrange"},changeTitleDesc:function(){var a=Imgur.Album.getInstance();window.location=location.protocol+"//"+a._.host+"/a/"+a._.id+"/titledesc"},generalInit:function(){var a=this,b=this._.operations,c=this._.layouts;switch(this._.operation){case b.embed:Imgur.Utilities.Embed.initEmbed.call(this);break;case b.rearrange:this.initRearrange();break;case b.titledesc:this.initTitleDesc();break;case b.all:this.initGrid();break;default:if(this._.album&&this._.album.album_layout)switch(this._.album.album_layout){case c.horizontal:this.initHorizontal();break;case c.grid:this.initGrid()}}$(".thumb-title").tipsy({gravity:"n",opacity:.95,offset:-10,html:!0}),this.albumActionButton(),this._.el.links.createAlbum.unbind("click"),this._.el.links.changeSettings.unbind("click"),this._.el.links.viewStats.unbind("click"),this._.el.links.deleteAlbum.unbind("click"),this._.el.links.hideAlbum.click(this.hideAlbum),this._.el.links.changeImages.unbind("click"),this._.el.links.changeCover.unbind("click"),this._.el.links.titleDesc.unbind("click"),this._.el.links.rearrange.unbind("click"),this._.el.links.downloadAlbum.unbind("click"),this._.el.links.createAlbum.click(this.createAlbum),this._.el.links.changeSettings.click(function(){a.changeSettings(void 0,this)}),this._.el.links.viewStats.click(function(){a.showAlbumStats()}),this._.el.links.deleteAlbum.click(this.deleteAlbum),this._.el.links.changeImages.click(function(){a.changeImages(!1,!0)}),this._.el.links.changeCover.click(function(){a.changeImages(!0,!0)}),this._.el.links.embedAlbum.click(_.bind(Imgur.Utilities.Embed.embedModal,this)),this._.el.links.titleDesc.click(this.changeTitleDesc),this._.el.links.rearrange.click(this.rearrangeAlbum),this._.el.links.downloadAlbum.click(this.downloadAlbum);var d=Imgur.ShareButtons.getInstance();d.bindButtons(),this._.vars.bodyHeight=$("body").height(),this._.el.embedAlbumForm.embedCodeInput.click($(this).selectAll),Imgur.Utilities.Embed.setupThemur.call(this),Imgur.Fullscreen&&Imgur.Fullscreen.getInstance()},profileInit:function(){this._.el.subdomain.editButton.unbind("click"),this._.el.subdomain.editButton.click(this.editButtonClickHandler),this._.el.subdomain.container.sortable({stop:this.albumSortStop,items:".album"});
var a=this;this._.el.subdomain.editOptionsItems.unbind("click"),this._.el.subdomain.editOptionsItems.click(function(){var b=$(this).parent().parent().parent().attr("id");a._.id=b.substr(b.indexOf("-")+1)}),this.generalInit()},albumActionButton:function(){this._.el.layout.global.actionButton.unbind("click"),this._.el.layout.global.actionButton.click(this.actionButtonClickHandler)},setAlbumID:function(a){this._.id=a}}),Class.addSingleton(Imgur.Album),Namespace("Imgur.PostOptions"),Imgur.PostOptions=React.createClass({displayName:"PostOptions",_:{localStorage:new Imgur.Storage.LocalStorage,clippy:[],embedcoder:null,linkTypes:["share","direct","embed","bbcode","reddit"]},getInitialState:function(){return{hash:this.props.initialHash,published:this.props.initialIsPublished,showAllLinks:this._.localStorage.get("post_options::showAllLinks")||!1}},componentWillMount:function(){this._.embedcoder=new Imgur.LinkGenerator,this._.embedcoder.setThumbSize("")},componentDidMount:function(){if(this.zeroClip(),$("#deletion-email").find("form").submit(this.deletionEmailSubmitHandler),!Imgur.Environment.image.is_album)return void Imgur.TitleDesc.getInstance().bindTitleDescriptionSubmit(null,!0);$("#delete-album-yes").click(this.deletePost),this.state.published&&$(".post-options-links .album-images-link").tipsy({gravity:"s",opacity:1});var a=Imgur.Album.getInstance({id:Imgur.Environment.image.hash,album:Imgur.Environment.image,images:Imgur.Environment.image.album_images,cover:Imgur.Environment.image.cover,layout:"vertical",operation:"edit",analytics:null});a.generalInit()},componentDidUpdate:function(){this.zeroClip()},toggleMoreLinks:function(){var a=!this.state.showAllLinks;this.setState({showAllLinks:a}),this._.localStorage.save("post_options::showAllLinks",a),Imgur.Util.jafoLog({event:"postOptionsShowAllLinks",meta:{display:a}})},getShareLink:function(a){{var b,c;Imgur.Environment}switch(a){case"share":b="Share Link",c=this._.embedcoder.imageLink(Imgur.Environment.image.is_album);break;case"direct":b="Direct Link",c=this._.embedcoder.directishLink();break;case"embed":b="Embed in HTML",c=this._.embedcoder.embed();break;case"bbcode":b="BBCode (Forums)",c=this._.embedcoder.bbcode();break;case"reddit":b="Markdown (Reddit)",c=this._.embedcoder.markdown()}return React.createElement("li",null,React.createElement("label",{htmlFor:a},b),React.createElement(Imgur.ZeroClippableField,{id:a,value:c,flash:!0}))},zeroClip:function(){for(var a;a<this._.linkTypes.length;a++)console.log(React.findDOMNode(this.refs[this._.linkTypes[a]])),this._.clippy[a]=new ZeroClipboard.Client(React.findDOMNode(this.refs[this._.linkTypes[a]]))},titleDescClick:function(){Imgur.TitleDesc.getInstance().addTitleDescription()},getDeletionLink:function(){$.colorbox({href:"#deletion-email",inline:!0,transition:"none",width:"422px",height:"230px",onLoad:function(){},onComplete:function(){React.render(React.createElement(Imgur.ZeroClippableField,{id:"delete",value:"https://"+Imgur.Environment.host+"/delete/"+Imgur.Environment.image.deletehash}),$("#deletion-container").get(0)),$("#deletion-email-textbox").focus()}})},deletionEmailSubmitHandler:function(){var a=$("#deletion-email-textbox").val(),b=$("#deletion-email-sent");return b.fadeIn(),$.post("https://"+Imgur.Environment.host+"/share/emaildeletionlinks/"+Imgur.Environment.hashes[0].deletehash,{email:a}),setTimeout(function(){$.colorbox.close(),b.fadeOut()},1e3),!1},deletePostConfirm:function(){Imgur.Environment.image.is_album&&$.colorbox({href:"#delete-album-form",inline:!0,transition:"none"})},deletePost:function(){$.ajax({method:"post",url:"/ajaxalbums/delete/"+this.state.hash,data:{msid:this.props.msid},success:function(){$.colorbox.close(),humanMsg.displayMsg(Imgur.Album.getInstance()._.messages.deleteAlbum),setTimeout(function(){window.location=Imgur.Environment.signed?location.protocol+"//"+Imgur.getInstance()._.auth.url+"."+Imgur.Environment.host:"/"},1e3)}})},render:function(){if(this.props.display===!1)return!1;sharePanelClasses=classNames({"new-panel":!0,"post-share-panel":!0,"height-all":this.state.showAllLinks,"height-album":Imgur.Environment.image.is_album});var a=classNames({"icon-arrow-down":!this.state.showAllLinks,"icon-arrow-up":this.state.showAllLinks}),b=Imgur.Environment.image.is_album;this._.embedcoder.setItem(Imgur.Environment.image);var c=classNames({"album-images-link":!0,published:this.state.published});return React.createElement("div",null,React.createElement("div",{className:"new-panel post-options-panel"},React.createElement("h2",{className:"new-panel-header"},(b?"Album":"Image")+" Options"),React.createElement("div",{className:"post-options"},b?React.createElement("ul",{className:"post-options-links"},Imgur.Environment.signed?React.createElement("li",null,React.createElement("a",{className:c,title:this.state.published?"Images locked after being shared":null},"Add or remove images")):"",React.createElement("li",null,React.createElement("a",{href:"//"+Imgur.Environment.host+"/a/"+this.state.hash+"/all",className:"post-titledesc-link"},"Browse all images")),React.createElement("li",null,React.createElement("a",{className:"album-titledesc-link"},"Edit image titles or descriptions")),React.createElement("li",null,React.createElement("a",{className:"album-rearrange-link"},"Rearrange images")),React.createElement("li",null,React.createElement("a",{className:"album-settings-link"},"Change album settings"))):React.createElement("ul",{className:"post-options-links"},React.createElement("li",null,React.createElement("a",{href:"https://"+Imgur.Environment.host+"/edit?deletehash="+Imgur.Environment.hashes[0].deletehash},"Edit image")),React.createElement("li",null,React.createElement("a",{onClick:this.titleDescClick,className:"post-titledesc-link"},"Add Title / Description")),React.createElement("li",null,React.createElement("a",{onClick:this.getDeletionLink},"Get deletion link"))),this.state.published?React.createElement("a",{className:"btn btn-grey left title post-options-publish",href:"/gallery/"+this.state.hash},"Shared! ",React.createElement("span",{className:"view"},"View post.")):React.createElement("a",{href:"/share/"+(b?"a/":"i/")+this.state.hash,className:"btn btn-main post-options-publish"},"Share with the community"),React.createElement("div",{className:"post-options-footer cf"},React.createElement("a",{className:"album-options-footer-link post-delete-link",onClick:this.deletePostConfirm,href:b?null:this._.embedcoder.deletion()},React.createElement("i",{className:"icon-trash"}),React.createElement("span",{className:"link-text"},"Delete ",b?"Album":"Image")),React.createElement("a",{className:"album-options-footer-link post-download-link",href:b?"/a/"+this.state.hash+"/zip":"/download/"+this.state.hash+"/"+_.escape(Imgur.Environment.image.title)},React.createElement("i",{className:"icon-download"}),React.createElement("span",{className:"link-text"},"Download Image",b?"s":""))))),React.createElement("div",{className:sharePanelClasses},React.createElement("div",{className:"new-panel-header"},React.createElement("h2",{className:"sg-title"},"Share this ",b?"Album":"Image")),React.createElement("div",{className:"share-links"},React.createElement("ul",null,this.getShareLink("share"),b?null:this.getShareLink("direct"),this.getShareLink("embed"),b?null:this.getShareLink("bbcode"),b?null:this.getShareLink("reddit"))),React.createElement("div",{className:"more-container",onClick:this.toggleMoreLinks},React.createElement("div",{className:"more-gradient"}),React.createElement("div",{className:"more-bar"},this.state.showAllLinks?"Less":"More"," ",React.createElement("i",{className:a})))))}}),Imgur.ZeroClippableField=React.createClass({displayName:"ZeroClippableField",render:function(){return this.isIOS()?React.DOM.div({className:"clipboard-wrapper"},React.DOM.input({ref:"input",onMouseDown:this._selectAll,onFocus:this._selectAll,onClick:this._selectAll,onMouseUp:this._onmouseup,readOnly:"readonly",value:this.props.value,type:"text"})):React.DOM.div({className:"clipboard-wrapper"},React.DOM.div({title:"copy",id:"target-clippy-"+this.props.id,ref:"container",className:"clipboard-container"},React.DOM.div({id:"clippy-"+this.props.id,className:"icon-copy",style:{zIndex:1}},"")),React.DOM.input({className:"share-link",onMouseDown:this._selectAll,onFocus:this._selectAll,onClick:this._selectAll,onMouseUp:this._onmouseup,ref:"input",readOnly:"readonly",value:this.props.value,type:"text"}))},isIOS:function(){return navigator.userAgent.match(/OS [0-9](_\d)+ like Mac OS X/i)},_onmouseup:function(a){a.preventDefault()},_selectAll:function(){$(this.refs.input.getDOMNode()).selectAll()},_zeroclip:function(){if(!this.isIOS()){var a=this.refs.container.getDOMNode(),b=$(this.refs.input.getDOMNode());this._clippy&&this._clippy.destroy();var c=new ZeroClipboard.Client;this._clippy=c;var d=this.props.value,e=this.props.value.split("/")[0];(e===Imgur.Environment.host||e===Imgur.Environment.cdnUrl.substring(2))&&(d="http://"+this.props.value),c.setText(d),c.glue("clippy-"+this.props.id,"target-clippy-"+this.props.id),c.addEventListener("mouseOver",_.bind(function(){$(this).tipsy("show")},a)),c.addEventListener("mouseout",_.bind(function(){$(this).tipsy("hide"),$(this).attr("title","copy")},a)),c.addEventListener("mouseup",_.bind(function(a){$(this).attr("title","copied"),$(this).tipsy("show"),flashElement(a,100,a.css("backgroundColor"))},a,b)),$(a).tipsy({trigger:"manual"}),this.props.flash&&flashElement(b,150,b.css("backgroundColor"))}},componentDidMount:function(){this._zeroclip()},componentDidUpdate:function(){this._zeroclip()},shouldComponentUpdate:function(a){return a.value!==this.props.value},componentWillUnmount:function(){this._clippy&&this._clippy.destroy()}});var _extends=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a};Namespace("Imgur.SideGallery"),Imgur.SideGallery=React.createClass({displayName:"SideGallery",HEIGHT:485,ROW_HEIGHT:{list:111,grid:147},ITEMS_PER_ROW:{list:1,grid:2},RENDER_BUFFER:1e3,FETCH_MORE_BUFFER:3e3,SELECTED_OFFSET:40,BREAK_HEIGHT:60,GRID_MARGIN:6,_:{localStorage:new Imgur.Storage.LocalStorage,isLoading:!1,currentInserted:!1,el:{$sideGallery:null,$content:null,$nano:null},sectionTitles:{hot:"Most Viral Images","new":"User Submitted Images",top:"Highest Scoring Images",filtered:"Filtered Out Images",custom:"Custom Gallery Images",favorites:"Favorites",random:"Random"},sortTitles:{viral:"sorted by popularity",time:"newest first","new":"newest first",newest:"newest first",oldest:"oldest first",rising:"rising",random:"sorted by random"},windowTitles:{day:"today",week:"this week",month:"this month",year:"this year",all:"all time"},sideGalleryItem:React.createClass({displayName:"sideGalleryItem",mixins:[React.addons.PureRenderMixin],handleClick:function(a){1!==a.button&&(this.props.selectImage(this.props.hash,!1,"targeted","click"),a.preventDefault())},render:function(){var a={"sg-item":!0,selected:this.props.selected,grid:"grid"===this.props.layout,list:"list"===this.props.layout,up:"up"===this.props.vote,down:"down"===this.props.vote,promoted:this.props.isAd&&!this.props.isCta,"sg-cta":this.props.isCta};this.props.className&&(a[this.props.className]=!0);var b=classNames(a),c=(this.props.is_album?"/a/":"/")+this.props.hash,d={backgroundImage:"url("+this.props.thumb+")"},e=this.props.shouldRender&&this.props.num_images>1?React.createElement("div",{className:"sg-item-num-images"},this.props.num_images):null,f=this.props.shouldRender&&this.props.isAd?React.createElement("div",{className:"sg-promoted-tag"},"promoted"):null,g=classNames({"sg-item-vote":!0,"icon-upvote":"up"===this.props.vote,"icon-downvote":"down"===this.props.vote}),h=this.props.shouldRender&&this.props.vote?React.createElement("div",{className:g}):null,i=React.createElement("div",{className:"sg-item-stats"},_.isUndefined(this.props.points)?null:React.createElement("span",{className:"icon-upvote"}),_.isUndefined(this.props.points)?null:React.createElement("span",{className:"sg-item-count"},Imgur.Util.numberFormat(this.props.points)),_.isUndefined(this.props.comment_count)?null:React.createElement("span",{className:"icon-comment"}),_.isUndefined(this.props.comment_count)?null:React.createElement("span",{className:"sg-item-count"},Imgur.Util.numberFormat(this.props.comment_count)));if(this.props.isCta)return React.createElement("a",{className:b,title:this.props.title,style:d,onClick:this.handleClick,href:c});if("grid"===this.props.layout){var j=!this.props.shouldRender||this.props.isAd||_.isUndefined(this.props.points)&&_.isUndefined(this.props.comment_count)?null:React.createElement("div",{className:"sg-item-metadata"},i);return React.createElement("a",{className:b,title:this.props.title,style:d,onClick:this.handleClick,href:c},h,f,e,j)}return React.createElement("a",{className:b,onClick:this.handleClick,href:c},React.createElement("div",{className:"sg-list-image",style:d},e),React.createElement("div",{className:"sg-list-metadata"},React.createElement("div",{className:"sg-list-title"},this.props.title),i,f))}})},getInitialState:function(){var a,b;if("undefined"==typeof $.cookie("m_section")){var c=document.createElement("a");c.href=document.referrer,"twitch.tv"===c.host?(a="tag",b="/t/gaming"):Imgur.Environment.image.topic&&"No Topic"!==Imgur.Environment.image.topic&&null===c.host.match(/imgur(-dev)?.com/g)&&(a="topic",b="/topic/"+Imgur.Environment.image.topic.replace(/ /g,"_"))}return Imgur.Environment.searchQuery&&(a="search"),{items:[],scrollTop:0,selectedHash:this.props.env.hash,source:b||this.props.env.baseURL,section:a||this.props.env.section||"hot",sort:this.props.env.sort||"viral",window:this.props.env.window||"day",page:this.props.env.page||0,endReached:!1,layout:this._.localStorage.get("sidegallery_layout")||"grid"}},changeLayout:function(a){var b=this.state.scrollTop/(this.ROW_HEIGHT[this.state.layout]/this.ITEMS_PER_ROW[this.state.layout])*(this.ROW_HEIGHT[a]/this.ITEMS_PER_ROW[a]);this.setState({layout:a},function(){this._.el.$content.scrollTop(b)}),this._.localStorage.save("sidegallery_layout",a),Imgur.Util.jafoLog({event:"sideGalleryLayout",meta:{layout:a}})},_ajaxSuccess:function(a){this._.isLoading=!1;var b=a.data.reduce(function(a,b){return a+(b.recommended?1:0)},0);if(b?(Imgur.Util.Experiments.isActive("4053")&&Imgur.Util.registerExperimentData("4053",{onRec:!0}),Imgur.Util.jafoLog({event:"recsLoaded",meta:{recommendationCount:b}}),this.props.showRecommendations||(a.data.splice(0,b),b=0)):Imgur.Util.registerExperimentData("4053",{onRec:!1}),this.isMounted()){var c=this.state.items.length;this.setState({items:_.uniq(this.state.items.concat(a.data),!1,function(a){return a.hash}),recommendationCount:b},function(){this._checkEndReached(a.data.length),!this._.currentInserted&&Imgur.Environment.captionsEnabled&&Imgur.Environment.image&&(this.props.showRecommendations?null:this.insertSingleItem(Imgur.Environment.image,0,!0),this._.currentInserted=!0),a.data.length>0&&this.props.emitter.trigger("sidegalleryPageLoad",0===c?"initial":"append")}.bind(this))}},_onScroll:function(){var a=this._.el.$content.scrollTop();this.setState({scrollTop:a},this._checkScrollPageNeeded),$(".tipsy").remove()},_checkEndReached:function(a){(0===a||this._listHeight()<this.HEIGHT)&&this.setState({endReached:!0})},_checkScrollPageNeeded:function(){this.state.scrollTop>this._listHeight()-this.FETCH_MORE_BUFFER&&!this._.isLoading&&this.setState({page:this.state.page+1},this._loadPage)},_listHeight:function(){return Math.ceil(this.state.items.length/this.ITEMS_PER_ROW[this.state.layout])*this.ROW_HEIGHT[this.state.layout]},_itemOffset:function(a){return Math.ceil((a+1)/this.ITEMS_PER_ROW[this.state.layout])*this.ROW_HEIGHT[this.state.layout]-this.ROW_HEIGHT[this.state.layout]},_loadPage:function(){if(this.state.endReached)return!1;var a,b={};if(this._.isLoading=!0,Imgur.Environment.searchQuery){var c=Imgur.getInstance().getSearchUrl(Imgur.Environment,this.state.page,!0);a=c.url+"?"+c.query}else{this.props.recsExperimentEnabled&&0==this.state.page&&(b.referring_hash=this.props.env.hash);var d=this.state.section&&"group"!=this.state.section&&"tag"!=this.state.section&&"favorites"!=this.state.section&&"topic"!=this.state.section&&"subreddit"!=this.state.section?"/"+this.state.section:"",e="top"!=this.state.section?this.state.sort+"/":"",f="top"==this.state.sort||"top"==this.state.section?this.state.window+"/":"";a=this.state.source+d+"/"+e+f+"page/"+this.state.page+this.props.cache}Imgur.Environment.searchQuery||-1==["relevance","score"].indexOf(this.state.sort)||(e=""),$.ajax({url:a,data:b,success:this._ajaxSuccess,error:this._switchToViral})},_switchToViral:function(){("hot"!=this.state.section||"viral"!=this.state.sort||"day"!=this.state.window)&&this.setState({items:[],page:0,section:"hot",sort:"viral",window:"day",source:"/gallery",endReached:!1,selectedHash:null},this._loadPage)},nthFromHash:function(a,b){var c=this.hashPosition(b),d=c+a;if(-1!==c)return d>=this.state.items.length&&(d=this.state.items.length-1),this.state.items[d].hash},insertSingleItem:function(a,b,c){if(-1!==this.hashPosition(a.hash))return c?this.selectImage(a.hash,null,"direct","inserted"):null,!1;for(;this.state.items[b]&&this.state.items[b].recommended;)b++;this.state.items.splice(b,0,a),this.setState({items:this.state.items},function(){c?this.selectImage(a.hash,null,"direct","inserted"):null})},selectedPosition:function(){return this.hashPosition(this.state.selectedHash)},hashPosition:function(a){return this.state.items.map(function(a){return a.hash}).indexOf(a)},selectImage:function(a,b,c,d){this.setState({selectedHash:a,scrollToHash:a},function(){var e=this.hashPosition(a);if(-1===e)return Imgur.Environment.image&&a===Imgur.Environment.image.hash?(this.props.emitter.trigger("select",Imgur.Environment.image,b,c,d),!0):!1;var f=this.state.items[e];this.props.emitter.trigger("select",f,b,c,d),0==e?this.props.emitter.trigger("firstImage",f,!1):e==this.state.items.length-1&&this.props.emitter.trigger("lastImage",f,!1)})},getImage:function(a){return!this._.currentInserted&&Imgur.Environment.image&&Imgur.Environment.image.hash===a?Imgur.Environment.image:this.state.items[this.hashPosition(a)]},getNextImage:function(a){var b=this.hashPosition(this.state.selectedHash)+1;if(a?b+=a:a=0,b<this.state.items.length){var c=this.state.items[b];return"down"===c.vote||c.nextable===!1?this.getNextImage(++a):c.hash}return!1},getPrevImage:function(a){var b=this.hashPosition(this.state.selectedHash)-1;if(a?b-=a:a=0,b>=0){var c=this.state.items[b];return"down"===c.vote||c.nextable===!1?this.getPrevImage(++a):c.hash}return!1},componentDidMount:function(){if(this.props.display!==!1){this._loadPage(),this.bindMouseMove();var a=_.throttle(_.bind(this._onScroll,this),500);this._.el.$sideGallery=$(React.findDOMNode(this)),this._.el.$content=this._.el.$sideGallery.find(".content"),this._.el.$nano=this._.el.$sideGallery.find(".content"),this._.el.$content.scroll(a),$(".sg-item.grid:not(.sg-cta)").tipsy({live:!0,opacity:1,html:!0,gravity:function(a){return $(".tipsy").addClass("tipsy-sidegallery"),a.offsetTop-this.state.scrollTop>this.HEIGHT-this.ROW_HEIGHT[this.state.layout]?"s":"n"}.bind(this),title:function(){return"<div class='sidegallery-tipsy'>"+Imgur.Util.htmlEntity(this.getAttribute("original-title"))+"</div>"}}),this.props.emitter.on("keyboardNav",this,_.partialRight(this._nav,"keyboard")),this.props.emitter.on("buttonNav",this,_.partialRight(this._nav,"click"))}},bindMouseMove:function(){var a,b=0,c=(Imgur.Util.getBrowserScrollbarWidth(),$("#side-gallery").find(".content")[0]),d=function(d){var e=$(d.target),f=e.closest(".scroll-content,.tipsy").length,g=Math.abs(d.clientX-a),h=Math.abs(d.clientY-b);(g>5||h>5)&&f?c.style.overflowY="scroll":f||(c.style.overflowY="hidden"),a=d.clientX,b=d.clientY}.bind(this);$("body").mousemove(_.throttle(d,20))},_nav:function(a,b){var c;switch(a){case"next":c=this.getNextImage();break;case"prev":c=this.getPrevImage()}return c&&this.selectImage(c,void 0,a,b),!1},updateVote:function(a,b){var c=this.hashPosition(a);if(-1===c)return!1;var d=this.state.items[c];switch(d.vote){case"up":d.ups--;break;case"down":d.downs--}switch(b){case"up":d.ups++;break;case"down":d.downs++}d.vote=b,d.points=d.ups-d.downs,this.state.items[c]=d,this.setState({items:this.state.items})},updateFavorite:function(a,b){this.state.items[this.hashPosition(a)].favorited=b,this.setState({items:this.state.items})},shouldComponentUpdate:function(){return!0},componentDidUpdate:function(a,b){(b.items.length!==this.state.items.length||b.layout!==this.state.layout)&&this._.el.$sideGallery.find(".nano").nanoScroller(),b.scrollToHash!==this.state.scrollToHash&&this.scrollToHash(this.state.scrollToHash)},scrollToHash:function(a){var b=React.findDOMNode(this.refs[a]);b&&this._.el.$content.stop().animate({scrollTop:b.offsetTop-(this.state.recommendationCount?this.GRID_MARGIN:this.SELECTED_OFFSET)})},render:function(){if(this.props.display===!1)return!1;var a,b,c,d,e,f,g,h,i,j=[],k=this._.sideGalleryItem,l={min:this.state.scrollTop-this.RENDER_BUFFER,max:this.state.scrollTop+this.HEIGHT+this.RENDER_BUFFER};switch(this.state.section){case"subreddit":h=Imgur.Environment.image.subreddit;break;case"topic":h=Imgur.Environment.image.topic;break;case"tag":h=Imgur.Environment.tag;break;case"search":switch(h="Searching "+Imgur.Environment.searchQuery,this.state.sort){case"relevance":i="most relevant from "+this._.windowTitles[this.state.window];break;case"score":i="highest scoring from "+this._.windowTitles[this.state.window]}break;case"favorites":var m=Imgur.Environment.favs_account_url||Imgur.Environment.auth.url,n="s"==m.substr(-1)?m+"'":m+"'s";h=React.createElement("span",null,React.createElement("span",{className:"sg-username"},n)," Favorites"),i=this._.sortTitles[this.state.sort];break;case"top":h=this._.sectionTitles[this.state.section],i="from "+this._.windowTitles[this.state.window];break;default:h=this._.sectionTitles[this.state.section]}i=i||("top"==this.state.sort?"from "+this._.windowTitles[this.state.window]:this._.sortTitles[this.state.sort]);for(var o=0;o<this.state.items.length;o++)g=this.state.items[o],f=this.state.items[o-1],c=this._itemOffset(o),b=c>l.min&&c<l.max,e=b?g.thumb?g.thumb:Imgur.Environment.cdnUrl+"/"+(g.is_album?g.album_cover:g.hash)+"b.jpg":"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",a=_.extend({},g,{thumb:e,selected:g.hash===this.state.selectedHash,selectImage:this.selectImage,shouldRender:b,layout:this.state.layout,position:o+1}),f&&f.recommended&&!g.recommended&&j.push(React.createElement("a",{className:"new-panel-header static-width",href:this.state.source},React.createElement("div",{className:"sg-title-container"},React.createElement("i",{className:"icon-grid"}),React.createElement("h2",{className:"sg-title"},h),i?React.createElement("h3",{className:"sg-subtitle"},i):null))),j.push(React.createElement(k,_extends({ref:this.state.items[o].hash,key:this.state.items[o].hash},a)));d=this.state.endReached?React.createElement("div",{className:"sidegallery-end"},"You have reached the end of this stream. Continue browsing ",React.createElement("a",{className:"link",onClick:this._switchToViral},"Most Viral")):React.createElement("div",{className:"sidegallery-end loading"});var p=!this.state.recommendationCount||this.state.recommendationCount&&this.state.scrollTop>=this._itemOffset(this.state.recommendationCount)+this.BREAK_HEIGHT/4;return h=p?h:"More Awesome Stuff",i=p?i:"based on current image",React.createElement("div",{className:"new-panel"},React.createElement("a",{className:"new-panel-header",href:p?this.state.source:"javascript: void(0);"},React.createElement("div",{className:"sg-title-container"},p?React.createElement("i",{className:"icon-grid"}):null,React.createElement("h2",{className:"sg-title"},h),i?React.createElement("h3",{className:"sg-subtitle"},i):null)),React.createElement("div",{className:"nano"},React.createElement("div",{className:"content scroll-content cf"},React.createElement("div",{className:classNames({items:!0,grid:"grid"==this.state.layout,list:"list"==this.state.layout})},j),d)),React.createElement("div",{className:"layout-options"},React.createElement("a",{className:classNames({"layout-button":!0,selected:"list"==this.state.layout}),onClick:this.changeLayout.bind(this,"list")},React.createElement("span",{className:"icon-right-list"})),React.createElement("a",{className:classNames({"layout-button":!0,selected:"grid"==this.state.layout}),onClick:this.changeLayout.bind(this,"grid")},React.createElement("span",{className:"icon-grid"}))))}}),Namespace("Imgur.ShareButtons"),Imgur.ShareButtons=Imgur.extend({init:function(a){this._=$.extend({resetUrl:!1,shareButtonClass:"addthis_button",addthisTimeout:null,shareData:{title:null,url:null,jafoMeta:{}},globalShareData:null},a),this._super(this._),this.bindButtons()},elements:{$social:$(".social")},getAddthisConfig:function(){return{pubid:"imgur",username:"imgur",ui_click:!0,ui_header_color:"#181817",ui_header_background:"#ddddd1",ui_offset_top:"0px",ui_open_windows:!0,data_ga_property:"UA-6671908-2",data_ga_tracker:window._gaq,data_track_clickback:!1,data_ga_social:!0,services_compact:"stumbleupon,google_plusone_share,pinterest_share,tumblr,email,gmail",services_exclude:"facebook,reddit",share:{url:this._.shareData.url,title:this.getShareTitle()}}},initAddthis:function(a){"undefined"==typeof window.addthis_config&&(window.addthis_config=this.getAddthisConfig(),$.getScript(location.protocol+"//s7.addthis.com/js/300/addthis_widget.js#pubid=imgur&domready=1",_.bind(function(){if(this.setupAddthis(),a){var b=function(){$(".addthis_button").click()};window.addthis.addEventListener("addthis.ready",b),this._.addthisTimeout=setTimeout(b,400)}},this),!0))},setShareData:function(a,b){b=_.merge({global:!1},b),b.global&&(this._.globalShareData=a),this._setShareData(a)},resetShareData:function(){this._.globalShareData&&this._setShareData(this._.globalShareData),this._.shareData.url||(this._.shareData.url=this._.protocol+"//"+this._.host+this._.url)},_setShareData:function(a){this._setJafoMeta(a.jafoMeta),this._setShareTitle(a.title),this._setUrl(a.url)},_setJafoMeta:function(a){this._.shareData.jafoMeta=a},_setShareTitle:function(a){a||(a=document.title),a=a.replace(/\s*\- (?:Album on )?Imgur$/,""),this._.shareData.title=a,"addthis"in window&&"update"in window.addthis&&window.addthis.update("share","title",a)},_setUrl:function(a){this._.shareData.url=a,"addthis"in window&&"update"in window.addthis&&window.addthis.update("share","url",a)},bindButtons:function(){this._.shareData.url=this._.shareData.url?this._.shareData.url:this._.protocol+"//"+this._.host+this._.url,this.elements.$social.unbind("click"),this.elements.$social.on("click","li span[data-jshook]",_.bind(function(a){switch(this.resetShareData(),a.currentTarget.getAttribute("data-jshook")){case"twitter_custom":this.shareTwitter();break;case"facebook_custom":this.shareFacebook();break;case"reddit_custom":this.shareReddit();break;case"digg_custom":this.shareDigg();break;case"tumblr_custom":this.shareTumblr();break;case"stumbleupon_custom":this.shareStumbleupon();break;case"googleplus_custom":this.shareGoogleplus();break;case"pinterest_custom":this.sharePinterest();break;case"st_email_custom":this.shareEmail();break;case"addthis_custom":this.shareAddthis()}},this)),$(document.body).on("hover",".addthis_button",_.bind(function(){this.initAddthis()},this))},bindAddthisButton:function(){try{window.addthis.button("."+this._.shareButtonClass)}catch(a){}},setupAddthis:function(){try{window.addthis.ost=0,window.addthis.addEventListener("addthis.menu.open",_.bind(function(a){this.addthisOpen(a)},this)),window.addthis.addEventListener("addthis.menu.share",_.bind(function(a){this.logSharePostAddthis(a.data.service)},this)),window.addthis.ready(),clearTimeout(this._.addthisTimeout)}catch(a){this._.addthisTimeout=setTimeout(_.bind(this.setupAddthis,this),100)}},addthisOpen:function(a){a.data.share||(a.data.share={}),a.data.share.url=this._.shareData.url},logShare:function(a){this._.resetUrl&&this.resetShareData();try{addthis_share.url=this._.shareData.url,window.addthis.share.track(a,0,addthis_share,window.addthis_config)}catch(b){this.logSharePostAddthis(a)}},logSharePostAddthis:function(a){var b=this._.shareData.url;switch(a){case"google_plusone_share":a="googleplus";break;default:a=a.replace(/_share$/,"")}this._.shareData.jafoMeta.hash&&$.post("//"+this._.host+"/share/share",{hash:this._.shareData.jafoMeta.hash});var b=this._.shareData.url;Imgur.Util.jafoLog({event:"share",meta:_.merge({shareTo:a},this._.shareData.jafoMeta)});try{Imgur.Util.getGoogleTracker(),"function"==typeof __ga&&__ga("send","social",a,"share",b)}catch(c){}},getShareTitle:function(){return this._.shareData.title||this._setShareTitle(),this._.shareData.title},shareTwitter:function(){this.logShare("twitter"),Imgur.Util.newWindow("http://twitter.com/share?url="+encodeURIComponent(this._.shareData.url)+"&text="+encodeURIComponent(this.getShareTitle())+"&via=imgur",550,425)},shareFacebook:function(){this.logShare("facebook"),Imgur.Util.newWindow("http://www.facebook.com/sharer.php?u="+encodeURIComponent(this._.shareData.url),755,425)},shareReddit:function(){this.logShare("reddit"),Imgur.Util.newWindow("http://reddit.com/submit?url="+encodeURIComponent(this._.shareData.url)+"&title="+encodeURIComponent(this.getShareTitle()))},shareDigg:function(){this.logShare("digg"),Imgur.Util.newWindow("http://digg.com/submit?phase=2&url="+encodeURIComponent(this._.shareData.url),1060,655)},shareTumblr:function(){this.logShare("tumblr");var a=$('link[rel="image_src"]').attr("href");if(a)var b="http://www.tumblr.com/share/photo?source="+encodeURIComponent(a)+"&caption="+encodeURIComponent(this.getShareTitle())+"&click_thru="+encodeURIComponent(this._.shareData.url);else var b="http://www.tumblr.com/share/link?url="+encodeURIComponent(this._.shareData.url)+"&name="+encodeURIComponent(this.getShareTitle())+"&description="+encodeURIComponent($('meta[name="description"]').attr("content"));Imgur.Util.newWindow(b,450,430)},shareStumbleupon:function(){this.logShare("stumbleupon"),Imgur.Util.newWindow("http://www.stumbleupon.com/submit?url="+encodeURIComponent(this._.shareData.url),1060,500)},shareGoogleplus:function(){this.logShare("googleplus"),Imgur.Util.newWindow("https://plus.google.com/share?url="+encodeURIComponent(this._.shareData.url),520,500)},sharePinterest:function(){this.logShare("pinterest");var a=$('link[rel="image_src"]').attr("href");Imgur.Util.newWindow("http://pinterest.com/pin/create/button/?url="+encodeURIComponent(this._.shareData.url)+"&description="+encodeURIComponent(this.getShareTitle())+"&media="+a,800,340)},shareEmail:function(){},shareAddthis:function(){this.initAddthis(!0)}}),Class.addSingleton(Imgur.ShareButtons),Namespace("Imgur.Caption"),Imgur.Caption=Imgur.extend({sid:$("#sid").val(),init:function(a){this._=$.extend({sid:Imgur.getInstance()._.sid,auth_id:Imgur.Environment.auth.id,signed:Imgur.Environment.signed,baseURL:"/gallery",hash:null,popEventState:"comment",el:{$captions:$("#captions")},$captions:$("#captions"),children:"children",counterClass:".counter",captionBarClass:"caption-bar",commentName:"comment",userCommentsClass:".comment-item",mobile:!1,showRepliesCount:!1,captions:{}},a),this._super(this._)},setupHandlers:function(){Imgur.ShareButtons.getInstance().bindButtons()},addDownvoteLimit:function(){clearTimeout(this._.timeout),$(".caption .arrow.down").unbind("click"),$(".caption .arrow.down").attr("title","Downvoting on this image has been disabled for one minute because you made a comment."),$(".caption .arrow.down").tipsy({gravity:"nw",opacity:1})},removeDownvoteLimit:function(){var a=this;$(".caption .arrow").unbind("click"),$(".caption .arrow.down").unbind("hover"),$(".tipsy").remove(),$(".caption .arrow.down").attr("title","dislike"),$(".caption .arrow").click(function(b){a.vote(b)
})},haveCaptionVotes:function(a){return a in this._.captions&&"votes"in this._.captions[a]},haveCaptions:function(a){return a in this._.captions&&"set"in this._.captions[a]},deleteCaption:function(a,b){this.haveCaptions(a)&&b in this._.captions[a].set&&(this._.captions[a].set[b].deleted=!0,this._.captions[a].set[b].just_deleted=!0)},getCaptionDepthById:function(a,b){if(b=Number(b),this.haveCaptions(a)&&b in this._.captions[a].set){for(var c=[],d=0,e=b;null!=e&&!(e in c);){c.push(e);var f=this._.captions[a].set[e];if(f&&f.hasOwnProperty("depth"))return d+f.depth;e=this._.captions[a].parent[e],d++}return d-1}},countComments:function(a){return this.haveCaptions(a)?Object.keys(this._.captions[a].set).length:null},getCaptionRepliesById:function(a,b){return b=Number(b),this.haveCaptions(a)&&b in this._.captions[a].set?_.filter(_.values(this._.captions[a].parent),function(a){return a===b}).length:void 0},getCaptionById:function(a,b){return b=Number(b),this.haveCaptions(a)&&b in this._.captions[a].set?this._.captions[a].set[b]:null},getCaptionPropertyById:function(a,b,c){return b=Number(b),this.haveCaptions(a)&&b in this._.captions[a].set&&c in this._.captions[a].set[b]?this._.captions[a].set[b][c]:null},getCaptionParentById:function(a,b){return b=Number(b),this.haveCaptions(a)&&b in this._.captions[a].parent?this._.captions[a].parent[b]:null},getParentIds:function(a){return this.haveCaptions(a)?_.uniq(_.values(this._.captions[a].parent)):[]},getCaptionChildrenIds:function(a,b){return b=b,this.haveCaptions(a)&&b in this._.captions[a].children?this._.captions[a].children[b]:[]},getCaptionIdsByFilter:function(a,b){if(!this.haveCaptions(a))return[];var c=[];return jQuery.each(this._.captions[a].set,function(a,d){b(d)&&c.push(a)}),c},mergeCaptions:function(a,b,c){var d=this;a in this._.captions?"set"in this._.captions[a]||(d._.captions[a].set={},d._.captions[a].parent={},d._.captions[a].children={}):d._.captions[a]={set:{},parent:{},children:{},votes:{}},jQuery.each(b,function(b,c){c.parent_id=Number(c.parent_id),c.id=Number(c.id),c.points=Number(c.points),c.visible_points=Number(c.points),0===c.parent_id&&(c.parent_id=null),d._.captions[a].set[c.id]=c,d._.captions[a].parent[c.id]=c.parent_id,c.parent_id in d._.captions[a].children||(d._.captions[a].children[c.parent_id]=[]),c.just_inserted?d._.captions[a].children[c.parent_id].unshift(c.id):d._.captions[a].children[c.parent_id].push(c.id)}),c&&c()},mergeCaption:function(a,b){this.mergeCaptions(a,[b])},mergeVotes:function(a,b,c){var d=this;b&&(this.haveCaptionVotes(a)||(a in this._.captions?this._.captions[a].votes={}:this._.captions[a]={parent:{},votes:{}}),jQuery.each(b,function(b,c){d._.captions[a].votes[c.caption_id]=c.vote}),c&&c())},getVotes:function(a){return this.haveCaptionVotes(a)?this._.captions[a].votes:{}},setVote:function(a,b,c){var d=this._.captions[a].votes[b];(void 0===d||null===d)&&(d="veto"),this._.captions[a].votes[b]=c;var e=this._.captions[a].set[b].visible_points,f={up:1,veto:0,down:-1},g=e-f[d],h=g+f[c];this._.captions[a].set[b].visible_points=h},getVoteByCaptionId:function(a,b){return this.haveCaptionVotes(a)&&b in this._.captions[a].votes?this._.captions[a].votes[b]:null},isCaptionOrItsSubtreeNSFW:function(a){var b=this._.captions[this._.hash].set;if(b.hasOwnProperty(a)){var c=b[a],d=_.filter(Object.keys(this._.captions[this._.hash].parent),_.bind(function(b){return this._.captions[this._.hash].set[b].points<0?!1:"Mature"===Imgur.InsideNav.getInstance()._.topic?!1:this._.captions[this._.hash].parent[b]===a&&this._.captions[this._.hash].set[b].caption.match(/nsfw/gi)},this));return c.caption.match(/nsfw/gi)||d.length}return!1},setCaptionVoteState:function(a){var b=["up","down"],c=a.vote,d=$(document.getElementById("caption-"+a.caption_id)).find(".arrows *");if("veto"==c)d.removeClass("pushed");else{var e=b[1-b.indexOf(c)],f=(d.filter(".up"),d.filter(".down"),d.filter("."+c)),g=d.filter("."+e);f.hasClass("pushed")||f.addClass("pushed"),g.removeClass("pushed")}return!0},purgeCaptionData:function(a){var b=this,c=Object.keys(this._.captions).filter(function(c){return Object.hasOwnProperty.call(b._.captions,c)&&-1===a.indexOf(c)});jQuery.each(c,function(a,c){delete b._.captions[c]})}}),Class.addSingleton(Imgur.Caption),Namespace("Imgur.Elements"),Imgur.Elements.PopupMenu=React.createClass({displayName:"PopupMenu",componentWillUnmount:function(){$("body").off("click",this.handleBodyClick)},getInitialState:function(){return{opened:!1}},handleBodyClick:function(){this.setState({opened:!1})},handleMenuClick:function(a){a.stopPropagation(),this.setState({opened:!this.state.opened}),this.state.opened?$("body").off("click",this.handleBodyClick):$("body").on("click",this.handleBodyClick)},render:function(){return React.DOM.div({onClick:this.handleMenuClick,className:this.props.className+" like-combobox-but-not "+(this.state.opened?" opened":"")},React.DOM.div({className:"options"},this.props.children))}}),Namespace("Imgur.Elements"),Imgur.Elements.Combobox=React.createClass({displayName:"Combobox",propTypes:{name:React.PropTypes.string.isRequired,value:React.PropTypes.string.isRequired,onChange:React.PropTypes.func.isRequired},getInitialState:function(){return{value:this.props.value}},componentDidMount:function(){$(this.refs.base.getDOMNode()).combobox({onChange:_.bind(function(a,b){switch(a){case this.props.name:var c=$(this.refs.base.getDOMNode()).find(".selection").text();this.props.onChange(c,b),this.setState({value:c})}},this)})},render:function(){return React.DOM.div({id:this.props.name,className:"combobox "+this.props.className,ref:"base",name:this.props.name},React.DOM.div({className:"selection"+(this.state.value==this.props.defaultValue?" default":" green")},this.state.value),React.DOM.div({className:"triangle"},""),React.DOM.div({className:"options"},this.props.defaultValue?React.DOM.div({className:"combobox-header"},this.props.defaultValue):"",_.map(this.props.values,_.bind(function(a){return React.DOM.div({className:"item "+(this.state.value==a.label?"selected":""),"data-value":a.value,key:a.label},a.label)},this))))}}),Namespace("Imgur.Elements"),function(a,b,c,d,e){{var f,g,h;d.DOM.div,d.DOM.span}h={left:"middle left",right:"middle right",top:"bottom center",bottom:"top center",center:"middle center"},g={bottom:"tooltip-top",top:"tooltip-bottom",left:"tooltip-left",right:"tooltip-right"},f=d.createClass({displayName:"tooltip-wrapper",propTypes:{position:d.PropTypes.oneOf(["top","right","bottom","left","center"]),target:d.PropTypes.object.isRequired,tetherConstraints:d.PropTypes.array,className:d.PropTypes.string},getDefaultProps:function(){return{position:"bottom",className:"tooltip",tetherConstraints:[{to:"scrollParent",attachment:"together",pin:!0}]}},componentWillUnmount:function(){this._tether&&this._tether.destroy()},getInitialState:function(){return{active:!1}},_tetherOptions:function(){return{element:this.getDOMNode().parentElement,target:this.props.target,attachment:h[this.props.position],optimizations:{moveElement:!1},constraints:this.props.tetherConstraints}},render:function(){return d.DOM.div({className:[this.props.className||"tooltip tooltip-top active",g[this.props.position],this.state.active?"active":""].join(" ")},d.DOM.div({className:"tooltip-close",onClick:c.bind(this.hide,this,"tooltip-close-button")}),d.DOM.div({className:"tooltip-content"},this.props.children))},componentDidUpdate:function(a,b){this._tether&&this._tether.position(),this.state.active!==b.active&&this.onToggle(this.state.active,b.active)},componentDidMount:function(){this._tether?this._tether.setOptions(this._tetherOptions()):this._tether=new e(this._tetherOptions())},componentWillUnmount:function(){this._tether=null},toggle:function(a,b){this.setState({active:a,trigger:b})},show:function(a){this.toggle(!0,a)},hide:function(a){this.toggle(!1,a)},onToggle:function(a){Imgur.Util.jafoLog({event:"tooltipToggled",meta:{name:this.props.name,toggled:a,trigger:this.state.trigger||null}}),a&&"function"==typeof this.props.onShow?this.props.onShow():a||"function"!=typeof this.props.onHide||this.props.onHide()}}),a.TetheredTooltip=f}(Imgur.Elements,$,_,React,Tether),function(a){var b=function(a,b,c){this._={storage:new Imgur.Storage.LocalStorage,name:a,storageKey:"freq-"+(c.storageKey||a),reactClass:b,props:c,children:[].slice.call(arguments,3),rendered:null,element:null,container:null}};b.prototype.name=function(){return this._.name},b.prototype.render=function(){return this._.rendered||(this._.rendered=this.shouldShow().then(function(){this._.container=document.createElement("div"),document.body.appendChild(this._.container),this._.element=this.createElement()}.bind(this))),this._.rendered},b.prototype.createElement=function(){var a,b;return this._.props.name=this._.name,this._.props.onShow=_.bind(function(){this.recordShow()},this),a=this._.reactClass.apply(this._.reactClass,[this._.props].concat(this._.children)),b=React.render(a,this._.container)},b.prototype.showing=function(){return this._.element&&this._.element.state.active},b.prototype.toggle=function(a,b){this.render().done(_.bind(function(){"undefined"==typeof a&&(a=!0),a=!!a,this._.element.setState({active:a,trigger:b})},this))},b.prototype.show=function(a){this.toggle(!0,a)},b.prototype.hide=function(a){this.toggle(!1,a)},b.prototype.shouldShow=function(){var a=$.Deferred();return this._.storage.get(this._.storageKey,!0)?a.reject():a.resolve(),a},b.prototype.recordShow=function(){this._.storage.save(this._.storageKey,+new Date)},a.FrequencyCappedWrapper=b}(Imgur.Elements),Namespace("Imgur.Comment"),Imgur.Comment=React.createClass({displayName:"Comment",propTypes:{childmap:React.PropTypes.object.isRequired,contextids:React.PropTypes.object.isRequired,image:React.PropTypes.object.isRequired,comment:React.PropTypes.object.isRequired,votable:React.PropTypes.bool.isRequired,votemap:React.PropTypes.object,onSubmit:React.PropTypes.func},contextTypes:{msid:React.PropTypes.string.isRequired,onContextChange:React.PropTypes.func.isRequired,linkifier:React.PropTypes.object.isRequired,onVoteChange:React.PropTypes.func},getInitialState:function(){return{showingReply:!1,reported:!1}},handleReplyClicked:function(a){a.stopPropagation(),this.setState({showingReply:!0})},handleReplyBlur:function(a){0!=this.refs.reply.getValue().length||a||this.setState({showingReply:!1})},handleReplySuccess:function(){this.setState({showingReply:!1}),this.props.onSubmit&&this.props.onSubmit()},handlePermalinkClick:function(a){a.stopPropagation(),this.context.onContextChange(a,this.props.comment.id,0)},handleContextClick:function(a){a.stopPropagation(),this.context.onContextChange(a,this.props.comment.id,1)},handleShareClick:function(){var a=window.location.protocol+"//"+Imgur.Environment.host+Imgur.Environment.baseURL+"/"+this.props.comment.hash+"/comment/"+this.props.comment.id,b=this.props.comment.author+" comments on '"+this.props.image.title+"' - Imgur",c=Imgur.ShareButtons.getInstance();c.setShareData({jafoMeta:_.extend(Imgur.Gallery.getInstance().getGalleryMetadata(),{type:"comment",hash:this.props.comment.hash,isAlbum:this.props.comment.on_album,inGallery:!0,commentId:this.props.comment.id}),title:b,url:a})},handleMobileIconClick:function(){Imgur.Util.jafoLog({event:"viaAppIcon",meta:{type:"comment",commentId:this.props.comment.id,platform:this.props.comment.platform}})},handleDeleteClick:function(){var a="Are you sure you want to delete this comment?";confirm(a)&&($.ajax({url:"/gallery/action/delete_caption/"+this.props.comment.id,type:"POST",data:{sid:this.context.msid}}),Imgur.Caption.getInstance().deleteCaption(this.props.comment.hash,this.props.comment.id),this.forceUpdate())},handleReportClick:function(){var a={type:"comment",commentId:this.props.comment.id,hash:this.props.comment.hash,isAlbum:this.props.comment.on_album,nsfw:this.props.image.nsfw};Imgur.Gallery.getInstance().generateReportBox("/gallery/action/report_caption/"+this.props.comment.id,a,_.bind(function(){this.setState({reported:!0})},this)),Imgur.Util.jafoLog({event:"reportInvoked",meta:a})},handleUpvoteClick:function(a){a.stopPropagation();var b=this.props.votemap[this.props.comment.id];this._vote("up"===b?"veto":"up")},handleDownvoteClick:function(a){a.stopPropagation();var b=this.props.votemap[this.props.comment.id];this._vote("down"===b?"veto":"down")},_vote:function(a){Imgur.Environment.signed||Imgur.getInstance().signin({invokedRegisterSigninBy:"voteAttempt",type:"comment"});var b=Imgur.InsideNav&&Imgur.InsideNav.getInstance().getHash()?"inside":"outside";Imgur.Caption.getInstance().setVote(this.props.comment.hash,this.props.comment.id,a),this.context.onVoteChange(this.props.comment,a),$.ajax({url:"/gallery/action/vote/"+this.props.comment.id,type:"POST",data:{vote:a,sid:this.context.msid,type:"caption",location:b,gallery:Imgur.Gallery.getInstance().getGalleryMetadata()}});var c={event:"vote"+(this.props.image.readonly?"ReadOnly":""),meta:_.extend(Imgur.Gallery.getInstance().getGalleryMetadata(),{type:"caption",vote:a,location:b,commentId:this.props.comment.id,hash:this.props.comment.hash})};Imgur.Util.jafoLog(c)},_nthIfy:function(a){return 1===a?"1st":2===a?"2nd":3===a?"3rd":String(a)+"th"},handleUserProfileClick:function(){Imgur.Util.jafoLog({event:"userProfileNav",meta:{accountId:this.props.comment.author_id,method:"usernameComment"}})},render:function(){var a=0,b=React.DOM.span({className:"no-expand left"},React.DOM.span());this.props.comment.id in this.props.childmap&&(a=this.props.childmap[this.props.comment.id].length,a>0&&(b=React.DOM.span({className:"expand left"},React.DOM.a({href:"javascript:void(0)"}))));var c=this.props.votable?React.DOM.div({className:"arrows"+(this.props.votable?"":" unvotable")},React.DOM.div({onClick:this.handleUpvoteClick,className:"btn btn-grey arrow up"+("up"==this.props.votemap[this.props.comment.id]?" pushed":"")},React.DOM.span({className:"icon-upvote"})),React.DOM.div({onClick:this.handleDownvoteClick,className:"btn btn-grey arrow down"+("down"==this.props.votemap[this.props.comment.id]?" pushed":"")},React.DOM.span({className:"icon-downvote"}))):null,d=this.props.comment.best_comment?React.DOM.span({className:"caption-awards right title"},this._nthIfy(this.props.comment.best_comment)):null,e=classNames({caption:!0,"caption-deleted":this.props.comment.deleted,"caption-just-deleted":this.props.comment.just_deleted,unvotable:!this.props.votable,contexted:this.props.comment.id in this.props.contextids}),f=this.context.linkifier.grab(this.props.comment.caption),g=1===this.props.comment.visible_points?" point : ":" points : ",h=1===a?" reply : ":" replies : ",i=null,j={iphone:"iPhone",android:"Android"},k=Object.keys(j);return k.indexOf(this.props.comment.platform)>-1&&(i=React.DOM.span({className:"via"},"via ",React.DOM.a({href:"/apps",target:"_blank",onClick:this.handleMobileIconClick},j[this.props.comment.platform],React.DOM.span({className:"icon icon-mobile"},null)))),React.DOM.div({className:e,"data-id":this.props.comment.id},b,c,React.DOM.div({className:"usertext textbox first1"},d,React.DOM.div({className:"author"},React.DOM.a({href:"/user/"+this.props.comment.author,onClick:this.handleUserProfileClick},this.props.comment.author+" "),this.props.image.account_id&&this.props.image.account_id===this.props.comment.author_id?React.DOM.span({className:"green"},"OP "):"",i,React.DOM.span(null,Imgur.Util.numberFormat(this.props.comment.visible_points)+g),a>0?React.DOM.span(null,a+h):"",React.createElement(Imgur.Caption.Timestamp,{shouldUpdate:!1,timestamp:this.props.comment.datetime})," ",React.DOM.a({onClick:this.handleReplyClicked,href:"javascript:void(0)",className:"reply"},"reply"),this.props.comment.deleted?"":React.createElement(Imgur.Elements.PopupMenu,{className:"caption-toolbar edit-button"},React.DOM.div({onClick:this.handleShareClick,className:"addthis_button item share-caption-link"},"share"),this.state.reported||1==$.cookie("c"+this.props.comment.id)?React.DOM.div({className:"item report-caption-link red"},"reported"):React.DOM.div({onClick:this.handleReportClick,className:"item report-caption-link"},"report"),React.DOM.a({onClick:this.handlePermalinkClick,className:"item permalink-caption-link",href:"/gallery/"+this.props.comment.hash+"/comment/"+this.props.comment.id},"permalink"),null!=this.props.comment.parent_id?React.DOM.a({onClick:this.handleContextClick,className:"item context-caption-link",href:"/gallery/"+this.props.comment.hash+"/comment/"+this.props.comment.id+"/1"},"context"):"",Imgur.Environment.signed&&(Number(this.props.comment.author_id)===Imgur.Environment.auth.id||Imgur.Environment.isGalleryAdmin)?React.DOM.a({onClick:this.handleDeleteClick,className:"item delete-caption-link",href:"javascript:void(0)"},"delete"):"")),f),this.state.showingReply?React.createElement(Imgur.Caption.Reply,{autofocus:!0,ref:"reply",image:this.props.image,parentId:this.props.comment.id,parentAuthorId:Number(this.props.comment.author_id),onBlur:this.handleReplyBlur,onSuccess:this.handleReplySuccess}):"")}}),Namespace("Imgur.Caption"),Imgur.Caption.Timestamp=React.createClass({name:"CaptionTimestamp",propTypes:{timestamp:React.PropTypes.string.isRequired,shouldUpdate:React.PropTypes.bool.isRequired},shouldComponentUpdate:function(){return this.props.shouldUpdate},render:function(){var a=moment.utc(this.props.timestamp,"YYYY-MM-DD HH:mm:ss"),b=a.fromNow(),c=a.toDate().toString();return React.DOM.span({title:c},b)}}),Namespace("Imgur.Comment"),Imgur.CommentTree=React.createClass({statics:{EXPAND_MODE_FORCE_COLLAPSED:-1,EXPAND_MODE_DEFAULT_COLLAPSED:0,EXPAND_MODE_FORCE_EXPANDED:1},displayName:"CommentTree",mixins:[React.addons.PureRenderMixin],propTypes:{comment:React.PropTypes.object.isRequired,image:React.PropTypes.object.isRequired,expandMode:React.PropTypes.number.isRequired,expandedFromPermalink:React.PropTypes.bool.isRequired,groupingBadReplies:React.PropTypes.bool.isRequired,contextids:React.PropTypes.object.isRequired,childmap:React.PropTypes.object.isRequired,votemap:React.PropTypes.object.isRequired,level:React.PropTypes.number,maxLevel:React.PropTypes.number},contextTypes:{onContextChange:React.PropTypes.func.isRequired},getInitialState:function(){return{expanded:this.props.expandMode===Imgur.CommentTree.EXPAND_MODE_FORCE_EXPANDED||this.props.expandedFromPermalink}},getDefaultProps:function(){return{level:0,maxLevel:7}},componentWillReceiveProps:function(a){(this.props.expandMode!=a.expandMode||a.expandedFromPermalink)&&(this.state.expanded&&a.expandMode<=Imgur.CommentTree.EXPAND_MODE_FORCE_COLLAPSED?this.setState({expanded:!1}):(!this.state.expanded&&a.expandMode===Imgur.CommentTree.EXPAND_MODE_FORCE_EXPANDED||a.expandedFromPermalink)&&this.setState({expanded:!0}))},handleCommentClick:function(a){($(a.target).closest(".expand").length||$(a.target).closest(".usertext").length&&!$(a.target).is("a"))&&(a.stopPropagation(),this.setState({expanded:!this.state.expanded}))},handleSubmit:function(){this.setState({expanded:!0})},handleLoadMoreClicked:function(a){this.context.onContextChange(a,this.props.comment.id,0)},render:function(){var a,b=this.props.comment.id in this.props.childmap,c=this.props.childmap[this.props.comment.id]&&this.props.childmap[this.props.comment.id].length||0;this.props.level<this.props.maxLevel?this.state.expanded&&(a=React.createElement(Imgur.CommentList,{image:this.props.image,contextids:this.props.contextids,childmap:this.props.childmap,votemap:this.props.votemap,expandMode:this.props.expandMode,expandedFromPermalink:this.props.expandedFromPermalink,groupingBadReplies:this.props.groupingBadReplies,level:this.props.level+1,parent_id:this.props.comment.id,votable:!0})):b&&(a=React.DOM.a({className:"load-more",href:"javascript:void(0)",onClick:this.handleLoadMoreClicked},"load more"));var d=classNames({comment:!0,"have-children":b&&this.props.level<this.props.maxLevel&&c>0,expanded:this.state.expanded,"load-more":this.props.level>=this.props.maxLevel&&b});return React.DOM.div({onKeyDown:this.handleKeyDown,"data-level":this.props.level,onClick:this.handleCommentClick,className:d},React.createElement(Imgur.Comment,{childmap:this.props.childmap,contextids:this.props.contextids,votemap:this.props.votemap,image:this.props.image,comment:this.props.comment,votable:!0,onSubmit:this.handleSubmit}),a)}}),Namespace("Imgur"),Imgur.CommentList=React.createClass({RENDERED_AT_A_TIME:20,displayName:"CommentList",mixins:[React.addons.PureRenderMixin],propTypes:{image:React.PropTypes.object.isRequired,contextids:React.PropTypes.object.isRequired,childmap:React.PropTypes.object.isRequired,votemap:React.PropTypes.object.isRequired,level:React.PropTypes.number.isRequired,expandMode:React.PropTypes.number.isRequired,expandedFromPermalink:React.PropTypes.bool.isRequired,groupingBadReplies:React.PropTypes.bool.isRequired,parent_id:React.PropTypes.number},getInitialState:function(){return{rendered:this.RENDERED_AT_A_TIME,bad_comments:!1}},_getChildrenIds:function(){return this.props.parent_id in this.props.childmap?this.props.childmap[this.props.parent_id]:[]},componentDidUpdate:function(){this._checkNeedToRenderMore()},componentDidMount:function(){this._mounted=!0,this._listener=_.throttle(this._checkNeedToRenderMore,50),$(window).on("scroll",this._listener),this._checkNeedToRenderMore()},componentWillUnmount:function(){$(window).off("scroll",this._listener),this._mounted=!1},toggleShowingBadComments:function(a){a.stopPropagation(),this.setState({bad_comments:!this.state.bad_comments})},_checkNeedToRenderMore:function(){if(this._mounted){var a=this._getChildrenIds();if(a.length>0&&a.length>this.state.rendered){var b=$(this.refs.last.getDOMNode());b.is(":in-viewport")&&this.setState({rendered:this.state.rendered+this.RENDERED_AT_A_TIME})}}},_handleBadCaptionsContainerClick:function(a){a.stopPropagation()},render:function(){for(var a=this.props.image.hash,b=[],c=[],d=[],e=this._getChildrenIds(),f=!1,g=0;g<Math.min(e.length,this.state.rendered);g++){var h=Imgur.Caption.getInstance().getCaptionById(a,e[g]),i={comment:h,image:this.props.image,key:h.id,level:this.props.level,expandMode:this.props.expandMode,expandedFromPermalink:this.props.expandedFromPermalink,contextids:this.props.contextids,childmap:this.props.childmap,votemap:this.props.votemap,votable:!0,groupingBadReplies:this.props.groupingBadReplies};g==Math.min(e.length,this.state.rendered)-1&&(i.ref="last"),h.points>=0||!this.props.groupingBadReplies?h.just_inserted?d.push(React.createElement(Imgur.CommentTree,i)):b.push(React.createElement(Imgur.CommentTree,i)):(c.push(React.createElement(Imgur.CommentTree,i)),f=!0)}return React.DOM.div({className:"children"},React.createElement(React.addons.CSSTransitionGroup,{key:"just-inserted-"+this.props.image.hash,transitionName:"newcomment"},d),b,React.DOM.div({onClick:this._handleBadCaptionsContainerClick,className:"bad-captions "+(f?"":"nodisplay")},React.DOM.div({className:"textbox"},React.DOM.a({onClick:this.toggleShowingBadComments,href:"javascript:void(0)",className:"link"},(this.state.bad_comments?"hide":"show")+" bad replies")),React.DOM.div({className:this.state.bad_comments?"":"nodisplay"},c)))}}),Namespace("Imgur"),Imgur.InsideCommentsArea=React.createClass({displayName:"InsideCommentArea",propTypes:{image:React.PropTypes.object.isRequired,loading:React.PropTypes.bool.isRequired,defaultExpandMode:React.PropTypes.number.isRequired,expandedFromPermalink:React.PropTypes.bool.isRequired,childmap:React.PropTypes.object.isRequired,commentSort:React.PropTypes.string.isRequired,onCommentSortChange:React.PropTypes.func.isRequired,contextId:React.PropTypes.number,contextLevels:React.PropTypes.number,permalink:React.PropTypes.object},contextTypes:{onContextChange:React.PropTypes.func.isRequired},mixins:[React.addons.PureRenderMixin],handleClickPermalinkViewRestBanner:function(a){a.preventDefault(),this.context.onContextChange(a,void 0,void 0)},getInitialState:function(){return{commentReplyNumber:0,expandMode:this.props.defaultExpandMode,expandedFromPermalink:this.props.expandedFromPermalink,forceCollapsed:!1}},componentDidMount:function(){var a=$(React.findDOMNode(this).parentNode);a.hasClass("comments-initialized")||a.addClass("comments-initialized"),$(document).on("keyup",this.handleDocumentKeyUp)},componentWillUnmount:function(){$(this.getDOMNode().parentNode);$(document).off("keyup",this.handleDocumentKeyUp)},componentWillReceiveProps:function(a){this.setState(this.props.contextId!==a.contextId&&a.contextId?{expandedFromPermalink:!0}:{expandedFromPermalink:!1}),(this.props.image.hash!==a.image.hash||this.props.image.is_album!==a.image.is_album)&&this.setState({showingReply:!0})},handleClickToggleForceExpanded:function(){this.setState(this.state.expandMode!==Imgur.CommentTree.EXPAND_MODE_FORCE_EXPANDED?{expandMode:Imgur.CommentTree.EXPAND_MODE_FORCE_EXPANDED}:{expandMode:Imgur.CommentTree.EXPAND_MODE_FORCE_COLLAPSED-Math.abs(this.state.expandMode)})},handleCommentSuccess:function(){this.setState({commentReplyNumber:this.state.commentReplyNumber+1})},handleDocumentKeyUp:function(a){a.ctrlKey||a.altKey||a.metaKey||$(a.target).is("input,textarea")||(219===a.keyCode?this.setState(this.state.expandMode===Imgur.CommentTree.EXPAND_MODE_FORCE_EXPANDED?{expandMode:Imgur.CommentTree.EXPAND_MODE_FORCE_COLLAPSED}:{expandMode:Imgur.CommentTree.EXPAND_MODE_FORCE_EXPANDED}):221===a.keyCode&&this.setState({expandMode:Imgur.CommentTree.EXPAND_MODE_FORCE_COLLAPSED-Math.abs(this.state.expandMode)}))},render:function(){var a=[];if(a.push(React.createElement(Imgur.Caption.Reply,{key:"reply:"+String(this.state.commentReplyNumber)+":"+this.props.image.hash,image:this.props.image,parentId:null,parentAuthorId:null,autofocus:!1,onBlur:_.noop,onSuccess:this.handleCommentSuccess})),a.push(React.DOM.div({key:"controls",className:"small textbox comments-info"},React.DOM.div({className:"left"},React.DOM.div({className:"inline"},React.DOM.span({className:"comments-count"},this.props.loading?"loading":Imgur.Caption.getInstance().countComments(this.props.image.hash))," comments sorted by ",React.DOM.span({dangerouslySetInnerHTML:{__html:"&nbsp;"}})),React.createElement(Imgur.Elements.Combobox,{name:"comment-sort",onChange:this.props.onCommentSortChange,className:"left inline",value:this.props.commentSort,values:[{label:"best"},{label:"new"},{label:"top"}]})),React.DOM.div({className:"right small"},React.DOM.a({onClick:this.handleClickToggleForceExpanded,href:"javascript:void(0)"},this.state.expandMode===Imgur.CommentTree.EXPAND_MODE_FORCE_EXPANDED?"collapse all":"expand all")),React.DOM.div({className:"clear"}))),!this.props.loading)if(this.props.contextId){a.push(React.DOM.div({key:"permalink-banner",className:"textbox reply-header"},React.DOM.span(null,"you are viewing a single comment"),React.DOM.p(null,React.DOM.a({className:"load-more",href:"/gallery/"+this.props.image.hash,onClick:this.handleClickPermalinkViewRestBanner},"view the rest of the comments"))));var b={},c=Imgur.Caption.getInstance().getCaptionById(this.props.image.hash,this.props.contextId),d=Imgur.Caption.getInstance().getCaptionById(this.props.image.hash,this.props.permalink.commentId);if(Imgur.Environment.signed&&Imgur.Environment.auth.id==d.author_id){var e=Imgur.Caption.getInstance().getCaptionIdsByFilter(this.props.image.hash,_.bind(function(a){var b=moment.utc(a.datetime,"YYYY-MM-DD HH:mm:ss").unix(),c=d.id==a.parent_id,e=Imgur.Environment.auth.id==a.author_id,f=b>this.props.timeLastRead;return f&&c&&!e},this));_.each(e,function(a){b[a]=!0})}a.push(React.createElement(Imgur.CommentTree,{contextids:b,childmap:this.props.childmap,votemap:this.props.votemap,image:this.props.image,key:"tree:"+this.props.image.hash,expandMode:this.state.expandMode,expandedFromPermalink:this.state.expandedFromPermalink,groupingBadReplies:!1,comment:c,votable:!0}))}else a.push(React.createElement(Imgur.CommentList,{contextids:{},childmap:this.props.childmap,votemap:this.props.votemap,image:this.props.image,key:"list:"+this.props.image.hash,expandMode:this.state.expandMode,expandedFromPermalink:this.state.expandedFromPermalink,level:0,parent_id:null,groupingBadReplies:!0,votable:!0}));return React.DOM.div({id:"comments",className:this.props.loading?"":"comments-loaded"},React.DOM.div({id:"captions",className:"root-caption-container"},a))}}),Namespace("Imgur.InsideNav"),Imgur.InsideNav=Imgur.extend({init:function(a,b,c,d,e,f,g){g=g||{},this._=$.extend({ad:{URL:void 0,timeTillRefresh:2e3,nextImageLoadRefreshesAd:!1,injectAd:$(".advertisement").length?!1:!0,closed:!1,currentTimeout:void 0,abpAdId:$("#div-gpt-ad-1421193579422-0")},tallAdParams:{sqWidth:821,sqHeight:599,recWidth:1294,recHeight:599,rightContentHeight:$("#right-content").height()},captionLayout:{sort:null},depth:1,insideCommentsArea:null,emitter:d,tagCortex:e,autoBrowse:!1,autoBrowseTimeout:null,autoBrowseWait:7e3,isHotImage:!0,adType:null,captionInstance:c,albumImageStore:f,fetchQueue:[],fetchingCaptions:{},image:{},fetchPageEventCount:0,checkFetchQueueInterval:void 0,fetchInterval:500,sideGallery:b,albumImages:[],analytics:a,initialImage:!0,isPromoted:!1,templates:{statBar:_.templates["galleryimage.pointInfo"]},headerFixed:!1,shareMarginTop:40,scrollPosition:0,postTitleMaxHeight:120,vwUnderImage:{padding:20,timeout:500,lastHash:null},vwTime:{lastHash:null,msec:0},vwUnderComments:{lastHash:null},postContents:{loading:[],loaded:[],hash:null},elements:{$metadataLink:$('link[rel="image_src"]'),$window:$(window),$postHeader:$(".post-header"),$postContainer:$(".post-container"),$shareButtons:$(".fixed-share-container"),$navPrev:$(".navPrev"),$navNext:$(".navNext"),$postJump:$("#post-jump"),$nicetime:$("#nicetime"),$voteUp:$("#mainUpArrow"),$voteDown:$("#mainDownArrow"),$image:$(".post-images"),$embed:$("#stats-embed-codes"),$download:$("#stats-download"),$underImage:$("#under-image"),$postTitleContainer:$(".post-title-container"),$captions_count:$("#comment-count"),sparkbar:".sparkbar",$taxonomyContainer:$(".taxonomy-container"),$iconMakeMeme:$(".image-options .options .item.icon-meme"),$actionTabs:$("#action-tabs > div"),$postOptions:$(".image-options"),$imageOptions:$("#options-btn .image-item"),$albumOptions:$("#options-btn .album-item"),$matureOption:$("#options-btn .mark-mature-post"),$deleteOption:$("#options-btn .remove-post"),$shareLink:$("#under-image .share-link"),$reddit:$("#stats-reddit"),$subreddit:$("#subreddit"),$smallLinks:$(".small.links"),$originalSource:$("#original-source .domain"),imageContainers:".post-images .post-image-container",adframe:$("#adiframe")[0],adWrapper:".advertisement",$scrollAd:$("#scroll-ad"),$scrollAdClose:$("#scroll-ad > a"),scrollAdframe:$("#scrolling_adiframe")[0],promoCompanion:".promoCompanion",albumTruncated:".js-post-truncated",albumDescription:".post-description",$favoritedImage:$(".favorite-image"),$randomButton:$(".random-button"),$statsContainer:$("#info-analytics"),$statsLink:$(".stats-link"),$views:$("#stats-views"),$bandwidth:$("#stats-bandwidth")},insideCommentsAreaWithContext:React.createClass({displayName:"insideCommentsAreaWithContext",childContextTypes:{onContextChange:React.PropTypes.func,msid:React.PropTypes.string,onSubmit:React.PropTypes.func,linkifier:React.PropTypes.object,onVoteChange:React.PropTypes.func},getChildContext:function(){return{onContextChange:this.props.loadmore,msid:this.props.msid,onSubmit:this.props.onsubmit,linkifier:this.props.linkifier,onVoteChange:this.props.onvotechange}},render:function(){return React.createElement(Imgur.InsideCommentsArea,this.props)}})},g),this._super(this._)},setHash:function(a){this._.hash=a,this.updateCaptionHash(),Imgur.getInstance().setHash(a)},getHash:function(){return this._.hash},updateCaptionHash:function(){this._.captionInstance.setHash(this._.hash)},updateShare:function(){if(!this.hasImage())return void imcon.warn("Can't find image when updating share");var a=this.getImage(),b="http://"+this._.host+this.getURL({type:"historyState",hash:a.hash});b=a.is_album?b.replace("/account/favorites/","/a/"):b.replace("/account/favorites/","/");
var c=Imgur.ShareButtons.getInstance();c.setShareData({jafoMeta:_.merge(Imgur.Gallery.getInstance().getGalleryMetadata(),{type:"galleryPost"},this._.imageJafoMeta),title:a.title,url:b},{global:!0}),this._.elements.$shareLink.val(b).data("value",b)},hasImage:function(a){return a=a||this._.hash,a==this._.image.hash?!0:null!=this._.sideGallery.getImage(a)},getImage:function(a){return a=a||this._.hash,null==this._.sideGallery?this._.image:this.hasImage(a)?this._.sideGallery.getImage(a):null},getCurrentImage:function(){return this._.sideGallery.getImage(this.getHash())},checkFetchQueue:function(){if(0!==this._.fetchQueue.length){var a=this._.fetchQueue.shift();a&&a()}},generalInit:function(a){this._.signed?this._.auth.id:null;this.bindScrollAd(),this.checkAdTime(),$(".post-image-placeholder").one("mousedown",function(a){a.target.setAttribute("src",a.target.parentNode.getAttribute("href"))}),this.bindAutoBrowse(),this.bindArrowKeys(),this.setupHistoryState(),this.setupDownloadLinks(this._.image),a(),setTimeout(this.forceAdRefresh.bind(this),2e3),this._.checkFetchQueueInterval=window.setInterval(this.checkFetchQueue.bind(this),this._.fetchInterval),this._.elements.$underImage.on("click",".stats-link",_.bind(this.showAnalytics,this)),Imgur.Util.triggerPerformanceCheckpoint("statsbtn"),"onhashchange"in window&&$(window).bind("hashchange",_.bind(this.forceScrollToCaption,this)),$("body").on("hover",".image-id-link",_.bind(function(a){var b=$(a.target);b.hasClass("imgur-image")||(b.addClass("imgur-image"),$.ajax({url:"/gallery/action/image/"+this.getHash(),type:"GET",data:{order:b.text().match(/\d+/)[0]},success:function(a){a.data&&a.data.url&&a.data.hash&&(b.attr("href",a.data.url),b.attr("data-hash",a.data.hash))}}))},this)),$(window).on("scroll",_.throttle(_.bind(this.checkStickyHeader,this),50)),this.checkStickyHeader(),this._.elements.$navPrev.click(_.bind(function(){this._.emitter.trigger("buttonNav","prev")},this)),this._.elements.$navNext.click(_.bind(function(){this._.emitter.trigger("buttonNav","next")},this)),this._.emitter.on("select",null,_.bind(function(a,b,c,d){this.logNavigation(c,d,a)},this)),this._.emitter.on("select",null,_.bind(this.checkViewabilityTime,this)),$(window).on("beforeunload",_.bind(this.checkViewabilityTime,this)),this._.emitter.on("select",null,_.partial(setTimeout,_.bind(this.postLoadingQueueContents,this),this._.vwUnderImage.timeout)),this._.emitter.on("postContentsLoaded",null,_.once(_.bind(this.bindViewabilityScroll,this))),this._.emitter.on("postContentsLoaded",null,_.partial(setTimeout,_.bind(this.checkViewabilityScroll,this),this._.vwUnderImage.timeout)),this.bindViewabilityJafo()},bindViewabilityJafo:function(){Math.random()<.01&&(this._.emitter.on("vwTime",null,_.bind(function(a,b){Imgur.Util.jafoLog({event:"vwTime",meta:{hash:a,sec:Math.floor(parseInt(b,10)/1e3)}})},this)),this._.emitter.on("vwUnderImage",null,_.bind(function(a,b,c){Imgur.Util.jafoLog({event:"vwUnderImage",meta:{hash:a,pos:b,target:c}})},this)),this._.emitter.on("vwUnderComments",null,_.bind(function(a,b,c,d){var e={hash:a,isAlbum:b,nsfw:c};b||(e.isAnimated=d),Imgur.Util.jafoLog({event:"vwUnderComments",meta:e})},this)))},postLoadingQueueContents:function(){var a,b,c,d,e;if(this._.image&&!(this._.image.num_images<1))for(this._.postContents.loading=[],this._.postContents.loaded=[],this._.postContents.hash=this._.image.hash,a=$(this._.elements.imageContainers),b=0;b<a.length;b++)c=$(a[b]),e=c.attr("id"),d=c.find("video, img").first(),!e||d.length<1||(this._.postContents.loading.push(e),d.is("video")?this.postLoadingCheckVideo(e,d):this.postLoadingCheckImg(e,d))},postLoadedContentHash:function(a){this.postLoadingVerifyHash(a)&&(this._.postContents.loaded.push(a),this._.postContents.loading.length===this._.postContents.loaded.length&&this._.emitter.trigger("postContentsLoaded",this._.image))},postLoadingVerifyHash:function(a){return this._.postContents.hash===this._.image.hash&&this._.postContents.loaded.indexOf(a)<0&&this._.postContents.loading.indexOf(a)>-1},postLoadingCheckImg:function(a,b){this.postLoadingVerifyHash(a)&&(b[0].complete?this.postLoadedContentHash(a):b.on("load error",{imgHash:a},_.bind(this.postLoadingHandleImg,this)))},postLoadingHandleImg:function(a){var b=Imgur.Util.dive(a,"data.imgHash");_.isString(b)&&this.postLoadedContentHash(b)},postLoadingCheckVideo:function(a,b){return b[0].readyState<1?void b.on("loadeddata",{imgHash:a},_.bind(this.postLoadingHandleVideo,this)):void this.postLoadedContentHash(a)},postLoadingHandleVideo:function(a){var b=Imgur.Util.dive(a,"data.imgHash"),c=$(a.target);c[0].readyState>0&&this.postLoadedContentHash(b)},bindViewabilityScroll:function(){$(window).on("scroll resize",_.throttle(_.bind(this.checkViewabilityScroll,this),250))},checkStickyHeader:function(){var a=$(window).scrollTop(),b=$(".post-header"),c=this._.elements.$postContainer.offset().top,d=a-this._.scrollPosition;if(this._.scrollPosition=a,!this._.headerFixed&&a>c){var e=this._.elements.$postHeader.outerHeight();this._.elements.$postHeader.addClass("fixed"),this._.elements.$postContainer.css("padding-top",e),this._.elements.$shareButtons.css("margin-top",this._.shareMarginTop-e),this._.headerFixed=!0}else this._.headerFixed&&c>=a&&(this._.elements.$postHeader.removeClass("fixed"),this._.elements.$postContainer.css("padding-top",0),this._.elements.$shareButtons.css("margin-top",this._.shareMarginTop),this._.headerFixed=!1);a>c+this._.postTitleMaxHeight&&d>10&&!b.hasClass("animate")&&b.outerHeight()>80?(b.addClass("animate"),b.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){$(this).addClass("animation-finished")})):(a<=c+this._.postTitleMaxHeight||-100>d)&&(b.off("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend"),b.removeClass("animation-finished"),b.removeClass("animate")),this._.captionsEnabled&&($.inviewport($("#right-content"),{threshold:0})?this._.elements.$postJump.removeClass("js-animate"):this._.elements.$postJump.addClass("js-animate"))},checkViewabilityTime:function(a){(_.isObject(a)||this._.vwTime.lastHash!==this._.hash)&&(this._.vwTime.msec>0&&this._.emitter.trigger("vwTime",this._.vwTime.lastHash,(new Date).valueOf()-this._.vwTime.msec),this._.vwTime.lastHash=""+this._.hash,this._.vwTime.msec=(new Date).valueOf())},checkViewabilityScroll:function(){var a=parseInt(this._.elements.$window.scrollTop()+this._.elements.$window.height(),10),b=parseInt(this._.elements.$underImage.offset().top+this._.elements.$underImage.outerHeight()+this._.vwUnderImage.padding,10),c=$("#comments-container");if(this._.captionsEnabled){var d=c.offset().top+c.height();if(this._.vwUnderImage.lastHash!==this._.hash&&a>=b&&(this._.emitter.trigger("vwUnderImage",this._.hash,a,b),this._.vwUnderImage.lastHash=this._.hash),this._.captionsEnabled&&this._.vwUnderComments.lastHash!==this._.hash&&a>d&&d>=this._.elements.$window.scrollTop()){var e=this._.sideGallery.getImage(this._.hash)||{};this._.emitter.trigger("vwUnderComments",this._.hash,e.is_album,e.nsfw,e.animated),this._.vwUnderComments.lastHash=this._.hash}}},enablePrevButton:function(){this._.elements.$navPrev.removeClass("disabled")},enableNextButton:function(){this._.elements.$navNext.removeClass("disabled")},disablePrevButton:function(){this._.elements.$navPrev.addClass("disabled")},disableNextButton:function(){this._.elements.$navNext.addClass("disabled")},changeSection:function(a){this._.section=a},changeSort:function(a){this._.sort=a},changeWindow:function(a){this._.window=a},updatePoints:function(a){var b,c,d;if("comment"===a.type){var e=this._.captionInstance.getCaptionById(this.getHash(),a.comment);e&&"visible_points"in e&&(e.visible_points=a.points),this._.insideCommentsArea.forceUpdate()}else if("image"===a.type&&"hash"in a){if(b=$(".points-"+a.hash),this._.emitter.trigger("imagePointUpdate",a),this._.analytics.updatePoints(a.ups,a.downs),c=parseInt(b.text().replace(/,/g,""),10),d=a.points,c===d)return;b.stop().animate({opacity:".8"},150,"linear",function(){b.text(Imgur.Util.numberFormat(Math.round(d))),b.stop().animate({opacity:"1"},150,"linear")})}},getURL:function(a){return{historyState:this._.baseURL+"/"+a.hash,image:this._.cdnURL+"/"+a.hash+a.ext,thumb:this._.cdnURL+"/"+a.hash+"b"+a.ext,imageVotesJSON:"//"+Imgur.Environment.host+"/gallery/"+a.hash+"/votes.json",captionsJSON:"//"+Imgur.Environment.host+"/gallery/"+a.hash+"/comment/best/hit.json"}[a.type]},fetchImage:function(a,b,c){var d=this._.sideGallery.getImage(a);d&&(d.is_album&&null==this._.albumImageStore.getImages(d.hash)?this._.albumImageStore.fetchImages(d.hash,_.bind(function(a){for(var c=0;c<a.count&&5>c;++c)this.preloadImage(a.images[c]);"function"==typeof b&&b(d)},this)):(this.preloadImage(d),"function"==typeof b&&b(d)),this.fetchCaptions(d.hash,c||_.noop))},fetchCaptions:function(a,b,c){if(this._.captionsEnabled){if(this._.captionInstance.haveCaptions(a))return void b();if(!this._.fetchingCaptions[a]){this._.fetchingCaptions[a]=!0;var d=this,e=this.getURL({type:"captionsJSON",hash:a}),f=this.getURL({type:"imageVotesJSON",hash:a});$.ajax(e,{displayGenericError:!1}).done(function(e){e&&e.data&&e.data.captions?(d._.captionInstance.mergeCaptions(a,e.data.captions),b(),delete d._.fetchingCaptions[a]):c||(delete d._.fetchingCaptions[a],d.fetchCaptions(a,b,!0))}).fail(function(){delete d._.fetchingCaptions[a],c||d.fetchCaptions(a,b,!0)}),this._.signed&&!c&&$.ajax(f,{displayGenericError:!1}).done(function(c){c&&c.data&&c.data.votes&&(d._.captionInstance.mergeVotes(a,c.data.votes),b())})}}},scrollToCaptions:function(a){var b=this._.elements.$underImage.offset().top-this._.elements.$postHeader.outerHeight();a?$("html, body").animate({scrollTop:b},500):window.scrollTo(0,b)},processCaptions:function(){var a=this,b=this._.hash,c=this.getCaptionSorter(),d=b===this._.image.hash?this._.image:this._.sideGallery.getImage(b),e=_.clone(this._.captionInstance.getParentIds(b)),f=_.transform(e,function(d,e){var f=a._.captionInstance.getCaptionChildrenIds(b,e),g=[];if(Imgur.Environment.auth.show_mature)g=f;else for(var h=0;h<f.length;h++){var i=a._.captionInstance.getCaptionById(b,f[h]),j=i.caption.match(/nsfw|mature/i),k=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,l=i.caption.match(k);j&&l&&i.author_id!=Imgur.Environment.auth.id||g.push(f[h])}g.sort(function(d,e){var f=a._.captionInstance.getCaptionById(b,d),g=a._.captionInstance.getCaptionById(b,e);return c(f,g)}),d[e]=g},{}),g=_.bind(function(a,b,c){a.preventDefault(),this.pushWindowState(b,c),this.processCaptions()},this),h=_.bind(function(a){this.processCaptions(),this._.emitter.trigger("captionSubmit",a)},this),i=$.cookie("GCS");i||(i="best");var j,k=_.bind(function(a,b){this.processCaptions(),this._.emitter.trigger("captionVoted",a,b)},this),l=_.bind(function(a){this.setCaptionSort(a),$.cookie("GCS",a,{expires:7,path:"/"}),Imgur.Util.jafoLog({event:"commentSort",meta:{sort:a,state:"done",hash:b}}),this.processCaptions()},this),m=this.getPermalinkIfExists();if("undefined"!=typeof m){j=m.commentId;var n=Imgur.Caption.getInstance().getCaptionById(b,j);if(null!==n){for(var o=n.parent_id,p=n.id,q=0;q<m.contextLevels&&(f[o]=[p],null!==o);q++)p=o,o=Imgur.Caption.getInstance().getCaptionParentById(b,o);j=m.contextLevels>0?p:n.id}else j=void 0}var r="undefined"!=typeof m&&"undefined"!=typeof j,s=Imgur.Util.getQueryParams(window.location.search),t="lr"in s?parseInt(s.lr):Number.MAX_SAFE_INTEGER,u={image:d,loading:!Imgur.Caption.getInstance().haveCaptions(b),childmap:f,votemap:Imgur.Caption.getInstance().getVotes(b),contextId:j,contextLevels:m?m.contextLevels:null,defaultExpandMode:Imgur.CommentTree.EXPAND_MODE_DEFAULT_COLLAPSED,expandedFromPermalink:r,commentSort:i,onCommentSortChange:l,timeLastRead:t,permalink:m,loadmore:g,msid:Imgur.Environment.msid,onsubmit:h,linkifier:this._.linkifier,onvotechange:k},v=this._.insideCommentsAreaWithContext;this._.insideCommentsArea=React.render(React.createElement(v,u),$("#comments-container").get(0)),Imgur.ShareButtons.getInstance().bindAddthisButton(),Imgur.Util.triggerPerformanceCheckpoint("comments_rendering"),this._.analytics.updateComments(Imgur.Caption.getInstance().countComments(b))},getPermalinkIfExists:function(){var a=window.location.pathname,b=-1!==a.indexOf("comment");if(b){var c=a.split("/comment/")[1].split("/");return{commentId:parseInt(c[0]),contextLevels:parseInt(c[1])}}},setupHistoryState:function(){var a=this,b=Imgur.History.getInstance();b.addPopState("inside_nav.comment",function(b){a.handlePopStateComment(b)}),b.addPopState("inside_nav.image",function(b){a.handlePopStateImage(b)})},handlePopStateComment:function(){var a=window.location.pathname.split("/"),b=null;3==a.length&&a[2].length>=5&&(b=a[2]),a.length>3&&(b="r"===a[1]?a[a.length-1]:"user"===a[1]?a[4]:a[2]),this.setHash(b),this.scrollToCaptions(),this.processCaptions()},handlePopStateImage:function(){var a=window.location.pathname.split("/"),b=null;3===a.length&&a[2].length>=5&&(b=a[2]),a[2]&&(b=-1!==_.indexOf(["r","t","topic"],a[1])?a[a.length-1]:"user"===a[1]?a[4]:a[2]),this._.sideGallery.getImage(a[1])&&(b=a[1]),this._.sideGallery.selectImage(b,!0),this.processCaptions(),this.updateShare()},pushWindowState:function(a,b){var c=this._.baseURL+"/"+this._.hash;a&&(c+="/comment/"+a,b&&(c+="/"+b)),Imgur.History.getInstance().addWindowState("inside_nav.comment","Comments on "+window.title,c)},setCaptionSort:function(a){var b=a.substr(0,1).toUpperCase()+a.substr(1);this._.captionLayout.sort=this["sortCaptionsBy"+b]},getCaptionSorter:function(){var a=[_.bind(this.sortCaptionsByMineJustSubmitted,this),this._.captionLayout.sort,_.bind(this.sortCaptionsByIdDesc,this)];return function(b,c){for(var d=0;d<a.length;d++){var e=a[d](b,c);if(0!=e)return e}return 0}},sortCaptionsByTop:function(a,b){var c=a.points,d=b.points;return c>d?-1:d>c?1:0},sortCaptionsByBest:function(a,b){var c=a.best_score,d=b.best_score;return c>d?-1:d>c?1:0},sortCaptionsByNew:function(a,b){var c=new Date(a.datetime),d=new Date(b.datetime);return c>d?-1:d>c?1:0},sortCaptionsByMineJustSubmitted:function(a,b){return"just_inserted"in a&&!("just_inserted"in b)?-1:"just_inserted"in b&&!("just_inserted"in a)?1:0},sortCaptionsById:function(a,b){return a.id<b.id?-1:a.id>b.id?1:0},sortCaptionsByIdDesc:function(a,b){return a.id>b.id?-1:a.id<b.id?1:0},showAnalytics:function(){this._.analytics.popAndLoad(this._.image)},blankPage:function(){var a=this._.elements;Imgur.InfiniteScroll.getInstance().stopInfiniteScroll(),React.unmountComponentAtNode(a.$image.get(0)),$(a.sparkbar).unbind(),$(a.sparkbar).remove(),this._.isPromoted&&(Imgur.Environment.l_ads?this.removeAds():this.removePromotedCompanion()),humanMsg.removeMsg(function(){$("#humanMsg").remove(),humanMsg.setup()}),this._.fetchQueue=[]},pushToFetchQueue:function(a,b,c){this._.fetchQueue.push(_.bind(this.fetchImage,this,a,b,c))},updateVoteResponseData:function(a,b,c){a=a||this.getHash(),b=b||this._.elements.$voteUp,c=c||this._.elements.$voteDown,null!=this._.sideGallery&&(b.hasClass("pushed")?this._.sideGallery.updateVote(a,"up"):c.hasClass("pushed")?this._.sideGallery.updateVote(a,"down"):this._.sideGallery.updateVote(a,"veto"))},updateFavorite:function(a){this._.sideGallery.updateFavorite(this.getHash(),a)},setupReportLink:function(){var a=this.getHash(),b=this._.sideGallery.getImage(a),c=Imgur.Environment.auth.url===this._.image.account_url||!this._.captionsEnabled||b.promoId||b.readonly;this._.el.inside.reportImageLink.toggleClass("nodisplay",c),1==$.cookie("r"+this.getHash())?(this._.el.inside.reportImageLink.addClass("red").text(" post reported"),this._.el.inside.reportImageLink.unbind("click")):(this._.el.inside.reportImageLink.removeClass("red").text(" report post"),this._.el.inside.reportImageLink.unbind("click"),this._.el.inside.reportImageLink.click(_.bind(function(){self._.emitter.trigger("report image")},this)))},handleAds:function(){var a=this.getHash(),b=this._.sideGallery.getImage(a);this.isSafe()?this._.ad.injectAd&&(!this._.isHotImage&&b.is_hot||b.hasOwnProperty("in_gallery")&&b.in_gallery)?this.showAds():this._.ad.injectAd&&this._.section&&0==$(this._.elements.adWrapper).length&&this.showAds():this.removeAds()},isSafe:function(){var a=this._.sideGallery.getImage(this.getHash());return a?a.is_safe===!0?!0:a.nsfw_tag||a.nsfw||a.hasOwnProperty("in_gallery")&&!a.in_gallery||a.is_moderated===!1?!1:!0:!1},updateSponsoredInfo:function(){var a=this.getHash(),b=this._.elements,c=this._.sideGallery.getImage(a);b.$smallLinks.hide();var d=$("<div>"+_.unescape(c.description)+"</div>");d.find("p").remove(":empty"),this.updateStatBar(c,0,0),this._.elements.$statsLink.hide(),this._.elements.$taxonomyContainer.hide(),this._.elements.$iconMakeMeme.hide(),this._.emitter.trigger("displayPromoted",a)},updateSubmissionInfo:function(){var a=this.getHash(),b=this._.elements,c=this._.sideGallery.getImage(a),d=this.numberFormat(c.points,"point").split(" "),e=Imgur.Util.truncatedNumberFormat(c.views),f=isFinite(c.points)&&this._.captionsEnabled&&c.readonly!==!0;this._.elements.$taxonomyContainer.toggle(f);var g=c.readonly!==!0;if(this._.elements.$statsLink.toggle(g),this.updateStatBar(c,d,e),this._.elements.$postTitleContainer.show(),this._.elements.$postOptions.show(),c.favorited?b.$favoritedImage.hasClass("favorited")||b.$favoritedImage.addClass("favorited"):b.$favoritedImage.removeClass("favorited"),b.$views.length&&b.$views.text(this.numberFormat(c.views)),b.$bandwidth.length&&b.$bandwidth.text(c.bandwidth),c.subreddit||c.in_gallery||"favorites"==this._.gallery_type){{var h=moment.utc(c.datetime,"YYYY-MM-DD HH:mm:ss").fromNow();moment.utc(c.datetime,"YYYY-MM-DD HH:mm:ss").format("dddd, MMMM D, YYYY [at] HH:mm:ss [GMT]")}b.$subreddit.text("/r/"+c.subreddit),b.$nicetime.text(h),this.setupDownloadLinks(c),c.is_album?b.$embed.text("View album page").attr("href","/a/"+a+"?gallery"):b.$embed.text("Get embed codes").attr("href","/"+a+"?tags"),c.source?b.$originalSource.html('<a href="'+c.source+'">'+Imgur.getInstance().parseUri(c.source).host+"</a>").parent().show():b.$originalSource.parent().hide()}c.in_gallery?(b.$smallLinks.show(),b.$reddit.show(),b.$reddit.attr("href","/gallery/"+c.hash),b.$reddit.html("View comments in the gallery")):c.permalink?(b.$smallLinks.show(),b.$reddit.show(),b.$reddit.attr("href","https://www.reddit.com"+c.permalink),b.$reddit.html("View comments on reddit")):b.$reddit.hide(),c.source?b.$originalSource.html('<a href="'+c.source+'" target="_blank">'+Imgur.getInstance().parseUri(c.source).host+"</a>").parent().show():b.$originalSource.parent().hide(),c.topic?$("#post-topic option").each(function(){return $(this).text()==c.topic?($(this).attr("selected",!0),!1):void 0}):$("#post-topic option").eq(0).attr("selected",!0),c.nsfw?$("#mature-post").addClass("nodisplay"):$("#mature-post").removeClass("nodisplay")},updateStatBar:function(a,b,c){var d=a.ups+a.downs;d=0>=d?1:d;var e=a.ups/d*100,f=a.downs/d*100;0==e&&0==f&&(e=50,f=50),this._.elements.$statsLink.html(this._.templates.statBar({item:a,points:b,views:c,upvotePercent:e,downvotePercent:f,captionsEnabled:this._.captionsEnabled}))},setupDownloadLinks:function(a){var b=this;this._.elements.$download.unbind("click"),a.is_album?(this._.elements.$download.text("Download album"),this._.elements.$download.click(function(){return b.startDownload(a.hash),!1})):(this._.elements.$download.text("Download full resolution"),this._.elements.$download.click(function(){return window.location="/download/"+a.hash+"/"+encodeURIComponent(a.title),!1}))},startDownload:function(a){var b=Imgur.Album.getInstance();b._.id=a,b.downloadAlbum()},updatePage:function(a){var b=this.getHash(),c=this._.elements,d=this._.sideGallery.getImage(b),e=this,f=680;Imgur.Environment.l_ads&&(this._.image.is_moderated&&this.removeAds(),d&&((!this._.captionsEnabled&&("comment_count"in d||d.in_gallery)||this._.captionsEnabled&&!("comment_count"in d)&&!d.in_gallery)&&this.removeAds(),this._.image=d)),this._.analytics.clear(!0),Imgur.Gallery.getInstance()._.account_url=d.account_url,a||Imgur.History.getInstance().addWindowState("inside_nav.image",d.title,this.getURL({type:"historyState",hash:b})),$(".opened").removeClass("opened"),"comment_count"in d||d.isAd||d.in_gallery?$("#comments-container").length||($('<div id="comments-container">').insertAfter(".post-container"),c.$voteUp.show(),c.$voteDown.show(),c.$postJump.show(),this._.captionsEnabled=!0):($("#comments-container").remove(),c.$voteUp.hide(),c.$voteDown.hide(),c.$postJump.hide(),this._.captionsEnabled=!1),d.isAd&&this.removeAds(),this.blankPage(),this._.isPromoted=d.isAd,"object"==typeof rt36th&&rt36th.gallery_nav(d),this.setupReportLink(),this.setupOptionDropdown(d);try{this._.elements.scrollAdframe.contentWindow.clear()}catch(g){}if(this._.elements.$scrollAd.addClass("nodisplay"),this._.elements.$scrollAd.removeClass("adload"),this._.isPromoted||this.handleAds(),this.checkAdTime(),d.width>f){var h=f/d.width;c.$image.css({minHeight:d.height*h})}else c.$image.css({minHeight:d.height||0});d.is_album&&Imgur.Util.triggerView(d.hash,{album:!0,discard:!0});d.isAd?_.unescape(d.description):d.description;Imgur.Notification.getInstance().setTitle(null==d.title||"untitled"==d.title?this._.galleryTitle+" - Imgur":d.title+" - Imgur"),d.isAd?this.updateSponsoredInfo():this.updateSubmissionInfo(),this._.captionsEnabled&&!this._.captionInstance.haveCaptions(b)?(this._.insideCommentsArea&&this._.insideCommentsArea.setProps({loading:!Imgur.Caption.getInstance().haveCaptions(d.hash),image:d}),this.pushToFetchQueue(b,function(a){e.insertPost(a)},_.bind(this.processCaptions,this))):(e.insertPost(d),this._.captionsEnabled&&this.processCaptions()),d.is_album===!0?c.$metadataLink.attr("href",this._.protocol+this._.cdnURL+"/"+d.album_cover+d.ext):c.$metadataLink.attr("href",this._.protocol+this._.cdnURL+"/"+d.hash+d.ext),c.$actionTabs.hide(),"up"==d.vote?(this._.elements.$voteUp.addClass("pushed"),this._.elements.$voteDown.removeClass("pushed")):"down"==d.vote?(this._.elements.$voteDown.addClass("pushed"),this._.elements.$voteUp.removeClass("pushed")):(this._.elements.$voteDown.removeClass("pushed"),this._.elements.$voteUp.removeClass("pushed"));var i=this._.sideGallery.getNextImage();null!=i&&this.pushToFetchQueue(i),$(".tipsy").remove(),Imgur.Util.googleTrackPageview(),this.purgeCommentData(),this.purgeAlbumData(),this.updateCaptionHash();var j=_.extend(Imgur.Gallery.getInstance().getGalleryMetadata(),{hash:d.hash,inGallery:"undefined"!=typeof Imgur.Gallery,isAlbum:d.is_album,nsfw:d.nsfw,galleryEntry:null});"string"==typeof d.subreddit&&(j.subreddit=d.subreddit);try{"string"==typeof d.reddit&&"string"==typeof d.hot_datetime?j.galleryEntry=moment.utc(d.hot_datetime,"YYYY-MM-DD HH:mm:ss").valueOf():"string"==typeof d.timestamp&&(j.galleryEntry=moment.utc(d.timestamp,"YYYY-MM-DD HH:mm:ss").valueOf())}catch(g){j.galleryEntry=null}this._.depth+=a?-1:1,j.depth=this._.depth,Imgur.Util.jafoLog({event:"item",meta:j}),this._.imageJafoMeta=j,this.updateShare(),this._.tagCortex.topic.set(d.topic)},setupOptionDropdown:function(a){var b=this._.elements,c=Imgur.Environment.auth&&Imgur.Environment.auth.url==a.account_url,d=a.is_album?"show":"hide",e=a.is_album?"hide":"show",f=c&&!a.nsfw&&this._.captionsEnabled?"show":"hide",g=c&&this._.captionsEnabled?"show":"hide",h=c||this._.isPromoted||!this._.captionsEnabled?"hide":"show";b.$imageOptions[e](),b.$albumOptions[d](),b.$matureOption[f](),b.$deleteOption[g](),this._.el.inside.reportImageLink[h](),a.animated&&!a.is_album&&b.$iconMakeMeme.hide()},purgeCommentData:function(){var a=this,b=Object.keys(this._.captionInstance._.captions).filter(function(b){return Object.hasOwnProperty.call(a._.captionInstance._.captions,b)&&a.isImageNearby(b)});this._.captionInstance.purgeCaptionData(b)},purgeAlbumData:function(){var a=Object.keys(this._.albumImages);if(a.length>10)for(var b=0;b<a.length;++b)this.isImageNearby(a[b])||delete this._.albumImages[a[b]]},isImageNearby:function(a){var b=this._.sideGallery.selectedPosition(),c=this._.sideGallery.hashPosition(a);return-1!==c&&c>=b-3&&b+1>=c},_promotedTag:function(){var a=React.DOM.div({className:"promoted-tag"},React.DOM.a({href:Imgur.Environment.ppBlog,className:"title",title:"learn more about promoted posts"},"promoted"));return a},_promotedWrap:function(a){return React.DOM.div({className:"promoted-wrap"},this._promotedTag(),a)},insertPost:function(a,b){if(a.hash==this.getHash()){if(a.is_album&&null==this._.albumImageStore.getImages(a.hash))return void this._.albumImageStore.fetchImages(a.hash,_.bind(this.insertPost,this,this._.sideGallery.getImage(a.hash)||a,b));var c={data:a,initial:this._.initialImage,all_loaded:b,album_image_store:this._.albumImageStore,in_gallery:this._.captionsEnabled,has_access:this._.hasAccess,linkifier:this._.linkifier};React.render(React.createElement(Imgur.Gallery.Post,c),$(".post-images").get(0))}},preloadImage:function(a){var b,c=".gif"==a.ext&&a.animated&&a.size>2097152;if(c){var d=document.createElement("video"),e=document.createElement("source");d.canPlayType&&d.canPlayType("video/webm")?e.src=Imgur.Environment.cdnUrl+"/"+a.hash+".webm":d.canPlayType&&(e.src=Imgur.Environment.cdnUrl+"/"+a.hash+".mp4"),d.appendChild(e),b=d}else{var f=document.createElement("img");f.src=Imgur.Environment.cdnUrl+"/"+a.hash+a.ext,b=f}var g=function(){b&&(c?$(b).find("source").attr("src",""):$(b).attr("src",""),b=null)};b.onload=b.onerror=g,this._.emitter.once("select",null,g)},bindGoogleForceRefresh:function(){var a=this;if(this._.elements.adframe){var b=this._.elements.adframe.contentDocument.getElementsByTagName("iframe")[0];"undefined"!=typeof b&&(b.onload=function(){a.forceAdRefresh()})}},forceAdRefresh:function(){Imgur.Environment.l_ads&&(this._.ad.nextImageLoadRefreshesAd=!0)},bindScrollAd:function(){if(Imgur.Environment.l_ads&&this._.elements.$scrollAd.length){var a=this;this._.elements.$scrollAdClose.on("click",function(){a._.ad.closed=!0,a._.elements.$scrollAd.addClass("nodisplay"),a._.elements.scrollAdframe.contentWindow.clear()}),$(window).on("scroll",_.throttle(function(){var b=$(this);if(!a._.isPromoted)if(!a._.ad.injectAd&&!a._.ad.closed&&b.scrollTop()>a._.tallAdParams.rightContentHeight&&(b.width()>a._.tallAdParams.sqWidth&&b.height()>a._.tallAdParams.sqHeight||b.width()>a._.tallAdParams.recWidth&&b.height()>a._.tallAdParams.recHeight)){if(a._.elements.$scrollAd.removeClass("nodisplay"),!a._.elements.$scrollAd.hasClass("adload"))try{a._.elements.scrollAdframe.contentWindow.tagRefresh()}catch(c){}a._.elements.$scrollAd.addClass("adload")}else a._.elements.$scrollAd.addClass("nodisplay")},150))}},checkAdTime:function(){var a=(this._.elements,this);if(this._.ad.nextImageLoadRefreshesAd){{a._.elements}if(window.usesABP&&"undefined"!=typeof window.abp_ad){this._.ad.abpAdId.removeClass("nodisplay");try{googletag.pubads().refresh([window.abp_ad])}catch(b){}}else if("undefined"!=typeof window.dfp_adslot)try{a._.elements.adframe.contentWindow.tagRefresh(),a.bindGoogleForceRefresh()}catch(b){}if("undefined"!=typeof window.leaderboard_slot&&window.leaderboard_slot&&!Imgur.Environment.auth.id)try{window.leaderboard_slot.setTargeting("url",location.href),googletag.pubads().refresh([window.leaderboard_slot])}catch(b){}this._.captionsEnabled||Imgur.Environment.auth.id||($(".trc_rbox").remove(),window._taboola=window._taboola||[],_taboola.push({mode:"thumbnails-a",container:"taboola-below-article-thumbnails",placement:"LoggedOut_NonGallery",target_type:"mix"}),window._taboola=window._taboola||[],_taboola.push({flush:!0})),Imgur.Util.jafoLog({event:"mattShown"}),this._.ad.nextImageLoadRefreshesAd=!1,window.clearTimeout(this._.ad.currentTimeout),this._.ad.currentTimeout=window.setTimeout(function(){a._.ad.nextImageLoadRefreshesAd=!0,a._.ad.currentTimeout=void 0},this._.ad.timeTillRefresh)}else this._.ad.currentTimeout||(this._.ad.currentTimeout=window.setTimeout(function(){a._.ad.nextImageLoadRefreshesAd=!0,a._.ad.currentTimeout=void 0},this._.ad.timeTillRefresh))},removePromotedCompanion:function(){$(this._.elements.promoCompanion).remove()},removeAds:function(){if(Imgur.Environment.l_ads){$(this._.elements.adWrapper).remove(),$("#div-gpt-ad-1450206165364-0").remove(),$(".trc_rbox").remove(),this._.ad.abpAdId.addClass("nodisplay"),this._.elements.$scrollAd.addClass("nodisplay");try{this._.elements.scrollAdframe.contentWindow.clear()}catch(a){}this._.ad.nextImageLoadRefreshesAd=!1,this._.ad.injectAd=!0}else"object"==typeof rt36th&&rt36th.destroy_slots()},showAds:function(a,b){if((Imgur.Environment.l_ads||a)&&(this._.adType="normal","undefined"==typeof Imgur.getInstance()._.auth||Imgur.getInstance()._.auth.isPro!==!0)){var c,d=this.getHash(),e=this._.sideGallery.getImage(d),f="//"+Imgur.Environment.host+"/ads?page=";if("https:"==document.location.protocol?(c="div-gpt-ad-1378449215044-0",f+="ssl"):e.hasOwnProperty("in_gallery")?(c="div-gpt-ad-1345436959737-0",f+="inside"):(c="div-gpt-ad-1407357841031-0",f+="inside&main=1&hot=1"),!window.usesABP){if("string"==typeof a)var g=a;else if(!Imgur.Environment.l_ads)var g='<iframe id="adiframe" class="adframe" src="'+f+'" scrolling="no" frameBorder="0"></iframe>';$("#right-content .advertisement .panel-ad").length?$("#right-content .advertisement .panel-ad").html(g):$("#right-content #side-gallery").after('<div class="advertisement"><div class="panel-ad">'+g+"</div></div>"),this._.isPromoted||(this._.captionsEnabled||Imgur.Environment.auth.id?!Imgur.Environment.auth.id&&this._.captionsEnabled&&this.injectLeaderboardAd("gallery"):this.injectLeaderboardAd("nongallery")),a||(this._.elements.adframe=$("#adiframe").get(0))}this._.ad.nextImageLoadRefreshesAd=!0,this._.ad.injectAd=!1,"function"==typeof b&&b.apply(window,[a,$(this._.elements.adWrapper).get(0)])}},injectLeaderboardAd:function(a){Imgur.Environment.l_ads&&($("#topbar").after('<div id="div-gpt-ad-1450206165364-0" class="center advertisement"></div>'),window.leaderboard_slot?(googletag.pubads().clearTargeting(),googletag.pubads().setTargeting("page",a),googletag.pubads().setTargeting("login",Imgur.Environment.auth.id?"yes":"no"),googletag.pubads().setTargeting("url",location.href),googletag.pubads().refresh([window.leaderboard_slot])):(googletag.cmd.push(function(){window.leaderboard_slot=googletag.defineSlot("/4761660/Leaderboard_970x90_ATF",[[970,90],[728,90]],"div-gpt-ad-1450206165364-0").setTargeting("page",a).setTargeting("login",Imgur.Environment.auth.id?"yes":"no").setTargeting("url",location.href).addService(googletag.pubads()),googletag.pubads().enableSingleRequest(),googletag.pubads().collapseEmptyDivs(),googletag.enableServices()}),googletag.cmd.push(function(){googletag.display("div-gpt-ad-1450206165364-0")})))},hideZoomedImage:function(){$(".jquery-image-zoom").is(":visible")&&$("div.jquery-image-zoom a").click(),$.colorbox.close()},timeoutNextImage:function(){if(this._.autoBrowse&&!this._.autoBrowseTimeout){var a=this._.autoBrowseWait,b=this;this._.autoBrowseTimeout=setTimeout(function(){b._.autoBrowseTimeout=null,b._.emitter.trigger("buttonNav","next")},a)}else this._.autoBrowse&&(window.clearTimeout(this._.autoBrowseTimeout),this._.autoBrowseTimeout=null,this.timeoutNextImage())},bindAutoBrowse:function(){var a=this;$(document).keyup(function(b){return b.ctrlKey&&120===b.keyCode&&(a._.autoBrowse=!a._.autoBrowse,a._.autoBrowse?(a.timeoutNextImage(),humanMsg.displayMsg("Starting auto browse in "+Math.ceil(a._.autoBrowseWait/1e3)+" seconds!")):(clearTimeout(a._.autoBrowseTimeout),humanMsg.displayMsg("Done already?"))),!0})},navToImage:function(a,b){if(!("hash"in a&&this._.hash==a.hash)){"performance"in window&&"memory"in window.performance&&Imgur.Util.jafoLog({event:"nextPageMemory",meta:{pageDepth:Imgur.getInstance().pageDepth,used:window.performance.memory.usedJSHeapSize,total:window.performance.memory.totalJSHeapSize,limit:window.performance.memory.jsHeapSizeLimit}}),Imgur.getInstance().pageDepth++,$.cookie("retina",Imgur.Util.isRetinaDisplay()?1:0);var c=this.getHash();
this._.initialImage=!1,this.hideZoomedImage(),this.setHash(a.hash),this.updatePage(b,c),this.timeoutNextImage(),this._.emitter.trigger("navToImage",this.getHash())}},logNavigation:function(a,b,c){"inserted"!==b&&(Imgur.Util.jafoLog({event:"galleryNav",meta:_.extend(Imgur.Gallery.getInstance().getGalleryMetadata(),{direction:a,trigger:b,targeted:c.hash,visibleTooltip:this._.tooltip&&this._.tooltip.showing()?this._.tooltip.name():null,layout:this._.sideGallery.state.layout,position:this._.sideGallery.selectedPosition()+1+("next"==a?1:-1)})}),"function"==typeof this._.onNavigation&&this._.onNavigation(a,b,c))},bindArrowKeys:function(){var a=this,b={ARROW_LEFT:[37],ARROW_RIGHT:[39],ENTER:[13],MINUS:[109,173,189],PLUS:[187,61,107],NINE:[57,105]};$(document).keydown(function(c){if(!c.ctrlKey&&!c.altKey&&!c.metaKey){if(-1!==b.ARROW_LEFT.indexOf(c.keyCode)&&a._.sideGallery.getPrevImage()){if($(c.target).is("input")||$(c.target).is("textarea"))return!0;c.preventDefault(),a._.emitter.trigger("keyboardNav","prev")}else if(-1!==b.ARROW_RIGHT.indexOf(c.keyCode)&&a._.sideGallery.getNextImage()){if($(c.target).is("input")||$(c.target).is("textarea")||Imgur.Environment.hasAccess&&!Imgur.Environment.captionsEnabled)return!0;c.preventDefault(),a._.emitter.trigger("keyboardNav","next")}else if(-1!==b.ENTER.indexOf(c.keyCode)){if($(c.target).is("input")||$(c.target).is("textarea"))return!0;var d=$(".jquery-image-zoom");if(d.length)d.click();else{var e=$(".post-image img");e.length&&e[0].click()}}else if(-1!==b.MINUS.indexOf(c.keyCode)&&a._.captionsEnabled){if(!$(c.target).is("input")&&!$(c.target).is("textarea")){var c=jQuery.Event("click",{vote_display_msg:!0});$('.arrow.down[type="image"]').trigger(c)}}else if(-1!==b.PLUS.indexOf(c.keyCode)&&a._.captionsEnabled){if(!$(c.target).is("input")&&!$(c.target).is("textarea")){var c=jQuery.Event("click",{vote_display_msg:!0});$('.arrow.up[type="image"]').trigger(c)}}else-1!==b.NINE.indexOf(c.keyCode)&&($(c.target).is("input")||$(c.target).is("textarea")||$(".load-more").click());return!0}return!0}),this._.isRandom&&this._.elements.$randomButton.click(function(b){b.preventDefault(),a._.emitter.trigger("keyboardNav","next")})},getSideGallery:function(){return this._.sideGallery},forceScrollToCaption:function(){var a=document.location.hash.substr(1),b=parseInt(a,10);if(!isNaN(b)){var c=$("#caption-"+a);this.scrollToCaption(c)}},scrollToCaption:function(a){var b=a.offset().top;$("body").scrollTop(b);var c=a.find(".textbox").first();c.addClass("flash"),setTimeout(function(){c.removeClass("flash")},2e3)},setupKeynavTooltip:function(a){if(!Imgur.Environment.auth.id){var b=a?"sidegallery-keynav-popup-tip":"sidegallery-keynav-postnext-tip",c=new Imgur.Elements.FrequencyCappedWrapper(b,Imgur.Elements.TetheredTooltip,{storageKey:"sidegallery-keynav-tip",position:"bottom",target:this._.elements.$navNext.not(".fixed .navNext")[0]},React.DOM.img({className:"left",src:"//s.imgur.com/images/keynav-lr.png",alt:"Left and right arrows on your keyboard",width:66,height:44}),React.DOM.div({className:"right",style:{width:"180px"}},React.DOM.em({},"Protip: "),React.DOM.span({},"You can use your keyboard arrows to navigate to the next post.")));this._.tooltip=c,a&&setTimeout(_.bind(c.show,c,"experiment-var-3003810115"),2e3);var d=!1,e=0,f=function(a){c.hide(a),d=!0};this._.onNavigation=function(b,g){return d?void 0:"keyboard"===g?void f("keyboard-navigation"):(e++,a||1!==e?void(e>2&&f("nextprev-click-"+e)):void c.show("experiment-var-3022360396"))}}}}),Class.addSingleton(Imgur.InsideNav),Namespace("Imgur.Fullscreen"),Imgur.Fullscreen=Class.extend({init:function(a){this._=$.extend({signed:Imgur.getInstance()._.signed,el:{$fullscreenBox:$(".fullscreenBox"),$fullscreenLink:$(".album-fullscreen-link"),$userActionLinks:$(".userActionLinks"),$embed:$("#fullscreenEmbed")}},a),window.fullScreenApi&&fullScreenApi.supportsFullScreen&&this._.el.$embed.length&&(this._.signed&&(this._.el.$fullscreenBox.hide(),this._.el.$fullscreenBox=$(".fullscreenAlbumOptions"),this._.el.$fullscreenLink=$(".fullscreenAlbumOptions .album-fullscreen-link")),this._.el.$fullscreenLink.length&&(this._.el.$fullscreenLink.unbind("click"),this._.el.$fullscreenLink[0].removeEventListener("click",this.viewFullscreen),this._.el.$fullscreenLink[0].addEventListener("click",this.viewFullscreen,!0)),this._.el.$userActionLinks.hasClass("vertical")&&this._.el.$userActionLinks.css({"line-height":"22px",padding:"8px","font-size":"13px"}),this._.el.$embed.attr("src",""),this._.el.$fullscreenBox.show())},viewFullscreen:function(){var a=Imgur.Fullscreen.getInstance(),b=a._.el.$embed,c=b[0];if(a._.el.$embed.length){if(!a._.el.$embed.attr("src")||!a._.el.$embed.attr("src").length)return a._.el.$embed.attr("src","/a/"+Imgur.Album.getInstance()._.id+"/embed"),$(a._.el.$embed[0].contentDocument).ready(a.viewFullscreen),void humanMsg.displayMsg("Starting fullscreen mode...")}else setTimeout(a.viewFullscreen,80);a._.el.$embed.show(),window.fullScreenApi.requestFullScreen(c),setTimeout(a.focusOverlayAfterOpen,99);var d=setInterval(function(){a.showOverlayIfOpen(d)},100),e=setInterval(function(){a.closeOverlayIfExited(e)},100)},focusOverlayAfterOpen:function(){var a=Imgur.Fullscreen.getInstance();fullScreenApi.isFullScreen()?(a._.el.$embed[0].contentWindow.focus(),$(a._.el.$embed[0].contentWindow).keydown(function(b){27==b.which&&a._.el.$embed.hide(),b.stopPropagation()})):(window.fullScreenApi.requestFullScreen(a._.el.$embed[0]),setTimeout(a.focusOverlayAfterOpen,200))},showOverlayIfOpen:function(a){var b=Imgur.Fullscreen.getInstance();b._.el.$embed.is(":visible")?clearInterval(a):b._.el.$embed.css({display:"block",opacity:"100%"})},closeOverlayIfExited:function(a){var b=Imgur.Fullscreen.getInstance();fullScreenApi.isFullScreen()||(b._.el.$embed.is(":visible")?b._.el.$embed.css({display:"none"}):clearInterval(a))}}),Class.addSingleton(Imgur.Fullscreen),Namespace("Imgur.Caption.Reply"),Imgur.Caption.Reply=React.createClass({displayName:"Reply",propTypes:{image:React.PropTypes.object.isRequired,parentId:React.PropTypes.number,parentAuthorId:React.PropTypes.number,autofocus:React.PropTypes.bool,onBlur:React.PropTypes.func,onSuccess:React.PropTypes.func},contextTypes:{msid:React.PropTypes.string.isRequired,onSubmit:React.PropTypes.func.isRequired},getDefaultProps:function(){return{maxLength:140,autofocus:!1}},getInitialState:function(){return{text:"",error:"",showingLoader:!1,focused:!1,clickingOnRules:!1}},componentDidMount:function(){this.props.autofocus&&this.refs.textarea.getDOMNode().focus()},getValue:function(){return $.trim(this.state.text)},handleSubmit:function(a){a.preventDefault(),a.stopPropagation(),this._submit()},handleError:function(a){var b=_.isObject(a.responseJSON)?a.responseJSON:a;this.setState(b&&"data"in b&&"error"in b.data&&"message"in b.data.error?{error:b.data.error.message}:{error:"An unknown error occurred."})},_submit:function(){if(!(0===this.state.text.length||this.state.text.length>this.props.maxLength)){var a={parent_id:this.props.parentId,parent_author:this.props.parentAuthorId,caption:this.state.text,sid:this.context.msid,gallery:Imgur.Gallery.getInstance().getGalleryMetadata()};Imgur.Environment.signed||(Imgur.getInstance().signin("commentAttempt"),a.redirect=!0),this.setState({showingLoader:!0});var b=$.ajax({url:"/gallery/action/caption/"+this.props.image.hash,type:"POST",data:a});b.always(_.bind(function(){this.setState({showingLoader:!1})},this)),Imgur.Environment.signed&&(b.done(_.bind(function(a){if(a.success){a.data.caption.just_inserted=!0,this.props.onSuccess(),Imgur.Caption.getInstance().mergeCaptions(a.data.caption.hash,[a.data.caption]);var b={caption_id:a.data.caption.id,vote:"up"};Imgur.Caption.getInstance().mergeVotes(a.data.caption.hash,[b]),this.context.onSubmit(a.data.caption)}else this.handleError(a)},this)),b.fail(_.bind(this.handleError,this)))}},handleTextChanged:function(a){this.setState({text:a.target.value})},handleClick:function(a){a.stopPropagation()},handleKeyDown:function(a){13===a.keyCode?(a.preventDefault(),this._submit()):27===a.keyCode&&this.refs.textarea.getDOMNode().blur()},handleFocus:function(){this.setState({focused:!0})},handleMouseDownRules:function(){this.setState({clickingOnRules:!0})},handleRules:function(){this.setState({clickingOnRules:!1}),Imgur.Util.jafoLog({event:"reportRules",meta:{type:"comment",hash:this.props.image.hash,isAlbum:this.props.image.is_album}})},render:function(){var a=this.props.maxLength-this.state.text.length,b=classNames,c=b({"caption-create":!0,loading:this.state.showingLoader,focused:this.state.focused,"counter-exceeded":0>a,"counter-warning":25>a&&a>=0});return React.DOM.form({className:c,onClick:this.handleClick,onSubmit:this.handleSubmit},React.DOM.textarea({ref:"textarea",onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onBlur:_.partial(this.props.onBlur,this.state.clickingOnRules),onChange:this.handleTextChanged,onFocus:this.handleFocus,placeholder:"Submit a comment",value:this.state.text}),this.state.error.length>0?React.DOM.div({className:"error"},this.state.error):"",React.DOM.div({className:"summary right"},React.DOM.div({className:"counter"},a),React.DOM.span({className:"community"},"Remember our ",React.DOM.a({href:"/rules",onMouseDown:this.handleMouseDownRules,onClick:this.handleRules,target:"_blank"},"community rules")),React.DOM.input({value:"Save",type:"submit",id:"submit-comment",className:"btn btn-grey",disabled:0>a?"disabled":""})),React.DOM.div({className:"clear"}))}}),Namespace("Imgur.Gallery"),Imgur.Gallery=Imgur.extend({init:function(a,b,c){return $.extend(this.settings,b),this._=_.merge({sid:b.sid,auth:b.auth||{},signed:!1,cdnURL:b.cdnUrl,baseURL:b.baseURL,sort:"hot",section:null,window:"day",page:0,maxPage:0,jafoPage:0,hash:null,nextHash:null,prevHash:null,showPast:!0,commentName:"comment",comment_sort:"best",indexName:"gallery",searchQuery:null,account_url:null,emitter:a,mobile:!1,isRandom:!1,gallery_type:null,tagsCookie:"tags",isIPad:navigator.userAgent.match(/iPad/i),history:c,el:{arrows:$(".arrow"),randomButton:$(".random-button"),outside:{pageDivider:"#imagelist .page-divider",noMorePagesID:"#nomore",tagLoaderClass:".outside-loader",loaderID:".imagelist-loader",extendedImagelist:"#extended-imagelist",loadMoreID:"#load-more",$sortOptions:$(".sentence-sorting .options a"),content:$("#imagelist"),messagebox:$("#messagebox"),comboboxes:$(".combobox"),$toggleViral:$("#showviral"),$toggleUserSub:$("#showusersub"),$toggleFiltered:$("#showfiltered"),galleryNewInfo:{id:"#gallery-new-info",$okay:$("#gallery-new-info-okay"),$no:$("#gallery-new-info-decline")}},inside:{reportImageLink:$("#report-image"),$shareTabButton:$(".button-container .share"),$optionsButton:$(".button-container .options-btn"),$actionBar:$("#under-image .action-bar"),$shareLink:$(".button-container .share-link"),counter:null,image:$(".image"),zoom:$(".zoom"),submitCaptionButton:$(".submit-caption-button"),commentExpand:$("#expand-comments"),comboboxes:$(".combobox"),commentSort:$("#comment-sort"),$comments:$("#captions"),reCaptionLink:$("#meme-image"),downloadAlbumForm:{id:"#download-album-form",emailInput:$("#download-album-form #email"),form:$("#download-album-form #download-form"),message:$("#message"),save:$("#download-album-form #save"),loader:$("#download-loader")}},user:{notorietyLink:$("#notoriety-link"),notorietyList:$("#notoriety-list"),buttonComments:$(".button.comments"),buttonFavorites:$(".button.likes"),buttonSubmitted:$(".button.submitted"),buttonReplies:$(".button.replies"),captions:$("#captions"),favorites:$("#likes"),loader:$("#loader"),pmButton:$("#pm-button"),pmWrapper:$("#pm-wrapper"),pmBody:$("#pm-wrapper textarea"),pmSendButton:$("#pm-send-button"),pmForm:$("#pm-wrapper form"),pmSent:$("#pm-sent"),updateLevelTable:$("#update-level-table"),$carousel:$("#thumbs-top")},past:{wrapper:$("#past-wrapper"),previewContent:$("#past-preview"),loader:$("#past-loader"),link:$("#past-link"),slider:$("#slider"),days:$("#days"),ticker:$("#slider-wrapper .ticker"),positiveTickClass:"positive",negativeTickClass:"negative",submitButton:$("#past-submit"),calendar:$("#past-calendar")},colorboxConfirmForm:{id:"#colorbox-confirm",title:$("#colorbox-confirm h3"),message:$("#colorbox-confirm-message"),yes:$("#colorbox-confirm-yes"),no:$("#colorbox-confirm-no"),loader:$("#colorbox-confirm .small-loader")},embedAlbumForm:Imgur.Utilities.Embed.elEmbedAlbumForm(),colorboxEmbed:Imgur.Utilities.Embed.elColorboxEmbed(),search:{$headerSearch:$(".search-container"),$headerSearchInput:$('.search-container input[name="q"]'),$advanced:$("#search_advanced"),$advancedForm:$("#search_advanced form"),$advancedAllInput:$('#search_advanced form input[name="q_all"]'),imageCard:".posts-search .post-list, .posts-search .post",$container:$("#imagelist"),size:"#q_size",$sizePx:$('input[name="q_size_px"]'),$sizeMpx:$('input[name="q_size_mpx"]'),$sizeFmt:$('input[name="q_size_fmt"]'),$sizeToggle:$("#q_size_is_mpx"),$pxCombo:$("#size_in_px"),$mpxCombo:$("#size_in_mpx")},side:{links:$("#fixed-side-footer-links"),imagePanels:$(".imagelist-panels")}},vars:{pastPage:0,scrolledPage:0,scrolledImageSet:0,pastTickerTimer:null,currentTheme:"dark"},messages:null},b),this._super(this._),this._},getEmitter:function(){return this._.emitter},getCacheValue:function(){var a="";return $("script[type*=javascript]").each(function(){if(this.src){var b=this.src.split("?"),c=$.trim(b[0].split("/").pop());if("gallery.js"==c)return void(a=b[1])}}),a},isNumberKey:function(a){var b=a.which?a.which:a.keyCode;return b>31&&(48>b||b>57)?!1:!0},remove:function(){humanMsg.displayMsg("Working...");var a=this.imgurInsideNav.getHash(),b=this._.baseURL+"/action/remove_image/"+a,c={remove:!0,sid:this._.sid};$.post(b,c,function(a){return a.success?void humanMsg.displayMsg("Image was removed from the gallery"):humanMsg.displayMsg(a.message,"error-msg")})},mature:function(){humanMsg.displayMsg("Working...");var a=this.imgurInsideNav.getHash(),b=this._.baseURL+"/action/mature_image/"+a,c={sid:this._.sid};$.post(b,c,_.bind(function(a){return a.success?(humanMsg.displayMsg("Image was marked mature"),void(this.imgurInsideNav.getImage().nsfw=!0)):humanMsg.displayMsg(a.message,"error-msg")},this))},opMature:function(){$.colorbox({href:this._.el.colorboxConfirmForm.id,open:!0,inline:!0,top:"15%",transition:"none",scrolling:!1,onComplete:_.bind(this.bindMatureImage,this)})},ban:function(){var a;""!=this._.account_url&&(a={account_url:this._.account_url,type:"main",sid:this._.sid,offending_url:window.location.href},$.post("/adm/removals/ban",a,_.bind(function(){var b="The ban hammer hit "+this._.account_url+" successfully for "+a.offending_url;humanMsg.displayMsg(b)},this)))},spam:function(){""!=this._.account_url&&$.post("/adm/removals/markspammer",{account_url:this._.account_url,type:"main",sid:this._.sid},_.bind(function(){humanMsg.displayMsg(this._.account_url+" has been spammed")},this))},warn:function(){var a=window.location.href;""!=this._.account_url&&$.post("/adm/removals/warn",{account_url:this._.account_url,data:a,sid:this._.sid},_.bind(function(){humanMsg.displayMsg(this._.account_url+" has been warned")},this))},trophy:function(a){var b,c,d=$(a.target),e=d.attr("data-type"),f=d.text(),g=d.val(),h=this.imgurInsideNav.getCurrentImage();if("comment"===e){if(b=document.location.pathname.match(/^\/gallery\/[^\/]+\/comment\/([0-9]+)\/?/),!b)return void humanMsg.displayMsg("Please visit a comment permalink to award that.","error-msg");c={comment_id:b[1]}}if("image"===e&&h.account_url){if(!/^\/(gallery\/[^\/]+|topic\/[a-zA-Z0-9_-]+\/[^\/]+)\/?/.test(document.location.pathname))return void humanMsg.displayMsg("Please visit the gallery or topic page for this post to award that.","error-msg");c={hash:h.hash}}"object"==typeof c&&$.post("/adm/trophies/"+g,c,_.bind(function(){humanMsg.displayMsg("Awarded "+f+" trophy!")},this)),a.preventDefault()},reportImage:function(){var a=this,b=a.imgurInsideNav.getHash(),c={type:"galleryPost",hash:b,isAlbum:a.imgurInsideNav._.image.is_album,nsfw:a.imgurInsideNav._.image.nsfw};Imgur.Util.jafoLog({event:"reportInvoked",meta:c}),this.generateReportBox(a._.baseURL+"/action/report_image/"+b,c,function(){a._.el.inside.reportImageLink.addClass("red").text(" post reported")})},bindDeleteImage:function(){var a=this;this._.el.colorboxConfirmForm.no.unbind("click"),this._.el.colorboxConfirmForm.yes.unbind("click"),this._.el.colorboxConfirmForm.title.html("Remove Submission from Gallery"),this._.el.colorboxConfirmForm.message.html(this._.messages.deleteImage),$.colorbox.resize(),this._.el.colorboxConfirmForm.no.click(function(){$.colorbox.close()}),this._.el.colorboxConfirmForm.yes.click(function(){a._.el.colorboxConfirmForm.yes.disable(),a._.el.colorboxConfirmForm.loader.show(),$.post(a._.baseURL+"/action/delete_image/"+a._.hash,{sid:a._.sid},function(){a._.el.colorboxConfirmForm.loader.hide(),a._.el.colorboxConfirmForm.yes.enable(),Imgur.Util.jafoLog({event:"removeFromGallery",meta:{hash:a._.hash,isAlbum:a._.image.is_album}}),a._.signed&&($.colorbox.close(),humanMsg.displayMsg("Submission has been removed"),setTimeout(function(){window.location="//"+a._.host},500))}).error(function(){a._.el.colorboxConfirmForm.yes.enable(),a._.el.colorboxConfirmForm.loader.hide()})})},bindMatureImage:function(){var a=this.imgurInsideNav.getHash(),b=this._.baseURL+"/action/mature_image/"+a,c={sid:this._.sid},d=this._.messages.markMature;this._.el.colorboxConfirmForm.no.unbind("click"),this._.el.colorboxConfirmForm.yes.unbind("click"),Imgur.Environment.auth.show_mature||(d="<p>"+d+"</p><p>"+this._.messages.markMatureNotEnabled+"</p>"),this._.el.colorboxConfirmForm.title.html("Mark this submission as mature?"),this._.el.colorboxConfirmForm.message.html(d),$.colorbox.resize(),this._.el.colorboxConfirmForm.no.click(function(){$.colorbox.close()}),this._.el.colorboxConfirmForm.yes.click(_.bind(function(){this._.el.colorboxConfirmForm.yes.disable(),this._.el.colorboxConfirmForm.loader.show(),$.ajax({method:"post",url:b,data:c,success:_.bind(function(){this._.el.colorboxConfirmForm.loader.hide(),this._.el.colorboxConfirmForm.yes.enable(),Imgur.Util.jafoLog({event:"markGalleryAsMature",meta:{hash:this._.hash,isAlbum:this._.image.is_album}}),$.colorbox.close(),humanMsg.displayMsg("Submission marked as mature")},this),error:_.bind(function(){this._.el.colorboxConfirmForm.yes.enable(),this._.el.colorboxConfirmForm.loader.hide()},this)})},this))},deleteImage:function(){var a=this;$.colorbox({href:a._.el.colorboxConfirmForm.id,open:!0,inline:!0,top:"15%",transition:"none",scrolling:!1,onComplete:function(){a.bindDeleteImage()}})},reCaption:function(){var a=Imgur.InsideNav.getInstance().getHash();window.location="/memegen/create/"+a},insertAd:function(a){var b=Math.floor(1e3*Math.random()),c=$('<div id="bottom-ad" class="advertisement"></div>'),d=$('<div class="panel-ad advertisement"></div>'),e=$('<iframe src="//imgur.com/include/rc-iframe.html?cb='+b+'" framespacing="0" frameborder="no" scrolling="no" width="300" height="250" allowtransparency="true"></iframe>');$(d).append(e),$(c).append(d),$(c).css("top",a+"px"),$("#content").append(c)},fadeInLoader:function(a){var b=this._.el.outside.content.find(this._.el.outside.tagLoaderClass);b.length&&b.eq(b.length-1).fadeIn(75,a)},fadeOutLoader:function(a){var b=this._.el.outside.content.find(this._.el.outside.tagLoaderClass);b.length&&b.eq(b.length-1).fadeOut(75,a)},initialPopState:function(){window.location=window.location},initTipsy:function(){if(!this._.isIPad){var a=$("#imagelist img, .thumbnails img, .thumbs img, .image img, .thumb-title");a.each(function(){$(this).attr("title",$(this).attr("data-title"))}),a.tipsy({gravity:"n",opacity:.95,offset:-15,html:!0,live:!0})}},initZoom:function(){this._.el.inside.zoom.imageZoom()},showPastPreview:function(){this._.vars.pastPage>this._.vars.maxDays&&(this._.vars.pastPage=this._.vars.maxDays,this._.el.past.days.val(this._.vars.pastPage)),$(".tipsy").remove(),this._.el.past.previewContent.empty(),this._.el.past.loader.show();var a=this,b=Imgur.getInstance()._.signed?"miss":"hit";$.cookie("gallerypage",this._.vars.pastPage,{domain:Imgur.Environment.host,path:"/"});var c=this._.vars.pastPage;Imgur.Util.jafoLog({event:"pastImages",meta:{days:c}}),$.get(this._.baseURL+"/past/page/"+(this._.showPast?this._.vars.pastPage:this._.vars.pastPage-1)+"/"+b+"?scrolled",function(b){a._.el.past.loader.hide(),a._.el.past.previewContent.html(b),a._.el.past.previewContent.find("img").tipsy({gravity:"n",opacity:.95,offset:-8,html:!0}).on("click",function(){Imgur.Util.jafoLog({event:"pastImagesClick",meta:{days:c}})})})},pastOnLoad:function(){this.hideAds(),0==this._.el.past.previewContent.find("h3").size()&&this.showPastPreview(),this._.el.past.days.val(this._.vars.pastPage);var a=this;this._.el.past.calendar.DatePicker({format:"m/d/Y",date:"",current:"",starts:1,position:"bottom",onBeforeShow:function(){var b=new Date;b.setUTCHours(0),b.setUTCMinutes(0),b.setUTCSeconds(0),b.setUTCMilliseconds(0);var c=864e5*a._.el.past.days.val(),d=new Date(b.getTime()-c),e=d.getUTCMonth()+1+"/"+d.getUTCDate()+"/"+d.getUTCFullYear();$(this).DatePickerSetDate(e,!0),$(".datepicker").css("z-index",1e4),Imgur.Util.jafoLog({event:"pastImagesCalendarOpen"})},onHide:function(){$(".datepicker").css("z-index",""),Imgur.Util.jafoLog({event:"pastImagesCalendarClose"})},onChange:function(b,c){var d=new Date,e=new Date(c);d.setUTCHours(0),d.setUTCMinutes(0),d.setUTCSeconds(0),d.setUTCMilliseconds(0),e.setUTCHours(0),e.setUTCMinutes(0),e.setUTCSeconds(0),e.setUTCMilliseconds(0);var f=Math.max(Math.floor((d.getTime()-e.getTime())/864e5),0);f=Math.min(f,a._.maxPage),a._.el.past.days.val(f),a._.vars.pastPage=f,a._.el.past.calendar.DatePickerHide(),a._.el.past.slider.slider("value",a._.vars.pastPage),a.showPastPreview(),Imgur.Util.jafoLog({event:"pastImagesCalendarChange"})}}),$(this._.el.past.slider).slider({value:this._.vars.pastPage,min:this._.vars.showPast?0:1,max:this._.maxPage,step:1,slide:function(b,c){a._.vars.pastPage=c.value,a._.el.past.days.val(a._.vars.pastPage)},change:function(){a.showPastPreview()}})},pastClickHandler:function(){var a=this;Imgur.Util.jafoLog({event:"pastImagesClock"}),$.colorbox({href:"#"+this._.el.past.wrapper.attr("id"),inline:!0,innerWidth:this._.el.past.wrapper.width()+20,innerHeight:this._.el.past.wrapper.height()+20,transition:"none",title:"<h1>Show images from the past</h1>",open:!0,onLoad:function(){a.pastOnLoad()},onClosed:function(){$.cookie("gallerypage",null,{expires:-1,domain:Imgur.Environment.host,path:"/"}),a.showAds()}})},pastDaysChangeHandler:function(a){isFinite(a.currentTarget.value)?(this._.vars.pastPage=parseInt(a.currentTarget.value,10),this._.el.past.slider.slider("value",this._.vars.pastPage)):humanMsg.displayMsg("Please enter a number","error-msg")},pastDaysKeypressHandler:function(a){return this.isNumberKey(a)},pastTickerClickHandler:function(a){clearTimeout(this._.vars.pastTickerTimer),this._.vars.pastPage=$(a.target).hasClass(this._.el.past.positiveTickClass)?this._.vars.pastPage+1<this._.maxPage?this._.vars.pastPage+1:this._.maxPage:this._.vars.pastPage-1>0?this._.vars.pastPage-1:0,this._.el.past.days.val(this._.vars.pastPage);var b=this,c=function(){b.showPastPreview()};this._.vars.pastTickerTimer=setTimeout(c,400)},pastSubmitClickHandler:function(){var a=this._.showPast?this._.vars.pastPage:this._.vars.pastPage-1;Imgur.Util.jafoLog({event:"pastImagesGo",meta:{page:a}}),$.colorbox.close(),window.location=this._.baseURL+"/hot/viral/page/"+a},getGalleryMetadata:function(){var a={};switch(a.gallerySort=this._.sort,a.galleryWindow=this._.window,a.galleryType=this._.section,this._.subreddit&&(a.galleryType="subreddit"),a.galleryType){case"subreddit":a.subreddit=this._.subreddit;break;case"topic":a.topic=this._.topic;break;case"tag":a.tag=this._.tag}return a.topicTag=a.tag||a.topic,a},getBaseUrl:function(){return this._.overRideUrl?this._.overRideUrl:this._.baseURL},getSectionUrl:function(){var a=this._.section&&!this._.subreddit&&"tag"!=this._.section&&"group"!=this._.section&&"topic"!=this._.section&&"favorites"!=this._.section?"/"+this._.section:"",b=this._.baseURL+a+"/";return b},getUrl:function(a,b){var c="top"==this._.section?"":this._.sort+"/",d="top"==this._.sort||"top"==this._.section?this._.window+"/":"",e=this.getSectionUrl()+c+d+"page/"+a+"/"+(Imgur.Environment.signed?"miss":"hit")+"?scrolled";if(this._.overRideUrl)return this._.overRideUrl+"/"+c+"/page/"+a+"/"+(Imgur.Environment.signed?"miss":"hit")+"?scrolled";if(this._.inSearch){var f=Imgur.getInstance().getSearchUrl(this._,a);e=f.url+"?scrolled&"+f.query}else"hot"==this._.section&&(e+="&set="+b);return e},handleResponse:function(a,b,c){var d=$(a).find("img").length;if(d>0&&(this._.vars.scrolledImageSet>=1||"new"==this._.section)&&!$(this._.el.outside.extendedImagelist).length&&$.cookie("showComments")){var e;e=$(0==this._.vars.scrolledImageSet?'<div id="extended-imagelist"></div>':'<div id="extended-imagelist"><div class="posts br5"></div><div class="page-divider"><a href="javascript:;" class="scroll-top-text">back to top</a></div></div>'),$(this._.el.outside.pageDivider).remove(),this._.el.outside.content.after(e),this._.el.outside.content=e}if(d>0&&c&&(Imgur.Util.getGoogleTracker(),__ga("send","pageview")),0==this._.vars.scrolledPage&&this._.vars.scrolledImageSet<=0){var f=this._.el.outside.content.find(this._.el.outside.tagLoaderClass);if(f.length&&f.eq(f.length-1).is(":visible"))return void this.fadeOutLoader(_.bind(this.handleResponse,this,a,b));$(this._.el.outside.extendedImagelist).length&&(this._.el.outside.content=this._.el.outside.content.prev(),$(this._.el.outside.extendedImagelist).remove()),this._.el.outside.content.find(".posts").remove(),this._.el.outside.content.find(".imagelist-header:gt(0)").remove(),this._.el.outside.content.append(a)}else this._.vars.scrolledImageSet>=1?(this._.el.outside.content.find(".posts:last .clear").remove(),this._.el.outside.content.find(".posts:last").append(a),this._.el.outside.content.find(".posts:last").append('<div class="clear"></div>')):this._.el.outside.content.append(a);this._.el.outside.content.find(".posts:last").find("img").each(function(){$(this).attr("title",$(this).attr("data-title")),$(this).tipsy({gravity:"n",opacity:.95,offset:-15,html:!0})});var g=$(".arrow");g.unbind("click"),g.click(_.bind(function(a){this.vote(a)},this)),this.initOutsideComboboxes(),this.searchHighlight(),0==$(this._.el.outside.noMorePagesID).length?(60>d&&(this._.vars.scrolledPage++,this._.vars.scrolledImageSet=-1),$(this._.el.outside.loaderID+":lt(-1)").remove(),Imgur.InfiniteScroll.getInstance().infiniteScroll(_.bind(function(){this.loadMore()},this))):this._.vars.scrolledImageSet>0?($(this._.el.outside.noMorePagesID).remove(),this._.vars.scrolledPage++,this._.vars.scrolledImageSet=-1,this.loadMore()):$(this._.el.outside.loaderID).eq(0).remove(),this._.emitter.trigger("new gallery page"),"function"==typeof b&&b(),this._.emitter.trigger("gallery page refetched"),this._.jafoPage++,Imgur.Util.jafoLog({event:"galleryPageShown",meta:_.merge(Imgur.Gallery.getInstance().getGalleryMetadata(),{pageNum:this._.jafoPage,itemCount:d})})},fetchImages:function(a,b,c){var d=this.getUrl(a,b);this._.vars.loading=!0,$.ajax({url:d,success:_.bind(function(a){this._.vars.loading=!1,this.handleResponse(a,c,d)},this)}),$(_.bind(function(){Imgur.Util.jafoLog({event:"galleryPageRequest",meta:_.merge(Imgur.Gallery.getInstance().getGalleryMetadata(),{pageNum:a})})},this))},showLoadMore:function(){$(this._.el.outside.loaderID).eq(0).html(this._.messages.loadMore),$(this._.el.outside.loadMoreID).click(_.bind(function(a){$(a.target).unbind("click"),$(a.target).parent().html('<img src="//s.imgur.com/images/loaders/ddddd1_181817/48.gif" />'),this.loadMore(!0)},this))},loadMore:function(a){return this._.vars.loading?void 0:!a&&this._.vars.scrolledPage>0&&this._.vars.scrolledPage%5==0&&-1==this._.vars.scrolledImageSet?void this.showLoadMore():void($(this._.el.outside.loaderID).length>0&&("hot"!=this._.section||this._.inSearch||this._.overRideUrl?this._.vars.scrolledPage++:this._.vars.scrolledImageSet++,this.fetchImages(this._.vars.scrolledPage,this._.vars.scrolledImageSet)))},notorietyLinkClickHandler:function(){this._.el.user.notorietyList.is(":hidden")?(this._.el.user.notorietyList.slideDown(),this._.el.user.notorietyLink.find("a").html("hide list")):(this._.el.user.notorietyList.slideUp(),this._.el.user.notorietyLink.find("a").html("show list"))},userButtonCommentsClickHandler:function(){window.location="/user/"+this._.account_url},userButtonFavoritesClickHandler:function(){window.location="/user/"+this._.account_url+"/favorites"},userButtonSubmittedClickHandler:function(){window.location="/user/"+this._.account_url+"/submitted"},userButtonRepliesClickHandler:function(){window.location="/user/"+this._.account_url+"/replies"},setupUserCaptions:function(){var a=new Imgur.Linkifier;a.addGrabber(new Imgur.Linkify.ImgurGrabber(Imgur.Environment.host,Imgur.Environment.cdnUrl)),a.addGrabber(new Imgur.Linkify.PlainGrabber),a.addGrabber(new Imgur.Linkify.UsernameGrabber),a.addViewer("youtube",new Imgur.Linkify.YoutubeViewer),a.addViewer("html5video",new Imgur.Linkify.Html5VideoViewer),a.addViewer("gifv",new Imgur.Linkify.ImgurGifvViewer(new Imgur.Linkify.Html5VideoViewer)),a.addViewer("imgur",new Imgur.Linkify.ImgurViewer),a.addViewer("image",new Imgur.Linkify.ImageViewer);var b=React.createClass({childContextTypes:{linkifier:React.PropTypes.object},getChildContext:function(){return{linkifier:a}},render:function(){return React.createElement(Imgur.UserCommentsArea,this.props)}});React.render(React.createElement(b,{user:this._.account_url,sort:this._.sort}),$(".left .panel .captions-container").get(0))},setupUserFavorites:function(){var a=this,b=function(){a._.el.user.loader.show(),$.get("/user/"+a._.account_url+"/favorites/page/"+ ++a._.page+"?scrolling",function(c){c?(a._.el.user.loader.hide(),a._.el.user.favorites.append(c),Imgur.InfiniteScroll.getInstance().infiniteScroll(b)):a._.el.user.loader.remove()})};this._.el.user.loader.length>0&&Imgur.InfiniteScroll.getInstance().infiniteScroll(b)},setupUserReplies:function(){var a=new Imgur.Linkifier;a.addGrabber(new Imgur.Linkify.ImgurGrabber(Imgur.Environment.host,Imgur.Environment.cdnUrl)),a.addGrabber(new Imgur.Linkify.PlainGrabber),a.addGrabber(new Imgur.Linkify.UsernameGrabber),a.addViewer("youtube",new Imgur.Linkify.YoutubeViewer),a.addViewer("html5video",new Imgur.Linkify.Html5VideoViewer),a.addViewer("gifv",new Imgur.Linkify.ImgurGifvViewer(new Imgur.Linkify.Html5VideoViewer)),a.addViewer("imgur",new Imgur.Linkify.ImgurViewer),a.addViewer("image",new Imgur.Linkify.ImageViewer);var b=React.createClass({childContextTypes:{linkifier:React.PropTypes.object},getChildContext:function(){return{linkifier:a}},render:function(){return React.createElement(Imgur.UserRepliesArea,this.props)}});React.render(React.createElement(b,{auth:this._.auth}),$(".left .panel .replies-div .captions-container").get(0))},setupUserSubmitted:function(){var a=this,b=function(){a._.el.user.loader.show(),$.get("/user/"+a._.account_url+"/submitted/page/"+ ++a._.page+"?scrolling",function(c){c?(a._.el.user.loader.hide(),a._.el.user.favorites.append(c),Imgur.InfiniteScroll.getInstance().infiniteScroll(b)):a._.el.user.loader.remove()})};this._.el.user.loader.length>0&&Imgur.InfiniteScroll.getInstance().infiniteScroll(b)},userPmButtonClickHandler:function(){var a=this;return this._.signed?void $.colorbox({href:"#"+a._.el.user.pmWrapper.attr("id"),inline:!0,innerWidth:a._.el.user.pmWrapper.width()+20,innerHeight:a._.el.user.pmWrapper.height()+20,transition:"none",open:!0,onComplete:function(){a._.el.user.pmBody.showPlaceholder(),a._.el.user.pmBody.focus()}}):Imgur.getInstance().signin("messageUserAttempt")},userPmSendButton:function(){var a=this;if(""!=a._.el.user.pmBody.val()&&a._.el.user.pmBody.val()!=a._.el.user.pmBody.attr("title")){for(var b=a._.el.user.pmForm.find("input, textarea"),c=0;c<b.length;++c){var d=$(b[c]);
d.val()==d.attr("title")&&d.val("")}$.post("/account/messages/create",a._.el.user.pmForm.serialize(),function(){a._.el.user.pmSent.fadeIn(250),setTimeout(function(){$.colorbox.close(),a._.el.user.pmSent.hide(),a._.el.user.pmBody.val(""),a._.el.user.pmBody.showPlaceholder()},600)})}},carouselItemFirstIn:function(a,b,c){0==a.index()?c.addClass("disabled"):c.removeClass("disabled")},carouselItemLastIn:function(a,b,c){var d=b.jcarousel("items").length;a.index()==d-1?c.addClass("disabled"):c.removeClass("disabled")},userInit:function(){var a=this;this.generalInit(),this._.el.user.notorietyLink.click(function(){a.notorietyLinkClickHandler()}),this._.el.user.buttonComments.click(function(){a.userButtonCommentsClickHandler()}),this._.el.user.buttonFavorites.click(function(){a.userButtonFavoritesClickHandler()}),this._.el.user.buttonSubmitted.click(function(){a.userButtonSubmittedClickHandler()}),this._.el.user.buttonReplies.click(function(){a.userButtonRepliesClickHandler()}),this._.el.user.pmButton.click(function(){a.userPmButtonClickHandler()}),this._.el.user.pmSendButton.click(function(){a.userPmSendButton()}),$("#remove-post").click(function(){a.remove(a.imgurInsideNav.getHash())}),$("#mature-post").click(function(){a.mature()}),$("#ban-user").click(function(){a.ban()}),$("#spam-user").click(function(){a.spam()}),"index"===this._.window?this.setupUserCaptions():"submitted"===this._.window?this.setupUserSubmitted():"replies"===this._.window?this.setupUserReplies():this.setupUserFavorites(),this._.el.user.$carousel.jcarousel({animation:300}),$(".next").click(function(){a._.el.user.$carousel.jcarousel("scroll","+=3",!0)}),$(".prev").click(function(){a._.el.user.$carousel.jcarousel("scroll","-=3",!0)}),a._.el.user.$carousel.find("li").bind("jcarouselitemfirstin",function(){a.carouselItemFirstIn($(this),a._.el.user.$carousel,$(".prev"))}).bind("jcarouselitemlastin",function(){a.carouselItemLastIn($(this),a._.el.user.$carousel,$(".next"))})},toggleShowViral:function(){$.cookie("hidingviral")?$.removeCookie("hidingviral",{path:"/"}):$.cookie("hidingviral",!0,{expires:30,path:"/"}),window.location=window.location},toggleShowFiltered:function(a,b,c){var d="true"!==$.cookie(a),e=d?"<span>showing "+c+"</span>":"<span>hiding "+c+"</span>";this._.el.outside.$toggleFiltered.toggleClass("showing",d).html(e),$(".cards").toggleClass("blurred",!d),$.cookie(a,d?"true":"false",{expires:30,path:"/",domain:Imgur.Environment.host}),Imgur.Util.jafoLog({event:b,meta:{toggle:d?"show":"hide"}})},initOutsideInfScroll:function(){Imgur.InfiniteScroll.getInstance().infiniteScroll(_.bind(function(){this.loadMore()},this))},bindOutsideSortOptions:function(){var a=this;this._.el.outside.$sortOptions.bind("click",function(){var b=$(this).attr("href").split("?")[0],c=b.split("/"),d=c[c.length-1];Imgur.Util.jafoLog({event:"gallerySortChange",meta:{location:"outside",gallerySort:d,galleryType:a._.section,previousSort:a._.sort,previousType:a._.section}})})},searchAdvancedHandleSubmit:function(a){a.preventDefault();var b,c,d,e,f=document.location,g=this._.el.search.$advancedForm.find("input"),h=[],i=!0,j=this._.el.search.$advancedAllInput.val(),k=g.length,l=f.protocol+"//"+f.host;if(skip={qs:1,q_all:1},f.port.length&&(l+=":"+f.port),l+="/search/"+this._.sort+"/"+this._.window,k){for(e=0;k>e;e++)if(b=$(g[e]),c=$(g[e]).attr("name"),d=String($(g[e]).val()),!(c in skip))switch(b.attr("type")){case"hidden":d!=$(g[e]).attr("data-default")&&(h.push(c+"="+encodeURIComponent(d)),i=!1);break;case"text":d.length&&(h.push(c+"="+encodeURIComponent(d)),i=!1);break;case"checkbox":b.is(":checked")&&h.push(c+"=on")}i?h=["q="+encodeURIComponent(j)]:h.push("q_all="+encodeURIComponent(j)),h.length&&(l+="?"+h.join("&")),document.location=l}},searchAdvancedToggleHandler:function(a){var b=this,c=$(a.target);this._.el.search.$advanced.is(":visible")?(this._.el.search.$advanced.fadeOut(150,function(){b.syncSearchSimpleAndAdvanced()}),$(a.target).attr("title","show advanced search")):(this._.el.search.$advanced.fadeIn(150,function(){b.syncSearchSimpleAndAdvanced()}),$(a.target).attr("title","hide advanced search")),c.parent().toggleClass("active"),c.tipsy("hide")},searchAdvancedToggleSizeType:function(){this._.el.search.$sizeToggle.is(":checked")?(this._.el.search.$pxCombo.hide(0),this._.el.search.$mpxCombo.show(0)):(this._.el.search.$mpxCombo.hide(0),this._.el.search.$pxCombo.show(0))},searchHighlight:function(){var a,b,c="",d=!1,e=!1,f={className:"matched-search-term"},g=$(this._.el.search.imageCard);if(this._.inSearch){if("object"!=typeof this._.advSearch||"string"==typeof this._.searchQuery&&""!==this._.searchQuery)this._.searchQuery&&g.strEle(this._.searchQuery,f);else{if("string"==typeof this._.advSearch.q_all&&(c+=" "+this._.advSearch.q_all),"string"==typeof this._.advSearch.q_exactly&&(d=this._.advSearch.q_exactly),"string"==typeof this._.advSearch.q_any&&(c+=" "+this._.advSearch.q_any),c.length&&(e=c.match(/("[^"]+"|[^\s]+)/g),b=e.length,b>0))for(a=0;b>a;a++)g.strEle(e[a],f);d&&g.strEle(d,f)}g.find(".bottom-box span").removeClass(f.className)}},syncSearchSimpleAndAdvanced:function(){this._.el.search.$advanced.length<1||(this._.el.search.$advanced.is(":visible")?(this._syncSearchSimpleAndAdvancedElements(this._.el.search.$headerSearchInput,this._.el.search.$advancedAllInput),this._.el.search.$headerSearch.removeClass("search-focused").addClass("search-forced-closed"),this._.el.search.$advancedAllInput.focus().select()):(this._syncSearchSimpleAndAdvancedElements(this._.el.search.$advancedAllInput,this._.el.search.$headerSearchInput),this._.el.search.$headerSearch.removeClass("search-forced-closed").addClass("search-focused"),this._.el.search.$headerSearchInput.focus().select()))},_syncSearchSimpleAndAdvancedElements:function(a,b){var c=String(b.val()),d=a.val(),e=a.attr("placeholder");c.length<1&&d!=e&&b.val(d).trigger("change"),a.val("")},outsideInit:function(){var a=this;this._.vars.scrolledPage=this._.vars.pastPage=this._.page,this._.showPast||(this._.vars.pastPage+=1),this.generalInit(),this.initOutsideInfScroll(),this.bindOutsideSortOptions(),$(".tooltip").tooltipster({interactive:!0,position:"left",speed:100,offsetX:7}),this._.el.arrows.click(function(b){a.vote(b)}),this._.el.past.link.click(function(){a.pastClickHandler()}),this._.el.past.days.change(function(b){a.pastDaysChangeHandler(b)}),this._.el.past.days.keypress(function(b){a.pastDaysKeypressHandler(b)}),this._.el.past.ticker.click(function(b){a.pastTickerClickHandler(b)}),this._.el.past.submitButton.click(function(){a.pastSubmitClickHandler()}),this._.el.search.$sizeToggle.on("change",function(b){a.searchAdvancedToggleSizeType(b)}),this._.el.search.$advancedForm.on("submit",function(b){a.searchAdvancedHandleSubmit(b)}),"new"==this._.section&&this._.el.outside.$toggleViral.click(function(){a.toggleShowViral()}),("topic"==this._.section||"filtered"==this._.section)&&$("#showfiltered").click(_.bind(this.toggleShowFiltered,this,"showingFiltered","toggleFiltered","filtered")),this.initOutsideComboboxes(),this.searchHighlight(),this._.el.outside.content.on("mouseenter",".post a",function(){var a=$(this).data("page");$.cookie("gallerypage",a,{domain:Imgur.Environment.host,path:"/"})}),this._.el.outside.content.on("mouseleave",".post a",function(){$.cookie("gallerypage",null,{expires:-1,domain:Imgur.Environment.host,path:"/"})}),$(document).ready(function(){a._.showGalleryNewInfo&&$.colorbox({href:a._.el.outside.galleryNewInfo.id,open:!0,inline:!0,top:"15%",transition:"none",scrolling:!1,onComplete:function(){a._.el.outside.galleryNewInfo.$okay.click(function(){$.cookie("IGT",1,{expires:7,path:"/"}),$.colorbox.close()}),a._.el.outside.galleryNewInfo.$no.click(function(){window.location="//"+a._.host+"/hot"})}})})},initOutsideComboboxes:function(){$(".combobox:not(#section):not(#sort)").combobox({onChange:_.bind(function(a,b){switch(a){case"q_size_px":$(this._.el.search.size).val(b),this._.el.search.$sizeMpx.val(b);var c=this._.el.search.$mpxCombo.find(".options .item").removeClass("selected").filter('[value="'+b+'"]').addClass("selected").text();this._.el.search.$mpxCombo.find("div.selection").first().text(c);break;case"q_size_mpx":$(this._.el.search.size).val(b),this._.el.search.$sizePx.val(b);var c=this._.el.search.$pxCombo.find(".options .item").removeClass("selected").filter('[value="'+b+'"]').addClass("selected").text();this._.el.search.$pxCombo.find("div.selection").first().text(c)}},this)})},insideInit:function(){var a=_.bind(function(a,b){var c=this.imgurInsideNav.getHash(),d=this.imgurInsideNav._.sideGallery.getImage(c);switch(d||(d=this._.image),b){case"download":Imgur.Util.jafoLog({event:"downloadImage",meta:{control:"postOptions",nsfw:d.nsfw,hash:d.hash,isAlbum:d.is_album,isAnimated:d.animated}}),d.is_album?this.imgurInsideNav.startDownload(d.hash):window.location="/download/"+c+"/"+encodeURIComponent(d.title);break;case"meme":Imgur.Util.jafoLog({event:"makeAMeme",meta:{control:"postOptions",nsfw:d.nsfw,hash:d.hash,isAlbum:d.is_album,isAnimated:d.animated}}),window.location="/memegen/create/"+c;break;case"report":1!=$.cookie("r"+c)&&this.reportImage();break;case"delete":this.deleteImage();break;case"embed":Imgur.Utilities.Embed.embedModal.call(this)}return!1},this);if(this.generalInit(),Imgur.getInstance().setHash(this._.hash),this._.el.embedAlbumForm.embedCodeInput.click($(this).selectAll),Imgur.Utilities.Embed.setupThemur.call(this),this._.comment_id||this._.mobile||this._.el.inside.$comments.html('<img class="small-margin-top" src="//s.imgur.com/images/loaders/ddddd1_2b2b2b/24.gif"/>'),this._.el.inside.$actionBar.on("click",".arrow",_.bind(function(a){var b=!1;"undefined"!=typeof a.vote_display_msg&&a.vote_display_msg===!0&&(b=!0),this.imgurInsideNav.vote(a,b)},this)),Imgur.Util.triggerPerformanceCheckpoint("votebtn"),Imgur.Util.triggerView(this._.hash,{album:this._.image.is_album,discard:!1}),this._.image.is_album)for(var b=0;b<this._.image.album_images.images.length&&10>b;b++){var c=this._.image.album_images.images[b];Imgur.Util.triggerView(c.hash,{image:!0,discard:!1})}this.initZoom(),this._.el.colorboxEmbed.embedCodeInput.click($(this).selectAll),this.imgurInsideNav.generalInit(_.bind(function(){this.imgurInsideNav.setCaptionSort(this._.comment_sort),!this._.mobile&&null!==this._.section&&this._.captionsEnabled&&this.imgurInsideNav.fetchCaptions(this._.hash,_.bind(function(){Imgur.Caption.getInstance().haveCaptions(this._.hash)&&this.imgurInsideNav.processCaptions(this._.hash)},this)),$(".post-loadall").click(_.bind(function(){return this.imgurInsideNav.insertPost(this._.image,!0),!1},this)),$("#post-jump-comments").click(_.bind(this.imgurInsideNav.scrollToCaptions,this.imgurInsideNav,!0)),$("#post-jump-top").click(function(){$("html, body").animate({scrollTop:0},500)})},this)),this._.el.inside.reCaptionLink.click(this.reCaption),this._.el.inside.$shareTabButton.click(this.toggleTab),1==$.cookie("r"+this.imgurInsideNav.getHash())?this._.el.inside.reportImageLink.addClass("red").text(" post reported"):this._.el.inside.reportImageLink.removeClass("red").text(" report post"),$("#remove-post").click(_.bind(this.remove,this)),$(".image-options .mark-mature-post").click(_.bind(this.opMature,this)),$("#mature-post").click(_.bind(this.mature,this)),$("#warn-user").click(_.bind(this.warn,this)),$("#ban-user").click(_.bind(this.ban,this)),$("#spam-user").click(_.bind(this.spam,this)),$("#trophy-mod").on("click","button",_.bind(this.trophy,this)),$("#post-topic").on("change",_.bind(function(){$.post(this._.baseURL+"/action/set_topic/"+this.imgurInsideNav.getHash(),{sid:this._.sid,topic_id:$("#post-topic").val()},_.bind(function(){var a=$("#post-topic").find("option:selected").text();humanMsg.displayMsg(a+" set as topic"),this.imgurInsideNav.getImage().topic=a},this))},this)),this._.el.inside.$shareLink.focus(this.select),this._.el.inside.$optionsButton.combobox({maybe:a}),$(document).ready(_.bind(function(){this.updateShare(),Imgur.Util.triggerPerformanceCheckpoint("sharebtn")},this))},toggleTab:function(a){if(!a)return void $(".button-container .btn").removeClass("opened");a.stopPropagation();var b=$(a.currentTarget),c=b.hasClass("opened");$(".opened").removeClass("opened"),c||b.addClass("opened")},generalInit:function(){window.navigator.userAgent===Imgur.Util.PERFORMANCE_CHECKPOINT_USER_AGENT&&window.performance.webkitSetResourceTimingBufferSize(9999999),this._.sid=$("#sid").val(),this._.messages={markMature:"Are you sure you want to mark this submission as mature?",markMatureNotEnabled:'If you\'d like to enable mature content for your account, please visit your <a href="/account/settings">account settings</a> and choose &quot;Show mature posts and comments.&quot; If you mark a post as mature, but choose not to enable mature content, you may not see your post when browsing Imgur.',deleteImage:"Are you sure you want to remove this submission from the gallery?",loadMore:'<div id="load-more">load more images</div>',reportImage:"Are you sure you want to report this submission for spam or abuse?"},this.initTipsy()},updateShare:function(){var a=this._.image;if(a){var b=Imgur.ShareButtons.getInstance();b.bindButtons();var c="http://"+this._.host+this._.baseURL+"/"+this._.hash;c=a.is_album?c.replace("/account/favorites/","/a/"):c.replace("/account/favorites/","/"),b.setShareData({title:a.title,jafoMeta:_.merge(this.getGalleryMetadata(),{type:"galleryPost",hash:this._.hash,isAlbum:a.is_album,inGallery:!0,nsfw:a.nsfw}),url:c},{global:!0})}},getInsideNav:function(){return this.imgurInsideNav},generateReportBox:function(a,b,c){this._.signed?$.colorbox({html:'<div id="report-container"></div>',open:!0,top:"10%",transition:"none",scrolling:!1,fixed:!0,width:420,height:402,className:"noBorder",close:"",onComplete:function(){React.render(React.createElement(Imgur.Elements.Report,{url:a,metadata:b,cb:c}),$("#report-container").get(0))},onClosed:_.bind(function(){this._.preventCloseAnalytics||Imgur.Util.jafoLog({event:"reportCancel",meta:_.extend({method:"modal"},b)}),this._.preventCloseAnalytics=!1},this)}):Imgur.getInstance().signin("reportAttempt")},preventCloseAnalytics:function(){this._.preventCloseAnalytics=!0}}),Class.addSingleton(Imgur.Gallery),Namespace("Imgur.Gallery"),Imgur.Gallery.Inside=Imgur.Gallery.extend({init:function(a,b,c){this.imgurInsideNav=a,this._super(b,c)}}),Namespace("Imgur.Gallery"),Imgur.Gallery.Outside=Imgur.Gallery.extend({}),Namespace("Imgur.Gallery"),Imgur.Gallery.MainOutside=Imgur.Gallery.Outside.extend({init:function(a,b,c,d){this._super(b,c,d),this._.outsideActiveTagStore=a},handleTagChanged:function(a){var b=this._.outsideActiveTagStore.getIsActive();b?this._handleTagSelect(a):this._handleTagDeselect(a)},_handleTagDeselect:function(){this._.overRideUrl=null,this._.history.addWindowState("initial","tagDeselect",this.getSectionUrl()),this.refetchPage()},_handleTagSelect:function(a){var b=this._.outsideActiveTagStore.getActiveTag(),c=encodeURIComponent(this._.outsideActiveTagStore.getActiveTagEncoded());this._.overRideUrl="/t/"+c,"rising"==this._.sort&&(this._.sort="viral"),a||(window.history.replaceState&&!window.history.state&&window.history.replaceState("initial","initial",window.location.href),this._.history.addWindowState("tag","Imgur - "+b,this._.overRideUrl)),this._updatePageOnTagChange(this._.overRideUrl)},_updatePageOnTagChange:function(){{var a=$("#sort"),b=$("#section"),c=a.find('.item[value="rising"]');a.find('.item[value="top"]')}if(b.find(".selected").removeClass("selected"),c.hasClass("selected")){var d=a.find('.item[value="'+this._.sort+'"]').addClass("selected");a.find(".selection").html(d.text())}c.hide(),$(".sort-options").hide(),this.refetchPage()},refetchPage:function(){this._.vars.loading||(this._.vars.scrolledPage>0&&(this._.vars.scrolledImageSet=-1),this._.vars.scrolledPage=0,Imgur.InfiniteScroll.getInstance().stopInfiniteScroll(),$(this._.el.outside.pageDivider).remove(),this.fadeInLoader(),this.fetchImages(0,0,_.bind(function(){this._.vars.loading||(Imgur.InfiniteScroll.getInstance().continueInfiniteScroll(),this.initOutsideInfScroll())},this)))}}),Namespace("Imgur.Gallery"),Imgur.Gallery.Header=React.createClass({displayName:"Gallery-Header",getInitialState:function(){return{first:!0,last:!1,image:this.props.initialImage,initial:!0}},_next:function(){this.props.emitter.trigger("buttonNav","next")},_prev:function(){this.props.emitter.trigger("buttonNav","prev")},componentDidUpdate:function(){if(!this.state.initial){var a=$(".post-header");if(a.hasClass("fixed")){a.removeClass("animate fixed animation-finished");var b=a.outerHeight();a.addClass("fixed"),$(".post-container").css("padding-top",b),$(document).scrollTop($(".post-pad").offset().top+1)}else $(document).scrollTop(0)}},render:function(){var a=Imgur.Environment.hasAccess&&!Imgur.Environment.captionsEnabled?" nodisplay":"";return React.DOM.div({},React.DOM.div({className:"next-prev"+a},React.DOM.div({onClick:this.state.first?_.noop:this._prev,className:"btn navPrev icon icon-arrow-left"+(this.state.first?" disabled":"")}),React.DOM.div({onClick:this.state.last?_.noop:this._next,className:"btn btn-action navNext"+(this.state.last?" disabled":"")},"Next Post ",React.DOM.span({className:"icon icon-arrow-right"}))),React.DOM.div({className:"post-title-container"},React.DOM.h1({className:classNames({"post-title":!0,"font-opensans-bold":!0,small:this.state.image.title&&this.state.image.title.length>150,"mature-indicator":this.state.image.nsfw})},this.state.image.title)),React.createElement(Imgur.Gallery.SourceBar,this.state.image))}}),Namespace("Imgur.Gallery"),Imgur.Gallery.SourceBar=React.createClass({displayName:"Gallery-SourceBar",viaAppIconClick:function(){Imgur.Util.jafoLog({event:"viaAppIcon",meta:{type:"upload",hash:this.props.hash,isAlbum:this.props.is_album,nsfw:this.props.nsfw,inGallery:!0,platform:"ios"===this.props.platform?"iphone":this.props.platform}})},_redditSource:function(a,b){return React.DOM.a({href:"https://www.reddit.com"+a,target:"_blank",key:"reddit"},b)},handleUserProfileClick:function(){Imgur.Util.jafoLog({event:"userProfileNav",meta:{accountId:this.props.account_id,method:"usernamePost"}})},render:function(){var a=[],b=!1;if(this.props.isAd&&a.push(React.DOM.a({href:"http://imgur.com/blog/2015/05/31/about-promoted-posts/",className:"title promoted-tag",title:"learn more about promoted posts",key:"promoted"},"Promoted")),this.props.account_url)a.push(React.DOM.span({key:"by"}," by "),React.DOM.a({href:"/user/"+this.props.account_url,onClick:this.handleUserProfileClick,title:"view account of "+this.props.account_url,className:"post-account",key:"account"},this.props.account_url));else if(this.props.reddit){var c=this.props.video_source&&!this.props.is_album?" (source)":"(source)";a.push(this._redditSource(this.props.reddit,c))}else this.props.subreddit?a.push(this._redditSource(this.props.permalink,"(source)")):(b=!0,a.push(React.DOM.span({key:"anon"},"Uploaded ")));var d={className:"post-title-meta font-opensans-semibold"};if(this.props.title||(d.className+=" post-title-meta--notitle"),this.props.isAd)return React.DOM.p(d,a);["ios","android"].indexOf(this.props.platform)>=0&&a.push(React.DOM.span({key:"platform"}," via ",React.DOM.a({href:"//"+Imgur.Environment.host+"/apps",onClick:this.viaAppIconClick},"ios"==this.props.platform?"iPhone":"Android",React.DOM.span({className:"icon-mobile"},null)))),b||a.push(React.DOM.span({key:"middot",dangerouslySetInnerHTML:{__html:" &middot; "}}));var e=moment.utc(this.props.timestamp||this.props.datetime,"YYYY-MM-DD HH:mm:ss");return a.push(React.DOM.span({className:"exact-time",title:e.toDate().toString()},e.fromNow())),this.props.video_source&&!this.props.is_album&&a.push(React.DOM.span({className:"vidgif-info",key:"vidgif"},React.DOM.span({key:"vidgif-middot",dangerouslySetInnerHTML:{__html:" &middot; "}}),React.DOM.span({key:"vidgif-text",className:"text"},"Made with ",React.DOM.a({href:"//imgur.com/vidgif",target:"_blank"},"Video to GIF")))),React.DOM.p(d,a)}}),Namespace("Imgur.Gallery"),Imgur.Gallery.Post=React.createClass({INITIAL_LOAD:10,MAX_WIDTH:680,RENDER_STATE:{PRE:1,POST:2},_:{onScroll:null},displayName:"GalleryPost",getInitialState:function(){return{all_loaded:!1,render_state:this.RENDER_STATE.PRE,scrolltop:0,window_height:600,thumb_size:"1"==$.cookie("retina")?"r":"g"}},componentDidMount:function(){this.props.data.is_album&&(this._calculateContainerHeights(),this.setState({render_state:this.RENDER_STATE.POST}))},componentWillMount:function(){this.props.all_loaded&&this.setState({all_loaded:!0}),this.props.data.is_album&&(this._.onScroll=_.throttle(_.bind(this._handleScroll,this),250),$(window).on("scroll",this._.onScroll),this._handleScroll())},componentWillUnmount:function(){this.props.data.is_album&&$(window).off("scroll",this._.onScroll)},componentDidUpdate:function(){this.state.render_state==this.RENDER_STATE.PRE&&(this._calculateContainerHeights(),this.setState({render_state:this.RENDER_STATE.POST}))},_handleScroll:function(){var a=$(window);this.setState({scrolltop:a.scrollTop(),window_height:a.height()})},_scaleWidth:function(a,b,c){if(b&&a){var d=b/a;if(a>=c)return Math.round(c*d)}return b},_calculateContainerHeights:function(){var a=this.props.album_image_store.getImages(this.props.data.hash),b=a.count;this.state.all_loaded||(b=Math.min(b,this.INITIAL_LOAD));for(var c=0;b>c;c++){var d=a.images[c];d.containerHeight=this._calculateElementHeight(React.findDOMNode(this.refs[d.hash]))}},_calculateElementHeight:function(a){if(!a)return 0;var b=parseFloat(document.defaultView.getComputedStyle(a,"").getPropertyValue("height"),10),c=parseFloat(document.defaultView.getComputedStyle(a,"").getPropertyValue("margin-top"),10)+parseFloat(document.defaultView.getComputedStyle(a,"").getPropertyValue("margin-bottom"),10);return b+c},_loadAll:function(){var a=this.props.album_image_store.getImages(this.props.hash);null!=a?this.setState({all_loaded:!0,render_state:this.RENDER_STATE.PRE}):this.props.album_image_store.fetchImages(this.props.hash,_.bind(function(){this.setState({all_loaded:!0,render_state:this.RENDER_STATE.PRE})},this))},_createRenderedImage:function(a,b){var c={thumbsize:a.thumbsize,width:this.MAX_WIDTH,minHeight:a.minHeight,item:a,wrap_with_direct_link:!1,poster:!1,showShareLinks:this.props.has_access&&!this.props.in_gallery,discarding_referrer:!this.props.initial||b>=this.INITIAL_LOAD&&!a.shown,firing_pixel:!this.props.initial||b>=this.INITIAL_LOAD&&!a.shown};return React.createElement(Imgur.ImageViewer,c)},_createComponent:function(a,b,c,d){var e="",f=classNames({"post-image-container":!0,"post-image-container--spacer":c!=d-1});return a.description&&(e=this.props.data.isAd?React.DOM.div({className:"post-image-description font-opensans-reg",dangerouslySetInnerHTML:{__html:a.description}}):React.DOM.div({className:"post-image-description font-opensans-reg"},this.props.linkifier.grab(a.description))),React.DOM.div({ref:a.hash,id:a.hash,className:f,key:a.hash},a.title?React.DOM.h2({className:"post-image-title font-opensans-semibold",dangerouslySetInnerHTML:{__html:a.title}}):"",b,e)},_getThumbSize:function(a){return a.prefer_video?"":"r"==this.state.thumb_size?a.width>2*this.MAX_WIDTH?"r":"":a.width>this.MAX_WIDTH?"g":""},render:function(){var a,b=this.props.album_image_store.getImages(this.props.data.hash),c=[],d=0,e="",f="";if(this.props.data.is_album&&b){d=b.count,this.state.all_loaded||(d=Math.min(d,this.INITIAL_LOAD));for(var g=0,h=0,i=0,j=(this.MAX_WIDTH,$(".post-images").offset().top),k=0;d>k;k++){var l=b.images[k];if(l.minHeight||(l.thumbsize=!l.animated&&l.width>this.MAX_WIDTH?this._getThumbSize(l):"",l.minHeight=this._scaleWidth(l.width,l.height,this.MAX_WIDTH)),this.state.render_state==this.RENDER_STATE.PRE)k<this.INITIAL_LOAD?(a=this._createRenderedImage(l,k,!0),l.shown=!0):a=React.DOM.div({ref:l.hash,style:{minHeight:l.minHeight}}),c.push(this._createComponent(l,a,k,d));else{var m=this.state.scrolltop-this.state.window_height,n=this.state.scrolltop+2*this.state.window_height,o=j+g+h,p=o+l.containerHeight;o>m&&n>o||p>m&&n>p||m>o&&p>n?(h+=l.containerHeight,a=this._createRenderedImage(l,k),l.shown=!0,c.push(this._createComponent(l,a,k,d))):0==h?g+=l.containerHeight:i+=l.containerHeight}}!this.state.all_loaded&&b.count>this.INITIAL_LOAD&&(e=React.DOM.div({className:"js-post-truncated font-opensans-semibold"},React.DOM.a({className:"post-loadall",onClick:this._loadAll},React.DOM.span({className:"icon-arrow-down"}),React.DOM.span({className:"load-more"},"Load remaining "+(b.count-this.INITIAL_LOAD)+" "+Imgur.Util.pluralize(b.count-this.INITIAL_LOAD,"image"))),React.DOM.span({className:"post-gridview"},React.DOM.span({className:"icon-grid"}),React.DOM.a({className:"post-gridview-link",target:"_blank",href:"/a/"+this.props.data.hash+"/layout/grid"},"Grid view")))),this.props.data.album_description&&(f=this.props.data.isAd?React.DOM.div({className:"post-description font-opensans-reg",dangerouslySetInnerHTML:{__html:this.props.data.album_description.trim()}}):React.DOM.div({className:"post-description font-opensans-reg"},this.props.linkifier.grab(this.props.data.album_description.trim())));for(var k=0;g>=1e6;k++)c.unshift(React.DOM.div({key:"padtop"+k,style:{height:1e6}})),g-=1e6;c.unshift(React.DOM.div({key:"padtop",style:{height:g}})),c.push(React.DOM.div({key:"padbot",style:{height:i}})),this.props.album_image_store.setImages(this.props.data.hash,b)}else{var q="";a=React.createElement(Imgur.ImageViewer,{thumbsize:this._getThumbSize(this.props.data),width:this.MAX_WIDTH,item:this.props.data,wrap_with_direct_link:!1,poster:!1,discarding_referrer:!this.props.initial,firing_pixel:!this.props.initial}),this.props.data.description&&(q=this.props.data.isAd?React.DOM.div({className:"post-image-description font-opensans-reg",dangerouslySetInnerHTML:{__html:this.props.data.description}}):React.DOM.div({className:"post-image-description font-opensans-reg"},this.props.linkifier.grab(this.props.data.description)));var r=React.DOM.div({id:this.props.data.hash,className:"post-image-container",key:this.props.data.hash},a,q);c.push(r)}return React.DOM.div({},c,e,f)}}),Namespace("Imgur.Gallery.Store"),Imgur.Gallery.Store.AlbumImage=Class.extend({init:function(){this._={posts:{},pendingRequestUrl:null}},getImages:function(a){return this._.posts[a]?this._.posts[a]:null},setImages:function(a,b){this._.posts[a]=b},fetchImages:function(a,b){var c="/ajaxalbums/getimages/"+a+"/hit.json?all=true";this._.pendingRequestUrl!=c&&(this._.pendingRequestUrl=c,$.getJSON(c,_.bind(function(c){null!=c&&"success"in c&&c.success&&(this._.posts[a]=c.data,this._.pendingRequestUrl=null,"function"==typeof b&&b(c.data))},this)).fail(_.bind(function(){this._.pendingRequestUrl=null},this)))}}),Namespace("Imgur.Factory"),Imgur.Factory.Gallery=Class.extend({_getDefaultPredicates:function(a){var b=function(b){return b instanceof a},c=function(){return function(a){return a instanceof Imgur.Tag.SuggestedTag}};return{base:b,providerByLevDistance:c}},_getAjaxGetWithLoader:function(a){return function(b,c,d,e){return a.show(),e=e||_.noop,d=d||_.noop,$.get(b,c,d).fail(e).always(_.bind(a.hide,a))}},_standardDataResponsePost:function(a){return function(b,c,d,e){e=e||_.noop,d=d||_.noop;var f=function(a,b,c){a&&a.success||!a&&"success"===b?d(a,b,c):e(a&&a.data&&a.data.error&&a.data.error.message||a&&a.data&&a.data.error||b,c,b)},g=function(a,b,c){var d=c;try{var f=a.responseJSON||$.parseJSON(a.responseText);return void e(f.data.error.message,a,b)}catch(g){}e(d,a,b)};return a(b,c,f,g)}},_getStandardPostAuthorized:function(){return this._standardDataResponsePost(this._.postProvider())},_getStandardPostAuthorizedWithLoader:function(a){var b=this._standardDataResponsePost(this._.postProvider());return function(c,d,e){return a.show(),b(c,d,e).always(_.bind(a.hide,a))}},_getPostAuthorizedWithLoader:function(a){var b=this._.postProvider();return function(c,d,e){return a.show(),b(c,d,e).always(_.bind(a.hide,a))}},_produceEmptyMessageProviderForQuery:function(a){return function(){return _.templates["tags.empty-message-makeone"]({query:a})}},_produceUserGroupProvider:function(a,b,c,d,e,f){var g=new Imgur.Tag.Comparator,h=(_.bind(g.compare,g),_.bind(this._produceUserGroupController,this,a,b,c,d,e,f)),i=_.bind(this._produceUserGroupFromData,this,g),j=_.bind(this._produceUserGroupFromDom,this,h,g,a),k=_.compose(j,i);return k},_produceUserGroupController:function(a,b,c,d,e,f,g,h){return new Imgur.Tag.Controller.UserGroup(a,b,c,g,h,d,e,f)},_produceUserGroupFromData:function(a,b,c){return $(_.templates["tags.user-group"]({group:{name:b,hash:c}}))},_produceUserGroupFromDom:function(a,b,c,d,e){var f=new Imgur.Element.SortedListEmptyable($(),b,e||[]),g=new Imgur.Tag.UserGroup(d,f),h=a(g,f);return g.get$RemoveButton().on("click",_.bind(h.handleRemoveEvent,h)),c.on("group.remove",h,h.handleRemoveEventOther),{group:g,adapter:h}}}),Namespace("Imgur.Factory"),Imgur.Factory.InsideGallery=Imgur.Factory.Gallery.extend({init:function(a,b,c,d){this._={parent_factory:a,env:b,gallery_env:b,groups:c,postProvider:d,stores:{},header:null}},produceInsideGallery:function(a,b){var c=this._.env,d=$("#side-gallery"),e=(new Imgur.Storage.LocalStorage).get("forceRecs",!1),f={env:c,cache:Imgur.Environment.signed||$.cookie("viral_flavor")?"/miss.json":"/hit.json",emitter:a,recsExperimentEnabled:e||Imgur.Util.Experiments.isActive("4053"),showRecommendations:e||Imgur.Util.Experiments.isActive("4053")&&"recs-new-users"===Imgur.Util.Experiments.getUserBucket("exp4053").variation};if(Imgur.Environment.hasAccess&&!Imgur.Environment.captionsEnabled){var g={initialHash:c.hash,initialIsPublished:c.inGallery,msid:this._.env.msid};React.render(React.createElement(Imgur.PostOptions,g),$("#post-options")[0]),f.display=!1,d.hide()}var h=React.render(React.createElement(Imgur.SideGallery,f),d[0]),i=navigator.userAgent.match(/iPad/i),j=this._.parent_factory.produceLinkify(a);j.addGrabber(new Imgur.Linkify.AlbumImageGrabber);var k=new Imgur.Linkify.AlbumImageViewer(c.hash);j.prependViewer("albumimage",k),a.on("select",k,k.handleUpdatedImage),a.trigger("beforeComments",this._.gallery_env.image);var l=new Imgur.Caption({sid:this._.env.sid,signed:this._.env.signed,auth_id:this._.env.auth.id,hash:c.hash,baseURL:c.baseURL,defaultText:"Submit a ",commentName:c.commentName,target:$("#submit-caption"),loadingClass:"#save-caption-loader",isReply:!1,isIPad:i,showRepliesCount:!0,emitter:a});Imgur.Util.triggerPerformanceCheckpoint("comment_box"),j.prependViewer("nsfw",new Imgur.Linkify.NSFWViewer(l)),Imgur.Caption._instance=l;var m=new Cortex({topic:this._.env.image.topic}),n=new Imgur.Gallery.Store.AlbumImage,o=this.produceInsideNav(a,b,h,l,c,m,j,n);Imgur.InsideNav._instance=o;var p=new Imgur.Gallery.Inside(o,a,c);Imgur.Gallery._instance=p,a.on("report image",p,p.reportImage);this._getStore("current image",a),this.producePromoted(a,o,h);this.produceInsideTaggingWidget(m,a),j.attachDelegate("#comments-container"),Imgur.Environment.hasAccess||(this._.header=React.render(React.createElement(Imgur.Gallery.Header,{initialImage:Imgur.Environment.image,emitter:a}),$(".post-header").get(0)));var q=!0;return a.on("select",null,function(a){return this._.header?(this._.header.setState({image:a,first:!1,last:!1,initial:q}),void(q=!1)):!1}.bind(this)),p},produceInsideNav:function(a,b,c,d,e,f,g,h){var i=new Imgur.InsideNav(b,c,d,a,f,h,_.merge(e,{isPromoted:e.image.isAd,el:{inside:{reportImageLink:$("#report-image"),image:$(".image"),arrows:$(".image-arrows"),zoom:$(".zoom"),accountBio:$("#account-bio.access"),submitCaptionButton:$(".submit-caption-button"),commentExpand:$("#expand-comments"),comboboxes:$(".combobox"),commentSort:$("#comment-sort"),$comments:$("#captions"),favoriteImageLink:$(".favorite-image"),reCaptionLink:$("#meme-image"),downloadAlbumForm:{id:"#download-album-form",emailInput:$("#download-album-form #email"),form:$("#download-album-form #download-form"),message:$("#message"),save:$("#download-album-form #save"),loader:$("#download-loader")}}},linkifier:g}));
return a.on("imageRendered",null,function(a,b){a.click(function(a){a.preventDefault(),c.selectImage(b.hash)})}),a.on("reset",null,function(a){c.selectImage(a.hash)}),a.on("select",i,i.navToImage),a.on("firstImage",i,function(){return this._.header?void this._.header.setState({first:!0,last:!1}):!1}.bind(this)),a.on("lastImage",i,function(){return this._.header?void this._.header.setState({first:!1,last:!0}):!1}.bind(this)),a.on("sectionChange",i,i.changeSection),a.on("sortChange",i,i.changeSort),a.on("windowChange",i,i.changeWindow),a.on("sidegalleryPageLoad",null,_.bind(function(a){switch(a){case"append":i.enableNextButton();break;case"prepend":i.enablePrevButton()}},this)),a.on("pointUpdate",i,i.updatePoints),i},_getStore:function(a,b){if(this._.stores.hasOwnProperty(a))return this._.stores[a];var c=null;switch(a){case"current image":c=new Imgur.Tag.Store.CurrentImage(b),c.setCurrentImage(this._.env.image),b.on("select",c,c.setCurrentImage)}return this._.stores[a]=c,c},produceInsideTaggingWidget:function(a,b){Imgur.getInstance().setEmitter(b);var c=$(".taxonomy-container"),d=new Imgur.Tag.InsideTaggingWidget(b,c),e=new Imgur.Tag.Controller.InsideTaggingWidget(d);c.on("click","#tags-underbar",_.bind(e.handleTabToggle,e));var f=new Imgur.Tag.Store.TagImage(b),g=this._getStore("current image",b),h=new Imgur.Tag.Store.Tag(b),i=function(a){a&&a.preventDefault&&(a.preventDefault(),a.stopPropagation());var b=a&&!a.preventDefault?a:"tagAttempt";imgur.signin(b,!0)},j=function(a,b){h.addTag(b),f.addTagForPost(a,b.tag,{source:Imgur.Tag.Store.TagImage.prototype.SOURCE.GALLERY_PAGE,tag:b.tag,points:b.points,author:b.author,vote:b.vote||"veto"})};_.each(this._.env.image.tags,_.partial(j,this._.env.image.hash)),_.each(this._.env.defaultTags,function(a){h.addTag(a)}),b.on("select",null,function(a){_.each(a.tags||[],_.partial(j,a.hash))});var k=new Imgur.Tag.TagModel(this._getStandardPostAuthorized()),l=new Imgur.Tag.AlternativesModelNoProvider($.getJSON,f,h),m=this._.postProvider(),n="//es."+this._.env.host,o=new Imgur.Tag.SuggestModelNoProvider(m,n),p=new Imgur.Tag.TagValidator(2,25),q=new Imgur.Tag.Store.Suggestion(b,p),r=new Imgur.Tag.Controller.InsideComponent(this._.env.signed,i,f,g,l,o,k,q,h),s={defaultTags:this._.env.defaultTags||[],tagImageStore:f,currentImageStore:g,suggestionStore:q,onVote:_.bind(r.handleVote,r),onDeleteTag:_.bind(r.handleDeleteTag,r),onReportTag:_.bind(r.handleReportTag,r),user:this._.env.auth.url,tagStore:h,tagCortex:a,opened:!1},t=function(){React.render(React.createElement(Imgur.Tag.InsideListComponent,s),c.get(0))};if(b.on("new suggest query",null,_.bind(r.handleChangedQuery,r)),c.length&&(t(),b.on("select",null,t),b.on("image-tag-box.hide",null,_.bind(function(){s.opened=!1,t()},this)),b.on("closed dropdown menu",null,_.bind(function(){s.opened=!1,t()},this)),b.on("image-tag-box.show",null,_.bind(function(){s.opened=!0,t()},this)),b.on("image tag updated",null,t),b.on("tag updated",null,t),b.on("tag added to post",null,t),b.on("ajax error added to post",null,t),b.on("tag removed from post",null,t),b.on("ajax error removed from post",null,t),b.on("ajax tag loading finished",null,t),b.on("new suggest query",null,t),b.on("new finished query",null,t),b.on("new suggest validation mode",null,t),b.on("new suggestions",null,t),b.on("current image updated",null,t),a.on("update",function(){t()})),b.on("image-tag-box.show",r,r.handleUpdateTagBox),this._.env.signed&&$("#tag-container").length){var u=new Imgur.Tag.Controller.Hotkeys(d,$("#tag-container"));$("body").keyup(_.bind(u.handleKeyUp,u))}Imgur.Util.triggerPerformanceCheckpoint("topics")},producePromoted:function(a,b,c){if("undefined"==typeof Imgur.getInstance()._.auth||Imgur.getInstance()._.auth.isPro!==!0){var d=this._.parent_factory.getConfig("promoted"),e=new Imgur.Promoted.Events(d,a,b),f=new Imgur.Promoted.Source.Adzerk(d,a),g=new Imgur.Promoted(d,a,b,c,e,f);return g}},produceSideGalleryCta:function(a,b,c){var d=this._.parent_factory.getConfig("global").ctaConfig["side-gallery"],e=new Imgur.SideGalleryCta(d,a,b,c);return e}}),Namespace("Imgur.Factory"),Imgur.Factory.OutsideGallery=Imgur.Factory.Gallery.extend({init:function(a,b,c,d){this._={env:{global:a,gallery:b,groups:c},gallery_env:b,postProvider:d}},produceOutsideGallery:function(a){var b=new Imgur.Tag.Store.OutsideActiveTag(a),c=new Imgur.History,d=this._.env.gallery,e=new Imgur.Gallery.MainOutside(b,a,d,c);return a.on("show tagset loader",e,e.fadeInLoader),a.on("hide tagset loader",e,e.fadeOutLoader),a.on("new tagset",e,e.refetchPage),a.on("new outside active tag",e,e.handleTagChanged),$("#imagelist").on("click",".remove-outside-image",function(a){var b=$(a.target).attr("data-hash");e.remove(b),$("#"+b).fadeOut()}),$("#imagelist").on("click",".scroll-top-text",function(){$("html, body").animate({scrollTop:0},"500","easeInOutCirc")}),$("#sponsored-upload").click(_.bind(function(){if(this._.env.gallery.signed)$("#topbar li.upload-button").click();else{var a=new Imgur;a.signin("sponsoredUploadAttempt",!0)}},this)),c.addPopState("initial",_.bind(e.initialPopState,e)),Imgur.Gallery._instance=e,{gallery:e,history:c,outsideActiveTagStore:b}},produceOutsideUser:function(a){var b=this._.env.gallery,c=new Imgur.Gallery.Outside(a,b);return Imgur.Gallery._instance=c,c},produceOutsideMemes:function(a){var b=this._.env.gallery,c=new Imgur.Gallery.Outside(a,b);return Imgur.Gallery._instance=c,c},produceOutsideNonMainSectionChooser:function(a){$("#section").combobox({maybe:function(){return!1}}),$("#sort").combobox();{var b=null;new Imgur.Tag.GroupSelector(a,this._.env.gallery.section,this._.env.gallery.sort,this._.env.gallery.searchQuery,$(".sentence-sorting"),b)}},produceOutsideTaggingWidget:function(a,b){{var c=(this._.env.gallery.sid,this._.env.gallery.signed),d=(this._.env.gallery.group,this._.env.gallery.group_type),e=new Imgur,f=function(a){a.preventDefault(),a.stopPropagation(),e.signin("tagAttempt",!0)},g=$("#outside-tagging"),h=$("#content .panel"),i=$("#outside-tagging-showhide"),j=$("#tags-blocked");j.find("#tags-blocked-toggle")}$("#section").combobox({maybe:function(){return!1}}),$("#sort").combobox({maybe:function(){return!1},onChange:function(b,c,d){a.trigger("chosen.sort",c,d)}});var k=new Imgur.Tag.Store.Tag(a),l=new Imgur.Tag.Store.TagGroup(a),m=new Imgur.Tag.Store.Group(a,this._.env.groups.groups),n=new Imgur.Tag.GroupModel(this._getStandardPostAuthorized(),l,a),o=new Imgur.Tag.TagValidator(2,25),p=new Imgur.Tag.Store.Suggestion(a,o);Imgur.Dev.DebugVar("suggestionstore",p);var q=this._.env.gallery.group.id;_.each(this._.env.gallery.group.tags,function(a){l.addTagToGroup(a,q)}),Imgur.Dev.DebugVar("tagGroupStore",l),Imgur.Dev.DebugVar("outsideActiveTagStore",b.outsideActiveTagStore),Imgur.Dev.DebugVar("tagstore",k),Imgur.Dev.DebugVar("groupstore",m),Imgur.Dev.DebugVar("taggroupstore",l);var r=function(){var a=$("script[type='text/tag-group-data']");a.each(function(){var a={};try{a=$.parseJSON($(this).html())}catch(b){}_.each(a,function(a,b){_.each(a,function(a){l.isTagInGroup(b,a)||l.addTagToGroup(b,a)})}),$(this).remove()})};r();var s=function(){var a=$("script[type='text/tag-data']");a.each(function(){var a=null;try{a=$.parseJSON($(this).html())}catch(b){}a&&k.addTag(a),$(this).remove()})};s(),a.on("new gallery page",null,s);var n=this._produceGroupModel(a,l),t=_.bind(function(){0==l.getTagsForGroup(q).length&&"filtered"!=d&&"base"!=d?this._produceEmptyGalleryTagList(a,l,b.outsideActiveTagStore,p,n):this._produceUserTagList(a,l,b.outsideActiveTagStore,p,n)},this);"group"!=this._.env.gallery.section&&"filtered"!=this._.env.gallery.section&&"custom"!=this._.env.gallery.section||"base"==d||(t(),a.on("gallery page refetched",null,t));var u=new Imgur.Tag.OutsideTaggingWidget(g,h,j,i,a);i.on("click",_.bind(u.toggle,u,this._.env.gallery.bestCaps));var v=$(".sentence-sorting"),w=(new Imgur.Tag.GroupValidator(2,25),new Imgur.Tag.Sentence(v.find(".before-text"),v.find(".middle-text"),m)),x=new Imgur.Tag.MainGroupSelector(a,this._.env.gallery.section,this._.env.gallery.sort,this._.env.gallery.inSearch,v,w,b.outsideActiveTagStore);if(b.history.addPopState("tag",function(){var a=window.location.href.replace(/.*\/t\//i,"").replace(/_/g," ");b.outsideActiveTagStore.setActiveTag(a,!0)}),this._.env.gallery.bestCaps&&$("#top-comments .best-captions img").tipsy({opacity:.95,offset:-2,gravity:"n",html:!0}),!c)return void $("#follow-tag, #custom-group a").on("click",f);if(this._.env.gallery.tag){var y=_.bind(function(){var a=$("#follow-tag").get(0);a&&React.render(React.createElement(Imgur.Tag.Follow,{groupModel:n,tag:this._.env.gallery.tag.tag,tagFollower:this._.env.gallery.tagFollower||"custom"==this._.env.gallery.section}),a)},this);y(),a.on("new tagset",null,_.bind(function(){this._.env.gallery.tagFollower=!this._.env.gallery.tagFollower,y()},this)),a.on("gallery page refetched",null,y)}var z=new Imgur.Tag.Controller.GroupSelectorLimits(a,x,m);return a.on("group.remove",z,z.handleGroupRemove),a.on("group.add",z,z.handleGroupAdd),n},produceSharePage:function(a,b,c,d,e,f,g,h,i){var j=new Imgur.Tag.Store.Tag(a,e);_.each(d,function(a){j.addTag({tag:a})});var k=new Imgur.Tag.TagValidator(2,25),l=new Imgur.Tag.Store.Suggestion(a,k),m="//es."+this._.env.global.host,n=new Imgur.Tag.SuggestModelNoProvider(this._.postProvider(),m),o=$("#tags input"),p=o.attr("placeholder"),q=o.attr("tabindex"),r=function(){React.render(React.createElement(Imgur.Share.Title,{title:g,maxLength:255}),$("#submission-title").get(0))};r();var s=function(){React.render(React.createElement(Imgur.Tag.ShareTagComponent,{tagStore:j,suggestionStore:l,placeholder:p,tabIndex:q,id:"tagbox",gallery_type:f,defaultTags:i,tagLimit:e}),$("#tags").get(0))};s();var t=Imgur.ShareOnImgur.getInstance({type:b,hash:c,tagStore:j,emitter:a,hasTitle:!!g,hasTopic:!!h});t.generalInit();var u=new Imgur.Tag.Controller.OutsideComponent(n,l);a.on("new suggest query",null,_.bind(u.handleChangedQuery,u)),a.on("select",null,s),a.on("new suggest query",null,s),a.on("new finished query",null,s),a.on("new suggestions",null,s),a.on("tag removed",null,s),a.on("tag limit reached",null,function(){humanMsg.displayMsg("You have already added the maximum number of tags","error-msg")}),$(document).on("click",function(a){return $(a.target).closest(".tag-filter, .tag-list-content").length?void $("#tags").addClass("focus"):void $("#tags").removeClass("focus")})},_produceUserTagList:function(a,b,c,d,e){var f=this._.postProvider(),g="//es."+this._.env.global.host,h=new Imgur.Tag.SuggestModelNoProvider(f,g),i={tagGroupStore:b,groupId:this._.env.gallery.group.id,outsideActiveTagStore:c,groupModel:e,suggestionStore:d,placeholder:"add tags to this gallery"};$("#tags-current-list, #outside-tagging-showhide").show(),$.cookie("showTags")&&$("#content > .panel").removeClass("hidden");var j=function(){React.render(React.createElement(Imgur.Tag.TagListComponent,i),$("#tags-current-list").get(0))};j(),a.on("tag added to group",null,j),a.on("tag removed from group",null,j),a.on("new tag-group event",null,j),a.on("pending tag removed from group",null,j),a.on("new outside active tag",null,j),a.on("new suggestions",null,j),a.on("new suggest query",null,j),a.on("new finished query",null,j),a.on("new suggest validation mode",null,j);var k=new Imgur.Tag.Controller.OutsideComponent(h,d);a.on("new suggest query",null,_.bind(k.handleChangedQuery,k))},_produceGroupModel:function(a,b){var c=new Imgur.Tag.GroupModel(this._getStandardPostAuthorized(),b,a);return c},_produceSuggestedTagFromData:function(a,b,c,d,e){var f=$(_.templates["tags.tag-suggested"]({is_first:!!e,tag:{name:c,subscribers:d,urlencoded:""}})),g=new Imgur.Tag.SuggestedTag(f,b);return g.get$Add().on("click",_.partial(a,g)),g},_produceRemovableTagFromData:function(a,b){var c=$(_.templates["tags.tag-removable"]({tag:b}));return c},produceBlockedTagFromDom:function(a,b){var c=new Imgur.Tag.RemovableTag(a,b);return c},produceRemovableTagFromDom:function(a,b,c,d){var e=new Imgur.Tag.RemovableTag(a,d);e.get$RemoveButton().on("click",_.bind(b.handleRemovedTagEvent,b,e));var f=[{spot:"markConfirmed",cover:"recomputeNanoScroller",type:"passAfter"}];return e=Imgur.Util.decorateWithDetailed(e,c,f)},_produceComboboxItemFromSomething:function(a,b){var c=$(_.templates["tags.combobox-item"]({value:b}));return c.append(a),c},_produceEmptyGalleryTagList:function(a,b,c,d,e){var f=this._.postProvider(),g="//es."+this._.env.global.host,h=new Imgur.Tag.SuggestModelNoProvider(f,g),i={tagGroupStore:b,groupId:this._.env.gallery.group.id,outsideActiveTagStore:c,groupModel:e,suggestionStore:d,id:"add-tag",placeholder:"Start following tags and stay up to date with the most viral images on the Internet"};$("#tags-current-list, #outside-tagging-showhide").hide(),$("#content > .panel").addClass("hidden");var j=function(){var a=$("#add-tag-container").get(0);a&&React.render(React.createElement(Imgur.Tag.TagListComponent,i),a)};j(),a.on("select",null,j),a.on("new suggest query",null,j),a.on("new finished query",null,j),a.on("new suggest validation mode",null,j),a.on("new suggestions",null,j);var k=new Imgur.Tag.Controller.OutsideComponent(h,d);a.on("new suggest query",null,_.bind(k.handleChangedQuery,k)),$(".popular-tag .add-tag").on("click",function(){var a=$(this).parent().find(".tag-name").text();e.subscribe(i.groupId,a)})}}),Namespace("Imgur.Favorite"),Imgur.Favorite=Imgur.extend({init:function(a){this._=$.extend({method:null,hash:null,$favButton:$(".favorite-image"),confirm:{target:"#colorbox-confirm",$message:$("#colorbox-confirm-message"),$title:$("#colorbox-confirm-title")},messages:{favorited:'<div class="favorited"></div>',unfavorited:'<div class="favorited unfavorited"></div>',confirmMsg:function(a){return"Are you sure you want to "+(a?"unfavorite":"favorite")+" this image?"},confirmTitle:function(a){return(a?"Unfavorite":"Favorite")+" this image?"}}},a),this._.method=$.trim(this._.method),this._super(this._),this._.hash||(this._.hash=Imgur.InsideNav.getInstance().getHash())},_init:function(){this.showMessage(),this._init_click_handler()},_init_click_handler:function(){this._.$favButton.unbind("click").on("click",_.bind(function(a){var b,c,d,e=!1;"undefined"!=typeof a.fav_display_msg&&a.fav_display_msg===!0&&(e=!0);try{Imgur.InsideNav&&(c=Imgur.InsideNav.getInstance().getImage()),c&&this._.hash===c.hash&&(b=c.is_album,d=function(a){Imgur.InsideNav.getInstance().updateFavorite("favorited"==a)})}catch(f){}this.favorite(this._.hash,b,d,e)},this)),Imgur.Util.triggerPerformanceCheckpoint("favoritebtn")},handleKey:function(a){if(!(a.ctrlKey||a.altKey||a.metaKey||48!=a.keyCode&&45!=a.keyCode&&96!=a.keyCode||$(a.target).is("input")||$(a.target).is("textarea"))){var b=jQuery.Event("click",{fav_display_msg:!0});this._.$favButton.trigger(b)}},showMessage:function(a){"undefined"==typeof a&&(a=this._.method),"favorited"==a?this.showFavorited():"unfavorited"==a?this.showUnfavorited():"confirm"==a&&this.showConfirm()},showFavorited:function(){humanMsg.displayMsg(this._.messages.favorited,"action-msg")},showUnfavorited:function(){humanMsg.displayMsg(this._.messages.unfavorited,"action-msg")},showConfirm:function(){this._.confirm.$message.html(this._.messages.confirmMsg(this.isFavorited())),this._.confirm.$title.html(this._.messages.confirmTitle(this.isFavorited())),Imgur.Utilities.ColorboxConfirm.getInstance().show(this._.confirm.target,_.bind(this.favorite,this))},favorite:function(a,b,c,d){Imgur.getInstance()._.signed||($(".tipsy,#favorite-bar").remove(),Imgur.getInstance().signin("favoriteAttempt",!0)),"undefined"==typeof a?a=this._.hash:"function"==typeof a&&(a=a()),Imgur.getInstance()._.signed&&(this._.$favButton.hasClass("favorited")?(this._.$favButton.removeClass("favorited"),this._.method="unfavorited"):(this._.$favButton.addClass("favorited"),this._.method="favorited",$("#mainUpArrow").is(":visible")&&this.upvote()),d&&this.showMessage());var e="/"+a+"/fav.json";(-1!==window.location.href.indexOf("/a/")||b)&&(e="/a"+e);var f={ajax:!0,msid:Imgur.Environment.msid,location:Imgur.InsideNav?"inside":"outside"};Imgur.getInstance()._.signed?Imgur.Util.jafoLog({event:"favorite",meta:{isAlbum:b?b:-1!==window.location.href.indexOf("/a/"),hash:a,location:Imgur.InsideNav?"inside":"outside",state:"unfavorited"===this._.method?"unfavorite":"favorite"}}):_.extend(f,{sid:Imgur.Environment.sid,vote:"up",type:"image"}),$.ajax({url:e,type:"POST",data:f,success:_.bind(this.favoriteSuccess,this,c),error:_.bind(this.favoriteError,this)})},favoriteSuccess:function(a,b){b&&"success"in b&&b.success&&(this._.method=b.data.fav_method,a&&a(b.data.fav_method))},favoriteError:function(){Imgur.getInstance()._.signed&&("favorited"==this._.method?(this._.$favButton.removeClass("favorited"),this._.method="unfavorited"):(this._.$favButton.addClass("favorited"),this._.method="favorited"))},isFavorited:function(){return this._.$favButton.hasClass("favorited")},upvote:function(){Imgur.getInstance()._.signed&&($("#mainUpArrow").hasClass("pushed")||$("#mainDownArrow").hasClass("pushed")||$("#mainUpArrow").click())}}),Namespace("Imgur.ShareOnImgur"),Imgur.ShareOnImgur=Imgur.extend({init:function(a){return a=a||{},this._=$.extend(!0,{gallerySubmitTermsUrl:"/lightboxes/galleryterms",galleryVerifyEmailFormUrl:"/lightboxes/verifyemail",gallerySubmitURL:"/share/i/",loading:!1,shareing:!1,terms:0,messages:{postingTooFast:function(a){var b=a>60?Math.round(a/60)+Imgur.Util.pluralize(Math.round(a/60)," minute"):a+Imgur.Util.pluralize(a," second");return"You're sharing too quickly. Please wait "+b+"."},banned:"You blew it! You have been banned for posting NSFW images to the gallery."},el:{$shareonimgur:$("#shareonimgur"),$shareAlbum:$("#share-album"),$preview:$("#preview"),$sortableContainer:$("#sortables"),$descriptions:$("#submission-title input, .data-col textarea"),$topic_id:$('input[name="topic_id"]'),$titleDesc:$('input[name="imageTitle[]"], textarea[name="description[]"]'),$imageTitles:$(".image-title"),$deleteContainers:$(".delete-col"),$required:$(".required"),$submit:$("#share"),$terms:$('input[name="terms"]'),$previewSubmit:$("#previewed"),$tagbox:$("#tagbox"),$contentContainer:$("#content-container"),$topicSelect:$(".topic-select"),$publishButtons:$("#publish-buttons"),$missingFields:$("#missing-fields"),sortHandler:".move",images:".image-container .zoom"}},a),this._.galleryLink="//"+imgur._.host+"/gallery/"+this._.hash+"/new",this._.publishCortex=new Cortex({submitting:!1,promoted:!1,missingFields:2}),this._=this._super(this._),this._},generalInit:function(){var a=this,b=function(){React.render(React.createElement(Imgur.Share.Publish,{cortex:a._.publishCortex,hash:a._.hash,isAlbum:"a"==a._.type?!0:!1,handlePreview:function(b){a._.originalState=a._.el.$shareAlbum.serialize(),a.handleSave(b)},handleSubmit:_.bind(a.handleSubmit,a)}),a._.el.$publishButtons.get(0))};b(),this._.publishCortex.on("update",function(){b()}),this.bindSortables(),$(this._.el.images).imageZoom(),this._.el.$deleteContainers.on("click",function(b){a.handleDelete(b)}),this._.el.$required.on("keyup",function(){""!=$(this).val()?(a._.hasTitle=!0,$(this).removeClass("error")):a._.hasTitle=!1,a.checkMissingFields()}),this._.el.$descriptions.on("keydown",function(a){if(9==a.keyCode&&!a.shiftKey){var b,c=$(this);b=c.hasClass("required")?$(".image-container").eq(0):c.parents(".image-container").next(),$.smoothScroll({scrollTarget:b})}}),this._.el.$titleDesc.on("change",function(){$(this).parents(".image-container").find('input[name="dirty[]"]').val(1)}),this._.originalState=this._.el.$shareAlbum.serialize(),this._.el.$topicSelect.combobox({onChange:function(){a._.hasTopic=!0,a.checkMissingFields(),a._.el.$topicSelect.removeClass("error")}}),this.placeShareButtons(),$(window).on("resize",_.bind(a.placeShareButtons,this)),$(window).on("beforeunload",function(){return a._.el.$shareAlbum.serialize()==a._.originalState||a._.sharing?void 0:"You have unsaved changes"})},placeShareButtons:function(){$("#topbar").height()+$("#shareonimgur").height()+$("#cta-container-placeholder").height()>$(window).height()&&$(window).width()>960?this._.el.$publishButtons.addClass("js-fixed"):this._.el.$publishButtons.removeClass("js-fixed")},previewInit:function(){this._.el.$previewSubmit.on("click",_.bind(function(){this.handlePreviewSubmit()},this))},bindSortables:function(){var a=this;this._.el.$sortableContainer.sortable({axis:"y",handle:this._.el.sortHandler,stop:function(){a.retabindex()}})},retabindex:function(){$("#tagbox, #submission-title input, .data-col input, .data-col textarea").each(function(a){$(this).attr("tabindex",a+1)})},handleDelete:function(a){a.preventDefault(),$(a.target).closest(".image-container").remove(),1==$(this._.el.images).length&&(this._.el.$sortableContainer.addClass("single"),this._.el.$imageTitles.remove()),this.retabindex()},serialize:function(){for(var a={},b="",c=this._.el.$shareAlbum.find(":input"),d=0;d<c.length;d++){var e=c[d].name.indexOf("[]"),f=c[d].name.replace("[]",""),g=c[d].value;""!=f&&("dirty"==f?b=g:("description"==f&&!b||"imageTitle"==f&&!b)&&(g=""),-1!=e?Array.isArray(a[f])?a[f].push(g):a[f]=[g]:"radio"==c[d].type||"checkbox"==c[d].type?c[d].checked&&(a[f]=g):a[f]=g)}return JSON.stringify(a)},handleSave:function(a){if(a&&a.preventDefault(),this.handleValidation(!0)){var b=this;this._.previewWindow=window.open("/share/"+this._.type+"/"+this._.hash+"/loading","_blank"),Imgur.Util.jafoLog({event:"shareOnImgurPreview",meta:{hash:this._.hash}}),$.post("/share/"+this._.type+"/"+this._.hash+"/save",{data:this.serialize()},function(a){return a&&a.success?void 0:b.handleFail(!0,a)}).fail(_.bind(this.handleFail,this,!0))}},handleSubmit:function(a){if(a&&a.preventDefault(),this.handleValidation()&&!this._.loading){var b=this;this._.loading=!0,this._.publishCortex.submitting.set(!0),$.post("/share/"+this._.type+"/"+this._.hash+"/share",{data:this.serialize()},function(a){if(!a||!a.success)return b.handleFail(!1,a);if(b._.sharing=!0,a.data&&a.data.promoPage){var c="";c+='<div class="panel" id="promo-success">',c+="<h1>Success!</h1>",c+="<ul>",c+='<li><a href="//'+imgur._.host+"/gallery/"+b._.hash+'/" target="_blank">View the gallery page</a></li>',c+='<li><a href="'+a.data.promoPage+'" target="_blank">View the promo flight</a></li>',c+="</ul>",c+="</div>",b._.el.$contentContainer.html(c)}else window.location="//"+imgur._.host+"/gallery/"+b._.hash+"/new"}).fail(_.bind(this.handleFail,this,!1))}},handlePreviewSubmit:function(){if(!this._.loading){var a=this;this._.loading=!0,$.post("/share/"+this._.type+"/"+this._.hash+"/share",{previewed:!0},function(b){return b&&b.success?void a.handlePreviewSuccess():a.handleFail(!1,b)}).fail(_.bind(this.handleFail,this,!1))}},handlePreviewSuccess:function(){try{window.opener.Imgur.ShareOnImgur.getInstance().redirectToGallery()}catch(a){window.location=this._.galleryLink}},redirectToGallery:function(){this._.previewWindow.close(),window.location=this._.galleryLink},handleFail:function(a,b){var c=this;this._.loading=!1,this._.publishCortex.submitting.set(!1);try{if(!b)throw"bad response";b.responseText&&(b=$.parseJSON(b.responseText))}catch(d){return humanMsg.displayMsg("An unknown error occurred. Please try again.","error-msg"),$.colorbox.close(),void Imgur.Util.jafoLog({event:"shareOnImgurError",meta:{hash:this._.hash,error:"unparsable",button:"share"}})}if(null==b.data||null==b.data.error||null==b.data.error.message)return humanMsg.displayMsg("An unknown error occurred. Please try again.","error-msg"),$.colorbox.close(),void Imgur.Util.jafoLog({event:"shareOnImgurError",meta:{hash:this._.hash,error:"unknown",button:"share"}});var e=parseInt(b.data.error.message),f="unknown";!isNaN(e)&&e>0?(f="rateLimit",humanMsg.displayMsg(this._.messages.postingTooFast(e),"error-msg")):"Banned"==b.data.error.message?(f="banned",humanMsg.displayMsg(this._.messages.banned,"error-msg"),$.colorbox.close()):"Terms"==b.data.error.message?(f="terms",this.showTerms(a)):"NotVerified"==b.data.error.message?(f="notVerified",this.showEmailVerification(function(){a?c.handleSave():c.handleSubmit()})):"OP"==b.data.error.message?(humanMsg.displayMsg("OP must exist.","error-msg"),$.colorbox.close()):"Suspended"==b.data.error.message?(f="suspended",humanMsg.displayMsg("Your account is currently suspended","error-msg")):(humanMsg.displayMsg("An unknown error ocurred. Please try again.","error-msg"),$.colorbox.close()),Imgur.Util.jafoLog({event:"shareOnImgurError",meta:{hash:this._.hash,error:f,button:"share"}})},handleValidation:function(a){var b=!1,c="",d=a===!0?"preview":"share";return this._.el.$required.val()||(this._.el.$required.addClass("error"),this._.el.$required.focus(),b=!0,c+="noTitle"),""==this._.el.$topic_id.val()&&(this._.el.$topicSelect.addClass("error"),b=!0,c+="noTitle"==c?"NoTags":"noTags"),b?(Imgur.Util.jafoLog({event:"shareOnImgurError",meta:{hash:this._.hash,error:c,button:d}}),!1):!0},checkMissingFields:function(){var a=0;return this._.hasTopic||a++,this._.hasTitle||a++,this._.publishCortex.missingFields.set(a),a},openSharePage:function(a){"undefined"!=typeof a&&(window.location="//"+imgur._.host+this._.gallerySubmitURL+a)},showTerms:function(a){var b=this,c=Imgur.ShareOnImgur.getInstance();$.colorbox.close(),$.colorbox({href:b._.gallerySubmitTermsUrl,open:!0,iframe:!0,top:"15%",transition:"none",scrolling:!1,innerWidth:"520px",innerHeight:"234px",onComplete:function(){b._.publishCortex.submitting.set(!1)},onCleanup:function(){c._.terms&&(b._.el.$terms.val(1),a?b.handleSave():b.handleSubmit())}})},acceptTerms:function(a,b){var c=Imgur.ShareOnImgur.getInstance();c._.terms=1,c._.el.$terms.val(1),b||$.colorbox.close()},declineTerms:function(){var a=Imgur.ShareOnImgur.getInstance();a._.terms=0,a._.el.$terms.val(0),$.colorbox.close()},showEmailVerification:function(a){var b=Imgur.ShareOnImgur.getInstance();$.colorbox.close(),setTimeout(function(){var c=b;$.colorbox({href:b._.galleryVerifyEmailFormUrl,open:!0,iframe:!0,top:"15%",transition:"none",scrolling:!1,innerWidth:"520px",innerHeight:"208px",onComplete:function(){b.sendVerificationEmail(),c.checkEmailVerification()},onCleanup:function(){a&&a()}})},600)},sendVerificationEmail:function(){$.get("/ajax/send_email_verification")},checkEmailVerification:function(a,b){var c=this;a||(a=""),$.post("/ajax/verify_email/"+a,function(d){d.data.verified?($.colorbox.close(),b&&b()):(d.data.invalid&&a&&humanMsg.displayMsg("Verification code is invalid","error-msg"),setTimeout(function(){c.checkEmailVerification()},1500))})}}),Class.addSingleton(Imgur.ShareOnImgur),Namespace("Imgur"),Imgur.GalleryPost=React.createClass({displayName:"GalleryPost",getInterestingEvents:function(){return["select"]},render:function(){var a=this.props.currentImageStore.getCurrentImage(),b=a.title,c=a.nsfw?"mature-indicator":"";return"untitled"==b&&(b=""),a.isAd?React.DOM.div(null,this.props.promotedTag(),React.DOM.h1({id:"image-title",className:c},b)):React.DOM.div(null,React.DOM.h1({id:"image-title",className:c},b))}}),Namespace("Imgur.Share"),Imgur.Share.Title=React.createClass({displayName:"Share-Title",getInitialState:function(){return{title:this.props.title,titleLength:this.props.title.length}},handleChange:function(a){this.setState({title:a.target.value,titleLength:a.target.value.length})},render:function(){var a="";return this.state.titleLength>=this.props.maxLength?a=" filled":this.state.titleLength>0&&(a=" filling"),React.DOM.input({type:"text",className:"required input-bb",ref:"title",name:"title",placeholder:"Give your post a title",value:this.state.title,autocomplete:"off",maxLength:this.props.maxLength,tabIndex:1,onChange:this.handleChange},React.DOM.p({className:"limit"+a},"("+this.state.titleLength+"/"+this.props.maxLength+")"))}}),Namespace("Imgur.Share"),Imgur.Share.Publish=React.createClass({displayName:"Share-Publish",handleRules:function(){Imgur.Util.jafoLog({event:"reportRules",meta:{type:"galleryPost",hash:this.props.hash,isAlbum:this.props.is_album}})},render:function(){var a,b,c=this.props.cortex.missingFields.getValue();return c?(a=React.DOM.button({id:"share",className:"btn btn-grey",disabled:"disabled"},"Finish & Share"),b=React.DOM.p({id:"missing-fields"},"missing "+c+" required field"+(0!=c?"s":""))):(a=React.DOM.button({id:"share",className:"btn btn-main",onClick:this.props.handleSubmit},"Finish & Share"),b=React.DOM.p({id:"missing-fields",className:"success"},"Remember our ",React.DOM.a({href:"/rules",target:"_blank",onClick:this.handleRules},"community rules"))),React.DOM.div({},a,React.DOM.span({id:"share-loader",className:this.props.cortex.submitting.getValue()?"":"nodisplay"}),this.props.cortex.promoted.getValue()?"":React.DOM.a({id:"preview",href:"",onClick:this.props.handlePreview},"preview post"),b)}}),Namespace("Imgur.Element"),Imgur.Element.SortedList=Class.extend({init:function(a,b,c){this._={el:{$container:a},comparator:b,list:c||[]}},getComparator:function(){return this._.comparator},getList:function(){return this._.list},get$Container:function(){return this._.el.$container},add:function(a){for(var b=!1,c=0;c<this._.list.length;c++){var d=this._.list[c],e=this._.comparator(a,d);if(0>=e){d.get$Container().before(a.get$Container()),this._.list.splice(c,0,a),b=!0;break}}b||this.append(a)},prepend:function(a){this._.list.length?this._.list[0].insertBefore(a):this._.el.$container.append(a.get$Container()),this._.list.unshift(a)},append:function(a){this._.el.$container.append(a.get$Container()),this._.list.push(a)},remove:function(a){this.removeElementPredicate(function(b){return b.equals(a)})},removeElementPredicate:function(a){this._.list=_.filter(this._.list,function(b){var c=a(b);return c&&b.remove(),!c})},clear:function(){for(var a=0;a<this._.list.length;a++)this._.list[a].remove();this._.list=[]},extend:function(a){_.each(a,_.bind(this.add,this))},length:function(){return this._.list.length},contains:function(a){return _.some(this._.list,function(b){return a.equals(b)})},containsBy:function(a){return _.some(this._.list,a)},moveToTop:function(a){a.remove(),this.remove(a),this.prepend(a)},findFirstBy:function(a){var b=_.filter(this._.list,a);return b.length?b[0]:null}}),Namespace("Imgur.Element"),Imgur.Element.SortedListEmptyable=Imgur.Element.SortedList.extend({init:function(a,b,c,d,e){this._super(a,c,d),this._.el.$empty=b,this._.emptyMessageProvider=e||function(){return b}},setEmptyMessageProvider:function(a){this._.emptyMessageProvider=a},getEmptyMessageProvider:function(){return this._.emptyMessageProvider},_replaceEmptyMessage:function(){var a=$(this._.emptyMessageProvider());this._.el.$empty.replaceWith(a),this._.el.$empty=a},add:function(a){this._super(a),this.hideEmptyMessage()},prepend:function(a){this.hideEmptyMessage(),this._super(a)},append:function(a){this.hideEmptyMessage(),this._super(a)},remove:function(a){this._super(a),0==this._.list.length&&this.showEmptyMessage()},removeElementPredicate:function(a){this._super(a),0==this._.list.length&&this.showEmptyMessage()},clear:function(){this._super(),this.showEmptyMessage()},hasEmptyMessage:function(){return!this._.el.$empty.hasClass("nodisplay")},hideEmptyMessage:function(){this.hasEmptyMessage()&&this._.el.$empty.addClass("nodisplay")},showEmptyMessage:function(){this._replaceEmptyMessage(),this.hasEmptyMessage()||this._.el.$empty.removeClass("nodisplay")}}),Namespace("Imgur.Element"),Imgur.Element.OutsideSortedListEmptyable=Imgur.Element.SortedListEmptyable.extend({hasEmptyMessage:function(){return this._.el.$selectorContainer.hasClass("noGroups")},hideEmptyMessage:function(){this.hasEmptyMessage()&&this._.el.$selectorContainer.removeClass("noGroups")},showEmptyMessage:function(){this._replaceEmptyMessage(),this.hasEmptyMessage()||this._.el.$selectorContainer.addClass("noGroups")}}),Namespace("Imgur.Tag"),Imgur.Tag.Follow=React.createClass({displayName:"Tag-Follow",_handleUnsubscribe:function(){this.props.groupModel.unsubscribe("[custom]",this.props.tag)},_handleSubscribe:function(){this.props.groupModel.subscribe("[custom]",this.props.tag)},render:function(){return this.props.tagFollower?React.DOM.div({className:"btn btn-small btn-main",onClick:_.bind(this._handleUnsubscribe,this)},"following"):React.DOM.div({className:"btn btn-small btn-secondary",onClick:_.bind(this._handleSubscribe,this)},"follow")
}}),Namespace("Imgur.Tag"),Imgur.Tag.GroupSelector=Class.extend({init:function(a,b,c,d,e,f){this._=_.merge(this._||{},{emitter:a,section:b,sort:c,inSearch:d,activeGroup:f,el:{$selection:e.find("#section .selection")}})},changeSelectionToTag:function(a){this._.el.$sectionName.html(a)},getActiveGroupId:function(){return this._.activeGroup.getId()},getActiveGroup:function(){return this._.activeGroup},getActiveGroupName:function(){return this._.activeGroup.getName()},getActiveTag:function(){return this._.tag},getActiveTagName:function(){return this._.tag.getName()},setActiveGroupName:function(a){this._.activeGroup.setName(a),this._.el.$selection.text(a).trim()},findTagInActiveGroup:function(a){return this._.activeGroup.findFirstTagBy(function(b){return b.getName()===a})}}),Namespace("Imgur.Tag"),Imgur.Tag.MainGroupSelector=Imgur.Tag.GroupSelector.extend({init:function(a,b,c,d,e,f,g){this._super(a,b,c,d,e),this._=_.merge(this._||{},{emitter:a,section:b,sort:c,inSearch:d,sentence:f,outsideActiveTagStore:g,el:{$container:e,$selectionName:e.find("#section .selection .name")}})},get$Container:function(){return this._.el.$container}}),Namespace("Imgur.Tag"),Imgur.Tag.Group=Class.extend({init:function(a,b){this._={list:b,el:{$container:a,$name:a.find(".name")}}},getId:function(){return this.getIdFrom$Container(this._.el.$container)},getList:function(){return this._.list},setList:function(a){this._.list=a},getName:function(){return this._.el.$name.text()},get$Container:function(){return this._.el.$container},get$Name:function(){return this._.el.$name},setName:function(a){this._.el.$name.text(a)},add:function(a){this._.list.add(a)},contains:function(a){return this._.list.contains(a)},containsBy:function(a){return this._.list.containsBy(a)},findFirstTagBy:function(a){return this._.list.findFirstBy(a)},getIdFrom$Container:function(a){return a.children("div").attr("value")},getTypeFrom$Container:function(a){return a.children("div").attr("data-type")},equals:function(a){return a===this.getId()},insertBefore:function(a){this.get$Container().before(a.get$Container())}}),Namespace("Imgur.Tag"),Imgur.Tag.UserGroup=Imgur.Tag.Group.extend({init:function(a,b){this._super(a,b),this._.el.$remove=a.find(".remove")},setName:function(a){this._.el.$name.text(a)},get$RemoveButton:function(){return this._.el.$remove},remove:function(){this._.el.$container.remove()},equals:function(a){return a===this.getId()}}),Namespace("Imgur.Tag"),Imgur.Tag.GroupModel=Class.extend({init:function(a,b,c){this._={post:a,tagGroupStore:b,emitter:c}},unsubscribe:function(a,b){this._.tagGroupStore.removeTagFromGroup(b,a);var c=_.bind(function(){this._.tagGroupStore.setFailedTag(""),this._.tagGroupStore.pushHistory(b,a,this._.tagGroupStore.ACTIONS.REMOVED),this._.emitter.trigger("new tagset")},this),d=_.bind(function(){this._.tagGroupStore.setFailedTag("Failed to unsubscribe from "+b),this._.tagGroupStore.addTagToGroup(b,a),this._.tagGroupStore.pushHistory(b,a,this._.tagGroupStore.ACTIONS.ERROR),humanMsg.displayMsg("Failed to unfollow tag","error-msg")},this);this._.post("/account/groups/unsubscribe",{group:a,tag:b},c,d)},subscribe:function(a,b){this._.tagGroupStore.addPendingTag(b,a);var c=_.bind(function(){this._.tagGroupStore.addTagToGroup(b,a),this._.tagGroupStore.removePendingTag(b,a),this._.tagGroupStore.setFailedTag(""),this._.tagGroupStore.pushHistory(b,a,this._.tagGroupStore.ACTIONS.ADDED),this._.emitter.trigger("new tagset")},this),d=_.bind(function(){this._.tagGroupStore.setFailedTag("Failed to subscribe to "+b),this._.tagGroupStore.removePendingTag(b,a),this._.tagGroupStore.pushHistory(b,a,this._.tagGroupStore.ACTIONS.ERROR),humanMsg.displayMsg("Failed to follow tag","error-msg")},this);this._.post("/account/groups/subscribe",{group:a,tag:b},c,d)},block:function(a,b){this._.tagGroupStore.addPendingTag(b,a);var c=_.bind(function(){this._.tagGroupStore.addTagToGroup(b,a),this._.tagGroupStore.removePendingTag(b,a),this._.tagGroupStore.setFailedTag(""),this._.tagGroupStore.pushHistory(b,a,this._.tagGroupStore.ACTIONS.BLOCKED),this._.emitter.trigger("new tagset")},this),d=_.bind(function(){this._.tagGroupStore.setFailedTag("Failed to block "+b),this._.tagGroupStore.removePendingTag(b,a),this._.tagGroupStore.pushHistory(b,a,this._.tagGroupStore.ACTIONS.ERROR)},this);this._.post("/account/groups/blocktag",{tag:b},c,d),this._.tagGroupStore.block(b)},unblock:function(a,b){this._.tagGroupStore.removeTagFromGroup(b,a);var c=_.bind(function(){this._.tagGroupStore.setFailedTag(""),this._.tagGroupStore.pushHistory(b,a,this._.tagGroupStore.ACTIONS.UNBLOCKED),this._.emitter.trigger("new tagset")},this),d=_.bind(function(){this._.tagGroupStore.pushHistory(b,a,this._.tagGroupStore.ACTIONS.ERROR),this._.tagGroupStore.setFailedTag("Failed to unblock "+b),this._.tagGroupStore.addTagToGroup(b,a)},this);this._.post("/account/groups/unblocktag",{tag:b},c,d),this._.tagGroupStore.unblock(b)}}),Namespace("Imgur.Tag"),Imgur.Tag.Tag=Class.extend({init:function(a){this._={el:{$container:a,$name:Object.getPrototypeOf(this).get$NameFrom$Container(a)}}},insertBefore:function(a){this._.el.$container.before(a.get$Container())},remove:function(){this._.el.$container.remove()},getName:function(){return this._.el.$name.text().toLowerCase()},get$Container:function(){return this._.el.$container},get$Name:function(){return this._.el.$name},get$NameFrom$Container:function(a){return a.children(".name")},getNameFrom$Container:function(a){return a.children(".name").text()},equals:function(a){return a instanceof Imgur.Tag.Tag&&a.getName()==this.getName()},addSelection:function(){this.get$Container().addClass("selected")},removeSelection:function(){this.get$Container().removeClass("selected")}}),Namespace("Imgur.Tag"),Imgur.Tag.RemovableTag=Imgur.Tag.Tag.extend({init:function(a,b){this._super(b),this._.emitter=a,this._.el.$remove=b.find(".remove")},getEmitter:function(){return this._.emitter},get$RemoveButton:function(){return this._.el.$remove},markConfirmed:function(){this._.el.$container.removeClass("pending")},remove:function(){this._.emitter.trigger("tag.remove",this.getName()),this._super()}}),Namespace("Imgur.Tag"),Imgur.Tag.InsideTaggingWidget=Class.extend({init:function(a,b){this._={emitter:a,el:{$container:b}}},isOpen:function(){return this._.el.$container.hasClass("opened")},popup:function(){this._.el.$container.addClass("opened"),this._.emitter.trigger("image-tag-box.show")},hide:function(){this._.el.$container.removeClass("opened"),this._.emitter.trigger("image-tag-box.hide")},get$Container:function(){return this._.el.$container}}),Namespace("Imgur.Tag"),Imgur.Tag.OutsideTaggingWidget=Class.extend({init:function(a,b,c,d,e){this._={emitter:e,showBestCommentsCookie:"showComments",showTagsCookie:"showTags",noBlockedCookie:"noBlocked",el:{$outsideTaggingParent:b,$outsideTagging:a,$blockedContainer:c,$tagShowHide:d,$blockedHeader:c.find("#tags-blocked-header"),$blockedBody:c.find("#tags-blocked-body"),$blockedCheckbox:c.find("#tags-blocked-toggle")}}},isOpen:function(){return $.cookie(this._.showTagsCookie)},toggle:function(a){var b=this._.el.$outsideTaggingParent.hasClass("hidden");$(".tipsy").remove(),b?(this._.el.$outsideTaggingParent.removeClass("hidden"),this._.el.$tagShowHide.attr("title","Hide Sidebar"),this._.el.$outsideTagging.stop(!0,!0).fadeTo(0,1)):(this._.el.$outsideTaggingParent.addClass("hidden"),this._.el.$tagShowHide.attr("title","Show Sidebar"),this._.el.$outsideTagging.stop(!0,!0).delay(100).fadeTo(100,0)),a?this.setBestCommentsCookie(b?1:0):this.setTagBoxCookie(b?1:0)},openTagBox:function(){this.isOpen()||this.toggle(!1)},setTagBoxCookie:function(a){a?$.cookie(this._.showTagsCookie,a,{path:"/",expires:1e4}):$.removeCookie(this._.showTagsCookie,{path:"/"})},setBestCommentsCookie:function(a){a?$.cookie(this._.showBestCommentsCookie,a,{path:"/",expires:1e4}):$.removeCookie(this._.showBestCommentsCookie,{path:"/"})},toggleBlockedTagsOnOff:function(){this._.el.$blockedCheckbox.is(":checked")?$.removeCookie(this._.noBlockedCookie,{path:"/"}):$.cookie(this._.noBlockedCookie,!0,{path:"/",expires:1e4}),this._.emitter.trigger("new tagset")},toggleBlocked:function(){this._.el.$blockedContainer.toggleClass("openedBlockedTags")},get$BlockedHeader:function(){return this._.el.$blockedHeader},get$BlockedCheckbox:function(){return this._.el.$blockedCheckbox},hideBlocked:function(){this._.el.$blockedContainer.hasClass("opened")||this._.el.$blockedContainer.removeClass("opened")}}),Namespace("Imgur.Tag"),Imgur.Tag.TagModel=Class.extend({init:function(a){this._={post:a}},changeVote:function(a,b,c,d,e){this._.post("/gallery/action/vote/"+a,{type:"tag",vote:c,tag:b},d,e)},deleteTag:function(a,b,c,d){this._.post("/gallery/action/delete_tag/"+a,{tag:b},c,d)},reportTag:function(a,b,c,d){this._.post("/gallery/action/report_tag/"+a,{tag:b},c,d)}}),Namespace("Imgur.Tag"),Imgur.Tag.Model=Class.extend({init:function(a,b){this._={ajax:a,tagProvider:b,queryNonce:0,pendingRequest:null}},cancel:function(){this._.queryNonce++,null!=this._.pendingRequest&&this._.pendingRequest.abort()},fetch:function(a,b,c,d){this.cancel(),this._.pendingRequest=this._.ajax(b,d,_.bind(this._handleResponse,this,this._.queryNonce,a,c||_.noop),_.bind(this._handleError,this,a))},responseWasSuccessful:function(a){return!!a.success},_handleResponse:function(a,b,c,d){this._.pendingRequest=null,a<this._.queryNonce||(this._.queryNonce++,d&&this.responseWasSuccessful(d)&&c(b,this._handleResponseSuccess(b,d)))},_handleError:function(){throw"abstract"},_handleResponseSuccess:function(){throw"abstract"}}),Namespace("Imgur.Tag"),Imgur.Tag.SuggestModel=Imgur.Tag.Model.extend({init:function(a,b,c){this._super(a,b),this._.autoSuggestUrl=c},fetch:function(a,b,c,d){this._super([a,b,d],this._.autoSuggestUrl+"/tags/_suggest",c,JSON.stringify({tags:{text:b,completion:{field:"name_suggest",size:10,fuzzy:{edit_distance:1}}}}))},responseWasSuccessful:function(a){return a._shards.successful>0},_handleResponseSuccess:function(a,b){var c=[],d=a[0],e=(a[1],a[2]);return _.each(b.tags[0].options,_.bind(function(a){c.push(this._.tagProvider(e,d,a.text,a.payload.subscribed))},this)),c},toString:function(){return"[tag suggestion model]"}}),Namespace("Imgur.Tag"),Imgur.Tag.AlternativesModel=Imgur.Tag.Model.extend({init:function(a,b){this._super(a,b),this._.lastResponse={hash:null,response:null}},fetch:function(a,b,c,d){var e=[a,c,d],f=Imgur.Environment.auth.url?"miss.json":"hit.json";this._.lastResponse.hash==a?b(e,this._.lastResponse.response):this._super(e,"/gallery/"+a+"/suggested_tags/"+f,_.bind(function(c,d){this._.lastResponse.hash=a,this._.lastResponse.response=d,b(c,d)},this))},_handleResponseSuccess:function(a,b){var c=[],d={},e=a[0],f=a[1]||_.noop,g=a[2]||_.noop;return _.each(b.data,_.bind(function(a){var b=[];_.each(a.groups,function(a){d[a.hash]=a,b.push(a.hash)}),c.push(this._.tagProvider(f,g,e,a.tag,a.vote||"veto",a.points,b,a.subscribers))},this)),{tags:c,groups:d}},toString:function(){return"[tag alternatives model]"}}),Namespace("Imgur.Tag"),Imgur.Tag.SuggestModelNoProvider=Imgur.Tag.Model.extend({init:function(a,b){this._super(a,null),this._.autoSuggestUrl=b},fetch:function(a,b){a?this._super(a,this._.autoSuggestUrl+"/tags/_suggest",b,JSON.stringify({tags:{text:a,completion:{field:"name_suggest",size:10,fuzzy:{edit_distance:1}}}})):b("",[])},responseWasSuccessful:function(a){return a._shards.successful>0},_handleResponseSuccess:function(a,b){var c=[];return _.each(b.tags[0].options,_.bind(function(a){c.push({tag:a.text,subscribers:a.payload.subscribed,images:a.payload.images})},this)),c},_handleError:_.noop}),Namespace("Imgur.Tag"),Imgur.Tag.AlternativesModelNoProvider=Imgur.Tag.Model.extend({init:function(a,b,c){this._super(a,null),this._.tagStore=c,this._.tagImageStore=b},fetch:function(a,b){if(b||!this._.tagImageStore.haveTagsForPost(a)){var c=a,d=Imgur.Environment.auth.url?"miss.json":"hit.json";this._.tagImageStore.setIsLoading(!0),this._super(c,"/gallery/"+a+"/suggested_tags/"+d)}},_handleResponseSuccess:function(a,b){this._.tagImageStore.setIsLoading(!1);var c=a;_.each(b.data,_.bind(function(a){this._.tagStore.addTag(a),this._.tagImageStore.addTagForPost(c,a.tag,{source:Imgur.Tag.Store.TagImage.prototype.SOURCE.SUGGESTION,tag:a.tag,vote:a.vote||"veto",points:Number(a.points),author:a.author})},this))},_handleError:function(){this._.tagImageStore.setIsLoading(!1)}}),Namespace("Imgur.Tag"),Imgur.Tag.AutocompleteComponent=React.createClass({displayName:"Tag-AutocompleteComponent",getInitialState:function(){return{hidden:""}},getDefaultProps:function(){return{KEYCODES:{KEY_T:84,KEY_ESC:27,KEY_DOWN_ARROW:40,KEY_RIGHT_ARROW:39,KEY_UP_ARROW:38,KEY_ENTER:13,KEY_TAB:9}}},focus:function(){this.refs.query.getDOMNode().focus()},moveCursorToEnd:function(a){a.selectionStart=a.selectionEnd=a.value.length,a.style.display="none",a.offsetHeight,a.style.display="block",a.focus()},handleKeyDown:function(a){9==a.keyCode&&""!=this._getAcInfo().queryDisplayed&&a.preventDefault();var b={down_arrow:a.keyCode===this.props.KEYCODES.KEY_DOWN_ARROW,up_arrow:a.keyCode===this.props.KEYCODES.KEY_UP_ARROW,right_arrow:a.keyCode===this.props.KEYCODES.KEY_RIGHT_ARROW,enter:a.keyCode===this.props.KEYCODES.KEY_ENTER,tab:a.keyCode===this.props.KEYCODES.KEY_TAB,modifier:!!a.metaKey||!!a.ctrlKey||!!a.altKey};if(!b.modifier){b.enter&&this.handleSubmit(a);var c=this.props.suggestionStore.getSuggestions();if(0==c.length&&(c=this.props.defaultTags||[]),c.length){var d=this.props.getAutocompleteIdx();if(b.down_arrow||b.up_arrow){var e=0;if(e=b.down_arrow?1:-1,0===d&&b.up_arrow||d===c.length-1&&b.down_arrow)return void this.props.setComponentState({selectionActive:!1,autocompleteIdx:null});d=null==d?b.up_arrow?c.length-1:0:((d+e)%c.length+c.length)%c.length,this.props.setComponentState({selectionActive:!0,autocompleteIdx:d})}else if(b.right_arrow||b.tab){var f=c[0].tag,g=this.refs.query.getDOMNode();null!=d?f=c[d].tag:"number"==typeof g.selectionEnd&&g.selectionEnd==g.value.length&&this.moveCursorToEnd(g),this.props.suggestionStore.setQuery(f),this.handleKeyPress(a),b.tab&&this.props.setComponentState({focusDue:!0})}}}},handleKeyPress:function(a){var b=this._getAcInfo().queryDisplayed+(32==a.which?"m":String.fromCharCode(a.which)),c=$("<span />").text(b);$("body").append(c),this.setState(c.width()>$(this.refs.query.getDOMNode()).width()?{hidden:"hidevis"}:{hidden:""}),c.remove()},handleChangedQuery:function(a){this.props.suggestionStore.setValidationMode("query"),this.props.suggestionStore.setQuery(a.target.value),this.props.setComponentState({selectionActive:!1,autocompleteIdx:null})},handleSubmit:function(a){a.preventDefault(),this.props.suggestionStore.setValidationMode("submit");var b=this._getAcInfo(),c=b.queryDisplayed,d=this.props.suggestionStore.getIsValidQuery(c);d&&this.props.onSubmit(c,a)},focused:function(){this.props.setComponentState({focusDue:!1})},_getAcInfo:function(){var a=this.props.suggestionStore.getQuery(),b="",c=this.props.suggestionStore.getSuggestions();0==c.length&&(c=this.props.defaultTags||[]),c.length&&null!=this.props.getAutocompleteIdx()?b=c[this.props.getAutocompleteIdx()].tag:c.length&&(b=c[0].tag);var d=this._longestCommonPrefix(b,a);return(!d||d!=a&&!this.props.getSelectionActive())&&(b=""),{acText:b,queryDisplayed:null!=this.props.getAutocompleteIdx()&&this.props.getSelectionActive()?b:a}},_longestCommonPrefix:function(a,b){if(!b)return a;for(var c=Math.min(a.length,b.length);c>=0;){if(a.substr(0,c)==b.substr(0,c))return a.substr(0,c);c--}return""},componentDidUpdate:function(){$(".tipsy").remove(),(this.props.maybeErrorLabel||this.props.maybeAjaxErrorLabel)&&$(".tipsy-error").tipsy({cls:"error-tipsy",gravity:"w",trigger:"manual",title:"data-title"}).tipsy("show")},componentWillUnmount:function(){$(".tipsy").remove()},render:function(){return React.DOM.div({className:"acContainer"},React.DOM.input({ref:"query",onChange:this.handleChangedQuery,type:"text",id:this.props.id?this.props.id:"tagbox",placeholder:this.props.placeholder,tabIndex:this.props.tabIndex,value:this._getAcInfo().queryDisplayed,onKeyDown:this.handleKeyDown,onKeyPress:this.handleKeyPress,autoComplete:"off","data-title":this.props.maybeErrorLabel?this.props.maybeErrorLabel:this.props.maybeAjaxErrorLabel?this.props.maybeAjaxErrorLabel:"",className:this.props.className+(this.props.maybeErrorLabel||this.props.maybeAjaxErrorLabel?" tipsy-error":"")}),React.DOM.input({id:"acText",type:"text",autoComplete:"off",readOnly:!0,ref:"hint",className:this.state.hidden,value:this._getAcInfo().acText}))}}),Namespace("Imgur.Tag"),Imgur.Tag.Comparator=Class.extend({compare:function(a,b){var c=a.getName(),d=b.getName();if(d==c)return 0;var e=[c,d];return e.sort(),e[0]==c?-1:1}}),Namespace("Imgur.Tag"),Imgur.Tag.ShareTagComponent=React.createClass({displayName:"Tag-ShareTagComponent",getInitialState:function(){return{focusDue:!0,selectionActive:!1,autocompleteIdx:null}},_encode:function(a){return a.replace(new RegExp(" ","g"),"_")},handleTagClicked:function(a,b){b.preventDefault()},handleRemoveClicked:function(a,b){b.preventDefault(),this.props.tagStore.removeTag(a)},handleQueryChange:function(a){this.props.suggestionStore.setQuery(a.target.value)},handleChoice:function(a,b){b.preventDefault(),this.props.suggestionStore.setValidationMode("query"),this.props.suggestionStore.clear(),this.props.suggestionStore.setQuery(""),this.props.tagStore.addTag({tag:a}),this.setState({selectionActive:!1,autocompleteIdx:null})},getSelectionActive:function(){return this.state.selectionActive},getAutocompleteIdx:function(){return this.state.autocompleteIdx},setComponentState:function(a){this.setState(a)},componentDidMount:function(){this._updateNano()},componentDidUpdate:function(){this._updateNano()},_updateNano:function(){var a=$(this.refs.nano.getDOMNode()),b=this.refs.content.getDOMNode();a.height("inherit").height(b.scrollHeight),a.nanoScroller({preventPageScrolling:!0,alwaysVisible:!0}),a.children(".pane").is(":visible")?a.addClass("nano-visible"):a.removeClass("nano-visible")},stopPropagation:function(a){a.stopPropagation()},_produceTag:function(a,b,c){return React.DOM.div({onClick:_.partial(this.handleChoice,b),className:"tag suggested pointer"+(a?" hover":"")},React.DOM.div({className:"name"},b),React.DOM.div({className:"images"},Imgur.Util.numberFormat(c)+" images"))},render:function(){var a=this.props.suggestionStore.getLastFinishedQuery(),b=this.props.suggestionStore.getQuery(),c=this.props.suggestionStore.getIsValidQuery(b),d=this.props.suggestionStore.getWhyNot(b),e=this.props.suggestionStore.getIsLoading(),f=this.props.suggestionStore.getSuggestions(),g=[],h=[],i=[],j=[],k=Object.keys(this.props.tagStore.getTags()),l=0,m="";if(tagCountText="",a.length){if(_.each(f,_.bind(function(a,b){var c=null!=this.state.autocompleteIdx&&b==this.state.autocompleteIdx&&this.state.selectionActive;g.push(this._produceTag(c,a.tag,a.images))},this)),!f.length&&c){var n=e?a:b;g.push(React.DOM.p({className:"empty"},"No tag like ",React.DOM.em(null,n)," found. ",React.DOM.a({className:"tag-create-from-empty-query",href:"#",onClick:_.partial(this.handleChoice,n)},"Make it!")))}}else g.push(React.DOM.div({className:"empty"},""));return!(g.length<2&&0==k.length)||f.length||e&&b.length||(i=_.filter(this.props.defaultTags,function(a){return-1==k.indexOf(a.tag)}),_.each(i,_.bind(function(a,b){if(-1==k.indexOf(a.tag)){var c=null!=this.state.autocompleteIdx&&b==this.state.autocompleteIdx&&this.state.selectionActive;h.push(this._produceTag(c,a.tag,a.images))}},this))),j=_.map(k,_.bind(function(a){return a==this.props.gallery_type?React.DOM.div({className:"tag-removable"},React.DOM.span(null,a)):React.DOM.div({className:"tag-removable"},React.DOM.span(null,a),React.DOM.a({onClick:_.partial(this.handleRemoveClicked,a),href:"#",className:"remove"},""),React.DOM.input({type:"hidden",name:"tag[]",value:a}))},this)),l=j.length,l>=this.props.tagLimit?m="filled":l>0&&(m="filling"),this.refs.query&&$(this.refs.query.getDOMNode()).find("input").is(":focus")&&(tagCountText="Press enter to add tag "),React.DOM.div(null,j,React.DOM.div({className:"tag-filter"},React.createElement(Imgur.Tag.AutocompleteComponent,{onSubmit:this.handleChoice,ref:"query",id:l>=this.props.tagLimit?"tagbox-hidden":this.props.id,type:"text",autoComplete:"off",placeholder:this.props.placeholder,tabIndex:this.props.tabIndex,defaultTags:i,suggestionStore:this.props.suggestionStore,getAutocompleteIdx:this.getAutocompleteIdx,getSelectionActive:this.getSelectionActive,setComponentState:this.setComponentState,maybeErrorLabel:d}),React.DOM.div({ref:"nano",className:"tag-list-content nano"},React.DOM.div({ref:"content",className:"tag-list-results scroll-content content"},i.length||f.length&&c?React.DOM.p({},"TAG SUGGESTIONS"):"",g,h))),React.DOM.p({id:"tag-count",className:"limit"},tagCountText,React.DOM.span({className:m},"("+l+"/"+this.props.tagLimit+")")))}}),Namespace("Imgur.Tag"),Imgur.Tag.TagListComponent=React.createClass({displayName:"Tag-TagListComponent",getInitialState:function(){return{focusDue:!0,selectionActive:!1,autocompleteIdx:null}},_encode:function(a){return a.replace(new RegExp(" ","g"),"_")},handleTagClicked:function(a,b){b.preventDefault();var c=this.props.outsideActiveTagStore.getIsActive(),d=this.props.outsideActiveTagStore.getActiveTag();c&&a===d?this.props.outsideActiveTagStore.deactivate():this.props.outsideActiveTagStore.setActiveTag(a)},handleRemoveClicked:function(a,b){b.preventDefault(),"[filtered]"===this.props.groupId?this.props.groupModel.unblock(this.props.groupId,a):this.props.groupModel.unsubscribe(this.props.groupId,a)},handleQueryChange:function(a){this.props.suggestionStore.setQuery(a.target.value)},handleChoice:function(a,b){b.preventDefault(),this.props.suggestionStore.setValidationMode("query"),this.props.suggestionStore.clear(),this.props.suggestionStore.setQuery(""),"[filtered]"===this.props.groupId?this.props.groupModel.block(this.props.groupId,a):this.props.tagGroupStore.isTagInGroup(a,this.props.groupId)||this.props.groupModel.subscribe(this.props.groupId,a)},getSelectionActive:function(){return this.state.selectionActive},getAutocompleteIdx:function(){return this.state.autocompleteIdx},setComponentState:function(a){this.setState(a)},componentDidMount:function(){this._updateNano()},componentDidUpdate:function(){this._updateNano()},_updateNano:function(){var a=$(this.refs.nano.getDOMNode()),b=this.refs.content.getDOMNode();a.height("inherit").height(b.scrollHeight),a.nanoScroller({preventPageScrolling:!0}),a.children(".pane").is(":visible")?a.addClass("nano-visible"):a.removeClass("nano-visible")},render:function(){var a=this.props.suggestionStore.getLastFinishedQuery(),b=this.props.suggestionStore.getQuery(),c=this.props.suggestionStore.getIsValidQuery(b),d=this.props.suggestionStore.getWhyNot(b),e=this.props.groupId,f=this.props.outsideActiveTagStore.getActiveTag(),g=this.props.suggestionStore.getIsLoading(),h=this.props.suggestionStore.getSuggestions(),i=this.props.tagGroupStore.getFailedTag(),j="",k="",l=[];if(a.length){if(l=_.map(h,_.bind(function(a,b){var c=null!=this.state.autocompleteIdx&&b==this.state.autocompleteIdx&&this.state.selectionActive;return React.DOM.div({onClick:_.partial(this.handleChoice,a.tag),className:"tag suggested"+(c?" hover":"")},React.DOM.span({className:"name"},a.tag),React.DOM.div({className:"add"},React.DOM.span({className:"plus-icon"},"")))},this)),!h.length&&c){var m=g?a:b;l.push(React.DOM.p({id:"new-empty-tag"},React.DOM.span({className:"icon-alert"},""),"Are you sure you want to create ",React.DOM.em(null,m)))}}else l=_.map(this.props.tagGroupStore.getTagsForGroup(e),_.bind(function(a){return React.DOM.div({className:"tag tag-removable "+(a===f?"selected":"")+(this.props.tagGroupStore.isPending(a,e)?" pending":"")},React.DOM.a({onClick:_.partial(this.handleTagClicked,a),href:"/t/"+this._encode(a),className:"name"},a),React.DOM.a({onClick:_.partial(this.handleRemoveClicked,a),href:"#",className:"remove"},""))},this));if(!l.length){var n="";"[filtered]"==this.props.groupId&&(n="Add tags to be filtered out."),l.push(React.DOM.div({className:"empty"},n))}return c||(j=d),i&&(k=i),React.DOM.div(null,React.DOM.div({className:"tag-filter"},React.createElement(Imgur.Tag.AutocompleteComponent,{onSubmit:this.handleChoice,ref:"query",id:this.props.id?this.props.id:"tagbox",type:"text",autoComplete:"off",placeholder:this.props.placeholder,maybeErrorLabel:j,maybeAjaxErrorLabel:k,suggestionStore:this.props.suggestionStore,getAutocompleteIdx:this.getAutocompleteIdx,getSelectionActive:this.getSelectionActive,setComponentState:this.setComponentState})),React.DOM.div({ref:"nano",className:"tag-list-content nano"},React.DOM.div({ref:"content",className:"tag-list-results scroll-content content"},l)))}}),Namespace("Imgur.Tag.Validator"),Imgur.Tag.TagValidator=Class.extend({TAG_REGEX:/^[a-z0-9&\-\s]*$/,init:function(a,b){this._={maxLength:b,minLength:a}},isValidTag:function(a,b,c){return this._validateTag(a,b,c).success},whyNot:function(a,b,c){return this._validateTag(a,b,c).message},_validateTag:function(a,b,c){var d={success:!0,message:null};return b=b.trim().toLowerCase(),null==b.match(Object.getPrototypeOf(this).TAG_REGEX)&&(d.message="Tags can only contain alphanumeric and others (&-)",d.success=!1),c&&(d.message="That tag is already in this gallery",d.success=!1),"submit"==a&&b.length<this._.minLength?(d.message="Tag is too short. Tags can be between "+this._.minLength+" and "+this._.maxLength+" characters.",d.success=!1):b.length>this._.maxLength&&(d.message="Tag is too long. Tags can be between "+this._.minLength+" and "+this._.maxLength+" characters.",d.success=!1),d}}),Namespace("Imgur.Tag.Validator"),Imgur.Tag.GroupValidator=Class.extend({GROUP_REGEX:/^[a-zA-Z0-9&\-\s]*$/,init:function(a,b){this._={maxLength:b,minLength:a}},isValidGroup:function(a,b){return this._validateGroup(a,b).success},whyNot:function(a,b){return this._validateGroup(a,b).message},_validateGroup:function(a,b){var c={success:!0,message:null};return b=b.trim(),null==b.match(Object.getPrototypeOf(this).GROUP_REGEX)&&(c.message="Galleries can only contain alphanumeric and others (&-).",c.success=!1),"submit"==a&&b.length<this._.minLength?(c.message="Gallery is too short. Galleries can be between "+this._.minLength+" and "+this._.maxLength+" characters.",c.success=!1):b.length>this._.maxLength&&(c.message="Gallery is too long. Galleries can be between "+this._.minLength+" and "+this._.maxLength+" characters.",c.success=!1),c}}),Namespace("Imgur.Tag"),Imgur.Tag.Sentence=Class.extend({init:function(a,b,c){this._={groupStore:c,el:{$before:a,$middle:b}}},get$Before:function(){return this._.el.$before},get$Middle:function(){return this._.el.$middle},change:function(a){"hot"==a?this._.el.$before.text("The"):"gallery-other"==a||"usersub"==a||"subreddit"==a?this._.el.$before.text(""):"tag"==a?this._.el.$before.text("Images tagged with"):"gallery"==a&&this._.el.$before.text("Your");var b=", sorted by";"hot"==a?b="images on the Internet"+b:"usersub"==a||"subreddit"==a?b="images"+b:("gallery"==a||"gallery-other"==a)&&(b=" gallery"+b),this._.el.$middle.text(b)}}),Namespace("Imgur.Tag"),Imgur.Tag.InsideListComponent=React.createClass({displayName:"Tag-InsideListComponent",getInitialState:function(){return{selectionActive:!1,autocompleteIdx:null,taggingActive:!1,taggingActivating:!1,focusDue:!0}},handleVote:function(a,b,c){var d=this.props.tagImageStore.getTagVote(a,b),e=c;d===c&&(e="veto");var f=this.props.currentImageStore.getCurrentImage();this.props.tagImageStore.setTagVote(a,b,e),this._logUpvoteTag(a,b,e,f,!1),this.props.onVote(a,b,e,_.partial(this._logUpvoteTag,a,b,e,f,!0,null))},_logUpvoteTag:function(a,b,c,d,e,f){f=f||{},"up"===c&&(f=_.extend({hash:a,isAlbum:d.is_album,nsfw:d.nsfw,isHot:d.is_hot,tag:b,control:"upvote"},f),Imgur.Util.jafoLog({event:e?"successUpvoteTag":"attemptUpvoteTag",meta:f}))},handleTopicClick:function(a){this._logOpenTopicTag(a,"topic","topic")},handleTagClick:function(a){this._logOpenTopicTag(a,"tag","tagBoxDropdown")},_logOpenTopicTag:function(a,b,c){var d=this.props.currentImageStore.getCurrentImage();Imgur.Util.jafoLog({event:"openTopicTag",meta:{hash:d.hash,isAlbum:d.is_album,nsfw:d.nsfw,isHot:d.is_hot,control:c,location:"inside",galleryType:b,topicTag:a}})},handleChoice:function(a,b,c,d){d&&d.preventDefault(),this.props.suggestionStore.setValidationMode("query"),this.props.suggestionStore.clear(),this.props.suggestionStore.setQuery(""),this.setState({selectionActive:!1,autocompleteIdx:null}),this.props.tagStore.haveTag(c)||this.props.tagStore.addTag({tag:c,images:"n/a",subscribers:"n/a",source:"query"==b});var e=$.Callbacks(),f=$.Callbacks(),g=this.props.currentImageStore.getCurrentImage();if(this.props.tagImageStore.isTagOnPost(a,c)){var h=this.props.tagImageStore.getTagVote(a,c);"up"!=h&&this.props.tagImageStore.setTagVote(a,c,"up"),this.props.tagImageStore.setTagSource(a,c,Imgur.Tag.Store.TagImage.prototype.SOURCE.USER),e.add(_.bind(this._logCustomTag,this,a,c,g,!1,{alreadyTagged:!0})),e.add(_.bind(this._logUpvoteTag,this,a,c,"up",g,!1,{control:"typed"})),f.add(_.bind(this._logUpvoteTag,this,a,c,"up",g,!0,{control:"typed"}))}else this.props.tagImageStore.addTagForPost(a,c,{source:Imgur.Tag.Store.TagImage.prototype.SOURCE.USER,tag:c,author:this.props.user,points:1,vote:"up"}),e.add(_.bind(this._logCustomTag,this,a,c,g,!1)),f.add(_.bind(this._logCustomTag,this,a,c,g,!0,null));e.fire(),this.props.onVote(a,c,"up",f.fire)},_logCustomTag:function(a,b,c,d,e){e=e||{};var f=this.props.tagImageStore.getTag(a,b);e=_.extend({hash:c.hash,isAlbum:c.is_album,nsfw:c.nsfw,isHot:c.is_hot,location:"inside",tag:f.tag,alreadyTagged:!1},e),Imgur.Util.jafoLog({event:d?"successCustomTag":"attemptCustomTag",meta:e})},activateTagging:function(){this.setState({taggingActive:!0}),this.setState({taggingActivating:!0}),setTimeout(_.bind(function(){this.setState({taggingActivating:!1})},this),500)},_produceTag:function(a,b,c){return"tag"==b.type&&"undefined"!=typeof b.tag?React.createElement(Imgur.Tag.InsidePostTag,{key:a+b.tag,ref:"tag-"+b.tag,name:b.tag,vote:b.vote,hash:a,isMine:b.author===this.props.user,onVote:_.partial(this.handleVote,a,b.tag),onRemoveClick:_.partial(this.props.onDeleteTag,a,b.tag),onTagClick:_.partial(this.handleTagClick,b.tag),onReport:_.bind(this.props.onReportTag,this,a,b.tag)}):b.type==Imgur.Tag.Store.TagImage.prototype.SOURCE.SUGGESTION||b.type==Imgur.Tag.Store.TagImage.prototype.SOURCE.DEFAULT?React.DOM.li({className:c?"hover":"",onClick:_.partial(this.handleChoice,a,b.type,b.tag),key:"stag-"+b.tag},React.DOM.div({className:"name"},b.tag),React.DOM.div({className:"images"},Imgur.Util.numberFormat(b.images)+" images")):void 0},componentDidUpdate:function(){var a=$(this.refs.nano.getDOMNode()),b=this.refs.content.getDOMNode();a.height("inherit").height(b.scrollHeight),a.nanoScroller({preventPageScrolling:!0,alwaysVisible:!0}),a.children(".pane").is(":visible")?a.addClass("nano-visible"):a.removeClass("nano-visible"),a=$(this.refs.suggestedNano.getDOMNode()),b=this.refs.suggestedContent.getDOMNode(),a.height("inherit").height(b.scrollHeight),a.nanoScroller({preventPageScrolling:!0,alwaysVisible:!0}),a.children(".pane").is(":visible")?a.addClass("nano-visible"):a.removeClass("nano-visible"),this.props.opened&&this.state.focusDue&&this.state.taggingActive&&!this.state.taggingActivating?(this.refs.query.focus(),this.setState({focusDue:!1})):this.props.opened||this.state.focusDue||!this.state.taggingActive||this.setState({focusDue:!0}),$(".tipsy").remove(),this.props.opened&&$(".tipsy-error").tipsy({cls:"error-tipsy",gravity:"w",trigger:"manual"}).tipsy("show")},componentWillUnmount:function(){$(".tipsy").remove()},getSelectionActive:function(){return this.state.selectionActive},getAutocompleteIdx:function(){return this.state.autocompleteIdx},setComponentState:function(a){this.setState(a)},render:function(){var a=this.props.currentImageStore.getCurrentImageId(),b=this.props.tagImageStore.getTagsForPost(a),c=this.props.suggestionStore.getSuggestions(),d=this.props.suggestionStore.getQuery(),e=this.props.suggestionStore.getIsValidQuery(d),f=this.props.suggestionStore.getWhyNot(d),g=this.props.suggestionStore.getIsLoading()||this.props.tagImageStore.getIsLoading(),h=this.props.tagImageStore.getAjaxError(a),i=this.props.suggestionStore.getLastFinishedQuery(),j=this.props.tagCortex.topic.getValue()&&"No Topic"!=this.props.tagCortex.topic.getValue(),k=[],l=(Object.keys(b),[React.DOM.li({className:"header",key:"users"},"tags added by users")]),m=[React.DOM.li({className:"header",key:"you"},"tags added by you")],n=[React.DOM.li({className:"header",key:"recommended"},"recommended tags")],o=_.values(b);
if(o.sort(function(a,b){return a.source==Imgur.Tag.Store.TagImage.prototype.SOURCE.USER?-1:b.source==Imgur.Tag.Store.TagImage.prototype.SOURCE.USER?1:a.points>b.points?-1:a.points<b.points?1:0}),_.each(o,_.bind(function(b){b.author===this.props.user?m.push(this._produceTag(a,_.merge({},b,{type:"tag"}),!1)):l.push(this._produceTag(a,_.merge({},b,{type:"tag"}),!1))},this)),_.each(c,_.bind(function(b,c){var d=null!=this.state.autocompleteIdx&&c==this.state.autocompleteIdx&&this.state.selectionActive;n.push(this._produceTag(a,_.merge({},b,{type:Imgur.Tag.Store.TagImage.prototype.SOURCE.SUGGESTION}),d))},this)),i.length&&!c.length&&e){var p=g?i:d;n=[React.DOM.span({className:"icon-alert",key:"alert"},""),React.DOM.div({id:"new-tag",key:"new-tag"},"Are you sure you want to create "+p)]}var q={onClick:_.bind(function(a){this.refs.query.handleSubmit(a)},this)};e||(q.title=f,q.className="tipsy-error"),h&&(q.title=h,q.className="tipsy-error");var r=o.length;r>1?r+=" tags":1==r?r+=" tag":r="Add tag";var s=classNames({active:this.state.taggingActive,noborder:l.length<2&&m.length<2}),t="";return j&&(t=React.DOM.a({id:"topic",href:"/topic/"+this.props.tagCortex.topic.getValue().replace(/ /g,"_"),onClick:_.partial(this.handleTopicClick,this.props.tagCortex.topic.getValue())},this.props.tagCortex.topic.getValue())),React.DOM.div({},t,React.DOM.div({id:"tags-underbar",className:j?"":"no-topic"},r,React.DOM.div({id:"tag-container"},React.DOM.div({id:"tags-dropdown"},React.DOM.div({ref:"nano",className:"tag-list-content nano"},React.DOM.div({ref:"content",className:"tag-list-results content scroll-content"},React.DOM.ul({},l.length>1?l:"",m.length>1?m:""))),React.DOM.div({id:"custom-tag",className:s},React.DOM.div({id:"custom-tag-text",onClick:this.activateTagging},"add a custom tag"),React.DOM.div({id:"acWrapper"},React.createElement(Imgur.Tag.AutocompleteComponent,{onSubmit:_.partial(this.handleChoice,a,Imgur.Tag.Store.TagImage.prototype.SOURCE.USER),ref:"query",type:"text",placeholder:"",className:g?"loading":"",defaultTags:k,suggestionStore:this.props.suggestionStore,getAutocompleteIdx:this.getAutocompleteIdx,getSelectionActive:this.getSelectionActive,setComponentState:this.setComponentState}),React.DOM.span(q,"Add")))),React.DOM.div({ref:"suggestedNano",id:"suggested-nano",className:"nano"},React.DOM.ul({ref:"suggestedContent",id:"suggested-dropdown",className:"content scroll-content"},n.length>1?n:"")))))}}),Namespace("Imgur.Tag"),Imgur.Tag.InsideSuggestedTag=React.createClass({displayName:"Tag-InsideSuggestedTag",handleClicked:function(a){a.stopPropagation()},render:function(){return React.DOM.div({onClick:this.props.onChoose,className:"tag suggested"+(this.props.selected?" hover":"")},React.DOM.div({className:"name"},this.props.name),React.DOM.div({className:"add"},React.DOM.span({className:"plus-icon"},"")),React.DOM.div({className:"right-bar"},React.DOM.div({className:"subscribers",title:this.props.subscribers+" followers"},this.props.subscribers),React.DOM.a({className:"external-link",onClick:this.handleClicked,href:"/t/"+this.props.name,target:"_blank"},"")))}}),Namespace("Imgur.Tag"),Imgur.Tag.InsidePostTag=React.createClass({displayName:"Tag-InsidePostTag",getInitialState:function(){return{reported:!1}},handleReport:function(){var a=$("#colorbox-confirm-title"),b=$("#colorbox-confirm-message");a.text("Report Tag"),b.text("Are you sure you want to report this tag?"),Imgur.Utilities.ColorboxConfirm.getInstance().show($("#colorbox-confirm"),_.bind(function(){$.cookie("t"+this.props.hash+"."+this.props.name,1,{expires:7,path:"/"}),this.props.onReport(),this.setState({reported:!0}),a.text(""),b.text("")},this))},render:function(){var a;return this.state.reported||1==$.cookie("t"+this.props.hash+"."+this.props.name)?a=React.DOM.span({className:"reported right"},"Reported"):this.props.isMine?a=React.DOM.span({className:"icon-x right pointer",title:"remove",onClick:this.props.onRemoveClick},""):(a=[React.DOM.span({onClick:_.partial(this.props.onVote,"up"),className:"icon-upvote right pointer"+("up"==this.props.vote?" green":""),key:"up-tag"})],Imgur.Environment.auth.isLoggedIn&&a.push(React.DOM.span({onClick:this.handleReport,className:"icon-flag right pointer",key:"report-tag"}))),React.DOM.li({},React.DOM.a({href:"/t/"+Imgur.Tag.Store.Tag.prototype.encode(this.props.name),ref:"name",className:"name",onClick:this.props.onTagClick},this.props.name),a)}}),Namespace("Imgur.Tag.Store"),Imgur.Tag.Store.Suggestion=Class.extend({init:function(a,b){this._={tagValidator:b,emitter:a,suggestions:[],query:"",lastFinishedQuery:"",validationMode:"query",loading:!1}},getIsLoading:function(){return this._.loading},setIsLoading:function(a){this._.loading=a,this._.emitter.trigger("new suggestions")},setValidationMode:function(a){this._.validationMode=a,this._.emitter.trigger("new suggest validation mode")},getIsValidQuery:function(a){return this._.tagValidator.isValidTag(this._.validationMode,a)},getWhyNot:function(a){return this._.tagValidator.whyNot(this._.validationMode,a)},getQuery:function(){return this._.query.toLowerCase()},getLastFinishedQuery:function(){return this._.lastFinishedQuery},setLastFinishedQuery:function(a){this._.lastFinishedQuery=a,this._.emitter.trigger("new finished query")},setQuery:function(a){this._.query=a,this._.emitter.trigger("new suggest query")},getSuggestions:function(){return this._.suggestions},setSuggestions:function(a){this._.suggestions=a,this._.emitter.trigger("new suggestions")},addSuggestion:function(a){this._.suggestions.push(a),this._.emitter.trigger("new suggestions")},clear:function(){this._.suggestions=[],this._.emitter.trigger("new suggestions")}}),Namespace("Imgur.Tag.Store"),Imgur.Tag.Store.CurrentImage=Class.extend({init:function(a){this._={emitter:a,currentImage:null}},setCurrentImage:function(a){this._.currentImage=a,this._.emitter.trigger("current image updated")},getCurrentImage:function(){return this._.currentImage},getCurrentImageId:function(){return this._.currentImage?this._.currentImage.hash:null}}),Namespace("Imgur.Tag.Store"),Imgur.Tag.Store.Group=Class.extend({init:function(a,b){this._={emitter:a,groups:b||{}}},getGroups:function(){return _.filter(_.values(this._.groups),function(a){return!a.deleted})},getGroup:function(a){return this._.groups[a]},haveGroup:function(a){return this._.groups.hasOwnProperty(a)&&!this._.groups[a].deleted},addGroup:function(a){this._.groups[a.hash]=a,this._.emitter.trigger("new group added")},removeGroup:function(a){this._.groups.hasOwnProperty(a)&&delete this._.groups[a],this._.emitter.trigger("group deleted")},markDeleted:function(a){this._.groups.hasOwnProperty(a)&&(this._.groups[a].deleted=!0),this._.emitter.trigger("group deleted")}}),Namespace("Imgur.Tag.Store"),Imgur.Tag.Store.TagImage=Class.extend({SOURCE:{DEFAULT:"default",GALLERY_PAGE:"page",SUGGESTION:"suggestion",USER:"user"},init:function(a){this._={emitter:a,tagsByHash:{},ajaxErrors:{},isLoading:!1}},setAjaxError:function(a,b){this._.ajaxErrors[a]=b,this._.emitter.trigger("ajax error added to post")},unsetAjaxError:function(a){delete this._.ajaxErrors[a],this._.emitter.trigger("ajax error removed from post")},getAjaxError:function(a){return this._.ajaxErrors.hasOwnProperty(a)?this._.ajaxErrors[a]:null},getIsLoading:function(){return this._.isLoading},setIsLoading:function(a){this._.isLoading=!!a,this._.emitter.trigger("ajax tag loading finished")},isTagOnPost:function(a,b){return this._.tagsByHash.hasOwnProperty(a)?this._.tagsByHash[a].hasOwnProperty(b):!1},getTagsForPost:function(a){return this._.tagsByHash.hasOwnProperty(a)?this._.tagsByHash[a]:[]},haveTagsForPost:function(a){return this._.tagsByHash.hasOwnProperty(a)},addTagForPost:function(a,b,c){if(this._.tagsByHash.hasOwnProperty(a)||(this._.tagsByHash[a]={}),this._.tagsByHash[a].hasOwnProperty(b)){var d=this._.tagsByHash[a][b].source;c=_.merge({},this._.tagsByHash[a][b],c,{source:d})}this._.tagsByHash[a][b]=c,this._.emitter.trigger("tag added to post")},removeTagFromPost:function(a,b){this._.tagsByHash.hasOwnProperty(a)&&this._.tagsByHash[a].hasOwnProperty(b)&&delete this._.tagsByHash[a][b],this._.emitter.trigger("tag removed from post")},getTag:function(a,b){if(!this._.tagsByHash.hasOwnProperty(a))return null;if(!this._.tagsByHash[a].hasOwnProperty(b))return null;var c=this._.tagsByHash[a][b];return c},_getTagProp:function(a,b,c){if(!this._.tagsByHash.hasOwnProperty(a))return null;if(!this._.tagsByHash[a].hasOwnProperty(b))return null;var b=this._.tagsByHash[a][b];return b[c]},_setTagProp:function(a,b,c,d){if(this._.tagsByHash.hasOwnProperty(a)&&this._.tagsByHash[a].hasOwnProperty(b)){var b=this._.tagsByHash[a][b];b[c]=d,this._.emitter.trigger("image tag updated")}},getTagVote:function(a,b){return this._getTagProp(a,b,"vote")},setTagVote:function(a,b,c){this._setTagProp(a,b,"vote",c)},setTagSource:function(a,b,c){this._setTagProp(a,b,"source",c)}}),Namespace("Imgur.Tag.Store"),Imgur.Tag.Store.Tag=Class.extend({INTERESTING_FIELDS:["tag","subscribers","images"],init:function(a,b){this._={emitter:a,tags:{},limit:b||0}},getTag:function(a){return this._.tags[a]},getTags:function(){return this._.tags},haveTag:function(a){return this._.tags.hasOwnProperty(a)},getTagSubscribers:function(a){return this._.tags.hasOwnProperty(a)&&this._.tags[a].hasOwnProperty("subscribers")?this._.tags[a].subscribers:"n/a"},addTag:function(a){if(0==this._.limit||Object.keys(this.getTags()).length!=this._.limit){var b={};this._.tags.hasOwnProperty(a.tag)&&(b=this._.tags[a.tag]),a=_.pick(a,this.INTERESTING_FIELDS),this._.tags[a.tag]=_.merge({},b,a),this._.emitter.trigger("tag updated")}else this._.emitter.trigger("tag limit reached")},removeTag:function(a){delete this._.tags[a],this._.emitter.trigger("tag removed")},setFollowing:function(a,b){var c=this.getTag(a);c&&(c.following=b)},encode:function(a){return encodeURIComponent(a.replace(new RegExp(" ","g"),"_"))}}),Namespace("Imgur.Tag.Store"),Imgur.Tag.Store.TagGroup=Class.extend({ACTIONS:{ADDED:"added",REMOVED:"removed",ERROR:"error",BLOCKED:"blocked",UNBLOCKED:"unblocked"},init:function(a){this._={emitter:a,groupsByTag:{},tagsByGroup:{},pendingAddTags:{},groupsEventHistory:{},failedTag:""}},isTagBlocked:function(a){return this.isTagInGroup(a,"[blocked]")},block:function(a){this.addTagToGroup(a,"[blocked]")},unblock:function(a){this.removeTagFromGroup(a,"[blocked]")},pushHistory:function(a,b,c){this._.groupsEventHistory.hasOwnProperty(a)||(this._.groupsEventHistory[a]={}),this._.groupsEventHistory[a].hasOwnProperty(b)||(this._.groupsEventHistory[a][b]=[]),this._.groupsEventHistory[a][b].push({time:Date.now(),action:c}),this._.emitter.trigger("new tag-group event")},getLatestTagGroupEvent:function(a,b){if(!this._.groupsEventHistory.hasOwnProperty(a)||!this._.groupsEventHistory[a].hasOwnProperty(b))return null;var c=this._.groupsEventHistory[a][b],d=c[c.length-1];return d},isTagInGroup:function(a,b){return this._.groupsByTag.hasOwnProperty(a)?-1!==this._.groupsByTag[a].indexOf(b)||this._.pendingAddTags.hasOwnProperty(b)&&-1!==this._.pendingAddTags[b].indexOf(a):!1},getTagsForGroup:function(a){return this._.tagsByGroup.hasOwnProperty(a)?this._.pendingAddTags.hasOwnProperty(a)?this._.tagsByGroup[a].concat(this._.pendingAddTags[a]):this._.tagsByGroup[a]:[]},getGroupHashesForTag:function(a){return this._.groupsByTag.hasOwnProperty(a)?this._.groupsByTag[a]:[]},addTagToGroup:function(a,b){this._.groupsByTag.hasOwnProperty(a)||(this._.groupsByTag[a]=[]),this._.tagsByGroup.hasOwnProperty(b)||(this._.tagsByGroup[b]=[]),this._.groupsByTag[a].push(b),this._.tagsByGroup[b].push(a),this._.emitter.trigger("tag added to group")},removeTagFromGroup:function(a,b){this._.groupsByTag.hasOwnProperty(a)&&(this._.groupsByTag[a]=_.filter(this._.groupsByTag[a],function(a){return a!=b})),this._.tagsByGroup.hasOwnProperty(b)&&(this._.tagsByGroup[b]=_.filter(this._.tagsByGroup[b],function(b){return b!=a})),this._.emitter.trigger("tag removed from group")},addPendingTag:function(a,b){this._.pendingAddTags[b]&&this._.pendingAddTags[b].length?this._.pendingAddTags[b].push(a):this._.pendingAddTags[b]=[a],this._.emitter.trigger("pending tag added to group")},removePendingTag:function(a,b){var c=this._.pendingAddTags[b].indexOf(a);c>-1&&(this._.pendingAddTags[b].splice(c,1),this._.emitter.trigger("pending tag removed from group"))},isPending:function(a,b){return this._.pendingAddTags.hasOwnProperty(b)?_.contains(this._.pendingAddTags[b],a):!1},getFailedTag:function(){return this._.failedTag},setFailedTag:function(a){this._.failedTag=a},getTags:function(){return this._.groupsByTag}}),Namespace("Imgur.Tag.Store"),Imgur.Tag.Store.OutsideActiveTag=Class.extend({init:function(a){this._={emitter:a,activeTag:null}},getIsActive:function(){return null!=this._.activeTag},getActiveTag:function(){return this._.activeTag},getActiveTagEncoded:function(){return this._.activeTag.replace(new RegExp(" ","g"),"_")},setActiveTag:function(a,b){this._.activeTag=a,this._.emitter.trigger("new outside active tag",!!b)},deactivate:function(a){this._.activeTag=null,this._.emitter.trigger("new outside active tag",!!a)}}),Namespace("Imgur.Tag.Controller"),Imgur.Tag.Controller.InsideTaggingWidget=Class.extend({init:function(a){this._={widget:a}},handleTabToggle:function(a){$(a.target).closest("#tag-container, .tag").length||(this._.widget.isOpen()?(this._.widget.hide(),$(".tipsy").remove()):this._.widget.popup())}}),Namespace("Imgur.Tag.Controller"),Imgur.Tag.Controller.InsideComponent=Class.extend({init:function(a,b,c,d,e,f,g,h,i){this._={signed:a,signin:b,tagImageStore:c,currentImageStore:d,suggestionModel:f,suggestionStore:h,alternativesModel:e,tagStore:i,voteModel:g,haveFetched:[]}},handleChangedQuery:function(){var a=this._.suggestionStore.getQuery();this._.suggestionStore.setIsLoading(!0),this._.suggestionModel.cancel(),this._.suggestionModel.fetch(a,_.bind(this._handleSuggestResponse,this),_.bind(this._handleSuggestError,this,a))},_handleSuggestResponse:function(a,b){this._.suggestionStore.setSuggestions(b);for(var c=0;c<b.length;c++)this._.tagStore.addTag(b[c]);this._.suggestionStore.setIsLoading(!1),this._.suggestionStore.setLastFinishedQuery(a)},_handleSuggestError:function(a){this._.suggestionStore.setIsLoading(!1),this._.suggestionStore.setLastFinishedQuery(a)},handleUpdateTagBox:function(){var a=this._.currentImageStore.getCurrentImageId();this._.suggestionStore.setValidationMode("query"),this._.suggestionStore.setQuery(""),-1==this._.haveFetched.indexOf(a)&&(this._.alternativesModel.fetch(a,!0),this._.haveFetched.push(a))},handleVote:function(a,b,c,d){this._.signed?this._.voteModel.changeVote(a,b,c,d,_.bind(this._handleVoteFail,this,a,b,c)):this._.signin({invokedRegisterSigninBy:"voteAttempt",type:"tag"})},_handleVoteFail:function(a,b,c,d){if("success"!=d){this._.tagImageStore.setAjaxError(a,d);var e=this._.tagImageStore.getTag(a,b);e&&e.source==Imgur.Tag.Store.TagImage.prototype.SOURCE.USER&&this._.tagImageStore.removeTagFromPost(a,b)}},handleDeleteTag:function(a,b){this._.signed&&(this._.voteModel.deleteTag(a,b),this._.tagImageStore.removeTagFromPost(a,b))},handleReportTag:function(a,b){this._.signed&&this._.voteModel.reportTag(a,b,_.noop,_.noop)}}),Namespace("Imgur.Tag.Controller"),Imgur.Tag.Controller.OutsideComponent=Class.extend({init:function(a,b){this._={suggestionModel:a,suggestionStore:b}},handleChangedQuery:function(){var a=this._.suggestionStore.getQuery();this._.suggestionStore.setIsLoading(!0),this._.suggestionModel.cancel(),this._.suggestionModel.fetch(a,_.bind(this._handleSuggestResponse,this),_.bind(this._handleSuggestError,this,a))},_handleSuggestResponse:function(a,b){this._.suggestionStore.setSuggestions(b),this._.suggestionStore.setIsLoading(!1),this._.suggestionStore.setLastFinishedQuery(a)},_handleSuggestError:function(a){this._.suggestionStore.setLastFinishedQuery(a),this._.suggestionStore.setIsLoading(!1)}}),Namespace("Imgur.Tag.Controller"),Imgur.Tag.Controller.GroupSelectorValidator=Class.extend({init:function(a,b,c){this._={validator:b,groupSelector:a,el:{$input:c}}},handleInputEvent:function(){var a=this._.el.$input.val();this._.validator.isValidGroup("query",a)?this._.groupSelector.hideError(this._.validator.whyNot("query",a)):this._.groupSelector.showError(this._.validator.whyNot("query",a))}}),Namespace("Imgur.Tag.Controller"),Imgur.Tag.Controller.UserGroup=Class.extend({init:function(a,b,c,d,e,f,g,h){this._={groupModel:b,activeGroupId:c,group:d,groupList:e,emitter:a,cboxConfirm:f,confirmTarget:"#colorbox-confirm",el:{$confirmMessage:g,$confirmTitle:h}}},handleRemoveConfirmedEvent:function(){this._.group.remove(),this._.emitter.trigger("group.remove",this._.group.getId()),this._.group.getId()==this._.activeGroupId&&this._.emitter.trigger("command.location","/")},handleRemoveEvent:function(a){a.stopPropagation(),this._.el.$confirmTitle.html("Delete "+this._.group.getName()+"?"),this._.el.$confirmMessage.html('Are you sure you want to delete the gallery <span class="green">'+this._.group.getName()+"</span>?"),this._.cboxConfirm.show(this._.confirmTarget,_.bind(this.handleRemoveConfirmedEvent,this,a))},handleRemovedTagEvent:function(a,b){b.stopPropagation(),this._.groupList.remove(a),this._.groupList.removeCoreSet(a),this._.groupModel.unsubscribe(this._.group.getId(),a.getName(),_.bind(function(){this._.emitter.trigger("new tagset")},this)),this._.emitter.trigger("show tagset loader")},handleRemoveEventOther:function(a){a==this._.group.getId()&&this._.group.remove()},setList:function(a){this._.groupList=a,this._.group.setList(a)}}),Namespace("Imgur.Tag.Controller"),Imgur.Tag.Controller.EmptyQueryMessage=Class.extend({init:function(a){this._={newTagController:a}},handleChosenEvent:function(a){$(a.target).attr("data-query");this._.newTagController.handleSubmitEvent()}}),Namespace("Imgur.Tag.Controller"),Imgur.Tag.Controller.GroupSelectorLimits=Class.extend({init:function(a,b,c){this._={emitter:a,groupSelector:b,groupStore:c}},_disableNew:function(){this._.groupSelector.disableNewGroupButton()},_enableNew:function(){this._.groupSelector.enableNewGroupButton()},handleGroupRemove:function(a){this._.groupSelector.removeUserGroup(a),this._.groupStore.markDeleted(a),this._.groupSelector.getRemainingUserGroups()>0&&this._enableNew()},handleGroupAdd:function(a){this._.groupSelector.addUserGroup(a),this._.groupStore.addGroup({hash:a.getId(),name:a.getName(),account_id:Imgur.Environment.auth.id,account_url:Imgur.Environment.auth.url}),this._.groupSelector.getRemainingUserGroups()<=0&&this._disableNew()}}),Namespace("Imgur.Tag.Controller"),Imgur.Tag.Controller.Hotkeys=Class.extend({KEYCODES:{KEY_T:84,KEY_ESC:27},init:function(a,b){this._={taggingWidget:a,el:{$tagging:b}}},handleKeyUp:function(a){var b=this._.el.$tagging.find("input"),c={el:{text:$(a.target).is("input")||$(a.target).is("textarea"),focusbox:!!$(a.target).is(b)},key:{esc:a.keyCode===Object.getPrototypeOf(this).KEYCODES.KEY_ESC,t:a.keyCode===Object.getPrototypeOf(this).KEYCODES.KEY_T},modifier:!!a.metaKey||!!a.ctrlKey||!!a.altKey};c.key.esc&&!c.el.focusbox&&c.el.text||!c.key.esc&&c.el.text||c.modifier||(c.key.t?this._.taggingWidget.popup():c.key.esc&&this._.taggingWidget.hide())}}),Namespace("Imgur.Tag"),Imgur.Tag.SuggestedTag=Imgur.Tag.Tag.extend({VOTE_UP:"up",init:function(a,b){this._super(a),this._.groupId=b,this._.el.$addBtn=a,this._.el.$subscribers=a.find(".subscribers")},getGroupId:function(){return this._.groupId},get$Add:function(){return this._.el.$addBtn},getSubscribers:function(){return Number(this._.el.$subscribers.attr("data-subscribers"))},get$ExternalLink:function(){return this._.el.$container.find(".external-link")}}),Imgur.Flash=React.createClass({displayName:"Flash",getDefaultProps:function(){return{delay:1e3}},getInitialState:function(){return{visible:!1}},componentWillReceiveProps:function(a){(a.start!==this.props.start||a.delay!==this.props.delay)&&(this._installTimer(a.start),this.setState({visible:!0}))},_getDuration:function(a){return Math.max(0,a+this.props.delay-+new Date)},componentDidMount:function(){this._getDuration(this.props.start)>0&&(this._installTimer(this.props.start),this.setState({visible:!0}))},_installTimer:function(a){null!==this._timer&&(window.clearTimeout(this._timerRef),this._timerRef=null);var b=this._getDuration(a);this._timerRef=window.setTimeout(_.bind(this._handleTimerExpired,this),b)},_handleTimerExpired:function(){this.setState({visible:!1}),this._timerRef=null},render:function(){return React.createElement(React.addons.CSSTransitionGroup,{transitionName:"flash"},this.state.visible?React.DOM.div(null,this.props.children):null)}}),Namespace("Imgur.Elements"),Imgur.Elements.Report=React.createClass({displayName:"ElementsReport",strings:{abuse:"Abusive/Offensive",abuseExplanation:"Racism, sexism, slurs, personal attacks, death threats, suicide requests, or any form of hate speech.",cancel:"Nevermind",dboi:"Doesn't belong on Imgur",dboiExplanation:"Posts condoning illegal activity, suicide threats, personal information, or anything else you think doesn't belong on Imgur.",defaultCombobox:"SELECT A REASON",explanationHeader:"What is ",explicit:"Sexually Explicit",explicitExplanation:"Content may include the explicit display of sexual organs especially intended to stimulate erotic feelings, full or partial nudity, any depiction of sexual activity, softcore or hardcore pornography.",mature:"Mature post not marked as mature",matureExplanation:"Sexually suggestive, not suitable for work, or intended for a mature audience.",reportHeading:"Report Submission.",reportPrompt:"Why do you want to report this?",spam:"Spam",spamExplanation:"Clickbait, advertising, scams, script bots, etc."},getInitialState:function(){return{name:"",value:""}},getDefaultProps:function(){return{metadata:{}}},shouldComponentUpdate:function(a,b){return this.state.value!==b.value},handleSubmit:function(a){if(a.preventDefault(),this.state.value){var b={sid:Imgur.Environment.msid,type:this.state.value,hash:this.props.metadata.hash};this.props.metadata.isAlbum&&(b.isAlbum=!0),Imgur.Util.jafoLog({event:"report",meta:this.props.metadata}),$.post(this.props.url,b),Imgur.Gallery.getInstance().preventCloseAnalytics(),$.colorbox.close(),humanMsg.displayMsg("Thanks for reporting!"),"function"==typeof this.props.cb&&this.props.cb()}},handleNvm:function(){Imgur.Gallery.getInstance().preventCloseAnalytics(),$.colorbox.close(),Imgur.Util.jafoLog({event:"reportCancel",meta:_.extend({method:"nvmButton"},this.props.metadata)})},setValue:function(a,b){this.setState({name:a,value:b})},render:function(){var a=[{label:this.strings.explicit,value:5},{label:this.strings.mature,value:4,nsfw:!1},{label:this.strings.abuse,value:3},{label:this.strings.spam,value:2},{label:this.strings.dboi,value:1}];this.props.metadata.nsfw&&(a=a.filter(function(a){return a.nsfw!==!1}));var b="";switch(this.state.value){case"1":b=this.strings.dboiExplanation;break;case"2":b=this.strings.spamExplanation;break;case"3":b=this.strings.abuseExplanation;break;case"4":b=this.strings.matureExplanation;break;case"5":b=this.strings.explicitExplanation}var c=""!==this.state.value?React.DOM.div({id:"report-rules"},React.DOM.p({className:"explanationHeader font-opensans-semibold indent"},'What is "'+this.state.name+'"?'),React.DOM.p({className:"explanationDescription font-opensans-reg indent"},b),React.DOM.p({className:"indent"},"Remember our ",React.DOM.a({target:"_blank",href:"http://imgur.com/rules"},"community rules"))):null;return React.DOM.div({},React.DOM.h2({},this.strings.reportHeading),React.DOM.p({},this.strings.reportPrompt),React.createElement(Imgur.Elements.Combobox,{name:"report-option",onChange:this.setValue,className:"",defaultValue:this.strings.defaultCombobox,value:this.strings.defaultCombobox,values:a}),c,React.DOM.button({className:"btn-action btn-small right",type:"button",onClick:this.handleSubmit},"Report"),React.DOM.a({className:"nvm pointer right",onClick:this.handleNvm},"Nevermind"),React.DOM.div({className:"clear"}))}}),function(a){var b=function(){var b='<div class="colpick"><div class="colpick_color"><div class="colpick_color_overlay1"><div class="colpick_color_overlay2"><div class="colpick_selector_outer"><div class="colpick_selector_inner"></div></div></div></div></div><div class="colpick_hue"><div class="colpick_hue_arrs"><div class="colpick_hue_larr"></div><div class="colpick_hue_rarr"></div></div></div><div class="colpick_new_color"></div><div class="colpick_current_color"></div><div class="colpick_hex_field"><div class="colpick_field_letter">#</div><input type="text" maxlength="6" size="6" /></div><div class="colpick_rgb_r colpick_field"><div class="colpick_field_letter">R</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_g colpick_field"><div class="colpick_field_letter">G</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_rgb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_h colpick_field"><div class="colpick_field_letter">H</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_s colpick_field"><div class="colpick_field_letter">S</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_hsb_b colpick_field"><div class="colpick_field_letter">B</div><input type="text" maxlength="3" size="3" /><div class="colpick_field_arrs"><div class="colpick_field_uarr"></div><div class="colpick_field_darr"></div></div></div><div class="colpick_submit"></div></div>',c={showEvent:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},colorScheme:"light",color:"3289c7",livePreview:!0,flat:!1,layout:"full",submit:1,submitText:"OK",height:156},g=function(b,c){var d=f(b);a(c).data("colpick").fields.eq(1).val(d.r).end().eq(2).val(d.g).end().eq(3).val(d.b).end()},i=function(b,c){a(c).data("colpick").fields.eq(4).val(Math.round(b.h)).end().eq(5).val(Math.round(b.s)).end().eq(6).val(Math.round(b.b)).end()},j=function(b,c){a(c).data("colpick").fields.eq(0).val(h(b))},k=function(b,c){a(c).data("colpick").selector.css("backgroundColor","#"+h({h:b.h,s:100,b:100})),a(c).data("colpick").selectorIndic.css({left:parseInt(a(c).data("colpick").height*b.s/100,10),top:parseInt(a(c).data("colpick").height*(100-b.b)/100,10)})},l=function(b,c){a(c).data("colpick").hue.css("top",parseInt(a(c).data("colpick").height-a(c).data("colpick").height*b.h/360,10))},m=function(b,c){a(c).data("colpick").currentColor.css("backgroundColor","#"+h(b))},n=function(b,c){a(c).data("colpick").newColor.css("backgroundColor","#"+h(b))},o=function(){var b,c=a(this).parent().parent();this.parentNode.className.indexOf("_hex")>0?(c.data("colpick").color=b=d(G(this.value)),g(b,c.get(0)),i(b,c.get(0))):this.parentNode.className.indexOf("_hsb")>0?(c.data("colpick").color=b=E({h:parseInt(c.data("colpick").fields.eq(4).val(),10),s:parseInt(c.data("colpick").fields.eq(5).val(),10),b:parseInt(c.data("colpick").fields.eq(6).val(),10)}),g(b,c.get(0)),j(b,c.get(0))):(c.data("colpick").color=b=e(F({r:parseInt(c.data("colpick").fields.eq(1).val(),10),g:parseInt(c.data("colpick").fields.eq(2).val(),10),b:parseInt(c.data("colpick").fields.eq(3).val(),10)})),j(b,c.get(0)),i(b,c.get(0))),k(b,c.get(0)),l(b,c.get(0)),n(b,c.get(0)),c.data("colpick").onChange.apply(c.parent(),[b,h(b),f(b),c.data("colpick").el,0])},p=function(){a(this).parent().removeClass("colpick_focus")},q=function(){a(this).parent().parent().data("colpick").fields.parent().removeClass("colpick_focus"),a(this).parent().addClass("colpick_focus")},r=function(b){b.preventDefault?b.preventDefault():b.returnValue=!1;var c=a(this).parent().find("input").focus(),d={el:a(this).parent().addClass("colpick_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:b.pageY,field:c,val:parseInt(c.val(),10),preview:a(this).parent().parent().data("colpick").livePreview};a(document).mouseup(d,t),a(document).mousemove(d,s)},s=function(a){return a.data.field.val(Math.max(0,Math.min(a.data.max,parseInt(a.data.val-a.pageY+a.data.y,10)))),a.data.preview&&o.apply(a.data.field.get(0),[!0]),!1},t=function(b){return o.apply(b.data.field.get(0),[!0]),b.data.el.removeClass("colpick_slider").find("input").focus(),a(document).off("mouseup",t),a(document).off("mousemove",s),!1},u=function(b){b.preventDefault?b.preventDefault():b.returnValue=!1;var c={cal:a(this).parent(),y:a(this).offset().top};a(document).on("mouseup touchend",c,w),a(document).on("mousemove touchmove",c,v);var d="touchstart"==b.type?b.originalEvent.changedTouches[0].pageY:b.pageY;return o.apply(c.cal.data("colpick").fields.eq(4).val(parseInt(360*(c.cal.data("colpick").height-(d-c.y))/c.cal.data("colpick").height,10)).get(0),[c.cal.data("colpick").livePreview]),!1},v=function(a){var b="touchmove"==a.type?a.originalEvent.changedTouches[0].pageY:a.pageY;return o.apply(a.data.cal.data("colpick").fields.eq(4).val(parseInt(360*(a.data.cal.data("colpick").height-Math.max(0,Math.min(a.data.cal.data("colpick").height,b-a.data.y)))/a.data.cal.data("colpick").height,10)).get(0),[a.data.preview]),!1},w=function(b){return g(b.data.cal.data("colpick").color,b.data.cal.get(0)),j(b.data.cal.data("colpick").color,b.data.cal.get(0)),a(document).off("mouseup touchend",w),a(document).off("mousemove touchmove",v),!1},x=function(b){b.preventDefault?b.preventDefault():b.returnValue=!1;var c={cal:a(this).parent(),pos:a(this).offset()};c.preview=c.cal.data("colpick").livePreview,a(document).on("mouseup touchend",c,z),a(document).on("mousemove touchmove",c,y);var d;return"touchstart"==b.type?(pageX=b.originalEvent.changedTouches[0].pageX,d=b.originalEvent.changedTouches[0].pageY):(pageX=b.pageX,d=b.pageY),o.apply(c.cal.data("colpick").fields.eq(6).val(parseInt(100*(c.cal.data("colpick").height-(d-c.pos.top))/c.cal.data("colpick").height,10)).end().eq(5).val(parseInt(100*(pageX-c.pos.left)/c.cal.data("colpick").height,10)).get(0),[c.preview]),!1},y=function(a){var b;return"touchmove"==a.type?(pageX=a.originalEvent.changedTouches[0].pageX,b=a.originalEvent.changedTouches[0].pageY):(pageX=a.pageX,b=a.pageY),o.apply(a.data.cal.data("colpick").fields.eq(6).val(parseInt(100*(a.data.cal.data("colpick").height-Math.max(0,Math.min(a.data.cal.data("colpick").height,b-a.data.pos.top)))/a.data.cal.data("colpick").height,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(a.data.cal.data("colpick").height,pageX-a.data.pos.left))/a.data.cal.data("colpick").height,10)).get(0),[a.data.preview]),!1},z=function(b){return g(b.data.cal.data("colpick").color,b.data.cal.get(0)),j(b.data.cal.data("colpick").color,b.data.cal.get(0)),a(document).off("mouseup touchend",z),a(document).off("mousemove touchmove",y),!1},A=function(){var b=a(this).parent(),c=b.data("colpick").color;b.data("colpick").origColor=c,m(c,b.get(0)),b.data("colpick").onSubmit(c,h(c),f(c),b.data("colpick").el)},B=function(b){b.stopPropagation();var c=a("#"+a(this).data("colpickId"));c.data("colpick").onBeforeShow.apply(this,[c.get(0)]);var d=a(this).offset(),e=d.top+this.offsetHeight,f=d.left,g=D(),h=c.width();f+h>g.l+g.w&&(f-=h),c.css({left:f+"px",top:e+"px"}),0!=c.data("colpick").onShow.apply(this,[c.get(0)])&&c.show(),a("html").mousedown({cal:c},C),c.mousedown(function(a){a.stopPropagation()})},C=function(b){0!=b.data.cal.data("colpick").onHide.apply(this,[b.data.cal.get(0)])&&b.data.cal.hide(),a("html").off("mousedown",C)
},D=function(){var a="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(a?document.documentElement.scrollLeft:document.body.scrollLeft),w:window.innerWidth||(a?document.documentElement.clientWidth:document.body.clientWidth)}},E=function(a){return{h:Math.min(360,Math.max(0,a.h)),s:Math.min(100,Math.max(0,a.s)),b:Math.min(100,Math.max(0,a.b))}},F=function(a){return{r:Math.min(255,Math.max(0,a.r)),g:Math.min(255,Math.max(0,a.g)),b:Math.min(255,Math.max(0,a.b))}},G=function(a){var b=6-a.length;if(b>0){for(var c=[],d=0;b>d;d++)c.push("0");c.push(a),a=c.join("")}return a},H=function(){var b=a(this).parent(),c=b.data("colpick").origColor;b.data("colpick").color=c,g(c,b.get(0)),j(c,b.get(0)),i(c,b.get(0)),k(c,b.get(0)),l(c,b.get(0)),n(c,b.get(0))};return{init:function(f){if(f=a.extend({},c,f||{}),"string"==typeof f.color)f.color=d(f.color);else if(void 0!=f.color.r&&void 0!=f.color.g&&void 0!=f.color.b)f.color=e(f.color);else{if(void 0==f.color.h||void 0==f.color.s||void 0==f.color.b)return this;f.color=E(f.color)}return this.each(function(){if(!a(this).data("colpickId")){var c=a.extend({},f);c.origColor=f.color;var d="collorpicker_"+parseInt(1e3*Math.random());a(this).data("colpickId",d);var e=a(b).attr("id",d);e.addClass("colpick_"+c.layout+(c.submit?"":" colpick_"+c.layout+"_ns")),"light"!=c.colorScheme&&e.addClass("colpick_"+c.colorScheme),e.find("div.colpick_submit").html(c.submitText).click(A),c.fields=e.find("input").change(o).blur(p).focus(q),e.find("div.colpick_field_arrs").mousedown(r).end().find("div.colpick_current_color").click(H),c.selector=e.find("div.colpick_color").on("mousedown touchstart",x),c.selectorIndic=c.selector.find("div.colpick_selector_outer"),c.el=this,c.hue=e.find("div.colpick_hue_arrs"),huebar=c.hue.parent();var h=navigator.userAgent.toLowerCase(),s="Microsoft Internet Explorer"===navigator.appName,t=s?parseFloat(h.match(/msie ([0-9]{1,}[\.0-9]{0,})/)[1]):0,v=s&&10>t,w=["#ff0000","#ff0080","#ff00ff","#8000ff","#0000ff","#0080ff","#00ffff","#00ff80","#00ff00","#80ff00","#ffff00","#ff8000","#ff0000"];if(v){var y,z;for(y=0;11>=y;y++)z=a("<div></div>").attr("style","height:8.333333%; filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr="+w[y]+", endColorstr="+w[y+1]+'); -ms-filter: "progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='+w[y]+", endColorstr="+w[y+1]+')";'),huebar.append(z)}else stopList=w.join(","),huebar.attr("style","background:-webkit-linear-gradient(top,"+stopList+"); background: -o-linear-gradient(top,"+stopList+"); background: -ms-linear-gradient(top,"+stopList+"); background:-moz-linear-gradient(top,"+stopList+"); -webkit-linear-gradient(top,"+stopList+"); background:linear-gradient(to bottom,"+stopList+"); ");e.find("div.colpick_hue").on("mousedown touchstart",u),c.newColor=e.find("div.colpick_new_color"),c.currentColor=e.find("div.colpick_current_color"),e.data("colpick",c),g(c.color,e.get(0)),i(c.color,e.get(0)),j(c.color,e.get(0)),l(c.color,e.get(0)),k(c.color,e.get(0)),m(c.color,e.get(0)),n(c.color,e.get(0)),c.flat?(e.appendTo(this).show(),e.css({position:"relative",display:"block"})):(e.appendTo(document.body),a(this).on(c.showEvent,B),e.css({position:"absolute"}))}})},showPicker:function(){return this.each(function(){a(this).data("colpickId")&&B.apply(this)})},hidePicker:function(){return this.each(function(){a(this).data("colpickId")&&a("#"+a(this).data("colpickId")).hide()})},setColor:function(b,c){if(c="undefined"==typeof c?1:c,"string"==typeof b)b=d(b);else if(void 0!=b.r&&void 0!=b.g&&void 0!=b.b)b=e(b);else{if(void 0==b.h||void 0==b.s||void 0==b.b)return this;b=E(b)}return this.each(function(){if(a(this).data("colpickId")){var d=a("#"+a(this).data("colpickId"));d.data("colpick").color=b,d.data("colpick").origColor=b,g(b,d.get(0)),i(b,d.get(0)),j(b,d.get(0)),l(b,d.get(0)),k(b,d.get(0)),n(b,d.get(0)),d.data("colpick").onChange.apply(d.parent(),[b,h(b),f(b),d.data("colpick").el,1]),c&&m(b,d.get(0))}})}}}(),c=function(a){var a=parseInt(a.indexOf("#")>-1?a.substring(1):a,16);return{r:a>>16,g:(65280&a)>>8,b:255&a}},d=function(a){return e(c(a))},e=function(a){var b={h:0,s:0,b:0},c=Math.min(a.r,a.g,a.b),d=Math.max(a.r,a.g,a.b),e=d-c;return b.b=d,b.s=0!=d?255*e/d:0,b.h=0!=b.s?a.r==d?(a.g-a.b)/e:a.g==d?2+(a.b-a.r)/e:4+(a.r-a.g)/e:-1,b.h*=60,b.h<0&&(b.h+=360),b.s*=100/255,b.b*=100/255,b},f=function(a){var b={},c=a.h,d=255*a.s/100,e=255*a.b/100;if(0==d)b.r=b.g=b.b=e;else{var f=e,g=(255-d)*e/255,h=(f-g)*(c%60)/60;360==c&&(c=0),60>c?(b.r=f,b.b=g,b.g=g+h):120>c?(b.g=f,b.b=g,b.r=f-h):180>c?(b.g=f,b.r=g,b.b=g+h):240>c?(b.b=f,b.r=g,b.g=f-h):300>c?(b.b=f,b.g=g,b.r=g+h):360>c?(b.r=f,b.g=g,b.b=f-h):(b.r=0,b.g=0,b.b=0)}return{r:Math.round(b.r),g:Math.round(b.g),b:Math.round(b.b)}},g=function(b){var c=[b.r.toString(16),b.g.toString(16),b.b.toString(16)];return a.each(c,function(a,b){1==b.length&&(c[a]="0"+b)}),c.join("")},h=function(a){return g(f(a))};a.fn.extend({colpick:b.init,colpickHide:b.hidePicker,colpickShow:b.showPicker,colpickSetColor:b.setColor}),a.extend({colpick:{rgbToHex:g,rgbToHsb:e,hsbToHex:h,hsbToRgb:f,hexToHsb:d,hexToRgb:c}})}(jQuery),function(a){function b(a){return a.replace(/(:|\.)/g,"\\$1")}var c="1.4.7",d={exclude:[],excludeWithin:[],offset:0,direction:"top",scrollElement:null,scrollTarget:null,beforeScroll:function(){},afterScroll:function(){},easing:"swing",speed:400,autoCoefficent:2},e=function(b){var c=[],d=!1,e=b.dir&&"left"==b.dir?"scrollLeft":"scrollTop";return this.each(function(){if(this!=document&&this!=window){var b=a(this);b[e]()>0?c.push(this):(b[e](1),d=b[e]()>0,d&&c.push(this),b[e](0))}}),c.length||this.each(function(){"BODY"===this.nodeName&&(c=[this])}),"first"===b.el&&c.length>1&&(c=[c[0]]),c};a.fn.extend({scrollable:function(a){var b=e.call(this,{dir:a});return this.pushStack(b)},firstScrollable:function(a){var b=e.call(this,{el:"first",dir:a});return this.pushStack(b)},smoothScroll:function(c){c=c||{};var d=a.extend({},a.fn.smoothScroll.defaults,c),e=a.smoothScroll.filterPath(location.pathname);return this.unbind("click.smoothscroll").bind("click.smoothscroll",function(c){var f=this,g=a(this),h=d.exclude,i=d.excludeWithin,j=0,k=0,l=!0,m={},n=location.hostname===f.hostname||!f.hostname,o=d.scrollTarget||(a.smoothScroll.filterPath(f.pathname)||e)===e,p=b(f.hash);if(d.scrollTarget||n&&o&&p){for(;l&&j<h.length;)g.is(b(h[j++]))&&(l=!1);for(;l&&k<i.length;)g.closest(i[k++]).length&&(l=!1)}else l=!1;l&&(c.preventDefault(),a.extend(m,d,{scrollTarget:d.scrollTarget||p,link:f}),a.smoothScroll(m))}),this}}),a.smoothScroll=function(b,c){var d,e,f,g,h=0,i="offset",j="scrollTop",k={},l={};"number"==typeof b?(d=a.fn.smoothScroll.defaults,f=b):(d=a.extend({},a.fn.smoothScroll.defaults,b||{}),d.scrollElement&&(i="position","static"==d.scrollElement.css("position")&&d.scrollElement.css("position","relative"))),d=a.extend({link:null},d),j="left"==d.direction?"scrollLeft":j,d.scrollElement?(e=d.scrollElement,h=e[j]()):e=a("html, body").firstScrollable(),d.beforeScroll.call(e,d),f="number"==typeof b?b:c||a(d.scrollTarget)[i]()&&a(d.scrollTarget)[i]()[d.direction]||0,k[j]=f+h+d.offset,g=d.speed,"auto"===g&&(g=k[j]||e.scrollTop(),g/=d.autoCoefficent),l={duration:g,easing:d.easing,complete:function(){d.afterScroll.call(d.link,d)}},d.step&&(l.step=d.step),e.length?e.stop().animate(k,l):d.afterScroll.call(d.link,d)},a.smoothScroll.version=c,a.smoothScroll.filterPath=function(a){return a.replace(/^\//,"").replace(/(index|default).[a-zA-Z]{3,4}$/,"").replace(/\/$/,"")},a.fn.smoothScroll.defaults=d}(jQuery),this._=this._||{},this._.templates=this._.templates||{},this._.templates["galleryimage.pointInfo"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="point-info left bold',1==item.nsfw&&(__p+=" mature-indicator"),captionsEnabled||(__p+=" nodisplay"),__p+='">\n    <span class="points-'+(null==(__t=item.hash)?"":__t)+'">'+(null==(__t=points[0])?"":__t)+'</span>\n    <span class="points-text-'+(null==(__t=item.hash)?"":__t)+'">'+(null==(__t=points[1])?"":__t)+'</span>\n    <br />\n</div>\n<div class="views-info left',captionsEnabled||(__p+=" js-views-info--center"),__p+='">\n    <span class="views-'+(null==(__t=item.hash)?"":__t)+'">'+(null==(__t=views)?"":__t)+'</span>\n    <span class="views-text-'+(null==(__t=item.hash)?"":__t)+'">view',1!=item.views&&-1!=item.views&&(__p+="s"),__p+="</span>\n</div>";return __p},this._.templates["galleryimage.favoriteBar"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div id="favorite-bar">\r\n    <div original-title="Favorite" class="favorite-image title ',favorited&&(__p+="favorited"),__p+='" href="javascript:;">\r\n        <span class="icon-fav"></span>\r\n    </div>\r\n    <div class="clipboard-container" id="copy-container" title="copy">\r\n        <div class="icon-copy" id="copy-clipboard"></div>\r\n    </div>\r\n    <input type="hidden" id="copy" value="'+(null==(__t=value)?"":__t)+'" readonly="readonly" />\r\n</div>';return __p},this._.templates["tags.tag"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<div class="tag">\n    <span class="tag-name">'+(null==(__t=tag.name)?"":__t)+"</span>\n</div>\n";return __p},this._.templates["tags.tag-removable"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<div class="tag tag-removable pending">\n    <a href="/t/'+(null==(__t=encodeURIComponent(tag.replace(/ /g,"_")))?"":__t)+'" class="name">'+(null==(__t=tag)?"":__t)+'</a>\n    <a href="javascript:void(0)" class="remove"></a>\n</div>\n';return __p},this._.templates["tags.tag-suggested"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="tag suggested',is_first&&(__p+=" is-first"),__p+='">\n    <span class="name">'+(null==(__t=tag.name)?"":__t)+'</span>\n    <div class="add">\n        <span class="plus-icon"></span>\n    </div>\n    <div class="right-bar">\n	    <span data-subscribers="'+(null==(__t=tag.subscribers)?"":__t)+'" class="subscribers" title="subscribers">'+(null==(__t=Imgur.Util.truncatedNumberFormat(tag.subscribers))?"":__t)+'</span>\n	    <a class="external-link" title="open in new tab" target="_blank" href="/t/'+(null==(__t=tag.urlencoded)?"":__t)+'"></a>\n    </div>\n</div>\n\n';return __p},this._.templates["tags.tag-gallery-image"]=function(obj){obj||(obj={});{var __t,__p="";_.escape,Array.prototype.join}with(obj)__p+='<div class="tag tag-gallery-image" data-group-ids="'+(null==(__t=group_lines_attr)?"":__t)+'">\n    <div class="votes">\n        <div class="vote agree',"up"===tag.vote&&(__p+=" green"),__p+='"></div>\n        <div class="vote disagree',"down"===tag.vote&&(__p+=" red"),__p+='"></div>\n        <div class="clear"></div>\n    </div>\n    <div class="name">'+(null==(__t=tag.name)?"":__t)+'</div>\n    <div class="score"></div>\n    <div class="right-bar">\n    	<div class="subscribers" title="subscribers">'+(null==(__t=Imgur.Util.truncatedNumberFormat(tag.subscribers))?"":__t)+"</div>\n    </div>\n</div>\n";return __p},this._.templates["tags.empty-message-makeone"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<p class="empty">\n    No tag like <em>'+(null==(__t=query)?"":__t)+'</em> found.\n\n    <a\n        class="tag-create-from-empty-query"\n        data-query="'+(null==(__t=query)?"":__t)+'"\n        href="javascript:void(0)">Make it!</a>\n</p>\n';return __p},this._.templates["tags.user-group"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<div class="item" value="'+(null==(__t=group.hash)?"":__t)+'">\n    <div data-type="user" value="'+(null==(__t=group.hash)?"":__t)+'">\n        <span class="name">'+(null==(__t=group.name)?"":__t)+'</span>\n        <span class="remove"></span>\n    </div>\n</div>';return __p},this._.templates["tags.combobox-item"]=function(obj){obj||(obj={});{var __t,__p="";_.escape}with(obj)__p+='<div class="item" value="'+(null==(__t=value)?"":__t)+'"></div>\n';return __p},Namespace("Imgur.Promoted"),Imgur.Promoted=Class.extend({init:function(a,b,c,d,e,f){this._={ele:{},config:a,emitter:b,events:e,eventsBound:!1,navs:0,navHashes:[],failMode:!1,reservations:[],ads:{},order:[],pxQueue:[],source:f,rgxSubreddit:/\/r\/([^\/]+)/,inside:c,sectSortWindow:"",sideGallery:d,enabled:Imgur.Gallery.getInstance()._.safe_tags&&!0},b.on("gotPromoted",this,this.handlePlacement),b.on("sidegalleryPageLoad",this,this.handleNewGalleryPage),b.on("navToImage",this,this.handleNav),b.on("displayPromoted",this,this.handleDisplay),b.on("promoEvent",this,this.handleDomEvent)},eventsEval:function(a){a in this._.ads?(this._.events.bindAll(),this._.eventsBound=!0):this._.eventsBound&&(this._.events.bindAll(!0),this._.eventsBound=!1)},handleDomEvent:function(a){var b,c=Imgur.Util.dive(a,"data.promoEvent");if(c)for(_.isArray(c)||(c=[c]),b=0;b<c.length;b++)this.pixel(this._.inside.getHash(),c[b])},handleNav:function(a,b,c){if(this._.enabled&&(this.eventsEval(a),isNaN(this._.navs)&&(this._.navs=0),!(this._.config.skipPromoNav&&a in this._.ads||this._.config.onlyUniqueNavs&&_.indexOf(this._.navHashes,a)>-1))){var d=this._.config.navThreshold;if(2>this._.order.length&&this._.config.populateFirst&&(d=isNaN(this._.config.populateFirstThreshold)?d:this._.config.populateFirstThreshold),this._.navHashes.push(a),this._.navs++,this._.failMode&&this._.navs>this._.config.failThreshold&&(this._.failMode=!1),!this._.failMode&&(b||this._.navs>0&&this._.navs>=d)){this._.navs=0;var e=this._.sideGallery.nthFromHash(isNaN(c)?this._.config.distance:c,a);this._.reservations.push(e),this._.emitter.trigger("wantPromoted",this._.source.getPlacement())}}},handleDisplay:function(a){var b;a in this._.ads&&(b=this._.ads[a],this.pixel(a,"IMPRESSION_POST"),this.pixel(a,"CLICK_THUMB"),this.placeCompanion(a),Imgur.Util.jafoLog({event:"ppConv",meta:{hash:a,flightId:Imgur.Util.dive(b,"parts.thumb.flightId"),campaignId:Imgur.Util.dive(b,"parts.thumb.campaignId")}}))},topicIsFiltered:function(){var a="topic"===this._.inside._.section?this._.inside._.topic:null;return a&&_.indexOf(this._.config.filteredTopics,a)>-1},sectionIsFiltered:function(){var a=this._.sideGallery.state.section in this._.config.filteredSections,b=_.indexOf(this._.config.filteredSections,this._.sideGallery.state.section)>-1;return"subreddit"===this._.sideGallery.state.section?!this.subredditIsAllowed():a||b?"object"==typeof this._.config.filteredSections[this._.sideGallery.state.section]?_.indexOf(this._.config.filteredSections[this._.sideGallery.state.section],this._.sideGallery.state.sort)>-1:!0:!1},subredditIsAllowed:function(){var a=this._.sideGallery.state.source,b=a?a.match(this._.rgxSubreddit):null;return b&&2===b.length?_.indexOf(this._.config.allowedSubreddits,b[1].toLowerCase())>-1:!1},handleNewGallery:function(){var a=isNaN(this._.config.populateFirstDistance)?this._.config.distance:this._.config.populateFirstDistance;if(this.topicIsFiltered())return this._.enabled=!1,void imcon.log("Filtered promo topic.");if(this.sectionIsFiltered())return this._.enabled=!1,void imcon.log("Filtered promo section");if(this._.config.populateFirst){var b=this._.inside.getHash();this.handleNav(b,!0,a)}this._.navs=0},handleNewGalleryPage:function(a){"initial"===a&&this.handleNewGallery()},handlePlacement:function(a){var b=a.getHash(),c=this._.reservations.shift();return b?(c||(imcon.warn("After hash found. Place to end",a),c=this._.sideGallery.state.items[this._.sideGallery.state.items.length-1]),void(b!=this._.inside._.hash&&!(b in this._.ads)&&this._.sideGallery.hashPosition(b)<0?(this._.ads[b]=a,this._.order.push(b),"timestamp"in a.parts.data||(a.parts.data.timestamp=moment().utc().format("YYYY-MM-DD HH:mm:ss")),this._.sideGallery.insertSingleItem(a.parts.data,this._.sideGallery.hashPosition(c)+1),this.pixel(b,"IMPRESSION_THUMB"),Imgur.Util.jafoLog({event:"ppImp",meta:{hash:b,flightId:Imgur.Util.dive(a,"parts.thumb.flightId"),campaignId:Imgur.Util.dive(a,"parts.thumb.campaignId")}}),imcon.log("placement",[a,c])):imcon.warn("Duplicate promo hash to be inserted. Denied.",b))):(imcon.warn("No hash found in placement response.",a),void(this._.failMode=!0))},placeCompanion:function(a){var b=Imgur.Util.dive(this._.ads[a],"parts.companion.html"),c='<div class="promoCompanion"><iframe id="promoCompanionFrame" width="300" height="250" marginwidth="0" marginheight="0" hspace="0" vspace="0" scrolling="no" frameBorder="0" seamless="seamless" sandbox="allow-same-origin allow-scripts allow-popups allow-popups-to-escape-sandbox"></iframe></div>';a in this._.ads&&b&&(""+b).length>0&&(this._.inside.showAds(c,function(a,c){var d,e=document.getElementById("promoCompanionFrame");a&&c&&e&&(d=e.contentWindow.document,d.open(),d.write(b),d.close())}),setTimeout(_.bind(function(){$(".promoCompanion").is(":visible")&&this.pixel(a,"IMPRESSION_COMPANION")},this),800))},pixel:function(a,b,c){var d,e=Imgur.Util.dive(this._.ads,a+".pixels."+b),f=[];if(_.isArray(e))for(d=0;d<e.length;d++)f.push(this.pixelFire(e[d],c,_.extend([],arguments)));return f},pixelFire:function(a,b,c){var d,e,f,g=this;return"string"==typeof a&&a.length>2&&(e=document.createElement("img"),e.pixelData=c,d=this._.pxQueue.push(e)-1,f=function(){"function"==typeof b&&b.apply(this,arguments),g._.emitter.trigger("promotedPixel",arguments),g._.pxQueue[d]=null},e.onload=f,e.onerror=f,e.src=a.replace(/\[timestamp\]/gi,(new Date).getTime())),e}}),Namespace("Imgur.Promoted.Events"),Imgur.Promoted.Events=Class.extend({init:function(a,b,c){this._={ele:{clicks:{ACTION_IMAGE_UPVOTE:"#mainUpArrow.arrow.up:not(.pushed)",ACTION_IMAGE_DOWNVOTE:"#mainDownArrow.arrow.down:not(.pushed)",ACTION_FAVORITE:".favorite-image:not(.favorited)",ACTION_SHARE:".social li",ACTION_SHARE_FACEBOOK:".social li span .facebook_custom",ACTION_SHARE_TWITTER:".social li span .twitter_custom",ACTION_SHARE_REDDIT:".social li span .reddit_custom",CLICK_COMPANION:"#right-content .advertisement .promoCompanion a img"},topCaptionTextarea:"#caption_textarea",replyCaptionTextarea:"#captions .comment"},config:a,emitter:b,inside:c}},bindAll:function(a){a?(this._.emitter.off("captionVoted",this,this._handleCommentVote),this._.emitter.off("captionSubmit",this,this._handleCommentSubmit),this._.emitter.off("vwTime",this,this._handleVwTime),this._.emitter.off("vwUnderImage",this,this._handleVwUnderImage)):(this._.emitter.on("captionVoted",this,this._handleCommentVote),this._.emitter.on("captionSubmit",this,this._handleCommentSubmit),this._.emitter.on("vwTime",this,this._handleVwTime),this._.emitter.on("vwUnderImage",this,this._handleVwUnderImage)),this.bindClicks(a)},bindClicks:function(a){var b,c=a?"off":"on";for(b in this._.ele.clicks)this._.ele.clicks.hasOwnProperty(b)&&$(this._.ele.clicks[b])[c]("click",null,{promoEvent:b},_.bind(this._fireEvent,this))},_handleVwTime:function(a,b){var c={hash:this.getSideImage(a),data:{sec:Math.floor(b/1e3),promoEvent:"VIEW_TIME_0"}};c.data.promoEvent=c.data.sec<=10?"VIEW_TIME_"+c.data.sec:c.data.sec<=14?"VIEW_TIME_10":c.data.sec<=19?"VIEW_TIME_15":c.data.sec<=24?"VIEW_TIME_20":c.data.sec<=29?"VIEW_TIME_25":"VIEW_TIME_30_PLUS",this._fireEvent(c)},_handleVwUnderImage:function(a){var b={hash:this.getSideImage(a),data:{promoEvent:"VIEW_UNDERIMAGE"}};this._fireEvent(b)},_handleCommentSubmit:function(a){var b={comment:a,data:{promoEvent:"ACTION_COMMENT"}};a.parent_id&&(b.data.promoEvent="ACTION_COMMENT_REPLY"),this._fireEvent(b)},_handleCommentVote:function(a,b){var c={comment:a,data:{promoEvent:null}};"veto"!==b&&(c.data.promoEvent="up"===b?"ACTION_COMMENT_UPVOTE":"ACTION_COMMENT_DOWNVOTE",this._fireEvent(c))},getSideImage:function(a){return this._.inside._.sideGallery.getImage(a)},_fireEvent:function(a){this._.emitter.trigger("promoEvent",a)}}),function(){function a(a){this.emitter=a,this.parts={companion:null,page:null,thumb:null,data:{}},this.pixels={}}a.prototype={addPixel:function(a,b){"object"!=typeof this.pixels[a]&&(this.pixels[a]=[]),this.pixels[a].push(b)},addCompanionPlacement:function(a){this.parts.companion=_.extend({},a)},addPagePlacement:function(a){this.parts.page=_.extend({},a)},addThumbPlacement:function(a){this.parts.thumb=_.extend({},a)},getHash:function(){return Imgur.Util.dive(this.parts,"data.hash")},setData:function(a){this.parts.data=_.extend(this.parts.data,a),this.parts.data.starting_score=0}},Imgur.Promoted.Post=a}(),Namespace("Imgur.Promoted.Source"),Imgur.Promoted.Source=Class.extend({init:function(){throw"Imgur.Promoted.Source is an abstract class."},getPlacement:function(){}}),Namespace("Imgur.Promoted.Source.Adzerk"),Imgur.Promoted.Source.Adzerk=Imgur.Promoted.Source.extend({init:function(a,b){return this._={blockedCreatives:[],emitter:b,espoused:!1,config:a,user:{},cookieOpts:{domain:"."+Imgur.Environment.host,path:"/",expires:365},rgxDomain:/\/\/engine\.[^.]+\.net/,pgxProto:/^[^:]+:\/\//,evtToPx:{10:"ACTION_IMAGE_UPVOTE",11:"ACTION_IMAGE_DOWNVOTE",22:"ACTION_COMMENT",101:"ACTION_COMMENT_REPLY",102:"ACTION_COMMENT_UPVOTE",103:"ACTION_COMMENT_DOWNVOTE",20:"ACTION_FAVORITE",21:"ACTION_SHARE",50:"ACTION_SHARE_FACEBOOK",51:"ACTION_SHARE_TWITTER",52:"ACTION_SHARE_PINTEREST",53:"ACTION_SHARE_REDDIT",54:"ACTION_SHARE_EMAIL",104:"VIEW_UNDERIMAGE",400:"VIEW_TIME_0",401:"VIEW_TIME_1",402:"VIEW_TIME_2",403:"VIEW_TIME_3",404:"VIEW_TIME_4",405:"VIEW_TIME_5",406:"VIEW_TIME_6",407:"VIEW_TIME_7",408:"VIEW_TIME_8",409:"VIEW_TIME_9",410:"VIEW_TIME_10",415:"VIEW_TIME_15",420:"VIEW_TIME_20",425:"VIEW_TIME_25",430:"VIEW_TIME_30_PLUS"}},this._idFromCookie(),this._},getPlacement:function(){var a={user:this._getUser(),placements:this._.config.adzerk.placementParms,blockedCreatives:this._.blockedCreatives};return $.ajax({url:this._.config.adzerk.apiLocation,type:"POST",contentType:"application/json",data:JSON.stringify(a),dataType:"json",success:_.bind(this._handleApiResponse,this),error:_.bind(this._handleApiError,this)})},_handleApiError:function(){imcon.log("adzerk get fail",arguments)},_decodeEncodedResponse:function(a){var b,c,d,e,f="contents.0.data.customData",g=Imgur.Util.dive(a,"decisions");if("object"==typeof g)for(b in g)if(g.hasOwnProperty(b)){if(c=Imgur.Util.dive(g[b],f+".encoded"),_.isArray(c))for(d=0;d<c.length;d++)e=Imgur.Util.dive(g[b],f+"."+c[d]),"string"==typeof e&&(a.decisions[b].contents[0].data.customData[c[d]]=decodeURIComponent(e),a.decisions[b].contents[0].data.customData[c[d]+"_raw"]=e);if(c=Imgur.Util.dive(g[b],f+".encodedObj"),_.isArray(c))for(d=0;d<c.length;d++)e=Imgur.Util.dive(g[b],f+"."+c[d]),"string"==typeof e&&(a.decisions[b].contents[0].data.customData[c[d]]=JSON.parse(decodeURIComponent(e)),a.decisions[b].contents[0].data.customData[c[d]+"_raw"]=e)}return a},_espouse:function(){this._.espoused||Imgur.Environment.auth&&$.ajax({type:"GET",url:"/account/espouse",complete:_.bind(function(){this._.espoused=!0},this)})},_idFromCookie:function(){var a=$.cookie(this._.config.userCookie);a&&(this._.user.key=a)},_handleApiResponse:function(a){var b,c=this._.config.adzerk,d=null,e=Imgur.Util.dive(a,"decisions."+c.placementIds.thumb),f=Imgur.Util.dive(a,"decisions."+c.placementIds.page),g=Imgur.Util.dive(a,"decisions."+c.placementIds.companion);"object"==typeof a&&"object"==typeof a.user&&a.user&&this._setUserFromResponse(a),"object"==typeof a&&"object"==typeof a.decisions&&a.decisions?(a=this._decodeEncodedResponse(a),d=new Imgur.Promoted.Post(this._.emitter),g&&(compFormatted=this._formatCompanionData(g),d.addCompanionPlacement(compFormatted),d.addPixel("CLICK_COMPANION",this._cleanPx(g.clickUrl)),d.addPixel("IMPRESSION_COMPANION",this._cleanPx(g.impressionUrl))),f&&(d.addPagePlacement(f),d.addPixel("IMPRESSION_POST",this._cleanPx(f.impressionUrl))),e&&(adData=Imgur.Util.dive(e,"contents.0.data.customData"),b=Imgur.Util.dive(e,"contents.0.data.customData.customPx"),adData&&(d.addThumbPlacement(e),d.addPixel("CLICK_THUMB",this._cleanPx(e.clickUrl)),d.addPixel("IMPRESSION_THUMB",this._cleanPx(e.impressionUrl)),d.setData(adData),this._.blockedCreatives.push(e.creativeId),"object"==typeof e.events&&this._addEventPixels(d,e.events),"object"==typeof b&&this._addCustomPixels(d,b))),this._.emitter.trigger("gotPromoted",d)):imcon.warn("Empty or invalid promoted response.",arguments)},_cleanPx:function(a){return"string"==typeof a&&(this._.rgxDomain.test(a)&&(a=a.replace(this._.rgxDomain,"//zrk."+Imgur.Environment.host)),this._.pgxProto.test(a)&&(a=a.replace(this._.pgxProto,"//"))),a},_addCustomPixels:function(a,b){var c,d;if("object"==typeof a&&_.isArray(b))for(d=b.length,c=0;d>c;c++)"undefined"!=typeof b[c].id&&"undefined"!=typeof b[c].url&&"string"==typeof b[c].id&&a.addPixel(b[c].id,this._cleanPx(b[c].url))},_addEventPixels:function(a,b){var c,d;if("object"==typeof a&&_.isArray(b))for(d=b.length,c=0;d>c;c++)"undefined"!=typeof b[c].id&&"undefined"!=typeof b[c].url&&"string"==typeof this._.evtToPx[b[c].id]&&a.addPixel(this._.evtToPx[b[c].id],this._cleanPx(b[c].url))},_setUserFromResponse:function(a){"object"==typeof a&&"object"==typeof a.user&&a.user&&(this._.user=_.extend({},a.user),this._idFromCookie(),$.cookie(this._.config.userCookie,this._.user.key,this._.cookieOpts),this._espouse())},_getUser:function(){return this._idFromCookie(),this._.user},_formatCompanionData:function(a){var b,c,d,e,f=Imgur.Util.dive(a,"contents.0.data.customData.adType"),g={type:f,raw:a,html:""};switch(g.raw=a,f){case"hash":case"native":b=Imgur.Environment.cdnUrl+"/"+Imgur.Util.dive(a,"contents.0.data.customData.hash")+".jpg",c=Imgur.Util.dive(a,"contents.0.data.customData.link"),d=Imgur.Util.dive(a,"contents.0.data.customData.title"),g.html='<a href="'+c+'" rel="nofollow" target="_blank" title="'+d+'"><img src="'+b+'" title="'+d+'" alt="'+d+'" border="0" width="300" height="250"></a>';break;case"html":g.html=Imgur.Util.dive(a,"contents.0.data.customData.html");break;default:e=Imgur.Util.dive(a,"contents.0.body"),e&&(g.html=e)}return g}}),Namespace("Imgur"),Imgur.SideGalleryCta=Class.extend({init:function(a,b,c,d){this._={config:a,emitter:b,inside:c,sideGallery:d},b.on("sidegalleryPageLoad",this,this.handleNewGalleryPage),b.on("select",this,this.handleSelectPost)},isActive:function(){var a=this.getItem();return!!a},handleNewGalleryPage:function(a){"initial"===a&&this.isActive()&&this.handleNewGallery()},handleNewGallery:function(){var a=this.getItem();if(a){var b=this._.inside.getHash(),c=b?this._.sideGallery.hashPosition(b):-1;insertAt=-1===c?0:c%2===1||c+1===this._.sideGallery.state.items.length?c+1:c+2,this._.sideGallery.insertSingleItem(a,insertAt)}},getItem:function(){var a=this._.inside.getHash(),b=_.find(this._.config,function(b,c){if(!b||!b.hash||!b.variation)return void imcon.log("Bad side cta item",c,b);if(b.active!==!1&&a!==b.hash){if(b.localStorageName){var d=new Imgur.Storage.LocalStorage,e=d.get(b.localStorageName);if(e)return}return b}});if(b){var c=moment().utc().format("YYYY-MM-DD HH:mm:ss");return b=_.extend({account_url:"Imgur",in_gallery:!0,isCta:!0,isAd:!0,create_datetime:c,timestamp:c,nsfw:!1},b),"what-is-imgur"===b.variation&&(b=_.extend({thumb:Imgur.Environment.staticUrl+"/images/house-cta/sidecta-whatisimgur.gif",title:"What is Imgur?",className:"what-is-imgur"},b)),b}},handleSelectPost:function(a){var b=_.find(this._.config,function(b){return b.hash===a.hash});if(b&&b.localStorageName){var c=new Imgur.Storage.LocalStorage;c.save(b.localStorageName,{hash:a.hash,date:+new Date})}}}),Imgur.LinkGenerator=Class.extend({init:function(){this._={item:null,thumbsize:null,threshold:null}},setItem:function(a){return this._.item=a,this},setThumbSize:function(a){return this._.thumbsize=a,this},setThreshold:function(a){return this._.threshold=a,this},reset:function(){return this._.item=null,this._.thumbsize="",this},imageLink:function(a){return"http://"+Imgur.Environment.host+"/"+(a?"a/":"")+this._.item.hash},directishLink:function(){var a=""==this._.thumbsize&&".gif"==this._.item.ext&&this._.item.animated?".gifv":this._.item.ext;return"http:"+Imgur.Environment.cdnUrl+"/"+this._.item.hash+this._.thumbsize+a},directLink:function(){return"http:"+Imgur.Environment.cdnUrl+"/"+this._.item.hash+this._.thumbsize+this._.item.ext},htmlImage:function(){return""==this._.thumbsize&&".gif"==this._.item.ext&&this._.item.animated&&this._.item.size>this._.threshold?'<iframe class="imgur-embed" width="100%" height="'+this._.item.height+'" frameborder="0" src="'+this.directishLink()+'#embed"></iframe>':'<a href="'+this.imageLink()+'"><img src="'+this.directLink()+'" title="source: imgur.com" /></a>'},markdown:function(){var a,b=""==this._.thumbsize&&".gif"==this._.item.ext&&this._.item.animated?".gifv":this._.item.ext;return a=this._.item.title?this._.item.title:"Imgur","["+a+"](http:"+Imgur.Environment.cdnUrl+"/"+this._.item.hash+this._.thumbsize+b+")"},bbcode:function(){return"[img]http:"+Imgur.Environment.cdnUrl+"/"+this._.item.hash+this._.thumbsize+this._.item.ext+"[/img]"},linkedBbcode:function(){return""==this._.thumbsize&&".gif"==this._.item.ext&&this._.item.animated&&this._.item.size>this._.threshold?"[url=http://"+Imgur.Environment.host+"/"+this._.item.hash+"]http:"+Imgur.Environment.cdnUrl+"/"+this._.item.hash+this._.thumbsize+".gifv[/url]":"[url=http://"+Imgur.Environment.host+"/"+this._.item.hash+"][img]http:"+Imgur.Environment.cdnUrl+"/"+this._.item.hash+this._.thumbsize+this._.item.ext+"[/img][/url]"},deletion:function(){return"https://"+Imgur.Environment.host+"/delete/"+this._.item.deletehash},embed:function(){var a=("imgur.com"===Imgur.Environment.host?"s.imgur.com/min":Imgur.Environment.host+"/include/minified")+"/embed.js",b=this._.item.title;b||(b="View post on imgur.com");var c=this._.item.is_album?"a/":"";return'<blockquote class="imgur-embed-pub" lang="en" data-id="'+c+this._.item.hash+'"><a href="//'+Imgur.Environment.host+"/"+c+this._.item.hash+'">'+_.escape(b)+'</a></blockquote><script async src="//'+a+'" charset="utf-8"></script>'}}),Namespace("Imgur.Album.Images"),Imgur.Album.Images=Class.extend({init:function(a){this._=$.extend(!0,{host:"imgur.com",cdnUrl:"//i.imgur.com",postURL:"/ajaxalbums/images",imagesPerPage:25,album:null,images:null,changeCover:!1,albumTitle:null,mode:null,onSubmitComplete:function(){},sort:0,order:1,selected:[],offsetSelectionInterval:null,imgurImages:null,operationQueue:{},el:{$thumbsContainer:$("#album-images #image-thumbs"),thumbsId:"#album-images #image-thumbs",messagesClass:"thumbs-message",$loader:$("#album-images #images-loader"),imageDivClass:"thumb",$modes:$("#album-images #images-menu .mode"),$operationLoader:$("#album-images #small-loader"),imageSelectedClass:"selected",$submitButton:$("#album-images #save")},messages:{noImages:'<span class="thumbs-message">No images were found.</span>'}},a),this._.operationQueue.hashes=null==this._.images?[]:this._.images,this._.operationQueue.count=null==this._.images?0:Object.size(this._.images),this.loadImages(),this.loadPageElements()},getPageOptions:function(){return isNaN(this._.album)?(this._.sort=3,this._.order=0):(this._.sort=0,this._.order=1),{sort:this._.sort,order:this._.order,album:this._.album}},noImagesFound:function(){var a=Imgur.Album.Images.getInstance();a._.el.$thumbsContainer.html(a._.messages.noImages)},addImageToThumbs:function(a,b,c){var d=Imgur.Album.Images.getInstance();if(!($(d._.el.thumbsId+" #"+a.hash).length>0)){var e=a.ext.match(/\?(.*)/),f="s.jpg"+(null!=e?e[0]:""),g=(d._.cdnUrl+"/"+a.hash+(".gif"==a.ext?a.ext:"h"+a.ext),$('<div class="'+d._.el.imageDivClass+'" id="'+a.hash+'" ext="'+a.ext+'"></div>')),h=$('<div class="selection"></div>');img=$('<img src="'+d._.cdnUrl+"/"+a.hash+f+'" />'),$(g).append(img),$(g).append(h),d._.operationQueue.hashes[a.hash]&&g.addClass(d._.el.imageSelectedClass),$("."+d._.el.messagesClass).remove(),c?$(g).appendTo(d._.el.$thumbsContainer):$(g).prependTo(d._.el.$thumbsContainer).hide().fadeIn("slow")}},queueOperation:function(a){var b=a.attr("id");this._.changeCover?(this._.operationQueue.count=1,this._.operationQueue.hashes[0]=b,this._.el.$thumbsContainer.find("."+this._.el.imageDivClass).removeClass(this._.el.imageSelectedClass),a.addClass(this._.el.imageSelectedClass)):this._.operationQueue.hashes[b]?(this._.operationQueue.count--,this._.operationQueue.hashes[b]=null,a.removeClass(this._.el.imageSelectedClass)):(this._.operationQueue.count++,this._.operationQueue.hashes[b]=!0,a.addClass(this._.el.imageSelectedClass))
},isInQueue:function(a){return 1==this._.operationQueue.hashes[a]},startOperation:function(){if(0==this._.operationQueue.count)return null;if(this._.images=[],this._.changeCover)this._.images.push(this._.operationQueue.hashes[0]);else for(var a in this._.operationQueue.hashes)null!=this._.operationQueue.hashes[a]&&this._.images.push(a);return this._.images},toggleOperationsLoader:function(){this._.el.$operationLoader.toggle()},bindOperationClick:function(a){var b=this;a.unbind("click"),a.click(function(){return b.queueOperation($(this).parent()),!1})},offsetSelection:function(){var a=Imgur.Album.Images.getInstance(),b=5,c=a._.el.$thumbsContainer.parent(),d=c.scrollTop(),e=c.selectable();e.y<0?(c.scrollTop(c.scrollTop()-b),c.scrollTop()<d&&c.selectable("recalc",-b)):e.y>c.height()&&(c.scrollTop(c.scrollTop()+b),c.scrollTop()>d&&c.selectable("recalc",b))},makeSelectable:function(){var a=Imgur.Album.Images.getInstance();a._.el.$thumbsContainer.unbind("mousedown"),a._.el.$thumbsContainer.parent().selectable({filter:".thumb",selected:function(b,c){a._.selected.push($(c.selected))},stop:function(){var b=0,c=!1,d=a._.selected.length;for(var e in a._.selected)if(a.isInQueue($(a._.selected[e]).attr("id")))b++,e==d-1&&d>b&&(c=!0);else if(b){c=!0;break}for(var e in a._.selected){var f=$(a._.selected[e]);c?a.isInQueue(f.attr("id"))||a.queueOperation(f):a.queueOperation(f)}a._.selected=[]}}),a._.el.$thumbsContainer.bind("mousedown",function(){clearInterval(a._.offsetSelectionInterval),a._.offsetSelectionInterval=setInterval(a.offsetSelection,50)}),$(document).bind("mouseup",function(){clearInterval(a._.offsetSelectionInterval)})},submit:function(){this._.images=this.startOperation(),this._.el.$submitButton.disable(),this.toggleOperationsLoader();var a=this;return $.post(this._.postURL+"/"+this._.album,"hashes="+this._.images+"&change_cover="+this._.changeCover,function(b){b.success?(a._.el.$submitButton.enable(),a.toggleOperationsLoader(),a._.onSubmitComplete(b)):4344==b.data.error.code?(a._.el.$submitButton.enable(),a.toggleOperationsLoader(),humanMsg.displayMsg("You are trying to add too many images to this album")):403==b.data.error.code?(a._.onSubmitComplete(b),humanMsg.displayMsg("Cannot edit album images while album is in the Gallery")):humanMsg.displayMsg("Unknown error occurred")}).error(function(b){a._.el.$submitButton.enable(),a.toggleOperationsLoader();var c=JSON.parse(b.responseText);humanMsg.displayMsg(c.data.error)}),!1},loadImages:function(){if(null!=this._.album&&"undefined"!=typeof this._.album){var a=Imgur.Images.getInstance();a.init({imagesPerPage:this._.imagesPerPage,addToThumbsFunc:this.addImageToThumbs,noImagesFunc:this.noImagesFound,onComplete:this.makeSelectable,loader:this._.el.$loader,noPageHash:!0}),a.setOptions(this.getPageOptions()),this.next=function(){a.next()},this.prev=function(){a.prev()},this.changePage=function(b){a.changePage(b)},a.bindScrollEvent(),a.reload(),this._.imgurImages=a}},loadPageElements:function(){this._.album&&(this._.el.$modes.filter(":first").attr("data-value",this._.album),this._.el.$modes.removeClass("selected"),this._.mode?(this._.el.$modes.siblings("div[data-value="+this._.mode+"]").addClass("selected"),this._.album=this._.mode):this._.el.$modes.siblings(".start").addClass("selected"),this._.imgurImages.setCurrentPage(1),this._.imgurImages.setOptions(this.getPageOptions()),this._.imgurImages.reload(),this._.el.$modes.click(this.modeClickHandler))},modeClickHandler:function(){var a=Imgur.Album.Images.getInstance();a._.el.$modes.removeClass("selected"),$(this).addClass("selected");var b=$(this).attr("data-value");a._.album=b,a._.imgurImages.setCurrentPage(1),a._.imgurImages.setOptions(a.getPageOptions()),a._.imgurImages.reload()},destroy:function(){this._.el.$thumbsContainer.empty(),this._.el.$modes.unbind("click"),this._.el.$modes.removeClass("selected"),this._.el.$loader.show()}}),Class.addSingleton(Imgur.Album.Images),Namespace("Imgur.Images"),Imgur.Images=Class.extend({init:function(a){this._=$.extend(!0,{imagesPerPage:20,thisName:"app",ajaxURL:"/ajax/images",noPageHash:!1,addToThumbsFunc:function(){return null},hiddenImagesFunc:function(){return null},noImagesFunc:function(){return null},onComplete:function(){return null},currentPage:1,totalPages:0,totalImageCount:0,numImages:0,changingPage:!1,options:null,imageLimit:225,isPro:!1,cache:[],stopOnPaging:!0,lastScrollPos:0,ajax:null,el:{$navigationContainer:$(".navigation"),$loader:$("#images-loader"),$totalCounter:$(".total-images"),$totalCounterSuffix:$(".total-images-suffix"),$thumbsContainer:$("#image-thumbs"),pageNumbersClass:"page-numbers",prevID:"prev",nextID:"next"}},a),this._.el.$totalCounter.text(0),this._.el.$totalCounterSuffix.text("images"),this._.noPageHash||(this._.currentPage=this.getPage())},getHash:function(){return window.location.hash.substring(1)},getPage:function(){var a=parseInt(this.getHash());return 1>a&&(a=1),a?a:1},stopPaging:function(){void 0!==window.stop?window.stop():void 0!==document.execCommand&&document.execCommand("Stop",!1)},generatePageLink:function(a,b){if(b>0&&b<=this._.totalPages){var c=$('<a href="javascript:;">'+b+"</a>"),d=this;c.click(function(){d._.el.$thumbsContainer.parent().scrollTop(0),d.changePage(b)}),a.append(c),b==this._.currentPage&&c.addClass("current-selected")}},generateNavigationLinks:function(){if(this._.el.$navigationContainer.empty(),1!=this._.totalPages){var a=(this._.currentPage-1,this._.currentPage+1,$('<span class="'+this._.el.pageNumbersClass+'"></span>')),b=$('<a href="javascript:;" id="'+this._.el.prevID+'">Prev</a>'),c=$('<a href="javascript:;" id="'+this._.el.nextID+'">Next</a>');b.click(this.prev),c.click(this.next);for(var d=this._.currentPage-5;d<this._.currentPage;++d)this.generatePageLink(a,d);for(var d=this._.currentPage;d<this._.currentPage+6;++d)this.generatePageLink(a,d);this._.el.$navigationContainer.append(a),this._.currentPage>1&&this._.el.$navigationContainer.append(b),this._.currentPage<this._.totalPages&&this._.el.$navigationContainer.append(c)}},recalcNavigation:function(){var a=Math.ceil(this._.totalImageCount/this._.imagesPerPage);1>a&&(a=1),a!=this._.totalPages&&(this._.totalPages=a,this.generateNavigationLinks(this._.currentPage)),this._.el.$totalCounter.text(Imgur.Util.numberFormat(this._.totalImageCount)),this._.el.$totalCounterSuffix.text(Imgur.Util.pluralize(this._.totalImageCount,"image"))},handleJSON:function(a){if(null!=a){if(this._.cache[$.param(this._.options)]=a,this._.isPro=a.isPro,a.count!=this._.totalImageCount&&(this._.totalImageCount=parseInt(a.count),this.recalcNavigation()),a.count>0&&a.images.length>0){var b=this;$.each(a.images,function(a,c){b._.numImages++,b._.addToThumbsFunc(c,null,!0)})}else this._.noImagesFunc();this._.el.$thumbsContainer.append('<div class="clear"></div>')}this._.changingPage=!1,this._.el.$loader.hide(),this._.onComplete()},changePage:function(a,b,c){if(null==this._.options)return!1;if(this._.changingPage){if(c)return!1;this._.ajax.abort()}if(a>this._.totalPages&&this._.totalPages>0)return!1;this._.changingPage=!0,this._.currentPage=a,this._.numImages=this._.imagesPerPage*(this._.currentPage-1),this._.el.$loader.show(),this.generateNavigationLinks(),c||(this._.el.$thumbsContainer.empty(),b||this._.noPageHash||(window.location=window.location.href.substring(0,window.location.href.indexOf("#"))+"#"+this._.currentPage)),this._.options.page=a,this._.options.perPage=this._.imagesPerPage;var d=$.param(this._.options),e=this;return this._.cache[d]?this.handleJSON(this._.cache[d]):(this._.stopOnPaging&&!b&&this.stopPaging(),this._.ajax=$.getJSON(this._.ajaxURL,this._.options,function(a){a.success&&e.handleJSON(a.data)})),!0},bindScrollEvent:function(){var a=80,b=this._.el.$thumbsContainer.parent(),c=this._.el.$thumbsContainer,d=this;this._.el.$thumbsContainer.parent().scroll(function(){b.scrollTop()>c.height()-b.height()-a&&d.changePage(d._.currentPage+1,!0,!0),d._.lastScrollPos=b.scrollTop()})},next:function(){var a=Imgur.Images.getInstance();return a._.el.$thumbsContainer.parent().scrollTop(0),a.changePage(a._.currentPage+1)},prev:function(){var a=Imgur.Images.getInstance();return a._.el.$thumbsContainer.parent().scrollTop(0),a.changePage(a._.currentPage-1)},reload:function(){return this.changePage(this._.currentPage,!0)},getCurrentPage:function(){return this._.currentPage},setCurrentPage:function(a){this._.currentPage=a},setOptions:function(a){this._.options=a},getTotalPages:function(){return this._.totalPages},getImageLimit:function(){return this._.imageLimit},getTotalImageCount:function(){return this._.totalImageCount},increaseImageCount:function(){this._.totalImageCount++},clearCache:function(){this._.cache=[]},stopOnPaging:function(a){this._.stopOnPaging=a}}),Class.addSingleton(Imgur.Images),Namespace("Imgur.TitleDesc"),Imgur.TitleDesc=Imgur.extend({init:function(a){return this._=$.extend(!0,{el:{titleDescriptionForm:{id:"#title-description",$form:$("#title-description form"),$titleInput:$("#title-input"),$descriptionInput:$("#description-input"),$loader:$("#title-description-loader")}}},a),this._=this._super(this._),this._},bindTitleDescriptionSubmit:function(a,b){if(b){this._.el.titleDescriptionForm.$titleInput.val(Imgur.Environment.hashes[0].title);var c=document.createElement("textarea");c.innerHTML=Imgur.Environment.hashes[0].description,this._.el.titleDescriptionForm.$descriptionInput.val(c.value)}var d=this;this._.el.titleDescriptionForm.$form.submit(function(){return d.titleDescriptionSubmitHandler(a)})},titleDescriptionSubmitHandler:function(a){var b=this._.el.titleDescriptionForm.$titleInput.val()!=this._.el.titleDescriptionForm.$titleInput.attr("title")?this._.el.titleDescriptionForm.$titleInput.val():"",c=this._.el.titleDescriptionForm.$descriptionInput.val()!=this._.el.titleDescriptionForm.$descriptionInput.attr("title")?this._.el.titleDescriptionForm.$descriptionInput.val():"";this._.el.titleDescriptionForm.$loader.show(),this._.hash=Imgur.getInstance()._.hash;var d=this,e=this._.hash.deletehash||Imgur.Environment.hashes[0].deletehash;return $.post("/ajax/titledesc/"+e,{title:b,desc:c},function(){$.colorbox.close(),humanMsg.displayMsg(d._.messages.titledesc),d._.el.titleDescriptionForm.$loader.hide(),a?a({title:b,description:c}):window.setTimeout(function(){location.reload()},1e3)}),!1},addTitleDescription:function(){var a=this;$.colorbox({href:a._.el.titleDescriptionForm.id,open:!0,inline:!0,top:"15%",transition:"none",scrolling:!1,onComplete:function(){a._.el.titleDescriptionForm.$titleInput.focus()}})},getElements:function(){return this._.el}}),Class.addSingleton(Imgur.TitleDesc);
//# sourceMappingURL=gallery.js.map