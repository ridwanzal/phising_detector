var autocompleteSearch=(function(){var q;function f(){var r={minLength:2,showDelay:400,showPornstars:true,defaultType:"video",boldenResults:true,typesListContainerId:"searchTypes",formId:"search_form",inputId:"searchInput",submitBtnId:"btnSearch",suggestionsListId:"searchSuggestions"};this.options=MG_Utils.extendDefaults(r,arguments[0]);this.types=this.options.types;this.typesList=document.getElementById(this.options.typesListContainerId);this.form=document.getElementById(this.options.formId);this.input=document.getElementById(this.options.inputId);this.submitBtn=document.getElementById(this.options.submitBtnId);this.suggestionsList=document.getElementById(this.options.suggestionsListId);this.typeSelected=document.getElementById("searchTypeSelected");this.focusInput=focusSearchInput;this.currentType=null;this.cache=null;this.term=null;this.searchName=null;this.tempTerm=null;this.timeouts={autocomplete:{timer:null,value:null,name:null,matches:0}};if(!q){p.call(this)}return q}f.prototype={constructor:f,setType:function(r){if(typeof r=="string"){this.currentType=this.getType(r)}this.typeSelected.setAttribute("data-search-type",this.currentType.name);this.typeSelected.querySelector("i").className=this.currentType.name;this.typesList.style.display="none"},getType:function(s){if(!s){s=this.typeSelected.getAttribute("data-search-type")}for(var r=0;r<this.types.length;r++){if(this.types[r].name==s){this.currentType=this.types[r];return this.currentType}}}};function p(){var r=this;o.call(this);(this.focusInput)?this.input.focus():this.input.blur();a.call(this);q=this}function a(){var r=this;c.call(this);MG_Utils.addEventHandler(this.submitBtn,"click",function(s){k.call(r,s)});MG_Utils.addEventHandler(this.form,"submit",function(s){k.call(r,s)})}function c(){var r=this;MG_Utils.addEventHandler(this.input,"keyup",function(s){j.call(r,s)});MG_Utils.addEventHandler(this.input,"keypress",function(t){var s=t.keyCode?t.keyCode:t.charCode;if(s==60||s==62){return false}});MG_Utils.addEventHandler(this.input,"keydown",function(s){e.call(r,s)});MG_Utils.addEventHandler(this.input,"click",function(s){s=s||window.event;s.stopPropagation?s.stopPropagation():s.returnValue=false});MG_Utils.addEventHandler(this.suggestionsList,"click",function(s){s=s||window.event;s.stopPropagation?s.stopPropagation():s.returnValue=false});MG_Utils.addEventHandler(document.body,"click",function(s){r.suggestionsList.style.display="none"})}function d(t){var r=this.input.value.toLowerCase(),s=this.suggestionsList.querySelector(".selected");if(r=="hd"&&currentType.name=="video"){window.location="/hd"}else{if(s){MG_Utils.removeClass(s,"selected")}MG_Utils.triggerEvent(this.form,"submit")}}function k(u){var s=this.input.value.replace(/^[ \t]+|[ \t]+$/gi,""),r=this.input.getAttribute("placeholder"),t=this.suggestionsList.querySelector(".selected");if(s!=""&&s!=r){if(t){if(MG_Utils.hasClass(t,"pornstar")||MG_Utils.hasClass(t,"channel")){MG_Utils.triggerEvent(t,"click");u.preventDefault?u.preventDefault():(u.returnValue=false);return false}}s=s.toLowerCase();s=encodeURIComponent(s);s=s.replace(/%20/g,"+");var v=this.currentType.submitUrl+s;window.location.href=v}u.preventDefault?u.preventDefault():(u.returnValue=false);return false}function j(v){var u=RegExp(/[\<\>]/gi),w=this.input.value.match(u),s=this.input.value.replace(u,""),z=v.keyCode?v.keyCode:v.charCode,A=this,x=this.input.value.trim(),y=this.currentType.name,r=false;if(z=="38"||z=="40"||z=="13"){return false}if(this.term){if(this.term==x&&this.searchName==this.currentType.name){return false}}if(w){this.input.value=s}if(z=="13"&&typeof arrowKeysSelected=="undefined"&&!MG_Utils.hasClass(this.form,"onHold")){if(this.input.value.toLowerCase()=="hd"&&this.currentType.name=="video"){window.location="/hd"}}this.term=x;this.tempTerm=x;this.searchName=this.currentType.name;if(!this.currentType.autocompleteUrl){return false}this.cache=this.input.getAttribute("data-autocomplete-cache")||{};if(typeof this.cache!=="object"){this.cache=JSON.parse(this.cache)}if(typeof this.cache[y]==="undefined"){this.cache[y]={}}for(var t in this.cache[y]){if(this.term==t){response(this.cache[y][t]);r=true}}if(r){return false}if(this.input.value.length<this.options.minLength){this.timeouts.autocomplete.value="";clearTimeout(this.timeouts.autocomplete.timer);this.timeouts.autocomplete.matches=0;this.suggestionsList.style.display="none"}else{if(this.input.value!=this.timeouts.autocomplete.value||this.currentType.name!=this.timeouts.autocomplete.name){this.timeouts.autocomplete.value=this.input.value;clearTimeout(this.timeouts.autocomplete.timer);if(this.currentType.autocompleteUrl!="user"){this.timeouts.autocomplete.timer=setTimeout(function(){MG_Utils.ajaxGet({url:A.currentType.autocompleteUrl,data:{pornstars:A.options.showPornstars,search_rnd:A.input.getAttribute("data-searchRnd"),search_hash:A.input.getAttribute("data-searchHash"),orientation:A.input.getAttribute("data-orientation"),q:A.input.value,alt:0},success:function(B){h.call(A,B)}})},this.options.showDelay)}}}}function e(w){var r=w.keyCode?w.keyCode:w.charCode,u=this.suggestionsList.querySelectorAll("li"),s=this.suggestionsList.querySelector(".selected"),v,t;if(!s){s=u[0]}if(r!=40&&r!=38){return}MG_Utils.removeClassMultiple(u,"selected");if(r==40){if(!s.length&&s===u[u.length-1]){v=u[0]}else{v=s.nextElementSibling||MG_Utils.nextElementSibling(s)}}else{if(r==38){if(!s.length&&s===u[0]){v=u[u.length-1]}else{v=s.previousElementSibling||MG_Utils.previousElementSibling(s)}}}MG_Utils.addClass(v,"selected");t=v.getAttribute("data-value");if(t){this.input.value=v.getAttribute("data-value");this.term=this.input.value}else{this.input.value=this.tempTerm}}function o(){l.call(this);this.typesList.querySelector("li.gifs span").innerHTML="GIFs";dropdown.init("#searchTypeWrapper");b.call(this);this.setType();i.call(this)}function l(){var r=this.typesList.innerHTML;this.types.forEach(function(s){r+='<li class="'+s.name+'" data-search-type="'+s.name+'"><i class="'+s.name+'"></i><span>'+s.name+"</span></li>"});this.typesList.innerHTML=r}function b(){var t=n.call(this),u=window.location.pathname;var v=u.split("/")[1];if(v){if(v=="gay"||v=="shemale"){var r=u.split("/")[2];if(r=="gifs"){v="gifs"}else{if(r=="pornstars"){v="pornstars"}}}for(var s=0;s<this.types.length;s++){if(this.types[s].testTypePattern==v){if(u.split("/")[2]!="edit"){t=this.types[s]}}}}this.currentType=t}function n(){var s=null;for(var r=0;r<this.types.length;r++){if(this.types[r].testTypePattern==this.options.defaultType){return this.types[r]}}}function i(){var s=this,r=MG_Utils.children(s.typesList).slice(1);r.forEach(function(t){MG_Utils.addEventHandler(t,"click",function(w){w=w||window.event;var u=w.target||w.srcElement;if(u.nodeName.toLowerCase()!=="li"){var v=u;while((v=v.parentElement)&&v.nodeName.toLowerCase()!=="li"){}u=v}s.setType(u.getAttribute("data-search-type"));s.typesList.focus();j.call(s,w)})})}function h(u){var s=this;if(this.timeouts.autocomplete.matches==0){this.suggestionsList.style.display="none"}this.suggestionsList.innerHTML="";var t=false,r=u;t=g.call(this,r);if(!t){this.timeouts.autocomplete.matches=0;this.suggestionsList.style.display="none"}else{this.suggestionsList.style.display="block"}}function g(r){var u=false,t=this;if(r instanceof Array&&r.length){this.timeouts.autocomplete.matches=r.length;MG_Utils.appendString(this.suggestionsList,'<li class="label"><a class="label">Suggestions</a></li>');for(var s in r){MG_Utils.appendString(this.suggestionsList,'<li class="item query" data-value="'+r[s]+'"><a>'+(this.options.boldenResults==true?m.call(this,r[s]):r[s])+"</a></li>")}[].forEach.call(this.suggestionsList.querySelectorAll(".query"),function(v){MG_Utils.addEventHandler(v,"click",function(w){t.input.value=this.textContent||this.innerText;k.call(t,w)})});u=true}else{if(r.queries instanceof Array&&r.queries.length){this.timeouts.autocomplete.matches=r.queries.length;MG_Utils.appendString(this.suggestionsList,'<li class="label"><a class="label">'+this.currentType.name.capitalize()+" results</a></li>");for(var s in r.queries){if(r.queries.hasOwnProperty(s)){MG_Utils.appendString(this.suggestionsList,'<li class="item query" data-value="'+r.queries[s]+'"><a>'+(this.options.boldenResults==true?m.call(this,r.queries[s]):r.queries[s])+"</a></li>")}}[].forEach.call(this.suggestionsList.querySelectorAll(".query"),function(v){MG_Utils.addEventHandler(v,"click",function(w){t.input.value=this.textContent||this.innerText;k.call(t,w)})});u=true}if(r.pornstars instanceof Array&&r.pornstars.length){MG_Utils.appendString(this.suggestionsList,'<li class="label"><a class="label">Pornstar profiles</a></li>');for(var s in r.pornstars){if(r.pornstars.hasOwnProperty(s)){MG_Utils.appendString(this.suggestionsList,'<li class="item pornstar" data-slug="'+r.pornstars[s]["slug"]+'" data-value="'+r.pornstars[s]["name"]+'"><a>'+(this.options.boldenResults==true?m.call(this,r.pornstars[s]["name"]):r.pornstars[s]["name"])+'&nbsp;&nbsp;-&nbsp;&nbsp;<span class="rank">Rank: '+r.pornstars[s]["rank"]+"</span></a></li>")}}[].forEach.call(this.suggestionsList.querySelectorAll(".pornstar"),function(v){MG_Utils.addEventHandler(v,"click",function(){location.href="/pornstar/"+this.getAttribute("data-slug")})});u=true}if(r.channels instanceof Array&&r.channels.length){MG_Utils.appendString(this.suggestionsList,'<li class="label"><a class="label">Channels</a></li>');for(var s in r.channels){if(r.channels.hasOwnProperty(s)){MG_Utils.appendString(this.suggestionsList,'<li class="item channel" data-slug="'+r.channels[s]["slug"]+'" data-value="'+r.channels[s]["name"]+'"><a>'+(this.options.boldenResults==true?m.call(this,r.channels[s]["name"]):r.channels[s]["name"])+'&nbsp;&nbsp;-&nbsp;&nbsp;<span class="rank">Rank: '+r.channels[s]["rank"]+"</span></a></li>")}}[].forEach.call(this.suggestionsList.querySelectorAll(".channel"),function(v){MG_Utils.addEventHandler(v,"click",function(){location.href="/channels/"+this.getAttribute("data-slug")})});u=true}}return u}function m(s){var v=this.input.value,u=s.search(RegExp(""+v,"i"));if(u>=0){v=v.toLowerCase();var r=s.split(/\s|_/);for(var t=0;t<r.length;t++){r[t]=r[t].substr(0,1).toUpperCase()+(r[t].length>1?r[t].substr(1,r[t].length).toLowerCase():"")}s=r.join(" ");s=s.slice(0,u)+'<span class="soughtValue">'+v+"</span>"+s.slice(u+v.length)}return s}String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};return f}());